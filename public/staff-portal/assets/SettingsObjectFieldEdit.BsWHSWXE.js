import{N as x,a5 as U,o as W,a6 as q,T as X,a7 as z,r as f,a8 as G,a9 as H,aa as Q,i as b,ab as R,j as a,Q as Z,a as d,z as S,l as u,H as c,ac as _,ad as y,ae as K,B as s,af as $,ag as J,ah as Y,ai as V}from"./index.Dg3lKJeg.js";import{u as ee,a as te,b as ae,f as ie}from"./SettingsDataModelFieldPreviewCard.C61YjwJF.js";import{S as ne}from"./SaveAndCancelButtons.DdB8J98L.js";import{S as se}from"./SettingsPageContainer.CJeLyK8s.js";import{s as oe,S as re,F as de,a as ce,b as le}from"./settingsFieldFormSchema.CCxvyFAT.js";import{S as me}from"./SubMenuTopBarContainer.BNGFwgBo.js";import{I as pe}from"./IconArchive.Cju1PHwh.js";import{I as ue}from"./IconArchiveOff.CYcNKIbh.js";import"./mutations.DtsxS3kK.js";import"./DatabaseIdentifierMaximumLength.CM85nVoY.js";import"./workspaceMemberQueryFragment.BaSCE7Jb.js";import"./SettingsFieldTypeConfigs.DAFrDVaZ.js";import"./SettingsNonCompositeFieldTypeConfigs.CqgeJGaG.js";import"./getObjectTypeLabel.CC2ZWRUI.js";import"./IconDeviceFloppy.CaehffdS.js";import"./SettingsOptionCardContentToggle.DYPf28jM.js";import"./SettingsOptionIconCustomizer.BYkiWDDL.js";import"./SettingsOptionCardContentSelect.DFB7abf9.js";import"./SettingsObjectNewFieldSelect.DyonPEDi.js";import"./SettingsCard.EuecTdsf.js";import"./index.DYjQm0RB.js";import"./IconTextWrap.Ct51CuzD.js";import"./Breadcrumb.CQyf5Hn6.js";const xe=()=>{const l=x(),g=U(),{i18n:t,_:he}=W(),{enqueueErrorSnackBar:A}=q(),{objectNamePlural:o="",fieldName:D=""}=X(),{findObjectMetadataItemByNamePlural:O}=z(),i=O(o),{deactivateMetadataField:N,activateMetadataField:j}=ee(),[I,C]=f.useState(null),e=i==null?void 0:i.fields.find(n=>n.name===D||n.name===I),M=te(),{updateOneFieldMetadataItem:F}=ae(),m=G({mode:"onTouched",resolver:H(oe()),values:{icon:(e==null?void 0:e.icon)??"Icon",type:e==null?void 0:e.type,label:(e==null?void 0:e.label)??"",description:e==null?void 0:e.description,isLabelSyncedWithName:(e==null?void 0:e.isLabelSyncedWithName)??!0}});f.useEffect(()=>{(!i||!e)&&g(Q.NotFound)},[g,i,e]);const{isDirty:P,isValid:T,isSubmitting:h}=m.formState,k=P&&T&&!h;if(!b(i)||!b(e))return null;const L=R({fieldMetadataItem:e,objectMetadataItem:i}),E=async n=>{const{dirtyFields:v}=m.formState;C(n.name);try{if(n.type===$.RELATION&&"relation"in n&&"relation"in v){const{relationFieldMetadataItem:p}=M({fieldMetadataItem:e})??{};b(p)&&await F({objectMetadataId:i.id,fieldMetadataIdToUpdate:p.id,updatePayload:n.relation.field})}const r=J(v,"relation");if(Object.keys(r).length>0){const p=Y(ie(n),Object.keys(r));await F({objectMetadataId:i.id,fieldMetadataIdToUpdate:e.id,updatePayload:p}),l(s.ObjectDetail,{objectNamePlural:o})}}catch(r){A({apolloError:r instanceof V?r:void 0})}},B=async()=>{await N(e.id,i.id),l(s.ObjectDetail,{objectNamePlural:o})},w=async()=>{await j(e.id,i.id),l(s.ObjectDetail,{objectNamePlural:o})};return a(y,{children:a(Z,{...m,children:a(me,{title:e==null?void 0:e.label,links:[{children:t._({id:"pmUArF"}),href:S(s.Workspace)},{children:t._({id:"B3toQF"}),href:S(s.Objects)},{children:i.labelPlural,href:S(s.ObjectDetail,{objectNamePlural:o})},{children:e.label}],actionButton:a(ne,{isLoading:h,isSaveDisabled:!k,isCancelDisabled:h,onCancel:()=>l(s.ObjectDetail,{objectNamePlural:o}),onSave:m.handleSubmit(E)}),children:d(se,{children:[d(u,{children:[a(c,{title:t._({id:"XTWO+W"}),description:t._({id:"h8mvCd"})}),a(re,{fieldMetadataItem:e,maxLength:de,isCreationMode:!1})]}),e.name!==_.NoteTarget&&e.name!==_.TaskTarget&&a(y,{children:d(u,{children:[e.isUnique?a(c,{title:t._({id:"fXVIZq"}),description:t._({id:"+69KDk"})}):a(c,{title:t._({id:"fXVIZq"}),description:t._({id:"uWikAA"})}),a(ce,{fieldMetadataItem:e,objectMetadataItem:i})]})}),d(u,{children:[a(c,{title:t._({id:"Nu4oKW"}),description:t._({id:"2OUtmv"})}),a(le,{fieldMetadataItem:e})]}),!L&&d(u,{children:[a(c,{title:t._({id:"Zz6Cxn"}),description:t._({id:"gexAq8"})}),a(K,{Icon:e.isActive?pe:ue,variant:"secondary",title:e.isActive?t._({id:"5y3O+A"}):t._({id:"FQBaXG"}),size:"small",onClick:e.isActive?B:w})]})]})})})})};export{xe as SettingsObjectFieldEdit};
