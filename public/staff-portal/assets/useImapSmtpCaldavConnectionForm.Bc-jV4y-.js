import{o as G,a as l,j as r,H as K,_ as m,a4 as c,b0 as $,l as Q,n as C,aw as H,a2 as p,cv as J,N as U,R as W,cw as Y,a8 as X,a9 as Z,a6 as ee,r as I,i as V,cx as ne,h as k,B as ae}from"./index.Dg3lKJeg.js";const re=C.div`
  display: flex;
  flex-direction: column;
  gap: ${({theme:e})=>e.spacing(6)};
`,y=C.div`
  display: flex;
  flex-direction: column;
  gap: ${({theme:e})=>e.spacing(2)};
`,M=C.div`
  margin-bottom: ${({theme:e})=>e.spacing(2)};
`,L=C.h3`
  color: ${({theme:e})=>e.font.color.primary};
  font-size: ${({theme:e})=>e.font.size.md};
  font-weight: ${({theme:e})=>e.font.weight.medium};
  margin: 0;
  margin-bottom: ${({theme:e})=>e.spacing(1)};
`,T=C.p`
  color: ${({theme:e})=>e.font.color.tertiary};
  font-size: ${({theme:e})=>e.font.size.sm};
  margin: 0;
`,F=C.div`
  display: flex;
  gap: ${({theme:e})=>e.spacing(3)};

  @media (max-width: ${H}px) {
    flex-direction: column;
  }
`,f=C.div`
  flex: 1;

  & > * {
    width: 100%;
  }
`,ce=({control:e,isEditing:t})=>{const{i18n:n,_:d}=G(),v=()=>t?n._({id:"AyPkS4"}):n._({id:"7JRigF"}),b=()=>t?n._({id:"cAn7CC"}):n._({id:"OLE3Ky"}),w=a=>Number(a);return l(Q,{children:[r(K,{title:v(),description:b()}),l(re,{children:[r(c,{name:"handle",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"email-address-connection-form",label:n._({id:"hzKQCy"}),placeholder:n._({id:"wrLOeW"}),value:a.value,onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),l(y,{children:[l(M,{children:[r(L,{children:n._({id:"ijW9MW"})}),l(T,{children:[n._({id:"jbuOOX"}),r("br",{}),n._({id:"EY3IAD"})]})]}),r(c,{name:"IMAP.host",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"imap-host-connection-form",label:n._({id:"/RAwfY"}),placeholder:n._({id:"+8jOVa"}),value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),r(c,{name:"IMAP.password",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"imap-password-connection-form",label:n._({id:"Ubs0tf"}),placeholder:n._({id:"CwstSL"}),type:"password",value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),l(F,{children:[r(f,{children:r(c,{name:"IMAP.port",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"imap-port-connection-form",label:n._({id:"TE8s2c"}),type:"number",placeholder:"993",value:a!=null&&a.value?a.value:993,onChange:S=>a.onChange(w(S)),error:(o=s.error)==null?void 0:o.message})}})}),r(f,{children:r(c,{name:"IMAP.secure",control:e,render:({field:a})=>r($,{label:n._({id:"N+Oh7x"}),options:[{label:"SSL/TLS",value:!0},{label:"None",value:!1}],value:a.value,onChange:a.onChange,dropdownId:"imap-secure-dropdown"})})})]})]}),l(y,{children:[l(M,{children:[r(L,{children:n._({id:"w+rJId"})}),l(T,{children:[n._({id:"gk/8eh"}),r("br",{}),n._({id:"O7a3Du"})]})]}),r(c,{name:"SMTP.host",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"smtp-host-connection-form",label:n._({id:"oKqFNn"}),placeholder:n._({id:"4oakKm"}),value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),r(c,{name:"SMTP.password",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"smtp-password-connection-form",label:n._({id:"UeDEV/"}),placeholder:n._({id:"CwstSL"}),type:"password",value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),l(F,{children:[r(f,{children:r(c,{name:"SMTP.port",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"smtp-port-connection-form",label:n._({id:"4waP7/"}),type:"number",placeholder:"587",value:a!=null&&a.value?a.value:587,onChange:S=>a.onChange(w(S)),error:(o=s.error)==null?void 0:o.message})}})}),r(f,{children:r(c,{name:"SMTP.secure",control:e,render:({field:a})=>r($,{label:n._({id:"0sIQAM"}),options:[{label:"SSL/TLS",value:!0},{label:"STARTTLS",value:!1}],value:a.value,onChange:a.onChange,dropdownId:"smtp-secure-dropdown"})})})]})]}),l(y,{children:[l(M,{children:[r(L,{children:n._({id:"GixROH"})}),l(T,{children:[n._({id:"6MDr1S"}),r("br",{}),n._({id:"8QyoLb"})]})]}),r(c,{name:"CALDAV.host",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"caldav-host-connection-form",label:n._({id:"JUGLyW"}),placeholder:n._({id:"+x0fpb"}),value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),r(c,{name:"CALDAV.username",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"caldav-username-connection-form",label:n._({id:"kGKOiW"}),placeholder:n._({id:"C5FAaq"}),required:!1,value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}}),r(c,{name:"CALDAV.password",control:e,render:({field:a,fieldState:s})=>{var o;return r(m,{instanceId:"caldav-password-connection-form",label:n._({id:"4dwQbl"}),placeholder:n._({id:"CwstSL"}),type:"password",value:a.value||"",onChange:a.onChange,error:(o=s.error)==null?void 0:o.message})}})]})]})]})},j=["IMAP","SMTP","CALDAV"],x=p.object({host:p.string().default(""),port:p.number().int().nullable().default(null),username:p.string().optional(),password:p.string().default(""),secure:p.boolean().default(!0)}).refine(e=>{var t,n;return(t=e.host)!=null&&t.trim()&&((n=e.password)!=null&&n.trim())?e.port&&e.port>0:!0},{message:"Port must be a positive number when configuring this protocol",path:["port"]}),oe=p.object({handle:p.string().email("Invalid email address"),IMAP:x.optional(),SMTP:x.optional(),CALDAV:x.optional()}).refine(e=>j.some(t=>B(e[t])),{message:"At least one account type (IMAP, SMTP, or CalDAV) must be completely configured",path:["handle"]}),B=e=>{var t,n;return!!((t=e==null?void 0:e.host)!=null&&t.trim()&&((n=e==null?void 0:e.password)!=null&&n.trim()))},se=(e,t)=>{const{data:n,loading:d,error:v}=J({variables:{id:e??""},skip:!e,onCompleted:b=>{t==null||t(b.getConnectedImapSmtpCaldavAccount)}});return{connectedAccount:n==null?void 0:n.getConnectedImapSmtpCaldavAccount,loading:d,error:v}},de=({isEditing:e=!1,connectedAccountId:t}={})=>{const n=U(),d=W(Y),v=X({mode:"onSubmit",resolver:Z(oe),defaultValues:{handle:"",IMAP:{host:"",port:993,password:"",secure:!0},SMTP:{host:"",port:587,password:"",secure:!0},CALDAV:{host:"",port:443,password:"",secure:!0,username:void 0}}}),{handleSubmit:b,formState:w,watch:a,reset:s}=v,{enqueueErrorSnackBar:o,enqueueSuccessSnackBar:S}=ee(),{isSubmitting:D}=w,{connectedAccount:R,loading:z}=se(e?t:void 0,I.useCallback(i=>{var g,h,u;V(i)&&s({handle:i.handle||"",IMAP:((g=i.connectionParameters)==null?void 0:g.IMAP)||void 0,SMTP:((h=i.connectionParameters)==null?void 0:h.SMTP)||void 0,CALDAV:((u=i.connectionParameters)==null?void 0:u.CALDAV)||void 0})},[s])),[O,{loading:N}]=ne(),_=a(),A=I.useCallback((i=_)=>j.filter(g=>{const h=i[g];return h&&B(h)}),[_]),E=I.useMemo(()=>{var i;return!!((i=_.handle)!=null&&i.trim())&&A().length>0},[A,_.handle]),q=I.useCallback(async i=>{if(!(d!=null&&d.id))throw new Error("Workspace member ID is missing");const g=A(i);if(g.length===0)throw new Error("At least one protocol must be configured");const h={};g.forEach(u=>{const P=i[u];V(P)&&(h[u]=P)});try{await O({variables:{...e&&t?{id:t}:{},accountOwnerId:d.id,handle:i.handle,connectionParameters:h}});const u=e?k._({id:"aJTn2g"}):k._({id:"f6bbrz"});S({message:u}),n(ae.Accounts)}catch(u){const P=u instanceof Error?u.message:"An unexpected error occurred";o({message:P})}},[d==null?void 0:d.id,A,O,e,t,S,n,o]);return{formMethods:v,handleSave:q,handleSubmit:b,canSave:E&&!D,isSubmitting:D,loading:z||N,connectedAccount:R}};export{ce as S,de as u};
