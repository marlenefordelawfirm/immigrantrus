import{p as F,j as n,e_ as R,e$ as B,f0 as v,ao as D,bT as E,bW as C,f1 as G,b7 as x,dN as I,dR as P,dO as h,i as w,ap as U,a as b,dS as z,dT as K,ad as L,n as W,dU as X,f2 as A,f3 as c,f4 as _,a_ as M,bb as k,dQ as V,r as q,f5 as $,f6 as j,f7 as H,f8 as Q}from"./index.Dg3lKJeg.js";import{E as Y,d as J,C as g,S as Z,b as ee,c as oe}from"./WorkflowDiagramStepNodeIcon.CqIy9G-o.js";import{B as te,g as y,E as re,a as ne,R as ae}from"./style.BQlYoUOS.js";import{W as se}from"./WorkflowDiagramStepNodeReadonly.DDcoJTVF.js";import"./index.C2saR20x.js";import"./string.DY8YL-MQ.js";const T=e=>`url(#${e})`,le=e=>e===R.SUCCESS?J:v,ie=e=>e===R.SUCCESS?Y:B,ue=({theme:e,edgeExecutionStatus:t})=>t===R.SUCCESS?e.tag.text.turquoise:e.border.color.strong,N=({edgePath:e,edgeExecutionStatus:t})=>{const o=F();return n(te,{markerStart:T(le(t)),markerEnd:T(ie(t)),path:e,style:{stroke:ue({theme:o,edgeExecutionStatus:t})}})},we=({sourceY:e,targetY:t,data:o})=>{const[r]=y({sourceX:g,sourceY:e,targetX:g,targetY:t});return n(N,{edgePath:r,edgeExecutionStatus:o==null?void 0:o.edgeExecutionStatus})},de=()=>{const{getIcon:e}=D(),t=E(C),o=E(G),r=x(I),u=x(P),{openWorkflowRunViewStepInCommandMenu:l}=h();return{openWorkflowRunFilterInCommandMenu:({stepId:i,stepName:f,stepExecutionStatus:p})=>{if(!w(t))throw new Error("Workflow ID is required");if(!w(o))throw new Error("Workflow run ID is required");r(i),u(a=>{if(!w(a))throw new Error("Workflow diagram must be defined");return{...a,nodes:a.nodes.map(m=>({...m,selected:!1}))}}),l({workflowId:t,workflowRunId:o,title:f,icon:e(U("FILTER")),workflowSelectedNode:i,stepExecutionStatus:p})}}},ce=e=>{if((e==null?void 0:e.edgeType)!=="filter")throw new Error('Edge data must be of type "filter"')},fe=W(X)`
  pointer-events: all;
`,me=W.div`
  height: 26px;
  width: 26px;
`,ke=({sourceY:e,targetY:t,data:o})=>{ce(o);const[r,u,l]=y({sourceX:g,sourceY:e,targetX:g,targetY:t}),{openWorkflowRunFilterInCommandMenu:d}=de(),i=()=>{if(!w(o.runStatus))throw new Error("Run status must be set on edge data for workflow runs");d({stepId:o.stepId,stepName:o.name,stepExecutionStatus:o.runStatus})};return b(L,{children:[n(N,{edgePath:r,edgeExecutionStatus:o.edgeExecutionStatus}),n(re,{children:n(Z,{"data-click-outside-id":z,labelX:u,labelY:l,children:n(ee,{shouldDisplay:!0,children:n(me,{children:n(fe,{className:"nodrag nopan",iconButtons:[{Icon:K,onClick:i}]})})})})})]})},ge=({sourceY:e,targetY:t,data:o})=>{const[r]=y({sourceX:g,sourceY:e,targetX:g,targetY:t});return n(N,{edgePath:r,edgeExecutionStatus:o==null?void 0:o.edgeExecutionStatus})},Se=()=>{const{getIcon:e}=D(),{openWorkflowRunViewStepInCommandMenu:t}=h(),o=A(),r=c(C),u=c(_),l=c(I),d=M(({snapshot:i,set:f})=>({nodes:p})=>{const a=k(i,r);if(!w(a))throw new Error("Expected the workflowId to be defined.");if(k(i,u)!=="done")return;const S=p[0];if(!w(S))return;f(l,S.id);const s=S.data;t({workflowId:a,workflowRunId:o,title:s.name,icon:e(V(s)),workflowSelectedNode:S.id,stepExecutionStatus:s.runStatus})},[r,u,l,t,o,e]);return ne({onChange:d}),null},pe=()=>{const{getIcon:e}=D(),{openWorkflowRunViewStepInCommandMenu:t}=h(),{isInRightDrawer:o}=q.useContext($),r=A(),u=c(C),l=c(_),d=c(j),i=c(I),f=c(H);return{handleWorkflowRunDiagramCanvasInit:M(({snapshot:a,set:m})=>()=>{if(k(a,l)!=="computing-dimensions")throw new Error("Sequence error: reactflow should be considered initialized only when the workflow diagram status is computing-dimensions.");if(m(l,"done"),o)return;const s=k(a,d);if(w(s)){const O=k(a,u);if(!w(O))throw new Error("The workflow id must be set; ensure the workflow id is always set before rendering the workflow diagram.");m(i,s.id),k(a,f).includes(s.id)||t({workflowId:O,workflowRunId:r,title:s.data.name,icon:e(V(s.data)),workflowSelectedNode:s.id,stepExecutionStatus:s.data.runStatus}),m(d,void 0)}},[l,o,d,u,i,f,t,r,e])}},Ee=({workflowRunStatus:e})=>e==="NOT_STARTED"?{color:"gray",text:"Not started"}:e==="RUNNING"?{color:"yellow",text:"Running"}:e==="COMPLETED"?{color:"green",text:"Completed"}:e==="ENQUEUED"?{color:"blue",text:"Enqueued"}:{color:"red",text:"Failed"},Re=({workflowRunStatus:e})=>{const t=Ee({workflowRunStatus:e}),{handleWorkflowRunDiagramCanvasInit:o}=pe();return b(ae,{children:[n(oe,{nodeTypes:{default:se},edgeTypes:{"filtering-disabled--run":ge,"empty-filter--run":we,"filter--run":ke},tagContainerTestId:"workflow-run-status",tagColor:t.color,tagText:t.text,onInit:o}),n(Se,{})]})},De=W.div`
  height: 100%;
`,xe=({workflowRunId:e})=>{const t=Q({workflowRunId:e}),o=E(_);return!w(t)||o==="computing-diagram"?null:n(De,{children:n(Re,{workflowRunStatus:t.status})})};export{xe as WorkflowRunVisualizer};
