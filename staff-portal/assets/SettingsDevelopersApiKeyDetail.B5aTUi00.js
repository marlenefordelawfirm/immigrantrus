import{p as Q,o as Y,a6 as Z,a as r,j as i,_ as T,b1 as R,ae as C,n as h,ch as J,r as A,bB as X,i as E,D as S,bv as U,N as ee,T as te,R as ie,a_ as ne,aY as se,aZ as ae,ci as oe,cj as re,z as $,l as x,ad as b,H as g,bx as ce,B as k,Z as G,by as B,d as j}from"./index.Dg3lKJeg.js";import{S as de}from"./SettingsPageContainer.CJeLyK8s.js";import{a as z}from"./apiKeyTokenFamilyState.Vlc66NL9.js";import{f as L}from"./formatExpiration.BUfIxfgs.js";import{S as le}from"./SubMenuTopBarContainer.BNGFwgBo.js";import{I as ue}from"./IconRepeat.DPq6O9un.js";import"./NeverExpireDeltaInYears.BAM5Jy2K.js";import"./Breadcrumb.CQyf5Hn6.js";const pe=h.div`
  display: flex;
  flex-direction: row;
`,fe=h.div`
  flex: 1;
  margin-right: ${({theme:e})=>e.spacing(2)};
`,me=({apiKey:e})=>{const l=Q(),{i18n:o,_:s}=Y(),{enqueueSuccessSnackBar:c}=Z();return r(pe,{children:[i(fe,{children:i(T,{instanceId:"api-key-display",value:e,fullWidth:!0})}),i(C,{Icon:R,title:o._({id:"he3ygx"}),onClick:()=>{c({message:o._({id:"r+NRG6"}),options:{icon:i(R,{size:l.icon.size.md}),duration:2e3}}),navigator.clipboard.writeText(e)}})]})},_e=h.div`
  display: flex;
  flex-direction: row;
  > * + * {
    margin-left: ${({theme:e})=>e.spacing(4)};
  }
`,ge=({apiKeyName:e,apiKeyId:l,disabled:o,onNameUpdate:s})=>{const[c]=J(),d=A.useCallback(X(async m=>{if(E(s)&&s(e),!e)return;const{data:u}=await c({variables:{input:{id:l,name:m}}}),I=u==null?void 0:u.updateApiKey;E(I)&&(s==null||s(I.name))},500),[c,s]);A.useEffect(()=>(d(e),d.cancel),[d,e]);const y=`${l}-name`;return i(_e,{children:i(T,{instanceId:y,placeholder:"E.g. backoffice integration",onChange:s,fullWidth:!0,value:e,disabled:o})})},he=(e,l)=>{if(!e)return null;const o=S.fromISO(e).diff(S.fromISO(l),["days"]).days;return S.utc().plus({days:o}).toISO()},ye=h.span`
  color: ${({theme:e})=>e.font.color.light};
  font-size: ${({theme:e})=>e.font.size.sm};
  font-weight: ${({theme:e})=>e.font.weight.regular};
`,Ie=h.div`
  align-items: center;
  display: flex;
  flex-direction: row;
  gap: ${({theme:e})=>e.spacing(2)};
  width: 100%;
`,W="delete-api-key-modal",O="regenerate-api-key-modal",Te=()=>{const{i18n:e,_:l}=Y(),{enqueueErrorSnackBar:o}=Z(),{openModal:s}=U(),[c,d]=A.useState(!1),y=ee(),{apiKeyId:m=""}=te(),u=ie(z(m)),I=ne(({set:n})=>(a,_)=>{n(z(a),_)},[]),[q]=se(),[F]=ae(),[K]=oe(),{data:v}=re({variables:{input:{id:m}},onCompleted:n=>{E(n==null?void 0:n.apiKey)&&D(n.apiKey.name)}}),t=v==null?void 0:v.apiKey,[w,D]=A.useState(""),M=async(n=!0)=>{d(!0);try{await K({variables:{input:{id:m}}}),n&&y(k.APIs)}catch{o({message:e._({id:"GHKxvg"})})}finally{d(!1)}},H=async(n,a)=>{var P;const{data:_}=await F({variables:{input:{name:n,expiresAt:a??""}}}),f=_==null?void 0:_.createApiKey;if(!f)return;const N=await q({variables:{apiKeyId:f.id,expiresAt:f==null?void 0:f.expiresAt}});return{id:f.id,token:(P=N.data)==null?void 0:P.generateApiKeyToken.token}},V=async()=>{d(!0);try{if(j.isNonEmptyString(t==null?void 0:t.name)){const n=he(t==null?void 0:t.expiresAt,t==null?void 0:t.createdAt),a=await H(t==null?void 0:t.name,n);await M(!1),j.isNonEmptyString(a==null?void 0:a.token)&&(I(a.id,a.token),y(k.ApiKeyDetail,{apiKeyId:a.id}))}}catch{o({message:e._({id:"PfAip2"})})}finally{d(!1)}},p=e._({id:"3d1wCB"});return r(b,{children:[(t==null?void 0:t.name)&&i(le,{title:t==null?void 0:t.name,links:[{children:e._({id:"pmUArF"}),href:$(k.Workspace)},{children:e._({id:"JR6nY7"}),href:$(k.APIs)},{children:e._({id:"z5EvY5",values:{apiKeyName:w}})}],children:r(de,{children:[i(x,{children:u?r(b,{children:[i(g,{title:e._({id:"yRnk5W"}),description:e._({id:"Ej5euX"})}),i(me,{apiKey:u})]}):r(b,{children:[i(g,{title:e._({id:"yRnk5W"}),description:e._({id:"vpZcGd"})}),r(Ie,{children:[i(C,{title:e._({id:"D+Mv78"}),Icon:ue,onClick:()=>s(O)}),i(ye,{children:L((t==null?void 0:t.expiresAt)||"",!0,!1)})]})]})}),r(x,{children:[i(g,{title:e._({id:"6YtxFj"}),description:e._({id:"z+6jaZ"})}),i(ge,{apiKeyName:w,apiKeyId:t==null?void 0:t.id,disabled:c,onNameUpdate:D})]}),r(x,{children:[i(g,{title:e._({id:"LxRNPw"}),description:e._({id:"leUubq"})}),i(T,{instanceId:`api-key-expiration-${t==null?void 0:t.id}`,placeholder:e._({id:"QVVmxi"}),value:L((t==null?void 0:t.expiresAt)||"",!0,!1),disabled:!0,fullWidth:!0})]}),r(x,{children:[i(g,{title:e._({id:"Zz6Cxn"}),description:e._({id:"T6S2Ns"})}),i(C,{accent:"danger",variant:"secondary",title:e._({id:"cnGeoo"}),Icon:ce,onClick:()=>s(W)})]})]})}),i(B,{confirmationPlaceholder:p,confirmationValue:p,modalId:W,title:e._({id:"hGfWDm"}),subtitle:i(G,{id:"6nsIo3",values:{confirmationValue:p}}),onConfirmClick:M,confirmButtonText:e._({id:"cnGeoo"}),loading:c}),i(B,{confirmationPlaceholder:p,confirmationValue:p,modalId:O,title:e._({id:"vpZcGd"}),subtitle:i(G,{id:"j843N3",values:{confirmationValue:p}}),onConfirmClick:V,confirmButtonText:e._({id:"Mwqo5m"}),loading:c})]})};export{Te as SettingsDevelopersApiKeyDetail};
