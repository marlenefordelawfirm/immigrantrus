const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.C06_t6vS.js","assets/decode.BDRbQOCM.js","assets/index.CWtGfzcb.js","assets/default.Cl3hj7Sz.js","assets/index.bsVAaBS1.js","assets/index.D22iV9cu.js","assets/index.D13MPiJ5.js","assets/index.C2o2j-tx.js","assets/index.c2V3InAJ.js","assets/index.D4Wp6AEg.js","assets/index.CjrT3HcA.js","assets/index.Dg3lKJeg.js","assets/index.DMD_3Uv7.css","assets/index.D1r_Q0JC.js","assets/index.BtpttBoU.js","assets/index.BY3x9OSE.js","assets/index.BUCFnM-n.js","assets/index.DEehm0bc.js","assets/index.COYepv-L.js","assets/index.Wb4bzIyB.js","assets/index.BVeNH5zi.js","assets/index.1zKQqHhf.js","assets/syntax.Dh_7PnPp.js","assets/index.DOWyBKr8.js","assets/index.ByI_odx6.js","assets/index.DdCAsX36.js","assets/index.DWHkiPoB.js","assets/index.dom.C3-224fz.js","assets/index.D55_0Pbk.js","assets/index.FLUkLUsW.js","assets/index.Dq2i-IQA.js","assets/index.CS-76Dhj.js","assets/index.E0wwlW8h.js"])))=>i.map(i=>d[i]);
import{hH as xt,hI as Xa,hJ as Ju,hK as Qa,hL as Za,hM as tc,hN as yi,hO as $o,hP as G,hQ as R,hR as O,hS as I,hT as B,hU as vi,hV as ec,hW as Be,hX as Yu,hY as Xu,hZ as K,h_ as Lo,h$ as Qu,i0 as El,i1 as Zu,i2 as th,i3 as eh,i4 as nh,i5 as oh,i6 as nc,i7 as rh,i8 as sh,i9 as ih,ia as lh,ib as ah,ic as ch,id as dh,ie as oc,ig as uh,ih as hh,ii as fh,ij as ph,ik as mh,il as gh,im as bh,io as rc,ip as tt,iq as it,ir as wh,is as sc,it as kh,iu as ic,iv as lc,iw as yh,aF as Tt,ix as vh}from"./index.Dg3lKJeg.js";function Ir(e){const{state:t,transaction:n}=e;let{selection:o}=n,{doc:r}=n,{storedMarks:s}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return s},get selection(){return o},get doc(){return r},get tr(){return o=n.selection,r=n.doc,s=n.storedMarks,n}}}class Pr{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:n,state:o}=this,{view:r}=n,{tr:s}=o,i=this.buildProps(s);return Object.fromEntries(Object.entries(t).map(([l,a])=>[l,(...d)=>{const u=a(...d)(i);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,n=!0){const{rawCommands:o,editor:r,state:s}=this,{view:i}=r,l=[],a=!!t,c=t||s.tr,d=()=>(!a&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(c),l.every(h=>h===!0)),u={...Object.fromEntries(Object.entries(o).map(([h,f])=>[h,(...m)=>{const g=this.buildProps(c,n),b=f(...m)(g);return l.push(b),u}])),run:d};return u}createCan(t){const{rawCommands:n,state:o}=this,r=!1,s=t||o.tr,i=this.buildProps(s,r);return{...Object.fromEntries(Object.entries(n).map(([a,c])=>[a,(...d)=>c(...d)({...i,dispatch:void 0})])),chain:()=>this.createChain(s,r)}}buildProps(t,n=!0){const{rawCommands:o,editor:r,state:s}=this,{view:i}=r,l={tr:t,editor:r,view:i,state:Ir({state:s,transaction:t}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(t,n),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(o).map(([a,c])=>[a,(...d)=>c(...d)(l)]))}};return l}}class Ch{constructor(){this.callbacks={}}on(t,n){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(n),this}emit(t,...n){const o=this.callbacks[t];return o&&o.forEach(r=>r.apply(this,n)),this}off(t,n){const o=this.callbacks[t];return o&&(n?this.callbacks[t]=o.filter(r=>r!==n):delete this.callbacks[t]),this}once(t,n){const o=(...r)=>{this.off(t,o),n.apply(this,r)};return this.on(t,o)}removeAllListeners(){this.callbacks={}}}function S(e,t,n){return e.config[t]===void 0&&e.parent?S(e.parent,t,n):typeof e.config[t]=="function"?e.config[t].bind({...n,parent:e.parent?S(e.parent,t,n):null}):e.config[t]}function Or(e){const t=e.filter(r=>r.type==="extension"),n=e.filter(r=>r.type==="node"),o=e.filter(r=>r.type==="mark");return{baseExtensions:t,nodeExtensions:n,markExtensions:o}}function ac(e){const t=[],{nodeExtensions:n,markExtensions:o}=Or(e),r=[...n,...o],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach(i=>{const l={name:i.name,options:i.options,storage:i.storage,extensions:r},a=S(i,"addGlobalAttributes",l);if(!a)return;a().forEach(d=>{d.types.forEach(u=>{Object.entries(d.attributes).forEach(([h,f])=>{t.push({type:u,name:h,attribute:{...s,...f}})})})})}),r.forEach(i=>{const l={name:i.name,options:i.options,storage:i.storage},a=S(i,"addAttributes",l);if(!a)return;const c=a();Object.entries(c).forEach(([d,u])=>{const h={...s,...u};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,t.push({type:i.name,name:d,attribute:h})})}),t}function nt(e,t){if(typeof e=="string"){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function Ct(...e){return e.filter(t=>!!t).reduce((t,n)=>{const o={...t};return Object.entries(n).forEach(([r,s])=>{if(!o[r]){o[r]=s;return}if(r==="class"){const l=s?String(s).split(" "):[],a=o[r]?o[r].split(" "):[],c=l.filter(d=>!a.includes(d));o[r]=[...a,...c].join(" ")}else if(r==="style"){const l=s?s.split(";").map(d=>d.trim()).filter(Boolean):[],a=o[r]?o[r].split(";").map(d=>d.trim()).filter(Boolean):[],c=new Map;a.forEach(d=>{const[u,h]=d.split(":").map(f=>f.trim());c.set(u,h)}),l.forEach(d=>{const[u,h]=d.split(":").map(f=>f.trim());c.set(u,h)}),o[r]=Array.from(c.entries()).map(([d,u])=>`${d}: ${u}`).join("; ")}else o[r]=s}),o},{})}function Ls(e,t){return t.filter(n=>n.type===e.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(e.attrs)||{}:{[n.name]:e.attrs[n.name]}).reduce((n,o)=>Ct(n,o),{})}function cc(e){return typeof e=="function"}function P(e,t=void 0,...n){return cc(e)?t?e.bind(t)(...n):e(...n):e}function Sh(e={}){return Object.keys(e).length===0&&e.constructor===Object}function Eh(e){return typeof e!="string"?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):e==="true"?!0:e==="false"?!1:e}function xl(e,t){return"style"in e?e:{...e,getAttrs:n=>{const o=e.getAttrs?e.getAttrs(n):e.attrs;if(o===!1)return!1;const r=t.reduce((s,i)=>{const l=i.attribute.parseHTML?i.attribute.parseHTML(n):Eh(n.getAttribute(i.name));return l==null?s:{...s,[i.name]:l}},{});return{...o,...r}}}}function Al(e){return Object.fromEntries(Object.entries(e).filter(([t,n])=>t==="attrs"&&Sh(n)?!1:n!=null))}function dc(e,t){var n;const o=ac(e),{nodeExtensions:r,markExtensions:s}=Or(e),i=(n=r.find(c=>S(c,"topNode")))===null||n===void 0?void 0:n.name,l=Object.fromEntries(r.map(c=>{const d=o.filter(b=>b.type===c.name),u={name:c.name,options:c.options,storage:c.storage,editor:t},h=e.reduce((b,k)=>{const v=S(k,"extendNodeSchema",u);return{...b,...v?v(c):{}}},{}),f=Al({...h,content:P(S(c,"content",u)),marks:P(S(c,"marks",u)),group:P(S(c,"group",u)),inline:P(S(c,"inline",u)),atom:P(S(c,"atom",u)),selectable:P(S(c,"selectable",u)),draggable:P(S(c,"draggable",u)),code:P(S(c,"code",u)),whitespace:P(S(c,"whitespace",u)),linebreakReplacement:P(S(c,"linebreakReplacement",u)),defining:P(S(c,"defining",u)),isolating:P(S(c,"isolating",u)),attrs:Object.fromEntries(d.map(b=>{var k;return[b.name,{default:(k=b==null?void 0:b.attribute)===null||k===void 0?void 0:k.default}]}))}),p=P(S(c,"parseHTML",u));p&&(f.parseDOM=p.map(b=>xl(b,d)));const m=S(c,"renderHTML",u);m&&(f.toDOM=b=>m({node:b,HTMLAttributes:Ls(b,d)}));const g=S(c,"renderText",u);return g&&(f.toText=g),[c.name,f]})),a=Object.fromEntries(s.map(c=>{const d=o.filter(g=>g.type===c.name),u={name:c.name,options:c.options,storage:c.storage,editor:t},h=e.reduce((g,b)=>{const k=S(b,"extendMarkSchema",u);return{...g,...k?k(c):{}}},{}),f=Al({...h,inclusive:P(S(c,"inclusive",u)),excludes:P(S(c,"excludes",u)),group:P(S(c,"group",u)),spanning:P(S(c,"spanning",u)),code:P(S(c,"code",u)),attrs:Object.fromEntries(d.map(g=>{var b;return[g.name,{default:(b=g==null?void 0:g.attribute)===null||b===void 0?void 0:b.default}]}))}),p=P(S(c,"parseHTML",u));p&&(f.parseDOM=p.map(g=>xl(g,d)));const m=S(c,"renderHTML",u);return m&&(f.toDOM=g=>m({mark:g,HTMLAttributes:Ls(g,d)})),[c.name,f]}));return new Qa({topNode:i,nodes:l,marks:a})}function rs(e,t){return t.nodes[e]||t.marks[e]||null}function Ml(e,t){return Array.isArray(t)?t.some(n=>(typeof n=="string"?n:n.name)===e.name):t}function Ci(e,t){const n=vi.fromSchema(t).serializeFragment(e),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}const xh=(e,t=500)=>{let n="";const o=e.parentOffset;return e.parent.nodesBetween(Math.max(0,o-t),o,(r,s,i,l)=>{var a,c;const d=((c=(a=r.type.spec).toText)===null||c===void 0?void 0:c.call(a,{node:r,pos:s,parent:i,index:l}))||r.textContent||"%leaf%";n+=r.isAtom&&!r.isText?d:d.slice(0,Math.max(0,o-s))}),n};function Si(e){return Object.prototype.toString.call(e)==="[object RegExp]"}class be{constructor(t){this.find=t.find,this.handler=t.handler}}const Ah=(e,t)=>{if(Si(t))return t.exec(e);const n=t(e);if(!n)return null;const o=[n.text];return o.index=n.index,o.input=e,o.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),o.push(n.replaceWith)),o};function uo(e){var t;const{editor:n,from:o,to:r,text:s,rules:i,plugin:l}=e,{view:a}=n;if(a.composing)return!1;const c=a.state.doc.resolve(o);if(c.parent.type.spec.code||!((t=c.nodeBefore||c.nodeAfter)===null||t===void 0)&&t.marks.find(h=>h.type.spec.code))return!1;let d=!1;const u=xh(c)+s;return i.forEach(h=>{if(d)return;const f=Ah(u,h.find);if(!f)return;const p=a.state.tr,m=Ir({state:a.state,transaction:p}),g={from:o-(f[0].length-s.length),to:r},{commands:b,chain:k,can:v}=new Pr({editor:n,state:m});h.handler({state:m,range:g,match:f,commands:b,chain:k,can:v})===null||!p.steps.length||(p.setMeta(l,{transform:p,from:o,to:r,text:s}),a.dispatch(p),d=!0)}),d}function Mh(e){const{editor:t,rules:n}=e,o=new O({state:{init(){return null},apply(r,s,i){const l=r.getMeta(o);if(l)return l;const a=r.getMeta("applyInputRules");return!!a&&setTimeout(()=>{let{text:d}=a;typeof d=="string"?d=d:d=Ci(I.from(d),i.schema);const{from:u}=a,h=u+d.length;uo({editor:t,from:u,to:h,text:d,rules:n,plugin:o})}),r.selectionSet||r.docChanged?null:s}},props:{handleTextInput(r,s,i,l){return uo({editor:t,from:s,to:i,text:l,rules:n,plugin:o})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{const{$cursor:s}=r.state.selection;s&&uo({editor:t,from:s.pos,to:s.pos,text:"",rules:n,plugin:o})}),!1)},handleKeyDown(r,s){if(s.key!=="Enter")return!1;const{$cursor:i}=r.state.selection;return i?uo({editor:t,from:i.pos,to:i.pos,text:`
`,rules:n,plugin:o}):!1}},isInputRules:!0});return o}function Th(e){return Object.prototype.toString.call(e).slice(8,-1)}function ho(e){return Th(e)!=="Object"?!1:e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Br(e,t){const n={...e};return ho(e)&&ho(t)&&Object.keys(t).forEach(o=>{ho(t[o])&&ho(e[o])?n[o]=Br(e[o],t[o]):n[o]=t[o]}),n}class lt{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=P(S(this,"addOptions",{name:this.name}))),this.storage=P(S(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new lt(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>Br(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new lt(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=P(S(n,"addOptions",{name:n.name})),n.storage=P(S(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:t,mark:n}){const{tr:o}=t.state,r=t.state.selection.$from;if(r.pos===r.end()){const i=r.marks();if(!!!i.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const a=i.find(c=>(c==null?void 0:c.type.name)===n.name);return a&&o.removeStoredMark(a),o.insertText(" ",r.pos),t.view.dispatch(o),!0}return!1}}function _h(e){return typeof e=="number"}class Lh{constructor(t){this.find=t.find,this.handler=t.handler}}const Ih=(e,t,n)=>{if(Si(t))return[...e.matchAll(t)];const o=t(e,n);return o?o.map(r=>{const s=[r.text];return s.index=r.index,s.input=e,s.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),s.push(r.replaceWith)),s}):[]};function Ph(e){const{editor:t,state:n,from:o,to:r,rule:s,pasteEvent:i,dropEvent:l}=e,{commands:a,chain:c,can:d}=new Pr({editor:t,state:n}),u=[];return n.doc.nodesBetween(o,r,(f,p)=>{if(!f.isTextblock||f.type.spec.code)return;const m=Math.max(o,p),g=Math.min(r,p+f.content.size),b=f.textBetween(m-p,g-p,void 0,"￼");Ih(b,s.find,i).forEach(v=>{if(v.index===void 0)return;const x=m+v.index+1,C=x+v[0].length,M={from:n.tr.mapping.map(x),to:n.tr.mapping.map(C)},E=s.handler({state:n,range:M,match:v,commands:a,chain:c,can:d,pasteEvent:i,dropEvent:l});u.push(E)})}),u.every(f=>f!==null)}let fo=null;const Oh=e=>{var t;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=n.clipboardData)===null||t===void 0||t.setData("text/html",e),n};function Bh(e){const{editor:t,rules:n}=e;let o=null,r=!1,s=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,l;try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}const a=({state:d,from:u,to:h,rule:f,pasteEvt:p})=>{const m=d.tr,g=Ir({state:d,transaction:m});if(!(!Ph({editor:t,state:g,from:Math.max(u-1,0),to:h.b-1,rule:f,pasteEvent:p,dropEvent:l})||!m.steps.length)){try{l=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{l=null}return i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(d=>new O({view(u){const h=p=>{var m;o=!((m=u.dom.parentElement)===null||m===void 0)&&m.contains(p.target)?u.dom.parentElement:null,o&&(fo=t)},f=()=>{fo&&(fo=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(u,h)=>{if(s=o===u.dom.parentElement,l=h,!s){const f=fo;f&&setTimeout(()=>{const p=f.state.selection;p&&f.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(u,h)=>{var f;const p=(f=h.clipboardData)===null||f===void 0?void 0:f.getData("text/html");return i=h,r=!!(p!=null&&p.includes("data-pm-slice")),!1}}},appendTransaction:(u,h,f)=>{const p=u[0],m=p.getMeta("uiEvent")==="paste"&&!r,g=p.getMeta("uiEvent")==="drop"&&!s,b=p.getMeta("applyPasteRules"),k=!!b;if(!m&&!g&&!k)return;if(k){let{text:C}=b;typeof C=="string"?C=C:C=Ci(I.from(C),f.schema);const{from:M}=b,E=M+C.length,A=Oh(C);return a({rule:d,state:f,from:M,to:{b:E},pasteEvt:A})}const v=h.doc.content.findDiffStart(f.doc.content),x=h.doc.content.findDiffEnd(f.doc.content);if(!(!_h(v)||!x||v===x.b))return a({rule:d,state:f,from:v,to:x,pasteEvt:i})}}))}function Dh(e){const t=e.filter((n,o)=>e.indexOf(n)!==o);return Array.from(new Set(t))}class Pe{constructor(t,n){this.splittableMarks=[],this.editor=n,this.extensions=Pe.resolve(t),this.schema=dc(this.extensions,n),this.setupExtensions()}static resolve(t){const n=Pe.sort(Pe.flatten(t)),o=Dh(n.map(r=>r.name));return o.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${o.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),n}static flatten(t){return t.map(n=>{const o={name:n.name,options:n.options,storage:n.storage},r=S(n,"addExtensions",o);return r?[n,...this.flatten(r())]:n}).flat(10)}static sort(t){return t.sort((o,r)=>{const s=S(o,"priority")||100,i=S(r,"priority")||100;return s>i?-1:s<i?1:0})}get commands(){return this.extensions.reduce((t,n)=>{const o={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:rs(n.name,this.schema)},r=S(n,"addCommands",o);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this,n=Pe.sort([...this.extensions].reverse()),o=[],r=[],s=n.map(i=>{const l={name:i.name,options:i.options,storage:i.storage,editor:t,type:rs(i.name,this.schema)},a=[],c=S(i,"addKeyboardShortcuts",l);let d={};if(i.type==="mark"&&S(i,"exitable",l)&&(d.ArrowRight=()=>lt.handleExit({editor:t,mark:i})),c){const m=Object.fromEntries(Object.entries(c()).map(([g,b])=>[g,()=>b({editor:t})]));d={...d,...m}}const u=Ju(d);a.push(u);const h=S(i,"addInputRules",l);Ml(i,t.options.enableInputRules)&&h&&o.push(...h());const f=S(i,"addPasteRules",l);Ml(i,t.options.enablePasteRules)&&f&&r.push(...f());const p=S(i,"addProseMirrorPlugins",l);if(p){const m=p();a.push(...m)}return a}).flat();return[Mh({editor:t,rules:o}),...Bh({editor:t,rules:r}),...s]}get attributes(){return ac(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:n}=Or(this.extensions);return Object.fromEntries(n.filter(o=>!!S(o,"addNodeView")).map(o=>{const r=this.attributes.filter(a=>a.type===o.name),s={name:o.name,options:o.options,storage:o.storage,editor:t,type:nt(o.name,this.schema)},i=S(o,"addNodeView",s);if(!i)return[];const l=(a,c,d,u,h)=>{const f=Ls(a,r);return i()({node:a,view:c,getPos:d,decorations:u,innerDecorations:h,editor:t,extension:o,HTMLAttributes:f})};return[o.name,l]}))}setupExtensions(){this.extensions.forEach(t=>{var n;this.editor.extensionStorage[t.name]=t.storage;const o={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:rs(t.name,this.schema)};t.type==="mark"&&(!((n=P(S(t,"keepOnSplit",o)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(t.name);const r=S(t,"onBeforeCreate",o),s=S(t,"onCreate",o),i=S(t,"onUpdate",o),l=S(t,"onSelectionUpdate",o),a=S(t,"onTransaction",o),c=S(t,"onFocus",o),d=S(t,"onBlur",o),u=S(t,"onDestroy",o);r&&this.editor.on("beforeCreate",r),s&&this.editor.on("create",s),i&&this.editor.on("update",i),l&&this.editor.on("selectionUpdate",l),a&&this.editor.on("transaction",a),c&&this.editor.on("focus",c),d&&this.editor.on("blur",d),u&&this.editor.on("destroy",u)})}}class ${constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=P(S(this,"addOptions",{name:this.name}))),this.storage=P(S(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new $(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>Br(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new $({...this.config,...t});return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=P(S(n,"addOptions",{name:n.name})),n.storage=P(S(n,"addStorage",{name:n.name,options:n.options})),n}}function uc(e,t,n){const{from:o,to:r}=t,{blockSeparator:s=`

`,textSerializers:i={}}=n||{};let l="";return e.nodesBetween(o,r,(a,c,d,u)=>{var h;a.isBlock&&c>o&&(l+=s);const f=i==null?void 0:i[a.type.name];if(f)return d&&(l+=f({node:a,pos:c,parent:d,index:u,range:t})),!1;a.isText&&(l+=(h=a==null?void 0:a.text)===null||h===void 0?void 0:h.slice(Math.max(o,c)-c,r-c))}),l}function hc(e){return Object.fromEntries(Object.entries(e.nodes).filter(([,t])=>t.spec.toText).map(([t,n])=>[t,n.spec.toText]))}const fc=$.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new O({key:new R("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:o,selection:r}=t,{ranges:s}=r,i=Math.min(...s.map(d=>d.$from.pos)),l=Math.max(...s.map(d=>d.$to.pos)),a=hc(n);return uc(o,{from:i,to:l},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:a})}}})]}}),Rh=()=>({editor:e,view:t})=>(requestAnimationFrame(()=>{var n;e.isDestroyed||(t.dom.blur(),(n=window==null?void 0:window.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Nh=(e=!1)=>({commands:t})=>t.setContent("",e),Hh=()=>({state:e,tr:t,dispatch:n})=>{const{selection:o}=t,{ranges:r}=o;return n&&r.forEach(({$from:s,$to:i})=>{e.doc.nodesBetween(s.pos,i.pos,(l,a)=>{if(l.type.isText)return;const{doc:c,mapping:d}=t,u=c.resolve(d.map(a)),h=c.resolve(d.map(a+l.nodeSize)),f=u.blockRange(h);if(!f)return;const p=bh(f);if(l.type.isTextblock){const{defaultType:m}=u.parent.contentMatchAt(u.index());t.setNodeMarkup(f.start,m)}(p||p===0)&&t.lift(f,p)})}),!0},Uh=e=>t=>e(t),Vh=()=>({state:e,dispatch:t})=>gh(e,t),$h=(e,t)=>({editor:n,tr:o})=>{const{state:r}=n,s=r.doc.slice(e.from,e.to);o.deleteRange(e.from,e.to);const i=o.mapping.map(t);return o.insert(i,s.content),o.setSelection(new B(o.doc.resolve(i-1))),!0},Fh=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,o=n.$anchor.node();if(o.content.size>0)return!1;const r=e.selection.$anchor;for(let s=r.depth;s>0;s-=1)if(r.node(s).type===o.type){if(t){const l=r.before(s),a=r.after(s);e.delete(l,a).scrollIntoView()}return!0}return!1},zh=e=>({tr:t,state:n,dispatch:o})=>{const r=nt(e,n.schema),s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r){if(o){const a=s.before(i),c=s.after(i);t.delete(a,c).scrollIntoView()}return!0}return!1},jh=e=>({tr:t,dispatch:n})=>{const{from:o,to:r}=e;return n&&t.delete(o,r),!0},Wh=()=>({state:e,dispatch:t})=>mh(e,t),Gh=()=>({commands:e})=>e.keyboardShortcut("Enter"),Kh=()=>({state:e,dispatch:t})=>ph(e,t);function Fo(e,t,n={strict:!0}){const o=Object.keys(t);return o.length?o.every(r=>n.strict?t[r]===e[r]:Si(t[r])?t[r].test(e[r]):t[r]===e[r]):!0}function pc(e,t,n={}){return e.find(o=>o.type===t&&Fo(Object.fromEntries(Object.keys(n).map(r=>[r,o.attrs[r]])),n))}function Tl(e,t,n={}){return!!pc(e,t,n)}function Rn(e,t,n){var o;if(!e||!t)return;let r=e.parent.childAfter(e.parentOffset);if((!r.node||!r.node.marks.some(d=>d.type===t))&&(r=e.parent.childBefore(e.parentOffset)),!r.node||!r.node.marks.some(d=>d.type===t)||(n=n||((o=r.node.marks[0])===null||o===void 0?void 0:o.attrs),!pc([...r.node.marks],t,n)))return;let i=r.index,l=e.start()+r.offset,a=i+1,c=l+r.node.nodeSize;for(;i>0&&Tl([...e.parent.child(i-1).marks],t,n);)i-=1,l-=e.parent.child(i).nodeSize;for(;a<e.parent.childCount&&Tl([...e.parent.child(a).marks],t,n);)c+=e.parent.child(a).nodeSize,a+=1;return{from:l,to:c}}function Se(e,t){if(typeof e=="string"){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}const qh=(e,t={})=>({tr:n,state:o,dispatch:r})=>{const s=Se(e,o.schema),{doc:i,selection:l}=n,{$from:a,from:c,to:d}=l;if(r){const u=Rn(a,s,t);if(u&&u.from<=c&&u.to>=d){const h=B.create(i,u.from,u.to);n.setSelection(h)}}return!0},Jh=e=>t=>{const n=typeof e=="function"?e(t):e;for(let o=0;o<n.length;o+=1)if(n[o](t))return!0;return!1};function Dr(e){return e instanceof B}function re(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function mc(e,t=null){if(!t)return null;const n=G.atStart(e),o=G.atEnd(e);if(t==="start"||t===!0)return n;if(t==="end")return o;const r=n.from,s=o.to;return t==="all"?B.create(e,re(0,r,s),re(e.content.size,r,s)):B.create(e,re(t,r,s),re(t,r,s))}function Yh(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ei(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const Xh=(e=null,t={})=>({editor:n,view:o,tr:r,dispatch:s})=>{t={scrollIntoView:!0,...t};const i=()=>{(Ei()||Yh())&&o.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(o.focus(),t!=null&&t.scrollIntoView&&n.commands.scrollIntoView())})};if(o.hasFocus()&&e===null||e===!1)return!0;if(s&&e===null&&!Dr(n.state.selection))return i(),!0;const l=mc(r.doc,e)||n.state.selection,a=n.state.selection.eq(l);return s&&(a||r.setSelection(l),a&&r.storedMarks&&r.setStoredMarks(r.storedMarks),i()),!0},Qh=(e,t)=>n=>e.every((o,r)=>t(o,{...n,index:r})),Zh=(e,t)=>({tr:n,commands:o})=>o.insertContentAt({from:n.selection.from,to:n.selection.to},e,t),gc=e=>{const t=e.childNodes;for(let n=t.length-1;n>=0;n-=1){const o=t[n];o.nodeType===3&&o.nodeValue&&/^(\n\s\s|\n)$/.test(o.nodeValue)?e.removeChild(o):o.nodeType===1&&gc(o)}return e};function po(e){const t=`<body>${e}</body>`,n=new window.DOMParser().parseFromString(t,"text/html").body;return gc(n)}function zo(e,t,n){if(e instanceof ec||e instanceof I)return e;n={slice:!0,parseOptions:{},...n};const o=typeof e=="object"&&e!==null,r=typeof e=="string";if(o)try{if(Array.isArray(e)&&e.length>0)return I.fromArray(e.map(l=>t.nodeFromJSON(l)));const i=t.nodeFromJSON(e);return n.errorOnInvalidContent&&i.check(),i}catch(s){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:s});return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",s),zo("",t,n)}if(r){if(n.errorOnInvalidContent){let i=!1,l="";const a=new Qa({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(i=!0,l=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?Be.fromSchema(a).parseSlice(po(e),n.parseOptions):Be.fromSchema(a).parse(po(e),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${l}`)})}const s=Be.fromSchema(t);return n.slice?s.parseSlice(po(e),n.parseOptions).content:s.parse(po(e),n.parseOptions)}return zo("",t,n)}function bc(e,t,n){const o=e.steps.length-1;if(o<t)return;const r=e.steps[o];if(!(r instanceof yi||r instanceof $o))return;const s=e.mapping.maps[o];let i=0;s.forEach((l,a,c,d)=>{i===0&&(i=d)}),e.setSelection(G.near(e.doc.resolve(i),n))}const tf=e=>!("type"in e),ef=(e,t,n)=>({tr:o,dispatch:r,editor:s})=>{var i;if(r){n={parseOptions:s.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let l;try{l=zo(t,s.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions},errorOnInvalidContent:(i=n.errorOnInvalidContent)!==null&&i!==void 0?i:s.options.enableContentCheck})}catch(p){return s.emit("contentError",{editor:s,error:p,disableCollaboration:()=>{s.storage.collaboration&&(s.storage.collaboration.isDisabled=!0)}}),!1}let{from:a,to:c}=typeof e=="number"?{from:e,to:e}:{from:e.from,to:e.to},d=!0,u=!0;if((tf(l)?l:[l]).forEach(p=>{p.check(),d=d?p.isText&&p.marks.length===0:!1,u=u?p.isBlock:!1}),a===c&&u){const{parent:p}=o.doc.resolve(a);p.isTextblock&&!p.type.spec.code&&!p.childCount&&(a-=1,c+=1)}let f;if(d){if(Array.isArray(t))f=t.map(p=>p.text||"").join("");else if(t instanceof I){let p="";t.forEach(m=>{m.text&&(p+=m.text)}),f=p}else typeof t=="object"&&t&&t.text?f=t.text:f=t;o.insertText(f,a,c)}else f=l,o.replaceWith(a,c,f);n.updateSelection&&bc(o,o.steps.length-1,-1),n.applyInputRules&&o.setMeta("applyInputRules",{from:a,text:f}),n.applyPasteRules&&o.setMeta("applyPasteRules",{from:a,text:f})}return!0},nf=()=>({state:e,dispatch:t})=>ah(e,t),of=()=>({state:e,dispatch:t})=>hh(e,t),rf=()=>({state:e,dispatch:t})=>fh(e,t),sf=()=>({state:e,dispatch:t})=>uh(e,t),lf=()=>({state:e,dispatch:t,tr:n})=>{try{const o=oc(e.doc,e.selection.$from.pos,-1);return o==null?!1:(n.join(o,2),t&&t(n),!0)}catch{return!1}},af=()=>({state:e,dispatch:t,tr:n})=>{try{const o=oc(e.doc,e.selection.$from.pos,1);return o==null?!1:(n.join(o,2),t&&t(n),!0)}catch{return!1}},cf=()=>({state:e,dispatch:t})=>dh(e,t),df=()=>({state:e,dispatch:t})=>ch(e,t);function wc(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function uf(e){const t=e.split(/-(?!$)/);let n=t[t.length-1];n==="Space"&&(n=" ");let o,r,s,i;for(let l=0;l<t.length-1;l+=1){const a=t[l];if(/^(cmd|meta|m)$/i.test(a))i=!0;else if(/^a(lt)?$/i.test(a))o=!0;else if(/^(c|ctrl|control)$/i.test(a))r=!0;else if(/^s(hift)?$/i.test(a))s=!0;else if(/^mod$/i.test(a))Ei()||wc()?i=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${a}`)}return o&&(n=`Alt-${n}`),r&&(n=`Ctrl-${n}`),i&&(n=`Meta-${n}`),s&&(n=`Shift-${n}`),n}const hf=e=>({editor:t,view:n,tr:o,dispatch:r})=>{const s=uf(e).split(/-(?!$)/),i=s.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),l=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),a=t.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,l))});return a==null||a.steps.forEach(c=>{const d=c.map(o.mapping);d&&r&&o.maybeStep(d)}),!0};function Nn(e,t,n={}){const{from:o,to:r,empty:s}=e.selection,i=t?nt(t,e.schema):null,l=[];e.doc.nodesBetween(o,r,(u,h)=>{if(u.isText)return;const f=Math.max(o,h),p=Math.min(r,h+u.nodeSize);l.push({node:u,from:f,to:p})});const a=r-o,c=l.filter(u=>i?i.name===u.node.type.name:!0).filter(u=>Fo(u.node.attrs,n,{strict:!1}));return s?!!c.length:c.reduce((u,h)=>u+h.to-h.from,0)>=a}const ff=(e,t={})=>({state:n,dispatch:o})=>{const r=nt(e,n.schema);return Nn(n,r,t)?lh(n,o):!1},pf=()=>({state:e,dispatch:t})=>ih(e,t),mf=e=>({state:t,dispatch:n})=>{const o=nt(e,t.schema);return sh(o)(t,n)},gf=()=>({state:e,dispatch:t})=>rh(e,t);function Rr(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function _l(e,t){const n=typeof t=="string"?[t]:t;return Object.keys(e).reduce((o,r)=>(n.includes(r)||(o[r]=e[r]),o),{})}const bf=(e,t)=>({tr:n,state:o,dispatch:r})=>{let s=null,i=null;const l=Rr(typeof e=="string"?e:e.name,o.schema);return l?(l==="node"&&(s=nt(e,o.schema)),l==="mark"&&(i=Se(e,o.schema)),r&&n.selection.ranges.forEach(a=>{o.doc.nodesBetween(a.$from.pos,a.$to.pos,(c,d)=>{s&&s===c.type&&n.setNodeMarkup(d,void 0,_l(c.attrs,t)),i&&c.marks.length&&c.marks.forEach(u=>{i===u.type&&n.addMark(d,d+c.nodeSize,i.create(_l(u.attrs,t)))})})}),!0):!1},wf=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),kf=()=>({tr:e,dispatch:t})=>{if(t){const n=new nc(e.doc);e.setSelection(n)}return!0},yf=()=>({state:e,dispatch:t})=>oh(e,t),vf=()=>({state:e,dispatch:t})=>nh(e,t),Cf=()=>({state:e,dispatch:t})=>eh(e,t),Sf=()=>({state:e,dispatch:t})=>th(e,t),Ef=()=>({state:e,dispatch:t})=>Zu(e,t);function jo(e,t,n={},o={}){return zo(e,t,{slice:!1,parseOptions:n,errorOnInvalidContent:o.errorOnInvalidContent})}const xf=(e,t=!1,n={},o={})=>({editor:r,tr:s,dispatch:i,commands:l})=>{var a,c;const{doc:d}=s;if(n.preserveWhitespace!=="full"){const u=jo(e,r.schema,n,{errorOnInvalidContent:(a=o.errorOnInvalidContent)!==null&&a!==void 0?a:r.options.enableContentCheck});return i&&s.replaceWith(0,d.content.size,u).setMeta("preventUpdate",!t),!0}return i&&s.setMeta("preventUpdate",!t),l.insertContentAt({from:0,to:d.content.size},e,{parseOptions:n,errorOnInvalidContent:(c=o.errorOnInvalidContent)!==null&&c!==void 0?c:r.options.enableContentCheck})};function kc(e,t){const n=Se(t,e.schema),{from:o,to:r,empty:s}=e.selection,i=[];s?(e.storedMarks&&i.push(...e.storedMarks),i.push(...e.selection.$head.marks())):e.doc.nodesBetween(o,r,a=>{i.push(...a.marks)});const l=i.find(a=>a.type.name===n.name);return l?{...l.attrs}:{}}function xi(e,t){const n=new Xa(e);return t.forEach(o=>{o.steps.forEach(r=>{n.step(r)})}),n}function Af(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Ll(e,t){const n=[];return e.descendants((o,r)=>{t(o)&&n.push({node:o,pos:r})}),n}function Wo(e,t,n){const o=[];return e.nodesBetween(t.from,t.to,(r,s)=>{n(r)&&o.push({node:r,pos:s})}),o}function Mf(e,t){for(let n=e.depth;n>0;n-=1){const o=e.node(n);if(t(o))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:o}}}function Nr(e){return t=>Mf(t.$from,e)}function Tf(e,t){const n=Pe.resolve(e);return dc(n,t)}function _f(e,t){const n={from:0,to:e.content.size};return uc(e,n,t)}function Lf(e,t){const n=nt(t,e.schema),{from:o,to:r}=e.selection,s=[];e.doc.nodesBetween(o,r,l=>{s.push(l)});const i=s.reverse().find(l=>l.type.name===n.name);return i?{...i.attrs}:{}}function yc(e,t){const n=Rr(typeof t=="string"?t:t.name,e.schema);return n==="node"?Lf(e,t):n==="mark"?kc(e,t):{}}function If(e,t=JSON.stringify){const n={};return e.filter(o=>{const r=t(o);return Object.prototype.hasOwnProperty.call(n,r)?!1:n[r]=!0})}function Pf(e){const t=If(e);return t.length===1?t:t.filter((n,o)=>!t.filter((s,i)=>i!==o).some(s=>n.oldRange.from>=s.oldRange.from&&n.oldRange.to<=s.oldRange.to&&n.newRange.from>=s.newRange.from&&n.newRange.to<=s.newRange.to))}function Ai(e){const{mapping:t,steps:n}=e,o=[];return t.maps.forEach((r,s)=>{const i=[];if(r.ranges.length)r.forEach((l,a)=>{i.push({from:l,to:a})});else{const{from:l,to:a}=n[s];if(l===void 0||a===void 0)return;i.push({from:l,to:a})}i.forEach(({from:l,to:a})=>{const c=t.slice(s).map(l,-1),d=t.slice(s).map(a),u=t.invert().map(c,-1),h=t.invert().map(d);o.push({oldRange:{from:u,to:h},newRange:{from:c,to:d}})})}),Pf(o)}function Mi(e,t,n){const o=[];return e===t?n.resolve(e).marks().forEach(r=>{const s=n.resolve(e),i=Rn(s,r.type);i&&o.push({mark:r,...i})}):n.nodesBetween(e,t,(r,s)=>{!r||(r==null?void 0:r.nodeSize)===void 0||o.push(...r.marks.map(i=>({from:s,to:s+r.nodeSize,mark:i})))}),o}function Io(e,t,n){return Object.fromEntries(Object.entries(n).filter(([o])=>{const r=e.find(s=>s.type===t&&s.name===o);return r?r.attribute.keepOnSplit:!1}))}function Is(e,t,n={}){const{empty:o,ranges:r}=e.selection,s=t?Se(t,e.schema):null;if(o)return!!(e.storedMarks||e.selection.$from.marks()).filter(u=>s?s.name===u.type.name:!0).find(u=>Fo(u.attrs,n,{strict:!1}));let i=0;const l=[];if(r.forEach(({$from:u,$to:h})=>{const f=u.pos,p=h.pos;e.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const b=Math.max(f,g),k=Math.min(p,g+m.nodeSize),v=k-b;i+=v,l.push(...m.marks.map(x=>({mark:x,from:b,to:k})))})}),i===0)return!1;const a=l.filter(u=>s?s.name===u.mark.type.name:!0).filter(u=>Fo(u.mark.attrs,n,{strict:!1})).reduce((u,h)=>u+h.to-h.from,0),c=l.filter(u=>s?u.mark.type!==s&&u.mark.type.excludes(s):!0).reduce((u,h)=>u+h.to-h.from,0);return(a>0?a+c:a)>=i}function Of(e,t,n={}){if(!t)return Nn(e,null,n)||Is(e,null,n);const o=Rr(t,e.schema);return o==="node"?Nn(e,t,n):o==="mark"?Is(e,t,n):!1}function Il(e,t){const{nodeExtensions:n}=Or(t),o=n.find(i=>i.name===e);if(!o)return!1;const r={name:o.name,options:o.options,storage:o.storage},s=P(S(o,"group",r));return typeof s!="string"?!1:s.split(" ").includes("list")}function Ti(e,{checkChildren:t=!0,ignoreWhitespace:n=!1}={}){var o;if(n){if(e.type.name==="hardBreak")return!0;if(e.isText)return/^\s*$/m.test((o=e.text)!==null&&o!==void 0?o:"")}if(e.isText)return!e.text;if(e.isAtom||e.isLeaf)return!1;if(e.content.childCount===0)return!0;if(t){let r=!0;return e.content.forEach(s=>{r!==!1&&(Ti(s,{ignoreWhitespace:n,checkChildren:t})||(r=!1))}),r}return!1}function Ps(e){return e instanceof xt}function Go(e,t,n){const r=e.state.doc.content.size,s=re(t,0,r),i=re(n,0,r),l=e.coordsAtPos(s),a=e.coordsAtPos(i,-1),c=Math.min(l.top,a.top),d=Math.max(l.bottom,a.bottom),u=Math.min(l.left,a.left),h=Math.max(l.right,a.right),f=h-u,p=d-c,b={top:c,bottom:d,left:u,right:h,width:f,height:p,x:u,y:c};return{...b,toJSON:()=>b}}function Bf(e,t,n){var o;const{selection:r}=t;let s=null;if(Dr(r)&&(s=r.$cursor),s){const l=(o=e.storedMarks)!==null&&o!==void 0?o:s.marks();return!!n.isInSet(l)||!l.some(a=>a.type.excludes(n))}const{ranges:i}=r;return i.some(({$from:l,$to:a})=>{let c=l.depth===0?e.doc.inlineContent&&e.doc.type.allowsMarkType(n):!1;return e.doc.nodesBetween(l.pos,a.pos,(d,u,h)=>{if(c)return!1;if(d.isInline){const f=!h||h.type.allowsMarkType(n),p=!!n.isInSet(d.marks)||!d.marks.some(m=>m.type.excludes(n));c=f&&p}return!c}),c})}const Df=(e,t={})=>({tr:n,state:o,dispatch:r})=>{const{selection:s}=n,{empty:i,ranges:l}=s,a=Se(e,o.schema);if(r)if(i){const c=kc(o,a);n.addStoredMark(a.create({...c,...t}))}else l.forEach(c=>{const d=c.$from.pos,u=c.$to.pos;o.doc.nodesBetween(d,u,(h,f)=>{const p=Math.max(f,d),m=Math.min(f+h.nodeSize,u);h.marks.find(b=>b.type===a)?h.marks.forEach(b=>{a===b.type&&n.addMark(p,m,a.create({...b.attrs,...t}))}):n.addMark(p,m,a.create(t))})});return Bf(o,n,a)},Rf=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),Nf=(e,t={})=>({state:n,dispatch:o,chain:r})=>{const s=nt(e,n.schema);let i;return n.selection.$anchor.sameParent(n.selection.$head)&&(i=n.selection.$anchor.parent.attrs),s.isTextblock?r().command(({commands:l})=>El(s,{...i,...t})(n)?!0:l.clearNodes()).command(({state:l})=>El(s,{...i,...t})(l,o)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Hf=e=>({tr:t,dispatch:n})=>{if(n){const{doc:o}=t,r=re(e,0,o.content.size),s=xt.create(o,r);t.setSelection(s)}return!0},Uf=e=>({tr:t,dispatch:n})=>{if(n){const{doc:o}=t,{from:r,to:s}=typeof e=="number"?{from:e,to:e}:e,i=B.atStart(o).from,l=B.atEnd(o).to,a=re(r,i,l),c=re(s,i,l),d=B.create(o,a,c);t.setSelection(d)}return!0},Vf=e=>({state:t,dispatch:n})=>{const o=nt(e,t.schema);return Qu(o)(t,n)};function Pl(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const o=n.filter(r=>t==null?void 0:t.includes(r.type.name));e.tr.ensureMarks(o)}}const $f=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:o,editor:r})=>{const{selection:s,doc:i}=t,{$from:l,$to:a}=s,c=r.extensionManager.attributes,d=Io(c,l.node().type.name,l.node().attrs);if(s instanceof xt&&s.node.isBlock)return!l.parentOffset||!Lo(i,l.pos)?!1:(o&&(e&&Pl(n,r.extensionManager.splittableMarks),t.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;const u=a.parentOffset===a.parent.content.size,h=l.depth===0?void 0:Af(l.node(-1).contentMatchAt(l.indexAfter(-1)));let f=u&&h?[{type:h,attrs:d}]:void 0,p=Lo(t.doc,t.mapping.map(l.pos),1,f);if(!f&&!p&&Lo(t.doc,t.mapping.map(l.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:d}]:void 0),o){if(p&&(s instanceof B&&t.deleteSelection(),t.split(t.mapping.map(l.pos),1,f),h&&!u&&!l.parentOffset&&l.parent.type!==h)){const m=t.mapping.map(l.before()),g=t.doc.resolve(m);l.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&t.setNodeMarkup(t.mapping.map(l.before()),h)}e&&Pl(n,r.extensionManager.splittableMarks),t.scrollIntoView()}return p},Ff=(e,t={})=>({tr:n,state:o,dispatch:r,editor:s})=>{var i;const l=nt(e,o.schema),{$from:a,$to:c}=o.selection,d=o.selection.node;if(d&&d.isBlock||a.depth<2||!a.sameParent(c))return!1;const u=a.node(-1);if(u.type!==l)return!1;const h=s.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==l||a.index(-2)!==a.node(-2).childCount-1)return!1;if(r){let b=I.empty;const k=a.index(-1)?1:a.index(-2)?2:3;for(let A=a.depth-k;A>=a.depth-3;A-=1)b=I.from(a.node(A).copy(b));const v=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,x={...Io(h,a.node().type.name,a.node().attrs),...t},C=((i=l.contentMatch.defaultType)===null||i===void 0?void 0:i.createAndFill(x))||void 0;b=b.append(I.from(l.createAndFill(null,C)||void 0));const M=a.before(a.depth-(k-1));n.replace(M,a.after(-v),new K(b,4-k,0));let E=-1;n.doc.nodesBetween(M,n.doc.content.size,(A,At)=>{if(E>-1)return!1;A.isTextblock&&A.content.size===0&&(E=At+1)}),E>-1&&n.setSelection(B.near(n.doc.resolve(E))),n.scrollIntoView()}return!0}const f=c.pos===a.end()?u.contentMatchAt(0).defaultType:null,p={...Io(h,u.type.name,u.attrs),...t},m={...Io(h,a.node().type.name,a.node().attrs),...t};n.delete(a.pos,c.pos);const g=f?[{type:l,attrs:p},{type:f,attrs:m}]:[{type:l,attrs:p}];if(!Lo(n.doc,a.pos,2))return!1;if(r){const{selection:b,storedMarks:k}=o,{splittableMarks:v}=s.extensionManager,x=k||b.$to.parentOffset&&b.$from.marks();if(n.split(a.pos,2,g).scrollIntoView(),!x||!r)return!0;const C=x.filter(M=>v.includes(M.type.name));n.ensureMarks(C)}return!0},ss=(e,t)=>{const n=Nr(i=>i.type===t)(e.selection);if(!n)return!0;const o=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(o===void 0)return!0;const r=e.doc.nodeAt(o);return n.node.type===(r==null?void 0:r.type)&&rc(e.doc,n.pos)&&e.join(n.pos),!0},is=(e,t)=>{const n=Nr(i=>i.type===t)(e.selection);if(!n)return!0;const o=e.doc.resolve(n.start).after(n.depth);if(o===void 0)return!0;const r=e.doc.nodeAt(o);return n.node.type===(r==null?void 0:r.type)&&rc(e.doc,o)&&e.join(o),!0},zf=(e,t,n,o={})=>({editor:r,tr:s,state:i,dispatch:l,chain:a,commands:c,can:d})=>{const{extensions:u,splittableMarks:h}=r.extensionManager,f=nt(e,i.schema),p=nt(t,i.schema),{selection:m,storedMarks:g}=i,{$from:b,$to:k}=m,v=b.blockRange(k),x=g||m.$to.parentOffset&&m.$from.marks();if(!v)return!1;const C=Nr(M=>Il(M.type.name,u))(m);if(v.depth>=1&&C&&v.depth-C.depth<=1){if(C.node.type===f)return c.liftListItem(p);if(Il(C.node.type.name,u)&&f.validContent(C.node.content)&&l)return a().command(()=>(s.setNodeMarkup(C.pos,f),!0)).command(()=>ss(s,f)).command(()=>is(s,f)).run()}return!n||!x||!l?a().command(()=>d().wrapInList(f,o)?!0:c.clearNodes()).wrapInList(f,o).command(()=>ss(s,f)).command(()=>is(s,f)).run():a().command(()=>{const M=d().wrapInList(f,o),E=x.filter(A=>h.includes(A.type.name));return s.ensureMarks(E),M?!0:c.clearNodes()}).wrapInList(f,o).command(()=>ss(s,f)).command(()=>is(s,f)).run()},jf=(e,t={},n={})=>({state:o,commands:r})=>{const{extendEmptyMarkRange:s=!1}=n,i=Se(e,o.schema);return Is(o,i,t)?r.unsetMark(i,{extendEmptyMarkRange:s}):r.setMark(i,t)},Wf=(e,t,n={})=>({state:o,commands:r})=>{const s=nt(e,o.schema),i=nt(t,o.schema),l=Nn(o,s,n);let a;return o.selection.$anchor.sameParent(o.selection.$head)&&(a=o.selection.$anchor.parent.attrs),l?r.setNode(i,a):r.setNode(s,{...a,...n})},Gf=(e,t={})=>({state:n,commands:o})=>{const r=nt(e,n.schema);return Nn(n,r,t)?o.lift(r):o.wrapIn(r,t)},Kf=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let o=0;o<n.length;o+=1){const r=n[o];let s;if(r.spec.isInputRules&&(s=r.getState(e))){if(t){const i=e.tr,l=s.transform;for(let a=l.steps.length-1;a>=0;a-=1)i.step(l.steps[a].invert(l.docs[a]));if(s.text){const a=i.doc.resolve(s.from).marks();i.replaceWith(s.from,s.to,e.schema.text(s.text,a))}else i.delete(s.from,s.to)}return!0}}return!1},qf=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:o,ranges:r}=n;return o||t&&r.forEach(s=>{e.removeMark(s.$from.pos,s.$to.pos)}),!0},Jf=(e,t={})=>({tr:n,state:o,dispatch:r})=>{var s;const{extendEmptyMarkRange:i=!1}=t,{selection:l}=n,a=Se(e,o.schema),{$from:c,empty:d,ranges:u}=l;if(!r)return!0;if(d&&i){let{from:h,to:f}=l;const p=(s=c.marks().find(g=>g.type===a))===null||s===void 0?void 0:s.attrs,m=Rn(c,a,p);m&&(h=m.from,f=m.to),n.removeMark(h,f,a)}else u.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,a)});return n.removeStoredMark(a),!0},Yf=(e,t={})=>({tr:n,state:o,dispatch:r})=>{let s=null,i=null;const l=Rr(typeof e=="string"?e:e.name,o.schema);return l?(l==="node"&&(s=nt(e,o.schema)),l==="mark"&&(i=Se(e,o.schema)),r&&n.selection.ranges.forEach(a=>{const c=a.$from.pos,d=a.$to.pos;let u,h,f,p;n.selection.empty?o.doc.nodesBetween(c,d,(m,g)=>{s&&s===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,d),u=g,h=m)}):o.doc.nodesBetween(c,d,(m,g)=>{g<c&&s&&s===m.type&&(f=Math.max(g,c),p=Math.min(g+m.nodeSize,d),u=g,h=m),g>=c&&g<=d&&(s&&s===m.type&&n.setNodeMarkup(g,void 0,{...m.attrs,...t}),i&&m.marks.length&&m.marks.forEach(b=>{if(i===b.type){const k=Math.max(g,c),v=Math.min(g+m.nodeSize,d);n.addMark(k,v,i.create({...b.attrs,...t}))}}))}),h&&(u!==void 0&&n.setNodeMarkup(u,void 0,{...h.attrs,...t}),i&&h.marks.length&&h.marks.forEach(m=>{i===m.type&&n.addMark(f,p,i.create({...m.attrs,...t}))}))}),!0):!1},Xf=(e,t={})=>({state:n,dispatch:o})=>{const r=nt(e,n.schema);return Xu(r,t)(n,o)},Qf=(e,t={})=>({state:n,dispatch:o})=>{const r=nt(e,n.schema);return Yu(r,t)(n,o)};var Zf=Object.freeze({__proto__:null,blur:Rh,clearContent:Nh,clearNodes:Hh,command:Uh,createParagraphNear:Vh,cut:$h,deleteCurrentNode:Fh,deleteNode:zh,deleteRange:jh,deleteSelection:Wh,enter:Gh,exitCode:Kh,extendMarkRange:qh,first:Jh,focus:Xh,forEach:Qh,insertContent:Zh,insertContentAt:ef,joinBackward:rf,joinDown:of,joinForward:sf,joinItemBackward:lf,joinItemForward:af,joinTextblockBackward:cf,joinTextblockForward:df,joinUp:nf,keyboardShortcut:hf,lift:ff,liftEmptyBlock:pf,liftListItem:mf,newlineInCode:gf,resetAttributes:bf,scrollIntoView:wf,selectAll:kf,selectNodeBackward:yf,selectNodeForward:vf,selectParentNode:Cf,selectTextblockEnd:Sf,selectTextblockStart:Ef,setContent:xf,setMark:Df,setMeta:Rf,setNode:Nf,setNodeSelection:Hf,setTextSelection:Uf,sinkListItem:Vf,splitBlock:$f,splitListItem:Ff,toggleList:zf,toggleMark:jf,toggleNode:Wf,toggleWrap:Gf,undoInputRule:Kf,unsetAllMarks:qf,unsetMark:Jf,updateAttributes:Yf,wrapIn:Xf,wrapInList:Qf});const vc=$.create({name:"commands",addCommands(){return{...Zf}}}),Cc=$.create({name:"drop",addProseMirrorPlugins(){return[new O({key:new R("tiptapDrop"),props:{handleDrop:(e,t,n,o)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:n,moved:o})}}})]}}),Sc=$.create({name:"editable",addProseMirrorPlugins(){return[new O({key:new R("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Ec=new R("focusEvents"),xc=$.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new O({key:Ec,props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const o=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(o),!1},blur:(t,n)=>{e.isFocused=!1;const o=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(o),!1}}}})]}}),Ac=$.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:l})=>{const{selection:a,doc:c}=l,{empty:d,$anchor:u}=a,{pos:h,parent:f}=u,p=u.parent.isTextblock&&h>0?l.doc.resolve(h-1):u,m=p.parent.type.spec.isolating,g=u.pos-u.parentOffset,b=m&&p.parent.childCount===1?g===u.pos:G.atStart(c).from===h;return!d||!f.type.isTextblock||f.textContent.length||!b||b&&u.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),o={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},r={...o},s={...o,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ei()||wc()?s:r},addProseMirrorPlugins(){return[new O({key:new R("clearDocument"),appendTransaction:(e,t,n)=>{if(e.some(m=>m.getMeta("composition")))return;const o=e.some(m=>m.docChanged)&&!t.doc.eq(n.doc),r=e.some(m=>m.getMeta("preventClearDocument"));if(!o||r)return;const{empty:s,from:i,to:l}=t.selection,a=G.atStart(t.doc).from,c=G.atEnd(t.doc).to;if(s||!(i===a&&l===c)||!Ti(n.doc))return;const h=n.tr,f=Ir({state:n,transaction:h}),{commands:p}=new Pr({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),Mc=$.create({name:"paste",addProseMirrorPlugins(){return[new O({key:new R("tiptapPaste"),props:{handlePaste:(e,t,n)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:n})}}})]}}),Tc=$.create({name:"tabindex",addProseMirrorPlugins(){return[new O({key:new R("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});var vn=Object.freeze({__proto__:null,ClipboardTextSerializer:fc,Commands:vc,Drop:Cc,Editable:Sc,FocusEvents:xc,Keymap:Ac,Paste:Mc,Tabindex:Tc,focusEventsPluginKey:Ec});class _e{get name(){return this.node.type.name}constructor(t,n,o=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=o,this.resolvedPos=t,this.editor=n,this.currentNode=r}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!==null&&t!==void 0?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let n=this.from,o=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,o=this.to-1}this.editor.commands.insertContentAt({from:n,to:o},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(t);return new _e(n,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new _e(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new _e(t,this.editor)}get children(){const t=[];return this.node.content.forEach((n,o)=>{const r=n.isBlock&&!n.isTextblock,s=n.isAtom&&!n.isText,i=this.pos+o+(s?0:1),l=this.resolvedPos.doc.resolve(i);if(!r&&l.depth<=this.depth)return;const a=new _e(l,this.editor,r,r?n:null);r&&(a.actualDepth=this.depth+1),t.push(new _e(l,this.editor,r,r?n:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,n={}){let o=null,r=this.parent;for(;r&&!o;){if(r.node.type.name===t)if(Object.keys(n).length>0){const s=r.node.attrs,i=Object.keys(n);for(let l=0;l<i.length;l+=1){const a=i[l];if(s[a]!==n[a])break}}else o=r;r=r.parent}return o}querySelector(t,n={}){return this.querySelectorAll(t,n,!0)[0]||null}querySelectorAll(t,n={},o=!1){let r=[];if(!this.children||this.children.length===0)return r;const s=Object.keys(n);return this.children.forEach(i=>{o&&r.length>0||(i.node.type.name===t&&s.every(a=>n[a]===i.node.attrs[a])&&r.push(i),!(o&&r.length>0)&&(r=r.concat(i.querySelectorAll(t,n,o))))}),r}setAttribute(t){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(n)}}const tp=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function ep(e,t,n){const o=document.querySelector("style[data-tiptap-style]");if(o!==null)return o;const r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute("data-tiptap-style",""),r.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(r),r}class np extends Ch{constructor(t={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:o,moved:r})=>this.options.onDrop(n,o,r)),this.on("paste",({event:n,slice:o})=>this.options.onPaste(n,o)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=ep(tp,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,n=!0){this.setOptions({editable:t}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,n){const o=cc(n)?n(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:o});return this.view.updateState(r),r}unregisterPlugin(t){if(this.isDestroyed)return;const n=this.state.plugins;let o=n;if([].concat(t).forEach(s=>{const i=typeof s=="string"?`${s}$`:s.key;o=o.filter(l=>!l.key.startsWith(i))}),n.length===o.length)return;const r=this.state.reconfigure({plugins:o});return this.view.updateState(r),r}createExtensionManager(){var t,n;const r=[...this.options.enableCoreExtensions?[Sc,fc.configure({blockSeparator:(n=(t=this.options.coreExtensionOptions)===null||t===void 0?void 0:t.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),vc,xc,Ac,Tc,Cc,Mc].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s==null?void 0:s.type));this.extensionManager=new Pe(r,this)}createCommandManager(){this.commandManager=new Pr({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var t;let n;try{n=jo(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(i){if(!(i instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(i.message))throw i;this.emit("contentError",{editor:this,error:i,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(l=>l.name!=="collaboration"),this.createExtensionManager()}}),n=jo(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const o=mc(n,this.options.autofocus);this.view=new Za(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)===null||t===void 0?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:tc.create({doc:n,selection:o||void 0})});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.createNodeViews(),this.prependClass();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(i=>{var l;return(l=this.capturedTransaction)===null||l===void 0?void 0:l.step(i)});return}const n=this.state.apply(t),o=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:t}),o&&this.emit("selectionUpdate",{editor:this,transaction:t});const r=t.getMeta("focus"),s=t.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:t}),s&&this.emit("blur",{editor:this,event:s.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return yc(this.state,t)}isActive(t,n){const o=typeof t=="string"?t:null,r=typeof t=="string"?n:t;return Of(this.state,o,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Ci(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:n=`

`,textSerializers:o={}}=t||{};return _f(this.state.doc,{blockSeparator:n,textSerializers:{...hc(this.schema),...o}})}get isEmpty(){return Ti(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const t=this.view.dom;t&&t.editor&&delete t.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}$node(t,n){var o;return((o=this.$doc)===null||o===void 0?void 0:o.querySelector(t,n))||null}$nodes(t,n){var o;return((o=this.$doc)===null||o===void 0?void 0:o.querySelectorAll(t,n))||null}$pos(t){const n=this.state.doc.resolve(t);return new _e(n,this)}get $doc(){return this.$pos(0)}}function sn(e){return new be({find:e.find,handler:({state:t,range:n,match:o})=>{const r=P(e.getAttributes,void 0,o);if(r===!1||r===null)return null;const{tr:s}=t,i=o[o.length-1],l=o[0];if(i){const a=l.search(/\S/),c=n.from+l.indexOf(i),d=c+i.length;if(Mi(n.from,n.to,t.doc).filter(f=>f.mark.type.excluded.find(m=>m===e.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;d<n.to&&s.delete(d,n.to),c>n.from&&s.delete(n.from+a,c);const h=n.from+a+i.length;s.addMark(n.from+a,h,e.type.create(r||{})),s.removeStoredMark(e.type)}}})}let qt=class Os{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=P(S(this,"addOptions",{name:this.name}))),this.storage=P(S(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Os(t)}configure(t={}){const n=this.extend({...this.config,addOptions:()=>Br(this.options,t)});return n.name=this.name,n.parent=this.parent,n}extend(t={}){const n=new Os(t);return n.parent=this,this.child=n,n.name=t.name?t.name:n.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=P(S(n,"addOptions",{name:n.name})),n.storage=P(S(n,"addStorage",{name:n.name,options:n.options})),n}};function He(e){return new Lh({find:e.find,handler:({state:t,range:n,match:o,pasteEvent:r})=>{const s=P(e.getAttributes,void 0,o,r);if(s===!1||s===null)return null;const{tr:i}=t,l=o[o.length-1],a=o[0];let c=n.to;if(l){const d=a.search(/\S/),u=n.from+a.indexOf(l),h=u+l.length;if(Mi(n.from,n.to,t.doc).filter(p=>p.mark.type.excluded.find(g=>g===e.type&&g!==p.mark.type)).filter(p=>p.to>u).length)return null;h<n.to&&i.delete(h,n.to),u>n.from&&i.delete(n.from+d,u),c=n.from+d+l.length,i.addMark(n.from+d,c,e.type.create(s||{})),i.removeStoredMark(e.type)}}})}var mo,op=new Uint8Array(16);function rp(){if(!mo&&(mo=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!mo))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return mo(op)}const sp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function ip(e){return typeof e=="string"&&sp.test(e)}var rt=[];for(var ls=0;ls<256;++ls)rt.push((ls+256).toString(16).substr(1));function lp(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(rt[e[t+0]]+rt[e[t+1]]+rt[e[t+2]]+rt[e[t+3]]+"-"+rt[e[t+4]]+rt[e[t+5]]+"-"+rt[e[t+6]]+rt[e[t+7]]+"-"+rt[e[t+8]]+rt[e[t+9]]+"-"+rt[e[t+10]]+rt[e[t+11]]+rt[e[t+12]]+rt[e[t+13]]+rt[e[t+14]]+rt[e[t+15]]).toLowerCase();if(!ip(n))throw TypeError("Stringified UUID is invalid");return n}function _c(e,t,n){e=e||{};var o=e.random||(e.rng||rp)();return o[6]=o[6]&15|64,o[8]=o[8]&63|128,lp(o)}var ap=class Lc{constructor(t){this.cache=new Map(t)}get(t){return this.cache.get(t)}set(t,n,o){t<0||this.cache.set(t,[n,o])}replace(t,n,o,r){this.remove(t),this.set(n,o,r)}remove(t){this.cache.delete(t)}invalidate(t){const n=new Lc(this.cache),o=t.mapping;return this.cache.forEach(([r,s],i)=>{if(i<0)return;const l=o.mapResult(i),a=t.doc.nodeAt(l.pos);if(l.deleted||!(a!=null&&a.eq(r)))n.remove(i);else if(i!==l.pos){const c=s.map(d=>d.map(o,0,0)).filter(d=>d!=null);n.replace(i,l.pos,a,c)}}),n}};function cp({parser:e,nodeTypes:t=["code_block","codeBlock"],languageExtractor:n=o=>o.attrs.language}){const o=new R("prosemirror-highlight");return new O({key:o,state:{init(r,s){const i=new ap,[l,a]=Ol(s.doc,e,t,n,i);return{cache:i,decorations:l,promises:a}},apply:(r,s)=>{const i=s.cache.invalidate(r),l=!!r.getMeta("prosemirror-highlight-refresh");if(!r.docChanged&&!l){const d=s.decorations.map(r.mapping,r.doc),u=s.promises;return{cache:i,decorations:d,promises:u}}const[a,c]=Ol(r.doc,e,t,n,i);return{cache:i,decorations:a,promises:c}}},view:r=>{const s=new Set,i=()=>{if(s.size>0)return;const a=r.state.tr.setMeta("prosemirror-highlight-refresh",!0);r.dispatch(a)},l=()=>{var a;const c=o.getState(r.state);for(const d of(a=c==null?void 0:c.promises)!=null?a:[])s.add(d),d.then(()=>{s.delete(d),i()}).catch(()=>{s.delete(d)})};return l(),{update:()=>{l()}}},props:{decorations(r){var s;return(s=this.getState(r))==null?void 0:s.decorations}}})}function Ol(e,t,n,o,r){const s=[],i=[];return e.descendants((l,a)=>{if(!l.type.isTextblock)return!0;if(n.includes(l.type.name)){const c=o(l),d=r.get(a);if(d){const[u,h]=d;s.push(...h)}else{const u=t({content:l.textContent,language:c||void 0,pos:a,size:l.nodeSize});u&&Array.isArray(u)?(r.set(a,l,u),s.push(...u)):u instanceof Promise&&(r.remove(a),i.push(u))}}return!1}),[tt.create(e,s),i]}function dp(e,t){return function({content:o,language:r,pos:s,size:i}){var l;const a=[],{tokens:c,fg:d,bg:u,rootStyle:h}=e.codeToTokens(o,{lang:r,theme:e.getLoadedThemes()[0]}),f=h||(d&&u?`--prosemirror-highlight:${d};--prosemirror-highlight-bg:${u}`:"");if(f){const m=it.node(s,s+i,{style:f});a.push(m)}let p=s+1;for(const m of c){for(const g of m){const b=p+g.content.length,k=it.inline(p,b,{style:up((l=g.htmlStyle)!=null?l:`color: ${g.color}`),class:"shiki"});a.push(k),p=b}p+=1}return a}}function up(e){return typeof e=="string"?e:Object.entries(e).map(([t,n])=>`${t}:${n}`).join(";")}const hp=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,fp=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,pp=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,mp=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,gp=lt.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:e=>e.type.name===this.name},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",Ct(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[sn({find:hp,type:this.type}),sn({find:pp,type:this.type})]},addPasteRules(){return[He({find:fp,type:this.type}),He({find:mp,type:this.type})]}}),bp=/(^|[^`])`([^`]+)`(?!`)/,wp=/(^|[^`])`([^`]+)`(?!`)/g,kp=lt.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",Ct(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[sn({find:bp,type:this.type})]},addPasteRules(){return[He({find:wp,type:this.type})]}}),yp=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,vp=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,Cp=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Sp=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Ep=lt.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>e.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:e=>e.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",Ct(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[sn({find:yp,type:this.type}),sn({find:Cp,type:this.type})]},addPasteRules(){return[He({find:vp,type:this.type}),He({find:Sp,type:this.type})]}}),xp=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Ap=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,Mp=lt.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["s",Ct(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[sn({find:xp,type:this.type})]},addPasteRules(){return[He({find:Ap,type:this.type})]}}),Tp=lt.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["u",Ct(this.options.HTMLAttributes,e),0]},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),_p=qt.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:e}){return["td",Ct(this.options.HTMLAttributes,e),0]}}),Lp=qt.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?t.split(",").map(o=>parseInt(o,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:e}){return["th",Ct(this.options.HTMLAttributes,e),0]}});var Bs,Ds;if(typeof WeakMap<"u"){let e=new WeakMap;Bs=t=>e.get(t),Ds=(t,n)=>(e.set(t,n),n)}else{const e=[];let n=0;Bs=o=>{for(let r=0;r<e.length;r+=2)if(e[r]==o)return e[r+1]},Ds=(o,r)=>(n==10&&(n=0),e[n++]=o,e[n++]=r)}var j=class{constructor(e,t,n,o){this.width=e,this.height=t,this.map=n,this.problems=o}findCell(e){for(let t=0;t<this.map.length;t++){const n=this.map[t];if(n!=e)continue;const o=t%this.width,r=t/this.width|0;let s=o+1,i=r+1;for(let l=1;s<this.width&&this.map[t+l]==n;l++)s++;for(let l=1;i<this.height&&this.map[t+this.width*l]==n;l++)i++;return{left:o,top:r,right:s,bottom:i}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,n){const{left:o,right:r,top:s,bottom:i}=this.findCell(e);return t=="horiz"?(n<0?o==0:r==this.width)?null:this.map[s*this.width+(n<0?o-1:r)]:(n<0?s==0:i==this.height)?null:this.map[o+this.width*(n<0?s-1:i)]}rectBetween(e,t){const{left:n,right:o,top:r,bottom:s}=this.findCell(e),{left:i,right:l,top:a,bottom:c}=this.findCell(t);return{left:Math.min(n,i),top:Math.min(r,a),right:Math.max(o,l),bottom:Math.max(s,c)}}cellsInRect(e){const t=[],n={};for(let o=e.top;o<e.bottom;o++)for(let r=e.left;r<e.right;r++){const s=o*this.width+r,i=this.map[s];n[i]||(n[i]=!0,!(r==e.left&&r&&this.map[s-1]==i||o==e.top&&o&&this.map[s-this.width]==i)&&t.push(i))}return t}positionAt(e,t,n){for(let o=0,r=0;;o++){const s=r+n.child(o).nodeSize;if(o==e){let i=t+e*this.width;const l=(e+1)*this.width;for(;i<l&&this.map[i]<r;)i++;return i==l?s-1:this.map[i]}r=s}}static get(e){return Bs(e)||Ds(e,Ip(e))}};function Ip(e){if(e.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+e.type.name);const t=Pp(e),n=e.childCount,o=[];let r=0,s=null;const i=[];for(let c=0,d=t*n;c<d;c++)o[c]=0;for(let c=0,d=0;c<n;c++){const u=e.child(c);d++;for(let p=0;;p++){for(;r<o.length&&o[r]!=0;)r++;if(p==u.childCount)break;const m=u.child(p),{colspan:g,rowspan:b,colwidth:k}=m.attrs;for(let v=0;v<b;v++){if(v+c>=n){(s||(s=[])).push({type:"overlong_rowspan",pos:d,n:b-v});break}const x=r+v*t;for(let C=0;C<g;C++){o[x+C]==0?o[x+C]=d:(s||(s=[])).push({type:"collision",row:c,pos:d,n:g-C});const M=k&&k[C];if(M){const E=(x+C)%t*2,A=i[E];A==null||A!=M&&i[E+1]==1?(i[E]=M,i[E+1]=1):A==M&&i[E+1]++}}}r+=g,d+=m.nodeSize}const h=(c+1)*t;let f=0;for(;r<h;)o[r++]==0&&f++;f&&(s||(s=[])).push({type:"missing",row:c,n:f}),d++}(t===0||n===0)&&(s||(s=[])).push({type:"zero_sized"});const l=new j(t,n,o,s);let a=!1;for(let c=0;!a&&c<i.length;c+=2)i[c]!=null&&i[c+1]<n&&(a=!0);return a&&Op(l,i,e),l}function Pp(e){let t=-1,n=!1;for(let o=0;o<e.childCount;o++){const r=e.child(o);let s=0;if(n)for(let i=0;i<o;i++){const l=e.child(i);for(let a=0;a<l.childCount;a++){const c=l.child(a);i+c.attrs.rowspan>o&&(s+=c.attrs.colspan)}}for(let i=0;i<r.childCount;i++){const l=r.child(i);s+=l.attrs.colspan,l.attrs.rowspan>1&&(n=!0)}t==-1?t=s:t!=s&&(t=Math.max(t,s))}return t}function Op(e,t,n){e.problems||(e.problems=[]);const o={};for(let r=0;r<e.map.length;r++){const s=e.map[r];if(o[s])continue;o[s]=!0;const i=n.nodeAt(s);if(!i)throw new RangeError(`No cell with offset ${s} found`);let l=null;const a=i.attrs;for(let c=0;c<a.colspan;c++){const d=(r+c)%e.width,u=t[d*2];u!=null&&(!a.colwidth||a.colwidth[c]!=u)&&((l||(l=Bp(a)))[c]=u)}l&&e.problems.unshift({type:"colwidth mismatch",pos:s,colwidth:l})}}function Bp(e){if(e.colwidth)return e.colwidth.slice();const t=[];for(let n=0;n<e.colspan;n++)t.push(0);return t}function dt(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(const n in e.nodes){const o=e.nodes[n],r=o.spec.tableRole;r&&(t[r]=o)}}return t}var fe=new R("selectingCells");function fn(e){for(let t=e.depth-1;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return e.node(0).resolve(e.before(t+1));return null}function Dp(e){for(let t=e.depth;t>0;t--){const n=e.node(t).type.spec.tableRole;if(n==="cell"||n==="header_cell")return e.node(t)}return null}function Jt(e){const t=e.selection.$head;for(let n=t.depth;n>0;n--)if(t.node(n).type.spec.tableRole=="row")return!0;return!1}function _i(e){const t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&t.node.type.spec.tableRole=="cell")return t.$anchor;const n=fn(t.$head)||Rp(t.$head);if(n)return n;throw new RangeError(`No cell found around position ${t.head}`)}function Rp(e){for(let t=e.nodeAfter,n=e.pos;t;t=t.firstChild,n++){const o=t.type.spec.tableRole;if(o=="cell"||o=="header_cell")return e.doc.resolve(n)}for(let t=e.nodeBefore,n=e.pos;t;t=t.lastChild,n--){const o=t.type.spec.tableRole;if(o=="cell"||o=="header_cell")return e.doc.resolve(n-t.nodeSize)}}function Rs(e){return e.parent.type.spec.tableRole=="row"&&!!e.nodeAfter}function Np(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function Li(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function Ic(e,t,n){const o=e.node(-1),r=j.get(o),s=e.start(-1),i=r.nextCell(e.pos-s,t,n);return i==null?null:e.node(0).resolve(s+i)}function Ue(e,t,n=1){const o={...e,colspan:e.colspan-n};return o.colwidth&&(o.colwidth=o.colwidth.slice(),o.colwidth.splice(t,n),o.colwidth.some(r=>r>0)||(o.colwidth=null)),o}function Pc(e,t,n=1){const o={...e,colspan:e.colspan+n};if(o.colwidth){o.colwidth=o.colwidth.slice();for(let r=0;r<n;r++)o.colwidth.splice(t,0,0)}return o}function Hp(e,t,n){const o=dt(t.type.schema).header_cell;for(let r=0;r<e.height;r++)if(t.nodeAt(e.map[n+r*e.width]).type!=o)return!1;return!0}var U=class ne extends G{constructor(t,n=t){const o=t.node(-1),r=j.get(o),s=t.start(-1),i=r.rectBetween(t.pos-s,n.pos-s),l=t.node(0),a=r.cellsInRect(i).filter(d=>d!=n.pos-s);a.unshift(n.pos-s);const c=a.map(d=>{const u=o.nodeAt(d);if(!u)throw RangeError(`No cell with offset ${d} found`);const h=s+d+1;return new wh(l.resolve(h),l.resolve(h+u.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=t,this.$headCell=n}map(t,n){const o=t.resolve(n.map(this.$anchorCell.pos)),r=t.resolve(n.map(this.$headCell.pos));if(Rs(o)&&Rs(r)&&Li(o,r)){const s=this.$anchorCell.node(-1)!=o.node(-1);return s&&this.isRowSelection()?ne.rowSelection(o,r):s&&this.isColSelection()?ne.colSelection(o,r):new ne(o,r)}return B.between(o,r)}content(){const t=this.$anchorCell.node(-1),n=j.get(t),o=this.$anchorCell.start(-1),r=n.rectBetween(this.$anchorCell.pos-o,this.$headCell.pos-o),s={},i=[];for(let a=r.top;a<r.bottom;a++){const c=[];for(let d=a*n.width+r.left,u=r.left;u<r.right;u++,d++){const h=n.map[d];if(s[h])continue;s[h]=!0;const f=n.findCell(h);let p=t.nodeAt(h);if(!p)throw RangeError(`No cell with offset ${h} found`);const m=r.left-f.left,g=f.right-r.right;if(m>0||g>0){let b=p.attrs;if(m>0&&(b=Ue(b,0,m)),g>0&&(b=Ue(b,b.colspan-g,g)),f.left<r.left){if(p=p.type.createAndFill(b),!p)throw RangeError(`Could not create cell with attrs ${JSON.stringify(b)}`)}else p=p.type.create(b,p.content)}if(f.top<r.top||f.bottom>r.bottom){const b={...p.attrs,rowspan:Math.min(f.bottom,r.bottom)-Math.max(f.top,r.top)};f.top<r.top?p=p.type.createAndFill(b):p=p.type.create(b,p.content)}c.push(p)}i.push(t.child(a).copy(I.from(c)))}const l=this.isColSelection()&&this.isRowSelection()?t:i;return new K(I.from(l),1,1)}replace(t,n=K.empty){const o=t.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){const{$from:l,$to:a}=r[i],c=t.mapping.slice(o);t.replace(c.map(l.pos),c.map(a.pos),i?K.empty:n)}const s=G.findFrom(t.doc.resolve(t.mapping.slice(o).map(this.to)),-1);s&&t.setSelection(s)}replaceWith(t,n){this.replace(t,new K(I.from(n),0,0))}forEachCell(t){const n=this.$anchorCell.node(-1),o=j.get(n),r=this.$anchorCell.start(-1),s=o.cellsInRect(o.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r));for(let i=0;i<s.length;i++)t(n.nodeAt(s[i]),r+s[i])}isColSelection(){const t=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(t,n)>0)return!1;const o=t+this.$anchorCell.nodeAfter.attrs.rowspan,r=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(o,r)==this.$headCell.node(-1).childCount}static colSelection(t,n=t){const o=t.node(-1),r=j.get(o),s=t.start(-1),i=r.findCell(t.pos-s),l=r.findCell(n.pos-s),a=t.node(0);return i.top<=l.top?(i.top>0&&(t=a.resolve(s+r.map[i.left])),l.bottom<r.height&&(n=a.resolve(s+r.map[r.width*(r.height-1)+l.right-1]))):(l.top>0&&(n=a.resolve(s+r.map[l.left])),i.bottom<r.height&&(t=a.resolve(s+r.map[r.width*(r.height-1)+i.right-1]))),new ne(t,n)}isRowSelection(){const t=this.$anchorCell.node(-1),n=j.get(t),o=this.$anchorCell.start(-1),r=n.colCount(this.$anchorCell.pos-o),s=n.colCount(this.$headCell.pos-o);if(Math.min(r,s)>0)return!1;const i=r+this.$anchorCell.nodeAfter.attrs.colspan,l=s+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,l)==n.width}eq(t){return t instanceof ne&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,n=t){const o=t.node(-1),r=j.get(o),s=t.start(-1),i=r.findCell(t.pos-s),l=r.findCell(n.pos-s),a=t.node(0);return i.left<=l.left?(i.left>0&&(t=a.resolve(s+r.map[i.top*r.width])),l.right<r.width&&(n=a.resolve(s+r.map[r.width*(l.top+1)-1]))):(l.left>0&&(n=a.resolve(s+r.map[l.top*r.width])),i.right<r.width&&(t=a.resolve(s+r.map[r.width*(i.top+1)-1]))),new ne(t,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,n){return new ne(t.resolve(n.anchor),t.resolve(n.head))}static create(t,n,o=n){return new ne(t.resolve(n),t.resolve(o))}getBookmark(){return new Up(this.$anchorCell.pos,this.$headCell.pos)}};U.prototype.visible=!1;G.jsonID("cell",U);var Up=class Oc{constructor(t,n){this.anchor=t,this.head=n}map(t){return new Oc(t.map(this.anchor),t.map(this.head))}resolve(t){const n=t.resolve(this.anchor),o=t.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&o.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&o.index()<o.parent.childCount&&Li(n,o)?new U(n,o):G.near(o,1)}};function Vp(e){if(!(e.selection instanceof U))return null;const t=[];return e.selection.forEachCell((n,o)=>{t.push(it.node(o,o+n.nodeSize,{class:"selectedCell"}))}),tt.create(e.doc,t)}function $p({$from:e,$to:t}){if(e.pos==t.pos||e.pos<t.pos-6)return!1;let n=e.pos,o=t.pos,r=e.depth;for(;r>=0&&!(e.after(r+1)<e.end(r));r--,n++);for(let s=t.depth;s>=0&&!(t.before(s+1)>t.start(s));s--,o--);return n==o&&/row|table/.test(e.node(r).type.spec.tableRole)}function Fp({$from:e,$to:t}){let n,o;for(let r=e.depth;r>0;r--){const s=e.node(r);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){n=s;break}}for(let r=t.depth;r>0;r--){const s=t.node(r);if(s.type.spec.tableRole==="cell"||s.type.spec.tableRole==="header_cell"){o=s;break}}return n!==o&&t.parentOffset===0}function zp(e,t,n){const o=(t||e).selection,r=(t||e).doc;let s,i;if(o instanceof xt&&(i=o.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")s=U.create(r,o.from);else if(i=="row"){const l=r.resolve(o.from+1);s=U.rowSelection(l,l)}else if(!n){const l=j.get(o.node),a=o.from+1,c=a+l.map[l.width*l.height-1];s=U.create(r,a+1,c)}}else o instanceof B&&$p(o)?s=B.create(r,o.from):o instanceof B&&Fp(o)&&(s=B.create(r,o.$from.start(),o.$from.end()));return s&&(t||(t=e.tr)).setSelection(s),t}var jp=new R("fix-tables");function Bc(e,t,n,o){const r=e.childCount,s=t.childCount;t:for(let i=0,l=0;i<s;i++){const a=t.child(i);for(let c=l,d=Math.min(r,i+3);c<d;c++)if(e.child(c)==a){l=c+1,n+=a.nodeSize;continue t}o(a,n),l<r&&e.child(l).sameMarkup(a)?Bc(e.child(l),a,n+1,o):a.nodesBetween(0,a.content.size,o,n+1),n+=a.nodeSize}}function Wp(e,t){let n;const o=(r,s)=>{r.type.spec.tableRole=="table"&&(n=Gp(e,r,s,n))};return t?t.doc!=e.doc&&Bc(t.doc,e.doc,0,o):e.doc.descendants(o),n}function Gp(e,t,n,o){const r=j.get(t);if(!r.problems)return o;o||(o=e.tr);const s=[];for(let a=0;a<r.height;a++)s.push(0);for(let a=0;a<r.problems.length;a++){const c=r.problems[a];if(c.type=="collision"){const d=t.nodeAt(c.pos);if(!d)continue;const u=d.attrs;for(let h=0;h<u.rowspan;h++)s[c.row+h]+=c.n;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,Ue(u,u.colspan-c.n,c.n))}else if(c.type=="missing")s[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const d=t.nodeAt(c.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...d.attrs,rowspan:d.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const d=t.nodeAt(c.pos);if(!d)continue;o.setNodeMarkup(o.mapping.map(n+1+c.pos),null,{...d.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const d=o.mapping.map(n);o.delete(d,d+t.nodeSize)}}let i,l;for(let a=0;a<s.length;a++)s[a]&&(i==null&&(i=a),l=a);for(let a=0,c=n+1;a<r.height;a++){const d=t.child(a),u=c+d.nodeSize,h=s[a];if(h>0){let f="cell";d.firstChild&&(f=d.firstChild.type.spec.tableRole);const p=[];for(let g=0;g<h;g++){const b=dt(e.schema)[f].createAndFill();b&&p.push(b)}const m=(a==0||i==a-1)&&l==a?c+1:u-1;o.insert(o.mapping.map(m),p)}c=u}return o.setMeta(jp,{fixTables:!0})}function Yt(e){const t=e.selection,n=_i(e),o=n.node(-1),r=n.start(-1),s=j.get(o);return{...t instanceof U?s.rectBetween(t.$anchorCell.pos-r,t.$headCell.pos-r):s.findCell(n.pos-r),tableStart:r,map:s,table:o}}function Dc(e,{map:t,tableStart:n,table:o},r){let s=r>0?-1:0;Hp(t,o,r+s)&&(s=r==0||r==t.width?null:0);for(let i=0;i<t.height;i++){const l=i*t.width+r;if(r>0&&r<t.width&&t.map[l-1]==t.map[l]){const a=t.map[l],c=o.nodeAt(a);e.setNodeMarkup(e.mapping.map(n+a),null,Pc(c.attrs,r-t.colCount(a))),i+=c.attrs.rowspan-1}else{const a=s==null?dt(o.type.schema).cell:o.nodeAt(t.map[l+s]).type,c=t.positionAt(i,r,o);e.insert(e.mapping.map(n+c),a.createAndFill())}}return e}function Kp(e,t){if(!Jt(e))return!1;if(t){const n=Yt(e);t(Dc(e.tr,n,n.left))}return!0}function qp(e,t){if(!Jt(e))return!1;if(t){const n=Yt(e);t(Dc(e.tr,n,n.right))}return!0}function Jp(e,{map:t,table:n,tableStart:o},r){const s=e.mapping.maps.length;for(let i=0;i<t.height;){const l=i*t.width+r,a=t.map[l],c=n.nodeAt(a),d=c.attrs;if(r>0&&t.map[l-1]==a||r<t.width-1&&t.map[l+1]==a)e.setNodeMarkup(e.mapping.slice(s).map(o+a),null,Ue(d,r-t.colCount(a)));else{const u=e.mapping.slice(s).map(o+a);e.delete(u,u+c.nodeSize)}i+=d.rowspan}}function Yp(e,t){if(!Jt(e))return!1;if(t){const n=Yt(e),o=e.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let r=n.right-1;Jp(o,n,r),r!=n.left;r--){const s=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!s)throw RangeError("No table found");n.table=s,n.map=j.get(s)}t(o)}return!0}function Xp(e,t,n){var o;const r=dt(t.type.schema).header_cell;for(let s=0;s<e.width;s++)if(((o=t.nodeAt(e.map[s+n*e.width]))==null?void 0:o.type)!=r)return!1;return!0}function Rc(e,{map:t,tableStart:n,table:o},r){var s;let i=n;for(let c=0;c<r;c++)i+=o.child(c).nodeSize;const l=[];let a=r>0?-1:0;Xp(t,o,r+a)&&(a=r==0||r==t.height?null:0);for(let c=0,d=t.width*r;c<t.width;c++,d++)if(r>0&&r<t.height&&t.map[d]==t.map[d-t.width]){const u=t.map[d],h=o.nodeAt(u).attrs;e.setNodeMarkup(n+u,null,{...h,rowspan:h.rowspan+1}),c+=h.colspan-1}else{const u=a==null?dt(o.type.schema).cell:(s=o.nodeAt(t.map[d+a*t.width]))==null?void 0:s.type,h=u==null?void 0:u.createAndFill();h&&l.push(h)}return e.insert(i,dt(o.type.schema).row.create(null,l)),e}function Qp(e,t){if(!Jt(e))return!1;if(t){const n=Yt(e);t(Rc(e.tr,n,n.top))}return!0}function Zp(e,t){if(!Jt(e))return!1;if(t){const n=Yt(e);t(Rc(e.tr,n,n.bottom))}return!0}function tm(e,{map:t,table:n,tableStart:o},r){let s=0;for(let c=0;c<r;c++)s+=n.child(c).nodeSize;const i=s+n.child(r).nodeSize,l=e.mapping.maps.length;e.delete(s+o,i+o);const a=new Set;for(let c=0,d=r*t.width;c<t.width;c++,d++){const u=t.map[d];if(!a.has(u)){if(a.add(u),r>0&&u==t.map[d-t.width]){const h=n.nodeAt(u).attrs;e.setNodeMarkup(e.mapping.slice(l).map(u+o),null,{...h,rowspan:h.rowspan-1}),c+=h.colspan-1}else if(r<t.height&&u==t.map[d+t.width]){const h=n.nodeAt(u),f=h.attrs,p=h.type.create({...f,rowspan:h.attrs.rowspan-1},h.content),m=t.positionAt(r+1,c,n);e.insert(e.mapping.slice(l).map(o+m),p),c+=f.colspan-1}}}}function em(e,t){if(!Jt(e))return!1;if(t){const n=Yt(e),o=e.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let r=n.bottom-1;tm(o,n,r),r!=n.top;r--){const s=n.tableStart?o.doc.nodeAt(n.tableStart-1):o.doc;if(!s)throw RangeError("No table found");n.table=s,n.map=j.get(n.table)}t(o)}return!0}function Bl(e){const t=e.content;return t.childCount==1&&t.child(0).isTextblock&&t.child(0).childCount==0}function nm({width:e,height:t,map:n},o){let r=o.top*e+o.left,s=r,i=(o.bottom-1)*e+o.left,l=r+(o.right-o.left-1);for(let a=o.top;a<o.bottom;a++){if(o.left>0&&n[s]==n[s-1]||o.right<e&&n[l]==n[l+1])return!0;s+=e,l+=e}for(let a=o.left;a<o.right;a++){if(o.top>0&&n[r]==n[r-e]||o.bottom<t&&n[i]==n[i+e])return!0;r++,i++}return!1}function om(e,t){const n=e.selection;if(!(n instanceof U)||n.$anchorCell.pos==n.$headCell.pos)return!1;const o=Yt(e),{map:r}=o;if(nm(r,o))return!1;if(t){const s=e.tr,i={};let l=I.empty,a,c;for(let d=o.top;d<o.bottom;d++)for(let u=o.left;u<o.right;u++){const h=r.map[d*r.width+u],f=o.table.nodeAt(h);if(!(i[h]||!f))if(i[h]=!0,a==null)a=h,c=f;else{Bl(f)||(l=l.append(f.content));const p=s.mapping.map(h+o.tableStart);s.delete(p,p+f.nodeSize)}}if(a==null||c==null)return!0;if(s.setNodeMarkup(a+o.tableStart,null,{...Pc(c.attrs,c.attrs.colspan,o.right-o.left-c.attrs.colspan),rowspan:o.bottom-o.top}),l.size){const d=a+1+c.content.size,u=Bl(c)?a+1:d;s.replaceWith(u+o.tableStart,d+o.tableStart,l)}s.setSelection(new U(s.doc.resolve(a+o.tableStart))),t(s)}return!0}function rm(e,t){const n=dt(e.schema);return sm(({node:o})=>n[o.type.spec.tableRole])(e,t)}function sm(e){return(t,n)=>{var o;const r=t.selection;let s,i;if(r instanceof U){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;s=r.$anchorCell.nodeAfter,i=r.$anchorCell.pos}else{if(s=Dp(r.$from),!s)return!1;i=(o=fn(r.$from))==null?void 0:o.pos}if(s==null||i==null||s.attrs.colspan==1&&s.attrs.rowspan==1)return!1;if(n){let l=s.attrs;const a=[],c=l.colwidth;l.rowspan>1&&(l={...l,rowspan:1}),l.colspan>1&&(l={...l,colspan:1});const d=Yt(t),u=t.tr;for(let f=0;f<d.right-d.left;f++)a.push(c?{...l,colwidth:c&&c[f]?[c[f]]:null}:l);let h;for(let f=d.top;f<d.bottom;f++){let p=d.map.positionAt(f,d.left,d.table);f==d.top&&(p+=s.nodeSize);for(let m=d.left,g=0;m<d.right;m++,g++)m==d.left&&f==d.top||u.insert(h=u.mapping.map(p+d.tableStart,1),e({node:s,row:f,col:m}).createAndFill(a[g]))}u.setNodeMarkup(i,e({node:s,row:d.top,col:d.left}),a[0]),r instanceof U&&u.setSelection(new U(u.doc.resolve(r.$anchorCell.pos),h?u.doc.resolve(h):void 0)),n(u)}return!0}}function im(e){return function(t,n){if(!Jt(t))return!1;if(n){const o=dt(t.schema),r=Yt(t),s=t.tr,i=r.map.cellsInRect(e=="column"?{left:r.left,top:0,right:r.right,bottom:r.map.height}:e=="row"?{left:0,top:r.top,right:r.map.width,bottom:r.bottom}:r),l=i.map(a=>r.table.nodeAt(a));for(let a=0;a<i.length;a++)l[a].type==o.header_cell&&s.setNodeMarkup(r.tableStart+i[a],o.cell,l[a].attrs);if(s.steps.length==0)for(let a=0;a<i.length;a++)s.setNodeMarkup(r.tableStart+i[a],o.header_cell,l[a].attrs);n(s)}return!0}}function Dl(e,t,n){const o=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(let r=0;r<o.length;r++){const s=t.table.nodeAt(o[r]);if(s&&s.type!==n.header_cell)return!1}return!0}function Ii(e,t){return t=t||{useDeprecatedLogic:!1},t.useDeprecatedLogic?im(e):function(n,o){if(!Jt(n))return!1;if(o){const r=dt(n.schema),s=Yt(n),i=n.tr,l=Dl("row",s,r),a=Dl("column",s,r),d=(e==="column"?l:e==="row"?a:!1)?1:0,u=e=="column"?{left:0,top:d,right:1,bottom:s.map.height}:e=="row"?{left:d,top:0,right:s.map.width,bottom:1}:s,h=e=="column"?a?r.cell:r.header_cell:e=="row"?l?r.cell:r.header_cell:r.cell;s.map.cellsInRect(u).forEach(f=>{const p=f+s.tableStart,m=i.doc.nodeAt(p);m&&i.setNodeMarkup(p,h,m.attrs)}),o(i)}return!0}}Ii("row",{useDeprecatedLogic:!0});Ii("column",{useDeprecatedLogic:!0});Ii("cell",{useDeprecatedLogic:!0});function lm(e,t){if(t<0){const n=e.nodeBefore;if(n)return e.pos-n.nodeSize;for(let o=e.index(-1)-1,r=e.before();o>=0;o--){const s=e.node(-1).child(o),i=s.lastChild;if(i)return r-1-i.nodeSize;r-=s.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;const n=e.node(-1);for(let o=e.indexAfter(-1),r=e.after();o<n.childCount;o++){const s=n.child(o);if(s.childCount)return r+1;r+=s.nodeSize}}return null}function Rl(e){return function(t,n){if(!Jt(t))return!1;const o=lm(_i(t),e);if(o==null)return!1;if(n){const r=t.doc.resolve(o);n(t.tr.setSelection(B.between(r,Np(r))).scrollIntoView())}return!0}}function go(e,t){const n=e.selection;if(!(n instanceof U))return!1;if(t){const o=e.tr,r=dt(e.schema).cell.createAndFill().content;n.forEachCell((s,i)=>{s.content.eq(r)||o.replace(o.mapping.map(i+1),o.mapping.map(i+s.nodeSize-1),new K(r,0,0))}),o.docChanged&&t(o)}return!0}function am(e){if(!e.size)return null;let{content:t,openStart:n,openEnd:o}=e;for(;t.childCount==1&&(n>0&&o>0||t.child(0).type.spec.tableRole=="table");)n--,o--,t=t.child(0).content;const r=t.child(0),s=r.type.spec.tableRole,i=r.type.schema,l=[];if(s=="row")for(let a=0;a<t.childCount;a++){let c=t.child(a).content;const d=a?0:Math.max(0,n-1),u=a<t.childCount-1?0:Math.max(0,o-1);(d||u)&&(c=Ns(dt(i).row,new K(c,d,u)).content),l.push(c)}else if(s=="cell"||s=="header_cell")l.push(n||o?Ns(dt(i).row,new K(t,n,o)).content:t);else return null;return cm(i,l)}function cm(e,t){const n=[];for(let r=0;r<t.length;r++){const s=t[r];for(let i=s.childCount-1;i>=0;i--){const{rowspan:l,colspan:a}=s.child(i).attrs;for(let c=r;c<r+l;c++)n[c]=(n[c]||0)+a}}let o=0;for(let r=0;r<n.length;r++)o=Math.max(o,n[r]);for(let r=0;r<n.length;r++)if(r>=t.length&&t.push(I.empty),n[r]<o){const s=dt(e).cell.createAndFill(),i=[];for(let l=n[r];l<o;l++)i.push(s);t[r]=t[r].append(I.from(i))}return{height:t.length,width:o,rows:t}}function Ns(e,t){const n=e.createAndFill();return new Xa(n).replace(0,n.content.size,t).doc}function dm({width:e,height:t,rows:n},o,r){if(e!=o){const s=[],i=[];for(let l=0;l<n.length;l++){const a=n[l],c=[];for(let d=s[l]||0,u=0;d<o;u++){let h=a.child(u%a.childCount);d+h.attrs.colspan>o&&(h=h.type.createChecked(Ue(h.attrs,h.attrs.colspan,d+h.attrs.colspan-o),h.content)),c.push(h),d+=h.attrs.colspan;for(let f=1;f<h.attrs.rowspan;f++)s[l+f]=(s[l+f]||0)+h.attrs.colspan}i.push(I.from(c))}n=i,e=o}if(t!=r){const s=[];for(let i=0,l=0;i<r;i++,l++){const a=[],c=n[l%t];for(let d=0;d<c.childCount;d++){let u=c.child(d);i+u.attrs.rowspan>r&&(u=u.type.create({...u.attrs,rowspan:Math.max(1,r-u.attrs.rowspan)},u.content)),a.push(u)}s.push(I.from(a))}n=s,t=r}return{width:e,height:t,rows:n}}function um(e,t,n,o,r,s,i){const l=e.doc.type.schema,a=dt(l);let c,d;if(r>t.width)for(let u=0,h=0;u<t.height;u++){const f=n.child(u);h+=f.nodeSize;const p=[];let m;f.lastChild==null||f.lastChild.type==a.cell?m=c||(c=a.cell.createAndFill()):m=d||(d=a.header_cell.createAndFill());for(let g=t.width;g<r;g++)p.push(m);e.insert(e.mapping.slice(i).map(h-1+o),p)}if(s>t.height){const u=[];for(let p=0,m=(t.height-1)*t.width;p<Math.max(t.width,r);p++){const g=p>=t.width?!1:n.nodeAt(t.map[m+p]).type==a.header_cell;u.push(g?d||(d=a.header_cell.createAndFill()):c||(c=a.cell.createAndFill()))}const h=a.row.create(null,I.from(u)),f=[];for(let p=t.height;p<s;p++)f.push(h);e.insert(e.mapping.slice(i).map(o+n.nodeSize-2),f)}return!!(c||d)}function Nl(e,t,n,o,r,s,i,l){if(i==0||i==t.height)return!1;let a=!1;for(let c=r;c<s;c++){const d=i*t.width+c,u=t.map[d];if(t.map[d-t.width]==u){a=!0;const h=n.nodeAt(u),{top:f,left:p}=t.findCell(u);e.setNodeMarkup(e.mapping.slice(l).map(u+o),null,{...h.attrs,rowspan:i-f}),e.insert(e.mapping.slice(l).map(t.positionAt(i,p,n)),h.type.createAndFill({...h.attrs,rowspan:f+h.attrs.rowspan-i})),c+=h.attrs.colspan-1}}return a}function Hl(e,t,n,o,r,s,i,l){if(i==0||i==t.width)return!1;let a=!1;for(let c=r;c<s;c++){const d=c*t.width+i,u=t.map[d];if(t.map[d-1]==u){a=!0;const h=n.nodeAt(u),f=t.colCount(u),p=e.mapping.slice(l).map(u+o);e.setNodeMarkup(p,null,Ue(h.attrs,i-f,h.attrs.colspan-(i-f))),e.insert(p+h.nodeSize,h.type.createAndFill(Ue(h.attrs,0,i-f))),c+=h.attrs.rowspan-1}}return a}function Ul(e,t,n,o,r){let s=n?e.doc.nodeAt(n-1):e.doc;if(!s)throw new Error("No table found");let i=j.get(s);const{top:l,left:a}=o,c=a+r.width,d=l+r.height,u=e.tr;let h=0;function f(){if(s=n?u.doc.nodeAt(n-1):u.doc,!s)throw new Error("No table found");i=j.get(s),h=u.mapping.maps.length}um(u,i,s,n,c,d,h)&&f(),Nl(u,i,s,n,a,c,l,h)&&f(),Nl(u,i,s,n,a,c,d,h)&&f(),Hl(u,i,s,n,l,d,a,h)&&f(),Hl(u,i,s,n,l,d,c,h)&&f();for(let p=l;p<d;p++){const m=i.positionAt(p,a,s),g=i.positionAt(p,c,s);u.replace(u.mapping.slice(h).map(m+n),u.mapping.slice(h).map(g+n),new K(r.rows[p-l],0,0))}f(),u.setSelection(new U(u.doc.resolve(n+i.positionAt(l,a,s)),u.doc.resolve(n+i.positionAt(d-1,c-1,s)))),t(u)}var hm=sc({ArrowLeft:bo("horiz",-1),ArrowRight:bo("horiz",1),ArrowUp:bo("vert",-1),ArrowDown:bo("vert",1),"Shift-ArrowLeft":wo("horiz",-1),"Shift-ArrowRight":wo("horiz",1),"Shift-ArrowUp":wo("vert",-1),"Shift-ArrowDown":wo("vert",1),Backspace:go,"Mod-Backspace":go,Delete:go,"Mod-Delete":go});function Po(e,t,n){return n.eq(e.selection)?!1:(t&&t(e.tr.setSelection(n).scrollIntoView()),!0)}function bo(e,t){return(n,o,r)=>{if(!r)return!1;const s=n.selection;if(s instanceof U)return Po(n,o,G.near(s.$headCell,t));if(e!="horiz"&&!s.empty)return!1;const i=Nc(r,e,t);if(i==null)return!1;if(e=="horiz")return Po(n,o,G.near(n.doc.resolve(s.head+t),t));{const l=n.doc.resolve(i),a=Ic(l,e,t);let c;return a?c=G.near(a,1):t<0?c=G.near(n.doc.resolve(l.before(-1)),-1):c=G.near(n.doc.resolve(l.after(-1)),1),Po(n,o,c)}}}function wo(e,t){return(n,o,r)=>{if(!r)return!1;const s=n.selection;let i;if(s instanceof U)i=s;else{const a=Nc(r,e,t);if(a==null)return!1;i=new U(n.doc.resolve(a))}const l=Ic(i.$headCell,e,t);return l?Po(n,o,new U(i.$anchorCell,l)):!1}}function fm(e,t){const n=e.state.doc,o=fn(n.resolve(t));return o?(e.dispatch(e.state.tr.setSelection(new U(o))),!0):!1}function pm(e,t,n){if(!Jt(e.state))return!1;let o=am(n);const r=e.state.selection;if(r instanceof U){o||(o={width:1,height:1,rows:[I.from(Ns(dt(e.state.schema).cell,n))]});const s=r.$anchorCell.node(-1),i=r.$anchorCell.start(-1),l=j.get(s).rectBetween(r.$anchorCell.pos-i,r.$headCell.pos-i);return o=dm(o,l.right-l.left,l.bottom-l.top),Ul(e.state,e.dispatch,i,l,o),!0}else if(o){const s=_i(e.state),i=s.start(-1);return Ul(e.state,e.dispatch,i,j.get(s.node(-1)).findCell(s.pos-i),o),!0}else return!1}function mm(e,t){var n;if(t.ctrlKey||t.metaKey)return;const o=Vl(e,t.target);let r;if(t.shiftKey&&e.state.selection instanceof U)s(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&o&&(r=fn(e.state.selection.$anchor))!=null&&((n=as(e,t))==null?void 0:n.pos)!=r.pos)s(r,t),t.preventDefault();else if(!o)return;function s(a,c){let d=as(e,c);const u=fe.getState(e.state)==null;if(!d||!Li(a,d))if(u)d=a;else return;const h=new U(a,d);if(u||!e.state.selection.eq(h)){const f=e.state.tr.setSelection(h);u&&f.setMeta(fe,a.pos),e.dispatch(f)}}function i(){e.root.removeEventListener("mouseup",i),e.root.removeEventListener("dragstart",i),e.root.removeEventListener("mousemove",l),fe.getState(e.state)!=null&&e.dispatch(e.state.tr.setMeta(fe,-1))}function l(a){const c=a,d=fe.getState(e.state);let u;if(d!=null)u=e.state.doc.resolve(d);else if(Vl(e,c.target)!=o&&(u=as(e,t),!u))return i();u&&s(u,c)}e.root.addEventListener("mouseup",i),e.root.addEventListener("dragstart",i),e.root.addEventListener("mousemove",l)}function Nc(e,t,n){if(!(e.state.selection instanceof B))return null;const{$head:o}=e.state.selection;for(let r=o.depth-1;r>=0;r--){const s=o.node(r);if((n<0?o.index(r):o.indexAfter(r))!=(n<0?0:s.childCount))return null;if(s.type.spec.tableRole=="cell"||s.type.spec.tableRole=="header_cell"){const l=o.before(r),a=t=="vert"?n>0?"down":"up":n>0?"right":"left";return e.endOfTextblock(a)?l:null}}return null}function Vl(e,t){for(;t&&t!=e.dom;t=t.parentNode)if(t.nodeName=="TD"||t.nodeName=="TH")return t;return null}function as(e,t){const n=e.posAtCoords({left:t.clientX,top:t.clientY});return n&&n?fn(e.state.doc.resolve(n.pos)):null}var Hc=class{constructor(e,t){this.node=e,this.defaultCellMinWidth=t,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${t}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Hs(e,this.colgroup,this.table,t),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,Hs(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function Hs(e,t,n,o,r,s){var i;let l=0,a=!0,c=t.firstChild;const d=e.firstChild;if(d){for(let u=0,h=0;u<d.childCount;u++){const{colspan:f,colwidth:p}=d.child(u).attrs;for(let m=0;m<f;m++,h++){const g=r==h?s:p&&p[m],b=g?g+"px":"";if(l+=g||o,g||(a=!1),c)c.style.width!=b&&(c.style.width=b),c=c.nextSibling;else{const k=document.createElement("col");k.style.width=b,t.appendChild(k)}}}for(;c;){const u=c.nextSibling;(i=c.parentNode)==null||i.removeChild(c),c=u}a?(n.style.width=l+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=l+"px")}}var yt=new R("tableColumnResizing");function gm({handleWidth:e=5,cellMinWidth:t=25,defaultCellMinWidth:n=100,View:o=Hc,lastColumnResizable:r=!0}={}){const s=new O({key:yt,state:{init(i,l){var a,c;const d=(c=(a=s.spec)==null?void 0:a.props)==null?void 0:c.nodeViews,u=dt(l.schema).table.name;return o&&d&&(d[u]=(h,f)=>new o(h,n,f)),new bm(-1,!1)},apply(i,l){return l.apply(i)}},props:{attributes:i=>{const l=yt.getState(i);return l&&l.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(i,l)=>{wm(i,l,e,r)},mouseleave:i=>{km(i)},mousedown:(i,l)=>{ym(i,l,t,n)}},decorations:i=>{const l=yt.getState(i);if(l&&l.activeHandle>-1)return xm(i,l.activeHandle)},nodeViews:{}}});return s}var bm=class Oo{constructor(t,n){this.activeHandle=t,this.dragging=n}apply(t){const n=this,o=t.getMeta(yt);if(o&&o.setHandle!=null)return new Oo(o.setHandle,!1);if(o&&o.setDragging!==void 0)return new Oo(n.activeHandle,o.setDragging);if(n.activeHandle>-1&&t.docChanged){let r=t.mapping.map(n.activeHandle,-1);return Rs(t.doc.resolve(r))||(r=-1),new Oo(r,n.dragging)}return n}};function wm(e,t,n,o){if(!e.editable)return;const r=yt.getState(e.state);if(r&&!r.dragging){const s=Cm(t.target);let i=-1;if(s){const{left:l,right:a}=s.getBoundingClientRect();t.clientX-l<=n?i=$l(e,t,"left",n):a-t.clientX<=n&&(i=$l(e,t,"right",n))}if(i!=r.activeHandle){if(!o&&i!==-1){const l=e.state.doc.resolve(i),a=l.node(-1),c=j.get(a),d=l.start(-1);if(c.colCount(l.pos-d)+l.nodeAfter.attrs.colspan-1==c.width-1)return}Uc(e,i)}}}function km(e){if(!e.editable)return;const t=yt.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&Uc(e,-1)}function ym(e,t,n,o){var r;if(!e.editable)return!1;const s=(r=e.dom.ownerDocument.defaultView)!=null?r:window,i=yt.getState(e.state);if(!i||i.activeHandle==-1||i.dragging)return!1;const l=e.state.doc.nodeAt(i.activeHandle),a=vm(e,i.activeHandle,l.attrs);e.dispatch(e.state.tr.setMeta(yt,{setDragging:{startX:t.clientX,startWidth:a}}));function c(u){s.removeEventListener("mouseup",c),s.removeEventListener("mousemove",d);const h=yt.getState(e.state);h!=null&&h.dragging&&(Sm(e,h.activeHandle,Fl(h.dragging,u,n)),e.dispatch(e.state.tr.setMeta(yt,{setDragging:null})))}function d(u){if(!u.which)return c(u);const h=yt.getState(e.state);if(h&&h.dragging){const f=Fl(h.dragging,u,n);zl(e,h.activeHandle,f,o)}}return zl(e,i.activeHandle,a,o),s.addEventListener("mouseup",c),s.addEventListener("mousemove",d),t.preventDefault(),!0}function vm(e,t,{colspan:n,colwidth:o}){const r=o&&o[o.length-1];if(r)return r;const s=e.domAtPos(t);let l=s.node.childNodes[s.offset].offsetWidth,a=n;if(o)for(let c=0;c<n;c++)o[c]&&(l-=o[c],a--);return l/a}function Cm(e){for(;e&&e.nodeName!="TD"&&e.nodeName!="TH";)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}function $l(e,t,n,o){const r=n=="right"?-o:o,s=e.posAtCoords({left:t.clientX+r,top:t.clientY});if(!s)return-1;const{pos:i}=s,l=fn(e.state.doc.resolve(i));if(!l)return-1;if(n=="right")return l.pos;const a=j.get(l.node(-1)),c=l.start(-1),d=a.map.indexOf(l.pos-c);return d%a.width==0?-1:c+a.map[d-1]}function Fl(e,t,n){const o=t.clientX-e.startX;return Math.max(n,e.startWidth+o)}function Uc(e,t){e.dispatch(e.state.tr.setMeta(yt,{setHandle:t}))}function Sm(e,t,n){const o=e.state.doc.resolve(t),r=o.node(-1),s=j.get(r),i=o.start(-1),l=s.colCount(o.pos-i)+o.nodeAfter.attrs.colspan-1,a=e.state.tr;for(let c=0;c<s.height;c++){const d=c*s.width+l;if(c&&s.map[d]==s.map[d-s.width])continue;const u=s.map[d],h=r.nodeAt(u).attrs,f=h.colspan==1?0:l-s.colCount(u);if(h.colwidth&&h.colwidth[f]==n)continue;const p=h.colwidth?h.colwidth.slice():Em(h.colspan);p[f]=n,a.setNodeMarkup(i+u,null,{...h,colwidth:p})}a.docChanged&&e.dispatch(a)}function zl(e,t,n,o){const r=e.state.doc.resolve(t),s=r.node(-1),i=r.start(-1),l=j.get(s).colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1;let a=e.domAtPos(r.start(-1)).node;for(;a&&a.nodeName!="TABLE";)a=a.parentNode;a&&Hs(s,a.firstChild,a,o,l,n)}function Em(e){return Array(e).fill(0)}function xm(e,t){var n;const o=[],r=e.doc.resolve(t),s=r.node(-1);if(!s)return tt.empty;const i=j.get(s),l=r.start(-1),a=i.colCount(r.pos-l)+r.nodeAfter.attrs.colspan-1;for(let c=0;c<i.height;c++){const d=a+c*i.width;if((a==i.width-1||i.map[d]!=i.map[d+1])&&(c==0||i.map[d]!=i.map[d-i.width])){const u=i.map[d],h=l+u+s.nodeAt(u).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",(n=yt.getState(e))!=null&&n.dragging&&o.push(it.node(l+u,l+u+s.nodeAt(u).nodeSize,{class:"column-resize-dragging"})),o.push(it.widget(h,f))}}return tt.create(e.doc,o)}function Am({allowTableNodeSelection:e=!1}={}){return new O({key:fe,state:{init(){return null},apply(t,n){const o=t.getMeta(fe);if(o!=null)return o==-1?null:o;if(n==null||!t.docChanged)return n;const{deleted:r,pos:s}=t.mapping.mapResult(n);return r?null:s}},props:{decorations:Vp,handleDOMEvents:{mousedown:mm},createSelectionBetween(t){return fe.getState(t.state)!=null?t.state.selection:null},handleTripleClick:fm,handleKeyDown:hm,handlePaste:pm},appendTransaction(t,n,o){return zp(o,Wp(o,n),e)}})}class J extends G{constructor(t){super(t,t)}map(t,n){let o=t.resolve(n.map(this.head));return J.valid(o)?new J(o):G.near(o)}content(){return K.empty}eq(t){return t instanceof J&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new J(t.resolve(n.pos))}getBookmark(){return new Pi(this.anchor)}static valid(t){let n=t.parent;if(n.isTextblock||!Mm(t)||!Tm(t))return!1;let o=n.type.spec.allowGapCursor;if(o!=null)return o;let r=n.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(t,n,o=!1){t:for(;;){if(!o&&J.valid(t))return t;let r=t.pos,s=null;for(let i=t.depth;;i--){let l=t.node(i);if(n>0?t.indexAfter(i)<l.childCount:t.index(i)>0){s=l.child(n>0?t.indexAfter(i):t.index(i)-1);break}else if(i==0)return null;r+=n;let a=t.doc.resolve(r);if(J.valid(a))return a}for(;;){let i=n>0?s.firstChild:s.lastChild;if(!i){if(s.isAtom&&!s.isText&&!xt.isSelectable(s)){t=t.doc.resolve(r+s.nodeSize*n),o=!1;continue t}break}s=i,r+=n;let l=t.doc.resolve(r);if(J.valid(l))return l}return null}}}J.prototype.visible=!1;J.findFrom=J.findGapCursorFrom;G.jsonID("gapcursor",J);class Pi{constructor(t){this.pos=t}map(t){return new Pi(t.map(this.pos))}resolve(t){let n=t.resolve(this.pos);return J.valid(n)?new J(n):G.near(n)}}function Mm(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),o=e.node(t);if(n==0){if(o.type.spec.isolating)return!0;continue}for(let r=o.child(n-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function Tm(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),o=e.node(t);if(n==o.childCount){if(o.type.spec.isolating)return!0;continue}for(let r=o.child(n);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||r.isAtom||r.type.spec.isolating)return!0;if(r.inlineContent)return!1}}return!0}function _m(){return new O({props:{decorations:Om,createSelectionBetween(e,t,n){return t.pos==n.pos&&J.valid(n)?new J(n):null},handleClick:Im,handleKeyDown:Lm,handleDOMEvents:{beforeinput:Pm}}})}const Lm=sc({ArrowLeft:ko("horiz",-1),ArrowRight:ko("horiz",1),ArrowUp:ko("vert",-1),ArrowDown:ko("vert",1)});function ko(e,t){const n=e=="vert"?t>0?"down":"up":t>0?"right":"left";return function(o,r,s){let i=o.selection,l=t>0?i.$to:i.$from,a=i.empty;if(i instanceof B){if(!s.endOfTextblock(n)||l.depth==0)return!1;a=!1,l=o.doc.resolve(t>0?l.after():l.before())}let c=J.findGapCursorFrom(l,t,a);return c?(r&&r(o.tr.setSelection(new J(c))),!0):!1}}function Im(e,t,n){if(!e||!e.editable)return!1;let o=e.state.doc.resolve(t);if(!J.valid(o))return!1;let r=e.posAtCoords({left:n.clientX,top:n.clientY});return r&&r.inside>-1&&xt.isSelectable(e.state.doc.nodeAt(r.inside))?!1:(e.dispatch(e.state.tr.setSelection(new J(o))),!0)}function Pm(e,t){if(t.inputType!="insertCompositionText"||!(e.state.selection instanceof J))return!1;let{$from:n}=e.state.selection,o=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!o)return!1;let r=I.empty;for(let i=o.length-1;i>=0;i--)r=I.from(o[i].createAndFill(null,r));let s=e.state.tr.replace(n.pos,n.pos,new K(r,0,0));return s.setSelection(B.near(s.doc.resolve(n.pos+1))),e.dispatch(s),!1}function Om(e){if(!(e.selection instanceof J))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",tt.create(e.doc,[it.widget(e.selection.head,t,{key:"gapcursor"})])}const Bm=$.create({name:"gapCursor",addProseMirrorPlugins(){return[_m()]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=P(S(e,"allowGapCursor",n)))!==null&&t!==void 0?t:null}}}),Dm=$.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>lc(e,t),redo:()=>({state:e,dispatch:t})=>ic(e,t)}},addProseMirrorPlugins(){return[kh(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),Rm="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Nm="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",ln=(e,t)=>{for(const n in t)e[n]=t[n];return e},Us="numeric",Vs="ascii",$s="alpha",Mn="asciinumeric",En="alphanumeric",Fs="domain",Vc="emoji",Hm="scheme",Um="slashscheme",cs="whitespace";function Vm(e,t){return e in t||(t[e]=[]),t[e]}function Oe(e,t,n){t[Us]&&(t[Mn]=!0,t[En]=!0),t[Vs]&&(t[Mn]=!0,t[$s]=!0),t[Mn]&&(t[En]=!0),t[$s]&&(t[En]=!0),t[En]&&(t[Fs]=!0),t[Vc]&&(t[Fs]=!0);for(const o in t){const r=Vm(o,n);r.indexOf(e)<0&&r.push(e)}}function $m(e,t){const n={};for(const o in t)t[o].indexOf(e)>=0&&(n[o]=!0);return n}function gt(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}gt.groups={};gt.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let o=0;o<t.jr.length;o++){const r=t.jr[o][0],s=t.jr[o][1];if(s&&r.test(e))return s}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,o){for(let r=0;r<e.length;r++)this.tt(e[r],t,n,o)},tr(e,t,n,o){o=o||gt.groups;let r;return t&&t.j?r=t:(r=new gt(t),n&&o&&Oe(t,n,o)),this.jr.push([e,r]),r},ts(e,t,n,o){let r=this;const s=e.length;if(!s)return r;for(let i=0;i<s-1;i++)r=r.tt(e[i]);return r.tt(e[s-1],t,n,o)},tt(e,t,n,o){o=o||gt.groups;const r=this;if(t&&t.j)return r.j[e]=t,t;const s=t;let i,l=r.go(e);if(l?(i=new gt,ln(i.j,l.j),i.jr.push.apply(i.jr,l.jr),i.jd=l.jd,i.t=l.t):i=new gt,s){if(o)if(i.t&&typeof i.t=="string"){const a=ln($m(i.t,o),n);Oe(s,a,o)}else n&&Oe(s,n,o);i.t=s}return r.j[e]=i,i}};const _=(e,t,n,o,r)=>e.ta(t,n,o,r),q=(e,t,n,o,r)=>e.tr(t,n,o,r),jl=(e,t,n,o,r)=>e.ts(t,n,o,r),y=(e,t,n,o,r)=>e.tt(t,n,o,r),oe="WORD",zs="UWORD",$c="ASCIINUMERICAL",Fc="ALPHANUMERICAL",Hn="LOCALHOST",js="TLD",Ws="UTLD",Bo="SCHEME",Ye="SLASH_SCHEME",Oi="NUM",Gs="WS",Bi="NL",Tn="OPENBRACE",_n="CLOSEBRACE",Ko="OPENBRACKET",qo="CLOSEBRACKET",Jo="OPENPAREN",Yo="CLOSEPAREN",Xo="OPENANGLEBRACKET",Qo="CLOSEANGLEBRACKET",Zo="FULLWIDTHLEFTPAREN",tr="FULLWIDTHRIGHTPAREN",er="LEFTCORNERBRACKET",nr="RIGHTCORNERBRACKET",or="LEFTWHITECORNERBRACKET",rr="RIGHTWHITECORNERBRACKET",sr="FULLWIDTHLESSTHAN",ir="FULLWIDTHGREATERTHAN",lr="AMPERSAND",ar="APOSTROPHE",cr="ASTERISK",he="AT",dr="BACKSLASH",ur="BACKTICK",hr="CARET",pe="COLON",Di="COMMA",fr="DOLLAR",Ft="DOT",pr="EQUALS",Ri="EXCLAMATION",_t="HYPHEN",Ln="PERCENT",mr="PIPE",gr="PLUS",br="POUND",In="QUERY",Ni="QUOTE",zc="FULLWIDTHMIDDLEDOT",Hi="SEMI",zt="SLASH",Pn="TILDE",wr="UNDERSCORE",jc="EMOJI",kr="SYM";var Wc=Object.freeze({__proto__:null,ALPHANUMERICAL:Fc,AMPERSAND:lr,APOSTROPHE:ar,ASCIINUMERICAL:$c,ASTERISK:cr,AT:he,BACKSLASH:dr,BACKTICK:ur,CARET:hr,CLOSEANGLEBRACKET:Qo,CLOSEBRACE:_n,CLOSEBRACKET:qo,CLOSEPAREN:Yo,COLON:pe,COMMA:Di,DOLLAR:fr,DOT:Ft,EMOJI:jc,EQUALS:pr,EXCLAMATION:Ri,FULLWIDTHGREATERTHAN:ir,FULLWIDTHLEFTPAREN:Zo,FULLWIDTHLESSTHAN:sr,FULLWIDTHMIDDLEDOT:zc,FULLWIDTHRIGHTPAREN:tr,HYPHEN:_t,LEFTCORNERBRACKET:er,LEFTWHITECORNERBRACKET:or,LOCALHOST:Hn,NL:Bi,NUM:Oi,OPENANGLEBRACKET:Xo,OPENBRACE:Tn,OPENBRACKET:Ko,OPENPAREN:Jo,PERCENT:Ln,PIPE:mr,PLUS:gr,POUND:br,QUERY:In,QUOTE:Ni,RIGHTCORNERBRACKET:nr,RIGHTWHITECORNERBRACKET:rr,SCHEME:Bo,SEMI:Hi,SLASH:zt,SLASH_SCHEME:Ye,SYM:kr,TILDE:Pn,TLD:js,UNDERSCORE:wr,UTLD:Ws,UWORD:zs,WORD:oe,WS:Gs});const Zt=/[a-z]/,Cn=new RegExp("\\p{L}","u"),ds=new RegExp("\\p{Emoji}","u"),te=/\d/,us=/\s/,Wl="\r",hs=`
`,Fm="️",zm="‍",fs="￼";let yo=null,vo=null;function jm(e=[]){const t={};gt.groups=t;const n=new gt;yo==null&&(yo=Gl(Rm)),vo==null&&(vo=Gl(Nm)),y(n,"'",ar),y(n,"{",Tn),y(n,"}",_n),y(n,"[",Ko),y(n,"]",qo),y(n,"(",Jo),y(n,")",Yo),y(n,"<",Xo),y(n,">",Qo),y(n,"（",Zo),y(n,"）",tr),y(n,"「",er),y(n,"」",nr),y(n,"『",or),y(n,"』",rr),y(n,"＜",sr),y(n,"＞",ir),y(n,"&",lr),y(n,"*",cr),y(n,"@",he),y(n,"`",ur),y(n,"^",hr),y(n,":",pe),y(n,",",Di),y(n,"$",fr),y(n,".",Ft),y(n,"=",pr),y(n,"!",Ri),y(n,"-",_t),y(n,"%",Ln),y(n,"|",mr),y(n,"+",gr),y(n,"#",br),y(n,"?",In),y(n,'"',Ni),y(n,"/",zt),y(n,";",Hi),y(n,"~",Pn),y(n,"_",wr),y(n,"\\",dr),y(n,"・",zc);const o=q(n,te,Oi,{[Us]:!0});q(o,te,o);const r=q(o,Zt,$c,{[Mn]:!0}),s=q(o,Cn,Fc,{[En]:!0}),i=q(n,Zt,oe,{[Vs]:!0});q(i,te,r),q(i,Zt,i),q(r,te,r),q(r,Zt,r);const l=q(n,Cn,zs,{[$s]:!0});q(l,Zt),q(l,te,s),q(l,Cn,l),q(s,te,s),q(s,Zt),q(s,Cn,s);const a=y(n,hs,Bi,{[cs]:!0}),c=y(n,Wl,Gs,{[cs]:!0}),d=q(n,us,Gs,{[cs]:!0});y(n,fs,d),y(c,hs,a),y(c,fs,d),q(c,us,d),y(d,Wl),y(d,hs),q(d,us,d),y(d,fs,d);const u=q(n,ds,jc,{[Vc]:!0});y(u,"#"),q(u,ds,u),y(u,Fm,u);const h=y(u,zm);y(h,"#"),q(h,ds,u);const f=[[Zt,i],[te,r]],p=[[Zt,null],[Cn,l],[te,s]];for(let m=0;m<yo.length;m++)de(n,yo[m],js,oe,f);for(let m=0;m<vo.length;m++)de(n,vo[m],Ws,zs,p);Oe(js,{tld:!0,ascii:!0},t),Oe(Ws,{utld:!0,alpha:!0},t),de(n,"file",Bo,oe,f),de(n,"mailto",Bo,oe,f),de(n,"http",Ye,oe,f),de(n,"https",Ye,oe,f),de(n,"ftp",Ye,oe,f),de(n,"ftps",Ye,oe,f),Oe(Bo,{scheme:!0,ascii:!0},t),Oe(Ye,{slashscheme:!0,ascii:!0},t),e=e.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<e.length;m++){const g=e[m][0],k=e[m][1]?{[Hm]:!0}:{[Um]:!0};g.indexOf("-")>=0?k[Fs]=!0:Zt.test(g)?te.test(g)?k[Mn]=!0:k[Vs]=!0:k[Us]=!0,jl(n,g,g,k)}return jl(n,"localhost",Hn,{ascii:!0}),n.jd=new gt(kr),{start:n,tokens:ln({groups:t},Wc)}}function Gc(e,t){const n=Wm(t.replace(/[A-Z]/g,l=>l.toLowerCase())),o=n.length,r=[];let s=0,i=0;for(;i<o;){let l=e,a=null,c=0,d=null,u=-1,h=-1;for(;i<o&&(a=l.go(n[i]));)l=a,l.accepts()?(u=0,h=0,d=l):u>=0&&(u+=n[i].length,h++),c+=n[i].length,s+=n[i].length,i++;s-=u,i-=h,c-=u,r.push({t:d.t,v:t.slice(s-c,s),s:s-c,e:s})}return r}function Wm(e){const t=[],n=e.length;let o=0;for(;o<n;){let r=e.charCodeAt(o),s,i=r<55296||r>56319||o+1===n||(s=e.charCodeAt(o+1))<56320||s>57343?e[o]:e.slice(o,o+2);t.push(i),o+=i.length}return t}function de(e,t,n,o,r){let s;const i=t.length;for(let l=0;l<i-1;l++){const a=t[l];e.j[a]?s=e.j[a]:(s=new gt(o),s.jr=r.slice(),e.j[a]=s),e=s}return s=new gt(n),s.jr=r.slice(),e.j[t[i-1]]=s,s}function Gl(e){const t=[],n=[];let o=0,r="0123456789";for(;o<e.length;){let s=0;for(;r.indexOf(e[o+s])>=0;)s++;if(s>0){t.push(n.join(""));for(let i=parseInt(e.substring(o,o+s),10);i>0;i--)n.pop();o+=s}else n.push(e[o]),o++}return t}const Un={defaultProtocol:"http",events:null,format:Kl,formatHref:Kl,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Ui(e,t=null){let n=ln({},Un);e&&(n=ln(n,e instanceof Ui?e.o:e));const o=n.ignoreTags,r=[];for(let s=0;s<o.length;s++)r.push(o[s].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=r}Ui.prototype={o:Un,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const o=t!=null;let r=this.o[e];return r&&(typeof r=="object"?(r=n.t in r?r[n.t]:Un[e],typeof r=="function"&&o&&(r=r(t,n))):typeof r=="function"&&o&&(r=r(t,n.t,n)),r)},getObj(e,t,n){let o=this.o[e];return typeof o=="function"&&t!=null&&(o=o(t,n.t,n)),o},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function Kl(e){return e}function Kc(e,t){this.t="token",this.v=e,this.tk=t}Kc.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),o=e.get("format",t,this);return n&&o.length>n?o.substring(0,n)+"…":o},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=Un.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),o=e.get("formatHref",n,this),r=e.get("tagName",n,t),s=this.toFormattedString(e),i={},l=e.get("className",n,t),a=e.get("target",n,t),c=e.get("rel",n,t),d=e.getObj("attributes",n,t),u=e.getObj("events",n,t);return i.href=o,l&&(i.class=l),a&&(i.target=a),c&&(i.rel=c),d&&ln(i,d),{tagName:r,attributes:i,content:s,eventListeners:u}}};function Hr(e,t){class n extends Kc{constructor(r,s){super(r,s),this.t=e}}for(const o in t)n.prototype[o]=t[o];return n.t=e,n}const ql=Hr("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Jl=Hr("text"),Gm=Hr("nl"),Co=Hr("url",{isLink:!0,toHref(e=Un.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Hn&&e[1].t===pe}}),Mt=e=>new gt(e);function Km({groups:e}){const t=e.domain.concat([lr,cr,he,dr,ur,hr,fr,pr,_t,Oi,Ln,mr,gr,br,zt,kr,Pn,wr]),n=[ar,pe,Di,Ft,Ri,Ln,In,Ni,Hi,Xo,Qo,Tn,_n,qo,Ko,Jo,Yo,Zo,tr,er,nr,or,rr,sr,ir],o=[lr,ar,cr,dr,ur,hr,fr,pr,_t,Tn,_n,Ln,mr,gr,br,In,zt,kr,Pn,wr],r=Mt(),s=y(r,Pn);_(s,o,s),_(s,e.domain,s);const i=Mt(),l=Mt(),a=Mt();_(r,e.domain,i),_(r,e.scheme,l),_(r,e.slashscheme,a),_(i,o,s),_(i,e.domain,i);const c=y(i,he);y(s,he,c),y(l,he,c),y(a,he,c);const d=y(s,Ft);_(d,o,s),_(d,e.domain,s);const u=Mt();_(c,e.domain,u),_(u,e.domain,u);const h=y(u,Ft);_(h,e.domain,u);const f=Mt(ql);_(h,e.tld,f),_(h,e.utld,f),y(c,Hn,f);const p=y(u,_t);y(p,_t,p),_(p,e.domain,u),_(f,e.domain,u),y(f,Ft,h),y(f,_t,p);const m=y(f,pe);_(m,e.numeric,ql);const g=y(i,_t),b=y(i,Ft);y(g,_t,g),_(g,e.domain,i),_(b,o,s),_(b,e.domain,i);const k=Mt(Co);_(b,e.tld,k),_(b,e.utld,k),_(k,e.domain,i),_(k,o,s),y(k,Ft,b),y(k,_t,g),y(k,he,c);const v=y(k,pe),x=Mt(Co);_(v,e.numeric,x);const C=Mt(Co),M=Mt();_(C,t,C),_(C,n,M),_(M,t,C),_(M,n,M),y(k,zt,C),y(x,zt,C);const E=y(l,pe),A=y(a,pe),At=y(A,zt),Me=y(At,zt);_(l,e.domain,i),y(l,Ft,b),y(l,_t,g),_(a,e.domain,i),y(a,Ft,b),y(a,_t,g),_(E,e.domain,C),y(E,zt,C),y(E,In,C),_(Me,e.domain,C),_(Me,t,C),y(Me,zt,C);const Cl=[[Tn,_n],[Ko,qo],[Jo,Yo],[Xo,Qo],[Zo,tr],[er,nr],[or,rr],[sr,ir]];for(let ns=0;ns<Cl.length;ns++){const[Sl,os]=Cl[ns],co=y(C,Sl);y(M,Sl,co),y(co,os,C);const Je=Mt(Co);_(co,t,Je);const yn=Mt();_(co,n),_(Je,t,Je),_(Je,n,yn),_(yn,t,Je),_(yn,n,yn),y(Je,os,C),y(yn,os,C)}return y(r,Hn,k),y(r,Bi,Gm),{start:r,tokens:Wc}}function qm(e,t,n){let o=n.length,r=0,s=[],i=[];for(;r<o;){let l=e,a=null,c=null,d=0,u=null,h=-1;for(;r<o&&!(a=l.go(n[r].t));)i.push(n[r++]);for(;r<o&&(c=a||l.go(n[r].t));)a=null,l=c,l.accepts()?(h=0,u=l):h>=0&&h++,r++,d++;if(h<0)r-=d,r<o&&(i.push(n[r]),r++);else{i.length>0&&(s.push(ps(Jl,t,i)),i=[]),r-=h,d-=h;const f=u.t,p=n.slice(r-d,r);s.push(ps(f,t,p))}}return i.length>0&&s.push(ps(Jl,t,i)),s}function ps(e,t,n){const o=n[0].s,r=n[n.length-1].e,s=t.slice(o,r);return new e(s,n)}const Jm=typeof console<"u"&&console&&console.warn||(()=>{}),Ym="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",z={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function Xm(){return gt.groups={},z.scanner=null,z.parser=null,z.tokenQueue=[],z.pluginQueue=[],z.customSchemes=[],z.initialized=!1,z}function Yl(e,t=!1){if(z.initialized&&Jm(`linkifyjs: already initialized - will not register custom scheme "${e}" ${Ym}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);z.customSchemes.push([e,t])}function Qm(){z.scanner=jm(z.customSchemes);for(let e=0;e<z.tokenQueue.length;e++)z.tokenQueue[e][1]({scanner:z.scanner});z.parser=Km(z.scanner.tokens);for(let e=0;e<z.pluginQueue.length;e++)z.pluginQueue[e][1]({scanner:z.scanner,parser:z.parser});return z.initialized=!0,z}function Vi(e){return z.initialized||Qm(),qm(z.parser.start,e,Gc(z.scanner.start,e))}Vi.scan=Gc;function qc(e,t=null,n=null){if(t&&typeof t=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const o=new Ui(n),r=Vi(e),s=[];for(let i=0;i<r.length;i++){const l=r[i];l.isLink&&(!t||l.t===t)&&o.check(l)&&s.push(l.toFormattedObject(o))}return s}function Zm(e){return e.length===1?e[0].isLink:e.length===3&&e[1].isLink?["()","[]"].includes(e[0].value+e[2].value):!1}function tg(e){return new O({key:new R("autolink"),appendTransaction:(t,n,o)=>{const r=t.some(c=>c.docChanged)&&!n.doc.eq(o.doc),s=t.some(c=>c.getMeta("preventAutolink"));if(!r||s)return;const{tr:i}=o,l=xi(n.doc,[...t]);if(Ai(l).forEach(({newRange:c})=>{const d=Wo(o.doc,c,f=>f.isTextblock);let u,h;if(d.length>1?(u=d[0],h=o.doc.textBetween(u.pos,u.pos+u.node.nodeSize,void 0," ")):d.length&&o.doc.textBetween(c.from,c.to," "," ").endsWith(" ")&&(u=d[0],h=o.doc.textBetween(u.pos,c.to,void 0," ")),u&&h){const f=h.split(" ").filter(b=>b!=="");if(f.length<=0)return!1;const p=f[f.length-1],m=u.pos+h.lastIndexOf(p);if(!p)return!1;const g=Vi(p).map(b=>b.toObject(e.defaultProtocol));if(!Zm(g))return!1;g.filter(b=>b.isLink).map(b=>({...b,from:m+b.start+1,to:m+b.end+1})).filter(b=>o.schema.marks.code?!o.doc.rangeHasMark(b.from,b.to,o.schema.marks.code):!0).filter(b=>e.validate(b.value)).filter(b=>e.shouldAutoLink(b.value)).forEach(b=>{Mi(b.from,b.to,o.doc).some(k=>k.mark.type===e.type)||i.addMark(b.from,b.to,e.type.create({href:b.href}))})}}),!!i.steps.length)return i}})}function eg(e){return new O({key:new R("handleClickLink"),props:{handleClick:(t,n,o)=>{var r,s;if(o.button!==0||!t.editable)return!1;let i=o.target;const l=[];for(;i.nodeName!=="DIV";)l.push(i),i=i.parentNode;if(!l.find(h=>h.nodeName==="A"))return!1;const a=yc(t.state,e.type.name),c=o.target,d=(r=c==null?void 0:c.href)!==null&&r!==void 0?r:a.href,u=(s=c==null?void 0:c.target)!==null&&s!==void 0?s:a.target;return c&&d?(window.open(d,u),!0):!1}}})}function ng(e){return new O({key:new R("handlePasteLink"),props:{handlePaste:(t,n,o)=>{const{state:r}=t,{selection:s}=r,{empty:i}=s;if(i)return!1;let l="";o.content.forEach(c=>{l+=c.textContent});const a=qc(l,{defaultProtocol:e.defaultProtocol}).find(c=>c.isLink&&c.value===l);return!l||!a?!1:e.editor.commands.setMark(e.type,{href:a.href})}}})}const og=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g;function Te(e,t){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return t&&t.forEach(o=>{const r=typeof o=="string"?o:o.scheme;r&&n.push(r)}),!e||e.replace(og,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const rg=lt.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(e=>{if(typeof e=="string"){Yl(e);return}Yl(e.scheme,e.optionalSlashes)})},onDestroy(){Xm()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(e,t)=>!!Te(e,t.protocols),validate:e=>!!e,shouldAutoLink:e=>!!e}},addAttributes(){return{href:{default:null,parseHTML(e){return e.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!t||!this.options.isAllowedUri(t,{defaultValidate:n=>!!Te(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:e}){return this.options.isAllowedUri(e.href,{defaultValidate:t=>!!Te(t,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Ct(this.options.HTMLAttributes,e),0]:["a",Ct(this.options.HTMLAttributes,{...e,href:""}),0]},addCommands(){return{setLink:e=>({chain:t})=>{const{href:n}=e;return this.options.isAllowedUri(n,{defaultValidate:o=>!!Te(o,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().setMark(this.name,e).setMeta("preventAutolink",!0).run():!1},toggleLink:e=>({chain:t})=>{const{href:n}=e;return this.options.isAllowedUri(n,{defaultValidate:o=>!!Te(o,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[He({find:e=>{const t=[];if(e){const{protocols:n,defaultProtocol:o}=this.options,r=qc(e).filter(s=>s.isLink&&this.options.isAllowedUri(s.value,{defaultValidate:i=>!!Te(i,n),protocols:n,defaultProtocol:o}));r.length&&r.forEach(s=>t.push({text:s.value,data:{href:s.href},index:s.start}))}return t},type:this.type,getAttributes:e=>{var t;return{href:(t=e.data)===null||t===void 0?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[],{protocols:t,defaultProtocol:n}=this.options;return this.options.autolink&&e.push(tg({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:o=>this.options.isAllowedUri(o,{defaultValidate:r=>!!Te(r,t),protocols:t,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&e.push(eg({type:this.type})),this.options.linkOnPaste&&e.push(ng({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),e}}),sg=qt.create({name:"text",group:"inline"}),Pt=()=>new Map,Ks=e=>{const t=Pt();return e.forEach((n,o)=>{t.set(o,n)}),t},Xt=(e,t,n)=>{let o=e.get(t);return o===void 0&&e.set(t,o=n()),o},ig=(e,t)=>{const n=[];for(const[o,r]of e)n.push(t(r,o));return n},lg=(e,t)=>{for(const[n,o]of e)if(t(o,n))return!0;return!1},Ve=()=>new Set,ms=e=>e[e.length-1],ag=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},$e=Array.from,cg=(e,t)=>{for(let n=0;n<e.length;n++)if(t(e[n],n,e))return!0;return!1},qs=Array.isArray;class Jc{constructor(){this._observers=Pt()}on(t,n){return Xt(this._observers,t,Ve).add(n),n}once(t,n){const o=(...r)=>{this.off(t,o),n(...r)};this.on(t,o)}off(t,n){const o=this._observers.get(t);o!==void 0&&(o.delete(n),o.size===0&&this._observers.delete(t))}emit(t,n){return $e((this._observers.get(t)||Pt()).values()).forEach(o=>o(...n))}destroy(){this._observers=Pt()}}const le=Math.floor,Do=Math.abs,se=(e,t)=>e<t?e:t,Nt=(e,t)=>e>t?e:t,Yc=e=>e!==0?e<0:1/e<0,Xl=1,Ql=2,gs=4,bs=8,Vn=32,ie=64,ht=128,dg=1<<29,Ur=31,Js=63,De=127,ug=2147483647,Xc=Number.MAX_SAFE_INTEGER,hg=Number.isInteger||(e=>typeof e=="number"&&isFinite(e)&&le(e)===e),fg=String.fromCharCode,pg=e=>e.toLowerCase(),mg=/^\s*/g,gg=e=>e.replace(mg,""),bg=/([A-Z])/g,Zl=(e,t)=>gg(e.replace(bg,n=>`${t}${pg(n)}`)),wg=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,o=new Uint8Array(n);for(let r=0;r<n;r++)o[r]=t.codePointAt(r);return o},$n=typeof TextEncoder<"u"?new TextEncoder:null,kg=e=>$n.encode(e),yg=$n?kg:wg;let On=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});On&&On.decode(new Uint8Array).length===1&&(On=null);class eo{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const no=()=>new eo,vg=e=>{const t=no();return e(t),Dt(t)},Cg=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},Dt=e=>{const t=new Uint8Array(Cg(e));let n=0;for(let o=0;o<e.bufs.length;o++){const r=e.bufs[o];t.set(r,n),n+=r.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),n),t},Sg=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(Nt(n,t)*2),e.cpos=0)},Z=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(n*2),e.cpos=0),e.cbuf[e.cpos++]=t},Ys=Z,D=(e,t)=>{for(;t>De;)Z(e,ht|De&t),t=le(t/128);Z(e,De&t)},$i=(e,t)=>{const n=Yc(t);for(n&&(t=-t),Z(e,(t>Js?ht:0)|(n?ie:0)|Js&t),t=le(t/64);t>0;)Z(e,(t>De?ht:0)|De&t),t=le(t/128)},Xs=new Uint8Array(3e4),Eg=Xs.length/3,xg=(e,t)=>{if(t.length<Eg){const n=$n.encodeInto(t,Xs).written||0;D(e,n);for(let o=0;o<n;o++)Z(e,Xs[o])}else wt(e,yg(t))},Ag=(e,t)=>{const n=unescape(encodeURIComponent(t)),o=n.length;D(e,o);for(let r=0;r<o;r++)Z(e,n.codePointAt(r))},Ze=$n&&$n.encodeInto?xg:Ag,Vr=(e,t)=>{const n=e.cbuf.length,o=e.cpos,r=se(n-o,t.length),s=t.length-r;e.cbuf.set(t.subarray(0,r),o),e.cpos+=r,s>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(Nt(n*2,s)),e.cbuf.set(t.subarray(r)),e.cpos=s)},wt=(e,t)=>{D(e,t.byteLength),Vr(e,t)},Fi=(e,t)=>{Sg(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},Mg=(e,t)=>Fi(e,4).setFloat32(0,t,!1),Tg=(e,t)=>Fi(e,8).setFloat64(0,t,!1),_g=(e,t)=>Fi(e,8).setBigInt64(0,t,!1),ta=new DataView(new ArrayBuffer(4)),Lg=e=>(ta.setFloat32(0,e),ta.getFloat32(0)===e),an=(e,t)=>{switch(typeof t){case"string":Z(e,119),Ze(e,t);break;case"number":hg(t)&&Do(t)<=ug?(Z(e,125),$i(e,t)):Lg(t)?(Z(e,124),Mg(e,t)):(Z(e,123),Tg(e,t));break;case"bigint":Z(e,122),_g(e,t);break;case"object":if(t===null)Z(e,126);else if(qs(t)){Z(e,117),D(e,t.length);for(let n=0;n<t.length;n++)an(e,t[n])}else if(t instanceof Uint8Array)Z(e,116),wt(e,t);else{Z(e,118);const n=Object.keys(t);D(e,n.length);for(let o=0;o<n.length;o++){const r=n[o];Ze(e,r),an(e,t[r])}}break;case"boolean":Z(e,t?120:121);break;default:Z(e,127)}};class ea extends eo{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&D(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const na=e=>{e.count>0&&($i(e.encoder,e.count===1?e.s:-e.s),e.count>1&&D(e.encoder,e.count-2))};class Ro{constructor(){this.encoder=new eo,this.s=0,this.count=0}write(t){this.s===t?this.count++:(na(this),this.count=1,this.s=t)}toUint8Array(){return na(this),Dt(this.encoder)}}const oa=e=>{if(e.count>0){const t=e.diff*2+(e.count===1?0:1);$i(e.encoder,t),e.count>1&&D(e.encoder,e.count-2)}};class ws{constructor(){this.encoder=new eo,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(oa(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return oa(this),Dt(this.encoder)}}class Ig{constructor(){this.sarr=[],this.s="",this.lensE=new Ro}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new eo;return this.sarr.push(this.s),this.s="",Ze(t,this.sarr.join("")),Vr(t,this.lensE.toUint8Array()),Dt(t)}}const we=e=>new Error(e),Rt=()=>{throw we("Method unimplemented")},St=()=>{throw we("Unexpected case")},Qc=we("Unexpected end of array"),Zc=we("Integer out of Range");class $r{constructor(t){this.arr=t,this.pos=0}}const pn=e=>new $r(e),Pg=e=>e.pos!==e.arr.length,Og=(e,t)=>{const n=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},kt=e=>Og(e,L(e)),cn=e=>e.arr[e.pos++],L=e=>{let t=0,n=1;const o=e.arr.length;for(;e.pos<o;){const r=e.arr[e.pos++];if(t=t+(r&De)*n,n*=128,r<ht)return t;if(t>Xc)throw Zc}throw Qc},zi=e=>{let t=e.arr[e.pos++],n=t&Js,o=64;const r=(t&ie)>0?-1:1;if((t&ht)===0)return r*n;const s=e.arr.length;for(;e.pos<s;){if(t=e.arr[e.pos++],n=n+(t&De)*o,o*=128,t<ht)return r*n;if(n>Xc)throw Zc}throw Qc},Bg=e=>{let t=L(e);if(t===0)return"";{let n=String.fromCodePoint(cn(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(cn(e));else for(;t>0;){const o=t<1e4?t:1e4,r=e.arr.subarray(e.pos,e.pos+o);e.pos+=o,n+=String.fromCodePoint.apply(null,r),t-=o}return decodeURIComponent(escape(n))}},Dg=e=>On.decode(kt(e)),tn=On?Dg:Bg,ji=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Rg=e=>ji(e,4).getFloat32(0,!1),Ng=e=>ji(e,8).getFloat64(0,!1),Hg=e=>ji(e,8).getBigInt64(0,!1),Ug=[e=>{},e=>null,zi,Rg,Ng,Hg,e=>!1,e=>!0,tn,e=>{const t=L(e),n={};for(let o=0;o<t;o++){const r=tn(e);n[r]=Fn(e)}return n},e=>{const t=L(e),n=[];for(let o=0;o<t;o++)n.push(Fn(e));return n},kt],Fn=e=>Ug[127-cn(e)](e);class ra extends $r{constructor(t,n){super(t),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),Pg(this)?this.count=L(this)+1:this.count=-1),this.count--,this.s}}class No extends $r{constructor(t){super(t),this.s=0,this.count=0}read(){if(this.count===0){this.s=zi(this);const t=Yc(this.s);this.count=1,t&&(this.s=-this.s,this.count=L(this)+2)}return this.count--,this.s}}class ks extends $r{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const t=zi(this),n=t&1;this.diff=le(t/2),this.count=1,n&&(this.count=L(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Vg{constructor(t){this.decoder=new No(t),this.str=tn(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),n=this.str.slice(this.spos,t);return this.spos=t,n}}const $g=crypto.getRandomValues.bind(crypto),Fg=Math.random,td=()=>$g(new Uint32Array(1))[0],zg=e=>e[le(Fg()*e.length)],jg="10000000-1000-4000-8000"+-1e11,Wg=()=>jg.replace(/[018]/g,e=>(e^td()&15>>e/4).toString(16)),Gg=Date.now,sa=e=>new Promise(e);Promise.all.bind(Promise);const ia=e=>e===void 0?null:e;class Kg{constructor(){this.map=new Map}setItem(t,n){this.map.set(t,n)}getItem(t){return this.map.get(t)}}let ed=new Kg,qg=!0;try{typeof localStorage<"u"&&localStorage&&(ed=localStorage,qg=!1)}catch{}const Jg=ed,Yg=Object.assign,nd=Object.keys,Xg=(e,t)=>{for(const n in e)t(e[n],n)},la=e=>nd(e).length,Qg=e=>{for(const t in e)return!1;return!0},od=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},Zg=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),tb=(e,t)=>e===t||la(e)===la(t)&&od(e,(n,o)=>(n!==void 0||Zg(t,o))&&t[o]===n),eb=Object.freeze,rd=e=>{for(const t in e){const n=e[t];(typeof n=="object"||typeof n=="function")&&rd(e[t])}return eb(e)},Wi=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&Wi(e,t,n+1)}},nb=e=>e,ob=(e,t)=>t.includes(e);var sd={REACT_APP_SERVER_BASE_URL:"http://localhost:3000"};const dn=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",id=typeof window<"u"&&typeof document<"u"&&!dn;let $t;const rb=()=>{if($t===void 0)if(dn){$t=Pt();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const o=e[n];o[0]==="-"?(t!==null&&$t.set(t,""),t=o):t!==null&&($t.set(t,o),t=null)}t!==null&&$t.set(t,"")}else typeof location=="object"?($t=Pt(),(location.search||"?").slice(1).split("&").forEach(e=>{if(e.length!==0){const[t,n]=e.split("=");$t.set(`--${Zl(t,"-")}`,n),$t.set(`-${Zl(t,"-")}`,n)}})):$t=Pt();return $t},Qs=e=>rb().has(e),yr=e=>ia(dn?sd[e.toUpperCase().replaceAll("-","_")]:Jg.getItem(e)),ld=e=>Qs("--"+e)||yr(e)!==null;ld("production");const sb=dn&&ob(sd.FORCE_COLOR,["true","1","2"]),ib=sb||!Qs("--no-colors")&&!ld("no-color")&&(!dn||process.stdout.isTTY)&&(!dn||Qs("--color")||yr("COLORTERM")!==null||(yr("TERM")||"").includes("color")),lb=e=>new Uint8Array(e),ab=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=fg(e[n]);return btoa(t)},cb=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),db=id?ab:cb,ub=e=>{const t=lb(e.byteLength);return t.set(e),t},hb=e=>vg(t=>an(t,e));class fb{constructor(t,n){this.left=t,this.right=n}}const ee=(e,t)=>new fb(e,t),pb=typeof document<"u"?document:{};typeof DOMParser<"u"&&new DOMParser;const mb=e=>ig(e,(t,n)=>`${n}:${t};`).join(""),gb=e=>class{constructor(n){this._=n}destroy(){e(this._)}},bb=gb(clearTimeout),Gi=(e,t)=>new bb(setTimeout(t,e)),ce=Symbol,ad=ce(),cd=ce(),wb=ce(),kb=ce(),yb=ce(),dd=ce(),vb=ce(),Ki=ce(),Cb=ce(),Sb=e=>{var r;e.length===1&&((r=e[0])==null?void 0:r.constructor)===Function&&(e=e[0]());const t=[],n=[];let o=0;for(;o<e.length;o++){const s=e[o];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)t.push(s);else if(s.constructor===Object)break}for(o>0&&n.push(t.join(""));o<e.length;o++){const s=e[o];s instanceof Symbol||n.push(s)}return n},Eb={[ad]:ee("font-weight","bold"),[cd]:ee("font-weight","normal"),[wb]:ee("color","blue"),[yb]:ee("color","green"),[kb]:ee("color","grey"),[dd]:ee("color","red"),[vb]:ee("color","purple"),[Ki]:ee("color","orange"),[Cb]:ee("color","black")},xb=e=>{var i;e.length===1&&((i=e[0])==null?void 0:i.constructor)===Function&&(e=e[0]());const t=[],n=[],o=Pt();let r=[],s=0;for(;s<e.length;s++){const l=e[s],a=Eb[l];if(a!==void 0)o.set(a.left,a.right);else{if(l===void 0)break;if(l.constructor===String||l.constructor===Number){const c=mb(o);s>0||c.length>0?(t.push("%c"+l),n.push(c)):t.push(l)}else break}}for(s>0&&(r=n,r.unshift(t.join("")));s<e.length;s++){const l=e[s];l instanceof Symbol||r.push(l)}return r},ud=ib?xb:Sb,Ab=(...e)=>{console.log(...ud(e)),fd.forEach(t=>t.print(e))},hd=(...e)=>{console.warn(...ud(e)),e.unshift(Ki),fd.forEach(t=>t.print(e))},fd=Ve(),pd=e=>({[Symbol.iterator](){return this},next:e}),Mb=(e,t)=>pd(()=>{let n;do n=e.next();while(!n.done&&!t(n.value));return n}),ys=(e,t)=>pd(()=>{const{done:n,value:o}=e.next();return{done:n,value:n?void 0:t(o)}});class qi{constructor(t,n){this.clock=t,this.len=n}}class mn{constructor(){this.clients=new Map}}const ke=(e,t,n)=>t.clients.forEach((o,r)=>{const s=e.doc.store.clients.get(r);if(s!=null){const i=s[s.length-1],l=i.id.clock+i.length;for(let a=0,c=o[a];a<o.length&&c.clock<l;c=o[++a])xd(e,s,c.clock,c.len,n)}}),Tb=(e,t)=>{let n=0,o=e.length-1;for(;n<=o;){const r=le((n+o)/2),s=e[r],i=s.clock;if(i<=t){if(t<i+s.len)return r;n=r+1}else o=r-1}return null},gn=(e,t)=>{const n=e.clients.get(t.client);return n!==void 0&&Tb(n,t.clock)!==null},Ji=e=>{e.clients.forEach(t=>{t.sort((r,s)=>r.clock-s.clock);let n,o;for(n=1,o=1;n<t.length;n++){const r=t[o-1],s=t[n];r.clock+r.len>=s.clock?r.len=Nt(r.len,s.clock+s.len-r.clock):(o<n&&(t[o]=s),o++)}t.length=o})},Zs=e=>{const t=new mn;for(let n=0;n<e.length;n++)e[n].clients.forEach((o,r)=>{if(!t.clients.has(r)){const s=o.slice();for(let i=n+1;i<e.length;i++)ag(s,e[i].clients.get(r)||[]);t.clients.set(r,s)}});return Ji(t),t},zn=(e,t,n,o)=>{Xt(e.clients,t,()=>[]).push(new qi(n,o))},md=()=>new mn,gd=e=>{const t=md();return e.clients.forEach((n,o)=>{const r=[];for(let s=0;s<n.length;s++){const i=n[s];if(i.deleted){const l=i.id.clock;let a=i.length;if(s+1<n.length)for(let c=n[s+1];s+1<n.length&&c.deleted;c=n[++s+1])a+=c.length;r.push(new qi(l,a))}}r.length>0&&t.clients.set(o,r)}),t},bn=(e,t)=>{D(e.restEncoder,t.clients.size),$e(t.clients.entries()).sort((n,o)=>o[0]-n[0]).forEach(([n,o])=>{e.resetDsCurVal(),D(e.restEncoder,n);const r=o.length;D(e.restEncoder,r);for(let s=0;s<r;s++){const i=o[s];e.writeDsClock(i.clock),e.writeDsLen(i.len)}})},Yi=e=>{const t=new mn,n=L(e.restDecoder);for(let o=0;o<n;o++){e.resetDsCurVal();const r=L(e.restDecoder),s=L(e.restDecoder);if(s>0){const i=Xt(t.clients,r,()=>[]);for(let l=0;l<s;l++)i.push(new qi(e.readDsClock(),e.readDsLen()))}}return t},aa=(e,t,n)=>{const o=new mn,r=L(e.restDecoder);for(let s=0;s<r;s++){e.resetDsCurVal();const i=L(e.restDecoder),l=L(e.restDecoder),a=n.clients.get(i)||[],c=Y(n,i);for(let d=0;d<l;d++){const u=e.readDsClock(),h=u+e.readDsLen();if(u<c){c<h&&zn(o,i,c,h-c);let f=Ot(a,u),p=a[f];for(!p.deleted&&p.id.clock<u&&(a.splice(f+1,0,Mr(t,p,u-p.id.clock)),f++);f<a.length&&(p=a[f++],p.id.clock<h);)p.deleted||(h<p.id.clock+p.length&&a.splice(f,0,Mr(t,p,h-p.id.clock)),p.delete(t))}else zn(o,i,u,h-u)}}if(o.clients.size>0){const s=new Fe;return D(s.restEncoder,0),bn(s,o),s.toUint8Array()}return null},bd=td;class Ee extends Jc{constructor({guid:t=Wg(),collectionid:n=null,gc:o=!0,gcFilter:r=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:l=!0}={}){super(),this.gc=o,this.gcFilter=r,this.clientID=bd(),this.guid=t,this.collectionid=n,this.share=new Map,this.store=new Sd,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=sa(c=>{this.on("load",()=>{this.isLoaded=!0,c(this)})});const a=()=>sa(c=>{const d=u=>{(u===void 0||u===!0)&&(this.off("sync",d),c())};this.on("sync",d)});this.on("sync",c=>{c===!1&&this.isSynced&&(this.whenSynced=a()),this.isSynced=c===void 0||c===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=a()}load(){const t=this._item;t!==null&&!this.shouldLoad&&V(t.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set($e(this.subdocs).map(t=>t.guid))}transact(t,n=null){return V(this,t,n)}get(t,n=et){const o=Xt(this.share,t,()=>{const s=new n;return s._integrate(this,null),s}),r=o.constructor;if(n!==et&&r!==n)if(r===et){const s=new n;s._map=o._map,o._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=s}),s._start=o._start;for(let i=s._start;i!==null;i=i.right)i.parent=s;return s._length=o._length,this.share.set(t,s),s._integrate(this,null),s}else throw new Error(`Type with the name ${t} has already been defined with a different constructor`);return o}getArray(t=""){return this.get(t,on)}getText(t=""){return this.get(t,ye)}getMap(t=""){return this.get(t,hn)}getXmlElement(t=""){return this.get(t,ut)}getXmlFragment(t=""){return this.get(t,ze)}toJSON(){const t={};return this.share.forEach((n,o)=>{t[o]=n.toJSON()}),t}destroy(){this.isDestroyed=!0,$e(this.subdocs).forEach(n=>n.destroy());const t=this._item;if(t!==null){this._item=null;const n=t.content;n.doc=new Ee({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=t,V(t.parent.doc,o=>{const r=n.doc;t.deleted||o.subdocsAdded.add(r),o.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class wd{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return L(this.restDecoder)}readDsLen(){return L(this.restDecoder)}}class kd extends wd{readLeftID(){return T(L(this.restDecoder),L(this.restDecoder))}readRightID(){return T(L(this.restDecoder),L(this.restDecoder))}readClient(){return L(this.restDecoder)}readInfo(){return cn(this.restDecoder)}readString(){return tn(this.restDecoder)}readParentInfo(){return L(this.restDecoder)===1}readTypeRef(){return L(this.restDecoder)}readLen(){return L(this.restDecoder)}readAny(){return Fn(this.restDecoder)}readBuf(){return ub(kt(this.restDecoder))}readJSON(){return JSON.parse(tn(this.restDecoder))}readKey(){return tn(this.restDecoder)}}class _b{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=L(this.restDecoder),this.dsCurrVal}readDsLen(){const t=L(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class un extends _b{constructor(t){super(t),this.keys=[],L(t),this.keyClockDecoder=new ks(kt(t)),this.clientDecoder=new No(kt(t)),this.leftClockDecoder=new ks(kt(t)),this.rightClockDecoder=new ks(kt(t)),this.infoDecoder=new ra(kt(t),cn),this.stringDecoder=new Vg(kt(t)),this.parentInfoDecoder=new ra(kt(t),cn),this.typeRefDecoder=new No(kt(t)),this.lenDecoder=new No(kt(t))}readLeftID(){return new en(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new en(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Fn(this.restDecoder)}readBuf(){return kt(this.restDecoder)}readJSON(){return Fn(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class Lb{constructor(){this.restEncoder=no()}toUint8Array(){return Dt(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){D(this.restEncoder,t)}writeDsLen(t){D(this.restEncoder,t)}}class oo extends Lb{writeLeftID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeRightID(t){D(this.restEncoder,t.client),D(this.restEncoder,t.clock)}writeClient(t){D(this.restEncoder,t)}writeInfo(t){Ys(this.restEncoder,t)}writeString(t){Ze(this.restEncoder,t)}writeParentInfo(t){D(this.restEncoder,t?1:0)}writeTypeRef(t){D(this.restEncoder,t)}writeLen(t){D(this.restEncoder,t)}writeAny(t){an(this.restEncoder,t)}writeBuf(t){wt(this.restEncoder,t)}writeJSON(t){Ze(this.restEncoder,JSON.stringify(t))}writeKey(t){Ze(this.restEncoder,t)}}class Ib{constructor(){this.restEncoder=no(),this.dsCurrVal=0}toUint8Array(){return Dt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const n=t-this.dsCurrVal;this.dsCurrVal=t,D(this.restEncoder,n)}writeDsLen(t){t===0&&St(),D(this.restEncoder,t-1),this.dsCurrVal+=t}}class Fe extends Ib{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ws,this.clientEncoder=new Ro,this.leftClockEncoder=new ws,this.rightClockEncoder=new ws,this.infoEncoder=new ea(Ys),this.stringEncoder=new Ig,this.parentInfoEncoder=new ea(Ys),this.typeRefEncoder=new Ro,this.lenEncoder=new Ro}toUint8Array(){const t=no();return D(t,0),wt(t,this.keyClockEncoder.toUint8Array()),wt(t,this.clientEncoder.toUint8Array()),wt(t,this.leftClockEncoder.toUint8Array()),wt(t,this.rightClockEncoder.toUint8Array()),wt(t,Dt(this.infoEncoder)),wt(t,this.stringEncoder.toUint8Array()),wt(t,Dt(this.parentInfoEncoder)),wt(t,this.typeRefEncoder.toUint8Array()),wt(t,this.lenEncoder.toUint8Array()),Vr(t,Dt(this.restEncoder)),Dt(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){an(this.restEncoder,t)}writeBuf(t){wt(this.restEncoder,t)}writeJSON(t){an(this.restEncoder,t)}writeKey(t){const n=this.keyMap.get(t);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(n)}}const Pb=(e,t,n,o)=>{o=Nt(o,t[0].id.clock);const r=Ot(t,o);D(e.restEncoder,t.length-r),e.writeClient(n),D(e.restEncoder,o);const s=t[r];s.write(e,o-s.id.clock);for(let i=r+1;i<t.length;i++)t[i].write(e,0)},Xi=(e,t,n)=>{const o=new Map;n.forEach((r,s)=>{Y(t,s)>r&&o.set(s,r)}),Fr(t).forEach((r,s)=>{n.has(s)||o.set(s,0)}),D(e.restEncoder,o.size),$e(o.entries()).sort((r,s)=>s[0]-r[0]).forEach(([r,s])=>{Pb(e,t.clients.get(r),r,s)})},Ob=(e,t)=>{const n=Pt(),o=L(e.restDecoder);for(let r=0;r<o;r++){const s=L(e.restDecoder),i=new Array(s),l=e.readClient();let a=L(e.restDecoder);n.set(l,{i:0,refs:i});for(let c=0;c<s;c++){const d=e.readInfo();switch(Ur&d){case 0:{const u=e.readLen();i[c]=new Lt(T(l,a),u),a+=u;break}case 10:{const u=L(e.restDecoder);i[c]=new It(T(l,a),u),a+=u;break}default:{const u=(d&(ie|ht))===0,h=new H(T(l,a),null,(d&ht)===ht?e.readLeftID():null,null,(d&ie)===ie?e.readRightID():null,u?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,u&&(d&Vn)===Vn?e.readString():null,Kd(e,d));i[c]=h,a+=h.length}}}}return n},Bb=(e,t,n)=>{const o=[];let r=$e(n.keys()).sort((f,p)=>f-p);if(r.length===0)return null;const s=()=>{if(r.length===0)return null;let f=n.get(r[r.length-1]);for(;f.refs.length===f.i;)if(r.pop(),r.length>0)f=n.get(r[r.length-1]);else return null;return f};let i=s();if(i===null)return null;const l=new Sd,a=new Map,c=(f,p)=>{const m=a.get(f);(m==null||m>p)&&a.set(f,p)};let d=i.refs[i.i++];const u=new Map,h=()=>{for(const f of o){const p=f.id.client,m=n.get(p);m?(m.i--,l.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):l.clients.set(p,[f]),r=r.filter(g=>g!==p)}o.length=0};for(;;){if(d.constructor!==It){const p=Xt(u,d.id.client,()=>Y(t,d.id.client))-d.id.clock;if(p<0)o.push(d),c(d.id.client,d.id.clock-1),h();else{const m=d.getMissing(e,t);if(m!==null){o.push(d);const g=n.get(m)||{refs:[],i:0};if(g.refs.length===g.i)c(m,Y(t,m)),h();else{d=g.refs[g.i++];continue}}else(p===0||p<d.length)&&(d.integrate(e,p),u.set(d.id.client,d.id.clock+d.length))}}if(o.length>0)d=o.pop();else if(i!==null&&i.i<i.refs.length)d=i.refs[i.i++];else{if(i=s(),i===null)break;d=i.refs[i.i++]}}if(l.clients.size>0){const f=new Fe;return Xi(f,l,new Map),D(f.restEncoder,0),{missing:a,update:f.toUint8Array()}}return null},Db=(e,t)=>Xi(e,t.doc.store,t.beforeState),Rb=(e,t,n,o=new un(e))=>V(t,r=>{r.local=!1;let s=!1;const i=r.doc,l=i.store,a=Ob(o,i),c=Bb(r,l,a),d=l.pendingStructs;if(d){for(const[h,f]of d.missing)if(f<Y(l,h)){s=!0;break}if(c){for(const[h,f]of c.missing){const p=d.missing.get(h);(p==null||p>f)&&d.missing.set(h,f)}d.update=Cr([d.update,c.update])}}else l.pendingStructs=c;const u=aa(o,r,l);if(l.pendingDs){const h=new un(pn(l.pendingDs));L(h.restDecoder);const f=aa(h,r,l);u&&f?l.pendingDs=Cr([u,f]):l.pendingDs=u||f}else l.pendingDs=u;if(s){const h=l.pendingStructs.update;l.pendingStructs=null,vr(r.doc,h)}},n,!1),vr=(e,t,n,o=un)=>{const r=pn(t);Rb(r,e,n,new o(r))},ca=(e,t,n)=>vr(e,t,n,kd),Nb=(e,t,n=new Map)=>{Xi(e,t.store,n),bn(e,gd(t.store))},Hb=(e,t=new Uint8Array([0]),n=new Fe)=>{const o=yd(t);Nb(n,e,o);const r=[n.toUint8Array()];if(e.store.pendingDs&&r.push(e.store.pendingDs),e.store.pendingStructs&&r.push(tw(e.store.pendingStructs.update,t)),r.length>1){if(n.constructor===oo)return Qb(r.map((s,i)=>i===0?s:nw(s)));if(n.constructor===Fe)return Cr(r)}return r[0]},da=(e,t)=>Hb(e,t,new oo),Ub=e=>{const t=new Map,n=L(e.restDecoder);for(let o=0;o<n;o++){const r=L(e.restDecoder),s=L(e.restDecoder);t.set(r,s)}return t},yd=e=>Ub(new wd(pn(e)));class Vb{constructor(){this.l=[]}}const ua=()=>new Vb,ha=(e,t)=>e.l.push(t),fa=(e,t)=>{const n=e.l,o=n.length;e.l=n.filter(r=>t!==r),o===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},vd=(e,t,n)=>Wi(e.l,[t,n]);class en{constructor(t,n){this.client=t,this.clock=n}}const Xe=(e,t)=>e===t||e!==null&&t!==null&&e.client===t.client&&e.clock===t.clock,T=(e,t)=>new en(e,t),jn=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw St()},Wn=(e,t)=>{for(;t!==null;){if(t.parent===e)return!0;t=t.parent._item}return!1};class Gn{constructor(t,n,o,r=0){this.type=t,this.tname=n,this.item=o,this.assoc=r}}const Bn=e=>new Gn(e.type==null?null:T(e.type.client,e.type.clock),e.tname??null,e.item==null?null:T(e.item.client,e.item.clock),e.assoc==null?0:e.assoc);class $b{constructor(t,n,o=0){this.type=t,this.index=n,this.assoc=o}}const Fb=(e,t,n=0)=>new $b(e,t,n),So=(e,t,n)=>{let o=null,r=null;return e._item===null?r=jn(e):o=T(e._item.id.client,e._item.id.clock),new Gn(o,r,t,n)},vs=(e,t,n=0)=>{let o=e._start;if(n<0){if(t===0)return So(e,null,n);t--}for(;o!==null;){if(!o.deleted&&o.countable){if(o.length>t)return So(e,T(o.id.client,o.id.clock+t),n);t-=o.length}if(o.right===null&&n<0)return So(e,o.lastId,n);o=o.right}return So(e,null,n)},zb=(e,t)=>{const n=nn(e,t),o=t.clock-n.id.clock;return{item:n,diff:o}},jb=(e,t,n=!0)=>{const o=t.store,r=e.item,s=e.type,i=e.tname,l=e.assoc;let a=null,c=0;if(r!==null){if(Y(o,r.client)<=r.clock)return null;const d=n?oi(o,r):zb(o,r),u=d.item;if(!(u instanceof H))return null;if(a=u.parent,a._item===null||!a._item.deleted){c=u.deleted||!u.countable?0:d.diff+(l>=0?0:1);let h=u.left;for(;h!==null;)!h.deleted&&h.countable&&(c+=h.length),h=h.left}}else{if(i!==null)a=t.get(i);else if(s!==null){if(Y(o,s.client)<=s.clock)return null;const{item:d}=n?oi(o,s):{item:nn(o,s)};if(d instanceof H&&d.content instanceof Vt)a=d.content.type;else return null}else throw St();l>=0?c=a._length:c=0}return Fb(a,c,e.assoc)},pa=(e,t)=>e===t||e!==null&&t!==null&&e.tname===t.tname&&Xe(e.item,t.item)&&Xe(e.type,t.type)&&e.assoc===t.assoc;class Qi{constructor(t,n){this.ds=t,this.sv=n}}const Cd=(e,t)=>new Qi(e,t),Cs=e=>Cd(gd(e.store),Fr(e.store)),Le=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!gn(t.ds,e.id),ti=(e,t)=>{const n=Xt(e.meta,ti,Ve),o=e.doc.store;n.has(t)||(t.sv.forEach((r,s)=>{r<Y(o,s)&&bt(e,T(s,r))}),ke(e,t.ds,r=>{}),n.add(t))};class Sd{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Fr=e=>{const t=new Map;return e.clients.forEach((n,o)=>{const r=n[n.length-1];t.set(o,r.id.clock+r.length)}),t},Y=(e,t)=>{const n=e.clients.get(t);if(n===void 0)return 0;const o=n[n.length-1];return o.id.clock+o.length},Ed=(e,t)=>{let n=e.clients.get(t.id.client);if(n===void 0)n=[],e.clients.set(t.id.client,n);else{const o=n[n.length-1];if(o.id.clock+o.length!==t.id.clock)throw St()}n.push(t)},Ot=(e,t)=>{let n=0,o=e.length-1,r=e[o],s=r.id.clock;if(s===t)return o;let i=le(t/(s+r.length-1)*o);for(;n<=o;){if(r=e[i],s=r.id.clock,s<=t){if(t<s+r.length)return i;n=i+1}else o=i-1;i=le((n+o)/2)}throw St()},Wb=(e,t)=>{const n=e.clients.get(t.client);return n[Ot(n,t.clock)]},nn=Wb,ei=(e,t,n)=>{const o=Ot(t,n),r=t[o];return r.id.clock<n&&r instanceof H?(t.splice(o+1,0,Mr(e,r,n-r.id.clock)),o+1):o},bt=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[ei(e,n,t.clock)]},ma=(e,t,n)=>{const o=t.clients.get(n.client),r=Ot(o,n.clock),s=o[r];return n.clock!==s.id.clock+s.length-1&&s.constructor!==Lt&&o.splice(r+1,0,Mr(e,s,n.clock-s.id.clock+1)),s},Gb=(e,t,n)=>{const o=e.clients.get(t.id.client);o[Ot(o,t.id.clock)]=n},xd=(e,t,n,o,r)=>{if(o===0)return;const s=n+o;let i=ei(e,t,n),l;do l=t[i++],s<l.id.clock+l.length&&ei(e,t,s),r(l);while(i<t.length&&t[i].id.clock<s)};class Kb{constructor(t,n,o){this.doc=t,this.deleteSet=new mn,this.beforeState=Fr(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=o,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const ga=(e,t)=>t.deleteSet.clients.size===0&&!lg(t.afterState,(n,o)=>t.beforeState.get(o)!==n)?!1:(Ji(t.deleteSet),Db(e,t),bn(e,t.deleteSet),!0),ba=(e,t,n)=>{const o=t._item;(o===null||o.id.clock<(e.beforeState.get(o.id.client)||0)&&!o.deleted)&&Xt(e.changed,t,Ve).add(n)},Ho=(e,t)=>{let n=e[t],o=e[t-1],r=t;for(;r>0;n=o,o=e[--r-1]){if(o.deleted===n.deleted&&o.constructor===n.constructor&&o.mergeWith(n)){n instanceof H&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,o);continue}break}const s=t-r;return s&&e.splice(t+1-s,s),s},qb=(e,t,n)=>{for(const[o,r]of e.clients.entries()){const s=t.clients.get(o);for(let i=r.length-1;i>=0;i--){const l=r[i],a=l.clock+l.len;for(let c=Ot(s,l.clock),d=s[c];c<s.length&&d.id.clock<a;d=s[++c]){const u=s[c];if(l.clock+l.len<=u.id.clock)break;u instanceof H&&u.deleted&&!u.keep&&n(u)&&u.gc(t,!1)}}}},Jb=(e,t)=>{e.clients.forEach((n,o)=>{const r=t.clients.get(o);for(let s=n.length-1;s>=0;s--){const i=n[s],l=se(r.length-1,1+Ot(r,i.clock+i.len-1));for(let a=l,c=r[a];a>0&&c.id.clock>=i.clock;c=r[a])a-=1+Ho(r,a)}})},Ad=(e,t)=>{if(t<e.length){const n=e[t],o=n.doc,r=o.store,s=n.deleteSet,i=n._mergeStructs;try{Ji(s),n.afterState=Fr(n.doc.store),o.emit("beforeObserverCalls",[n,o]);const l=[];n.changed.forEach((a,c)=>l.push(()=>{(c._item===null||!c._item.deleted)&&c._callObserver(n,a)})),l.push(()=>{n.changedParentTypes.forEach((a,c)=>{c._dEH.l.length>0&&(c._item===null||!c._item.deleted)&&(a=a.filter(d=>d.target._item===null||!d.target._item.deleted),a.forEach(d=>{d.currentTarget=c,d._path=null}),a.sort((d,u)=>d.path.length-u.path.length),vd(c._dEH,a,n))})}),l.push(()=>o.emit("afterTransaction",[n,o])),Wi(l,[]),n._needFormattingCleanup&&gw(n)}finally{o.gc&&qb(s,r,o.gcFilter),Jb(s,r),n.afterState.forEach((d,u)=>{const h=n.beforeState.get(u)||0;if(h!==d){const f=r.clients.get(u),p=Nt(Ot(f,h),1);for(let m=f.length-1;m>=p;)m-=1+Ho(f,m)}});for(let d=i.length-1;d>=0;d--){const{client:u,clock:h}=i[d].id,f=r.clients.get(u),p=Ot(f,h);p+1<f.length&&Ho(f,p+1)>1||p>0&&Ho(f,p)}if(!n.local&&n.afterState.get(o.clientID)!==n.beforeState.get(o.clientID)&&(Ab(Ki,ad,"[yjs] ",cd,dd,"Changed the client-id because another client seems to be using it."),o.clientID=bd()),o.emit("afterTransactionCleanup",[n,o]),o._observers.has("update")){const d=new oo;ga(d,n)&&o.emit("update",[d.toUint8Array(),n.origin,o,n])}if(o._observers.has("updateV2")){const d=new Fe;ga(d,n)&&o.emit("updateV2",[d.toUint8Array(),n.origin,o,n])}const{subdocsAdded:l,subdocsLoaded:a,subdocsRemoved:c}=n;(l.size>0||c.size>0||a.size>0)&&(l.forEach(d=>{d.clientID=o.clientID,d.collectionid==null&&(d.collectionid=o.collectionid),o.subdocs.add(d)}),c.forEach(d=>o.subdocs.delete(d)),o.emit("subdocs",[{loaded:a,added:l,removed:c},o,n]),c.forEach(d=>d.destroy())),e.length<=t+1?(o._transactionCleanups=[],o.emit("afterAllTransactions",[o,e])):Ad(e,t+1)}}},V=(e,t,n=null,o=!0)=>{const r=e._transactionCleanups;let s=!1,i=null;e._transaction===null&&(s=!0,e._transaction=new Kb(e,n,o),r.push(e._transaction),r.length===1&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{i=t(e._transaction)}finally{if(s){const l=e._transaction===r[0];e._transaction=null,l&&Ad(r,0)}}return i};class Yb{constructor(t,n){this.insertions=n,this.deletions=t,this.meta=new Map}}const wa=(e,t,n)=>{ke(e,n.deletions,o=>{o instanceof H&&t.scope.some(r=>r===e.doc||Wn(r,o))&&il(o,!1)})},ka=(e,t,n)=>{let o=null;const r=e.doc,s=e.scope;V(r,l=>{for(;t.length>0&&e.currStackItem===null;){const a=r.store,c=t.pop(),d=new Set,u=[];let h=!1;ke(l,c.insertions,f=>{if(f instanceof H){if(f.redone!==null){let{item:p,diff:m}=oi(a,f.id);m>0&&(p=bt(l,T(p.id.client,p.id.clock+m))),f=p}!f.deleted&&s.some(p=>p===l.doc||Wn(p,f))&&u.push(f)}}),ke(l,c.deletions,f=>{f instanceof H&&s.some(p=>p===l.doc||Wn(p,f))&&!gn(c.insertions,f.id)&&d.add(f)}),d.forEach(f=>{h=Gd(l,f,d,c.insertions,e.ignoreRemoteMapChanges,e)!==null||h});for(let f=u.length-1;f>=0;f--){const p=u[f];e.deleteFilter(p)&&(p.delete(l),h=!0)}e.currStackItem=h?c:null}l.changed.forEach((a,c)=>{a.has(null)&&c._searchMarker&&(c._searchMarker.length=0)}),o=l},e);const i=e.currStackItem;if(i!=null){const l=o.changedParentTypes;e.emit("stack-item-popped",[{stackItem:i,type:n,changedParentTypes:l,origin:e},e]),e.currStackItem=null}return i};class Md extends Jc{constructor(t,{captureTimeout:n=500,captureTransaction:o=a=>!0,deleteFilter:r=()=>!0,trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:l=qs(t)?t[0].doc:t instanceof Ee?t:t.doc}={}){super(),this.scope=[],this.doc=l,this.addToScope(t),this.deleteFilter=r,s.add(this),this.trackedOrigins=s,this.captureTransaction=o,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.captureTimeout=n,this.afterTransactionHandler=a=>{if(!this.captureTransaction(a)||!this.scope.some(g=>a.changedParentTypes.has(g)||g===this.doc)||!this.trackedOrigins.has(a.origin)&&(!a.origin||!this.trackedOrigins.has(a.origin.constructor)))return;const c=this.undoing,d=this.redoing,u=c?this.redoStack:this.undoStack;c?this.stopCapturing():d||this.clear(!1,!0);const h=new mn;a.afterState.forEach((g,b)=>{const k=a.beforeState.get(b)||0,v=g-k;v>0&&zn(h,b,k,v)});const f=Gg();let p=!1;if(this.lastChange>0&&f-this.lastChange<this.captureTimeout&&u.length>0&&!c&&!d){const g=u[u.length-1];g.deletions=Zs([g.deletions,a.deleteSet]),g.insertions=Zs([g.insertions,h])}else u.push(new Yb(a.deleteSet,h)),p=!0;!c&&!d&&(this.lastChange=f),ke(a,a.deleteSet,g=>{g instanceof H&&this.scope.some(b=>b===a.doc||Wn(b,g))&&il(g,!0)});const m=[{stackItem:u[u.length-1],origin:a.origin,type:c?"redo":"undo",changedParentTypes:a.changedParentTypes},this];p?this.emit("stack-item-added",m):this.emit("stack-item-updated",m)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(t){const n=new Set(this.scope);t=qs(t)?t:[t],t.forEach(o=>{n.has(o)||(n.add(o),(o instanceof et?o.doc!==this.doc:o!==this.doc)&&hd("[yjs#509] Not same Y.Doc"),this.scope.push(o))})}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,n=!0){(t&&this.canUndo()||n&&this.canRedo())&&this.doc.transact(o=>{t&&(this.undoStack.forEach(r=>wa(o,this,r)),this.undoStack=[]),n&&(this.redoStack.forEach(r=>wa(o,this,r)),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:n}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let t;try{t=ka(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){this.redoing=!0;let t;try{t=ka(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Xb(e){const t=L(e.restDecoder);for(let n=0;n<t;n++){const o=L(e.restDecoder),r=e.readClient();let s=L(e.restDecoder);for(let i=0;i<o;i++){const l=e.readInfo();if(l===10){const a=L(e.restDecoder);yield new It(T(r,s),a),s+=a}else if((Ur&l)!==0){const a=(l&(ie|ht))===0,c=new H(T(r,s),null,(l&ht)===ht?e.readLeftID():null,null,(l&ie)===ie?e.readRightID():null,a?e.readParentInfo()?e.readString():e.readLeftID():null,a&&(l&Vn)===Vn?e.readString():null,Kd(e,l));yield c,s+=c.length}else{const a=e.readLen();yield new Lt(T(r,s),a),s+=a}}}}class Zi{constructor(t,n){this.gen=Xb(t),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===It);return this.curr}}class tl{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const Qb=e=>Cr(e,kd,oo),Zb=(e,t)=>{if(e.constructor===Lt){const{client:n,clock:o}=e.id;return new Lt(T(n,o+t),e.length-t)}else if(e.constructor===It){const{client:n,clock:o}=e.id;return new It(T(n,o+t),e.length-t)}else{const n=e,{client:o,clock:r}=n.id;return new H(T(o,r+t),null,T(o,r+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},Cr=(e,t=un,n=Fe)=>{if(e.length===1)return e[0];const o=e.map(d=>new t(pn(d)));let r=o.map(d=>new Zi(d,!0)),s=null;const i=new n,l=new tl(i);for(;r=r.filter(h=>h.curr!==null),r.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){const p=h.curr.id.clock-f.curr.id.clock;return p===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===It?1:-1:p}else return f.curr.id.client-h.curr.id.client}),r.length!==0;){const d=r[0],u=d.curr.id.client;if(s!==null){let h=d.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=s.struct.id.clock+s.struct.length&&h.id.client>=s.struct.id.client;)h=d.next(),f=!0;if(h===null||h.id.client!==u||f&&h.id.clock>s.struct.id.clock+s.struct.length)continue;if(u!==s.struct.id.client)me(l,s.struct,s.offset),s={struct:h,offset:0},d.next();else if(s.struct.id.clock+s.struct.length<h.id.clock)if(s.struct.constructor===It)s.struct.length=h.id.clock+h.length-s.struct.id.clock;else{me(l,s.struct,s.offset);const p=h.id.clock-s.struct.id.clock-s.struct.length;s={struct:new It(T(u,s.struct.id.clock+s.struct.length),p),offset:0}}else{const p=s.struct.id.clock+s.struct.length-h.id.clock;p>0&&(s.struct.constructor===It?s.struct.length-=p:h=Zb(h,p)),s.struct.mergeWith(h)||(me(l,s.struct,s.offset),s={struct:h,offset:0},d.next())}}else s={struct:d.curr,offset:0},d.next();for(let h=d.curr;h!==null&&h.id.client===u&&h.id.clock===s.struct.id.clock+s.struct.length&&h.constructor!==It;h=d.next())me(l,s.struct,s.offset),s={struct:h,offset:0}}s!==null&&(me(l,s.struct,s.offset),s=null),el(l);const a=o.map(d=>Yi(d)),c=Zs(a);return bn(i,c),i.toUint8Array()},tw=(e,t,n=un,o=Fe)=>{const r=yd(t),s=new o,i=new tl(s),l=new n(pn(e)),a=new Zi(l,!1);for(;a.curr;){const d=a.curr,u=d.id.client,h=r.get(u)||0;if(a.curr.constructor===It){a.next();continue}if(d.id.clock+d.length>h)for(me(i,d,Nt(h-d.id.clock,0)),a.next();a.curr&&a.curr.id.client===u;)me(i,a.curr,0),a.next();else for(;a.curr&&a.curr.id.client===u&&a.curr.id.clock+a.curr.length<=h;)a.next()}el(i);const c=Yi(l);return bn(s,c),s.toUint8Array()},Td=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:Dt(e.encoder.restEncoder)}),e.encoder.restEncoder=no(),e.written=0)},me=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Td(e),e.written===0&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),D(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},el=e=>{Td(e);const t=e.encoder.restEncoder;D(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const o=e.clientStructs[n];D(t,o.written),Vr(t,o.restEncoder)}},ew=(e,t,n,o)=>{const r=new n(pn(e)),s=new Zi(r,!1),i=new o,l=new tl(i);for(let c=s.curr;c!==null;c=s.next())me(l,t(c),0);el(l);const a=Yi(r);return bn(i,a),i.toUint8Array()},nw=e=>ew(e,nb,un,oo),ya="You must not compute changes after the event-handler fired.";class zr{constructor(t,n){this.target=t,this.currentTarget=t,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=ow(this.currentTarget,this.target))}deletes(t){return gn(this.transaction.deleteSet,t.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw we(ya);const t=new Map,n=this.target;this.transaction.changed.get(n).forEach(r=>{if(r!==null){const s=n._map.get(r);let i,l;if(this.adds(s)){let a=s.left;for(;a!==null&&this.adds(a);)a=a.left;if(this.deletes(s))if(a!==null&&this.deletes(a))i="delete",l=ms(a.content.getContent());else return;else a!==null&&this.deletes(a)?(i="update",l=ms(a.content.getContent())):(i="add",l=void 0)}else if(this.deletes(s))i="delete",l=ms(s.content.getContent());else return;t.set(r,{action:i,oldValue:l})}}),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(t===null){if(this.transaction.doc._transactionCleanups.length===0)throw we(ya);const n=this.target,o=Ve(),r=Ve(),s=[];if(t={added:o,deleted:r,delta:s,keys:this.keys},this.transaction.changed.get(n).has(null)){let l=null;const a=()=>{l&&s.push(l)};for(let c=n._start;c!==null;c=c.right)c.deleted?this.deletes(c)&&!this.adds(c)&&((l===null||l.delete===void 0)&&(a(),l={delete:0}),l.delete+=c.length,r.add(c)):this.adds(c)?((l===null||l.insert===void 0)&&(a(),l={insert:[]}),l.insert=l.insert.concat(c.content.getContent()),o.add(c)):((l===null||l.retain===void 0)&&(a(),l={retain:0}),l.retain+=c.length);l!==null&&l.retain===void 0&&a()}this._changes=t}return t}}const ow=(e,t)=>{const n=[];for(;t._item!==null&&t!==e;){if(t._item.parentSub!==null)n.unshift(t._item.parentSub);else{let o=0,r=t._item.parent._start;for(;r!==t._item&&r!==null;)!r.deleted&&r.countable&&(o+=r.length),r=r.right;n.unshift(o)}t=t._item.parent}return n},ct=()=>{hd("Invalid access: Add Yjs type to a document before reading data.")},_d=80;let nl=0;class rw{constructor(t,n){t.marker=!0,this.p=t,this.index=n,this.timestamp=nl++}}const sw=e=>{e.timestamp=nl++},Ld=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=nl++},iw=(e,t,n)=>{if(e.length>=_d){const o=e.reduce((r,s)=>r.timestamp<s.timestamp?r:s);return Ld(o,t,n),o}else{const o=new rw(t,n);return e.push(o),o}},jr=(e,t)=>{if(e._start===null||t===0||e._searchMarker===null)return null;const n=e._searchMarker.length===0?null:e._searchMarker.reduce((s,i)=>Do(t-s.index)<Do(t-i.index)?s:i);let o=e._start,r=0;for(n!==null&&(o=n.p,r=n.index,sw(n));o.right!==null&&r<t;){if(!o.deleted&&o.countable){if(t<r+o.length)break;r+=o.length}o=o.right}for(;o.left!==null&&r>t;)o=o.left,!o.deleted&&o.countable&&(r-=o.length);for(;o.left!==null&&o.left.id.client===o.id.client&&o.left.id.clock+o.left.length===o.id.clock;)o=o.left,!o.deleted&&o.countable&&(r-=o.length);return n!==null&&Do(n.index-r)<o.parent.length/_d?(Ld(n,o,r),n):iw(e._searchMarker,o,r)},Kn=(e,t,n)=>{for(let o=e.length-1;o>=0;o--){const r=e[o];if(n>0){let s=r.p;for(s.marker=!1;s&&(s.deleted||!s.countable);)s=s.left,s&&!s.deleted&&s.countable&&(r.index-=s.length);if(s===null||s.marker===!0){e.splice(o,1);continue}r.p=s,s.marker=!0}(t<r.index||n>0&&t===r.index)&&(r.index=Nt(t,r.index+n))}},Wr=(e,t,n)=>{const o=e,r=t.changedParentTypes;for(;Xt(r,e,()=>[]).push(n),e._item!==null;)e=e._item.parent;vd(o._eH,n,t)};class et{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=ua(),this._dEH=ua(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,n){this.doc=t,this._item=n}_copy(){throw Rt()}clone(){throw Rt()}_write(t){}get _first(){let t=this._start;for(;t!==null&&t.deleted;)t=t.right;return t}_callObserver(t,n){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){ha(this._eH,t)}observeDeep(t){ha(this._dEH,t)}unobserve(t){fa(this._eH,t)}unobserveDeep(t){fa(this._dEH,t)}toJSON(){}}const Id=(e,t,n)=>{e.doc??ct(),t<0&&(t=e._length+t),n<0&&(n=e._length+n);let o=n-t;const r=[];let s=e._start;for(;s!==null&&o>0;){if(s.countable&&!s.deleted){const i=s.content.getContent();if(i.length<=t)t-=i.length;else{for(let l=t;l<i.length&&o>0;l++)r.push(i[l]),o--;t=0}}s=s.right}return r},Pd=e=>{e.doc??ct();const t=[];let n=e._start;for(;n!==null;){if(n.countable&&!n.deleted){const o=n.content.getContent();for(let r=0;r<o.length;r++)t.push(o[r])}n=n.right}return t},Od=(e,t)=>{const n=[];let o=e._start;for(;o!==null;){if(o.countable&&Le(o,t)){const r=o.content.getContent();for(let s=0;s<r.length;s++)n.push(r[s])}o=o.right}return n},qn=(e,t)=>{let n=0,o=e._start;for(e.doc??ct();o!==null;){if(o.countable&&!o.deleted){const r=o.content.getContent();for(let s=0;s<r.length;s++)t(r[s],n++,e)}o=o.right}},Bd=(e,t)=>{const n=[];return qn(e,(o,r)=>{n.push(t(o,r,e))}),n},lw=e=>{let t=e._start,n=null,o=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;t!==null&&t.deleted;)t=t.right;if(t===null)return{done:!0,value:void 0};n=t.content.getContent(),o=0,t=t.right}const r=n[o++];return n.length<=o&&(n=null),{done:!1,value:r}}}},Dd=(e,t)=>{e.doc??ct();const n=jr(e,t);let o=e._start;for(n!==null&&(o=n.p,t-=n.index);o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<o.length)return o.content.getContent()[t];t-=o.length}},Sr=(e,t,n,o)=>{let r=n;const s=e.doc,i=s.clientID,l=s.store,a=n===null?t._start:n.right;let c=[];const d=()=>{c.length>0&&(r=new H(T(i,Y(l,i)),r,r&&r.lastId,a,a&&a.id,t,null,new je(c)),r.integrate(e,0),c=[])};o.forEach(u=>{if(u===null)c.push(u);else switch(u.constructor){case Number:case Object:case Boolean:case Array:case String:c.push(u);break;default:switch(d(),u.constructor){case Uint8Array:case ArrayBuffer:r=new H(T(i,Y(l,i)),r,r&&r.lastId,a,a&&a.id,t,null,new ro(new Uint8Array(u))),r.integrate(e,0);break;case Ee:r=new H(T(i,Y(l,i)),r,r&&r.lastId,a,a&&a.id,t,null,new so(u)),r.integrate(e,0);break;default:if(u instanceof et)r=new H(T(i,Y(l,i)),r,r&&r.lastId,a,a&&a.id,t,null,new Vt(u)),r.integrate(e,0);else throw new Error("Unexpected content type in insert operation")}}}),d()},Rd=()=>we("Length exceeded!"),Nd=(e,t,n,o)=>{if(n>t._length)throw Rd();if(n===0)return t._searchMarker&&Kn(t._searchMarker,n,o.length),Sr(e,t,null,o);const r=n,s=jr(t,n);let i=t._start;for(s!==null&&(i=s.p,n-=s.index,n===0&&(i=i.prev,n+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(n<=i.length){n<i.length&&bt(e,T(i.id.client,i.id.clock+n));break}n-=i.length}return t._searchMarker&&Kn(t._searchMarker,r,o.length),Sr(e,t,i,o)},aw=(e,t,n)=>{let r=(t._searchMarker||[]).reduce((s,i)=>i.index>s.index?i:s,{index:0,p:t._start}).p;if(r)for(;r.right;)r=r.right;return Sr(e,t,r,n)},Hd=(e,t,n,o)=>{if(o===0)return;const r=n,s=o,i=jr(t,n);let l=t._start;for(i!==null&&(l=i.p,n-=i.index);l!==null&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&bt(e,T(l.id.client,l.id.clock+n)),n-=l.length);for(;o>0&&l!==null;)l.deleted||(o<l.length&&bt(e,T(l.id.client,l.id.clock+o)),l.delete(e),o-=l.length),l=l.right;if(o>0)throw Rd();t._searchMarker&&Kn(t._searchMarker,r,-s+o)},Er=(e,t,n)=>{const o=t._map.get(n);o!==void 0&&o.delete(e)},ol=(e,t,n,o)=>{const r=t._map.get(n)||null,s=e.doc,i=s.clientID;let l;if(o==null)l=new je([o]);else switch(o.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:l=new je([o]);break;case Uint8Array:l=new ro(o);break;case Ee:l=new so(o);break;default:if(o instanceof et)l=new Vt(o);else throw new Error("Unexpected content type")}new H(T(i,Y(s.store,i)),r,r&&r.lastId,null,null,t,n,l).integrate(e,0)},rl=(e,t)=>{e.doc??ct();const n=e._map.get(t);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},Ud=e=>{const t={};return e.doc??ct(),e._map.forEach((n,o)=>{n.deleted||(t[o]=n.content.getContent()[n.length-1])}),t},Vd=(e,t)=>{e.doc??ct();const n=e._map.get(t);return n!==void 0&&!n.deleted},cw=(e,t)=>{const n={};return e._map.forEach((o,r)=>{let s=o;for(;s!==null&&(!t.sv.has(s.id.client)||s.id.clock>=(t.sv.get(s.id.client)||0));)s=s.left;s!==null&&Le(s,t)&&(n[r]=s.content.getContent()[s.length-1])}),n},Eo=e=>(e.doc??ct(),Mb(e._map.entries(),t=>!t[1].deleted));class dw extends zr{}class on extends et{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const n=new on;return n.push(t),n}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new on}clone(){const t=new on;return t.insert(0,this.toArray().map(n=>n instanceof et?n.clone():n)),t}get length(){return this.doc??ct(),this._length}_callObserver(t,n){super._callObserver(t,n),Wr(this,t,new dw(this,t))}insert(t,n){this.doc!==null?V(this.doc,o=>{Nd(o,this,t,n)}):this._prelimContent.splice(t,0,...n)}push(t){this.doc!==null?V(this.doc,n=>{aw(n,this,t)}):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,n=1){this.doc!==null?V(this.doc,o=>{Hd(o,this,t,n)}):this._prelimContent.splice(t,n)}get(t){return Dd(this,t)}toArray(){return Pd(this)}slice(t=0,n=this.length){return Id(this,t,n)}toJSON(){return this.map(t=>t instanceof et?t.toJSON():t)}map(t){return Bd(this,t)}forEach(t){qn(this,t)}[Symbol.iterator](){return lw(this)}_write(t){t.writeTypeRef(Dw)}}const uw=e=>new on;class hw extends zr{constructor(t,n,o){super(t,n),this.keysChanged=o}}class hn extends et{constructor(t){super(),this._prelimContent=null,t===void 0?this._prelimContent=new Map:this._prelimContent=new Map(t)}_integrate(t,n){super._integrate(t,n),this._prelimContent.forEach((o,r)=>{this.set(r,o)}),this._prelimContent=null}_copy(){return new hn}clone(){const t=new hn;return this.forEach((n,o)=>{t.set(o,n instanceof et?n.clone():n)}),t}_callObserver(t,n){Wr(this,t,new hw(this,t,n))}toJSON(){this.doc??ct();const t={};return this._map.forEach((n,o)=>{if(!n.deleted){const r=n.content.getContent()[n.length-1];t[o]=r instanceof et?r.toJSON():r}}),t}get size(){return[...Eo(this)].length}keys(){return ys(Eo(this),t=>t[0])}values(){return ys(Eo(this),t=>t[1].content.getContent()[t[1].length-1])}entries(){return ys(Eo(this),t=>[t[0],t[1].content.getContent()[t[1].length-1]])}forEach(t){this.doc??ct(),this._map.forEach((n,o)=>{n.deleted||t(n.content.getContent()[n.length-1],o,this)})}[Symbol.iterator](){return this.entries()}delete(t){this.doc!==null?V(this.doc,n=>{Er(n,this,t)}):this._prelimContent.delete(t)}set(t,n){return this.doc!==null?V(this.doc,o=>{ol(o,this,t,n)}):this._prelimContent.set(t,n),n}get(t){return rl(this,t)}has(t){return Vd(this,t)}clear(){this.doc!==null?V(this.doc,t=>{this.forEach(function(n,o,r){Er(t,r,o)})}):this._prelimContent.clear()}_write(t){t.writeTypeRef(Rw)}}const fw=e=>new hn,ge=(e,t)=>e===t||typeof e=="object"&&typeof t=="object"&&e&&t&&tb(e,t);class ni{constructor(t,n,o,r){this.left=t,this.right=n,this.index=o,this.currentAttributes=r}forward(){switch(this.right===null&&St(),this.right.content.constructor){case Q:this.right.deleted||wn(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const va=(e,t,n)=>{for(;t.right!==null&&n>0;){switch(t.right.content.constructor){case Q:t.right.deleted||wn(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&bt(e,T(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},xo=(e,t,n,o)=>{const r=new Map,s=o?jr(t,n):null;if(s){const i=new ni(s.p.left,s.p,s.index,r);return va(e,i,n-s.index)}else{const i=new ni(null,t._start,0,r);return va(e,i,n)}},$d=(e,t,n,o)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===Q&&ge(o.get(n.right.content.key),n.right.content.value));)n.right.deleted||o.delete(n.right.content.key),n.forward();const r=e.doc,s=r.clientID;o.forEach((i,l)=>{const a=n.left,c=n.right,d=new H(T(s,Y(r.store,s)),a,a&&a.lastId,c,c&&c.id,t,null,new Q(l,i));d.integrate(e,0),n.right=d,n.forward()})},wn=(e,t)=>{const{key:n,value:o}=t;o===null?e.delete(n):e.set(n,o)},Fd=(e,t)=>{for(;e.right!==null;){if(!(e.right.deleted||e.right.content.constructor===Q&&ge(t[e.right.content.key]??null,e.right.content.value)))break;e.forward()}},zd=(e,t,n,o)=>{const r=e.doc,s=r.clientID,i=new Map;for(const l in o){const a=o[l],c=n.currentAttributes.get(l)??null;if(!ge(c,a)){i.set(l,c);const{left:d,right:u}=n;n.right=new H(T(s,Y(r.store,s)),d,d&&d.lastId,u,u&&u.id,t,null,new Q(l,a)),n.right.integrate(e,0),n.forward()}}return i},Ss=(e,t,n,o,r)=>{n.currentAttributes.forEach((h,f)=>{r[f]===void 0&&(r[f]=null)});const s=e.doc,i=s.clientID;Fd(n,r);const l=zd(e,t,n,r),a=o.constructor===String?new Ht(o):o instanceof et?new Vt(o):new Ke(o);let{left:c,right:d,index:u}=n;t._searchMarker&&Kn(t._searchMarker,n.index,a.getLength()),d=new H(T(i,Y(s.store,i)),c,c&&c.lastId,d,d&&d.id,t,null,a),d.integrate(e,0),n.right=d,n.index=u,n.forward(),$d(e,t,n,l)},Ca=(e,t,n,o,r)=>{const s=e.doc,i=s.clientID;Fd(n,r);const l=zd(e,t,n,r);t:for(;n.right!==null&&(o>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Q));){if(!n.right.deleted)switch(n.right.content.constructor){case Q:{const{key:a,value:c}=n.right.content,d=r[a];if(d!==void 0){if(ge(d,c))l.delete(a);else{if(o===0)break t;l.set(a,c)}n.right.delete(e)}else n.currentAttributes.set(a,c);break}default:o<n.right.length&&bt(e,T(n.right.id.client,n.right.id.clock+o)),o-=n.right.length;break}n.forward()}if(o>0){let a="";for(;o>0;o--)a+=`
`;n.right=new H(T(i,Y(s.store,i)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ht(a)),n.right.integrate(e,0),n.forward()}$d(e,t,n,l)},jd=(e,t,n,o,r)=>{let s=t;const i=Pt();for(;s&&(!s.countable||s.deleted);){if(!s.deleted&&s.content.constructor===Q){const c=s.content;i.set(c.key,c)}s=s.right}let l=0,a=!1;for(;t!==s;){if(n===t&&(a=!0),!t.deleted){const c=t.content;switch(c.constructor){case Q:{const{key:d,value:u}=c,h=o.get(d)??null;(i.get(d)!==c||h===u)&&(t.delete(e),l++,!a&&(r.get(d)??null)===u&&h!==u&&(h===null?r.delete(d):r.set(d,h))),!a&&!t.deleted&&wn(r,c);break}}}t=t.right}return l},pw=(e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Q){const o=t.content.key;n.has(o)?t.delete(e):n.add(o)}t=t.left}},mw=e=>{let t=0;return V(e.doc,n=>{let o=e._start,r=e._start,s=Pt();const i=Ks(s);for(;r;){if(r.deleted===!1)switch(r.content.constructor){case Q:wn(i,r.content);break;default:t+=jd(n,o,r,s,i),s=Ks(i),o=r;break}r=r.right}}),t},gw=e=>{const t=new Set,n=e.doc;for(const[o,r]of e.afterState.entries()){const s=e.beforeState.get(o)||0;r!==s&&xd(e,n.store.clients.get(o),s,r,i=>{!i.deleted&&i.content.constructor===Q&&i.constructor!==Lt&&t.add(i.parent)})}V(n,o=>{ke(e,e.deleteSet,r=>{if(r instanceof Lt||!r.parent._hasFormatting||t.has(r.parent))return;const s=r.parent;r.content.constructor===Q?t.add(s):pw(o,r)});for(const r of t)mw(r)})},Sa=(e,t,n)=>{const o=n,r=Ks(t.currentAttributes),s=t.right;for(;n>0&&t.right!==null;){if(t.right.deleted===!1)switch(t.right.content.constructor){case Vt:case Ke:case Ht:n<t.right.length&&bt(e,T(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}s&&jd(e,s,t.right,r,t.currentAttributes);const i=(t.left||t.right).parent;return i._searchMarker&&Kn(i._searchMarker,t.index,-o+n),t};class bw extends zr{constructor(t,n,o){super(t,n),this.childListChanged=!1,this.keysChanged=new Set,o.forEach(r=>{r===null?this.childListChanged=!0:this.keysChanged.add(r)})}get changes(){if(this._changes===null){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(this._delta===null){const t=this.target.doc,n=[];V(t,o=>{const r=new Map,s=new Map;let i=this.target._start,l=null;const a={};let c="",d=0,u=0;const h=()=>{if(l!==null){let f=null;switch(l){case"delete":u>0&&(f={delete:u}),u=0;break;case"insert":(typeof c=="object"||c.length>0)&&(f={insert:c},r.size>0&&(f.attributes={},r.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),c="";break;case"retain":d>0&&(f={retain:d},Qg(a)||(f.attributes=Yg({},a))),d=0;break}f&&n.push(f),l=null}};for(;i!==null;){switch(i.content.constructor){case Vt:case Ke:this.adds(i)?this.deletes(i)||(h(),l="insert",c=i.content.getContent()[0],h()):this.deletes(i)?(l!=="delete"&&(h(),l="delete"),u+=1):i.deleted||(l!=="retain"&&(h(),l="retain"),d+=1);break;case Ht:this.adds(i)?this.deletes(i)||(l!=="insert"&&(h(),l="insert"),c+=i.content.str):this.deletes(i)?(l!=="delete"&&(h(),l="delete"),u+=i.length):i.deleted||(l!=="retain"&&(h(),l="retain"),d+=i.length);break;case Q:{const{key:f,value:p}=i.content;if(this.adds(i)){if(!this.deletes(i)){const m=r.get(f)??null;ge(m,p)?p!==null&&i.delete(o):(l==="retain"&&h(),ge(p,s.get(f)??null)?delete a[f]:a[f]=p)}}else if(this.deletes(i)){s.set(f,p);const m=r.get(f)??null;ge(m,p)||(l==="retain"&&h(),a[f]=m)}else if(!i.deleted){s.set(f,p);const m=a[f];m!==void 0&&(ge(m,p)?m!==null&&i.delete(o):(l==="retain"&&h(),p===null?delete a[f]:a[f]=p))}i.deleted||(l==="insert"&&h(),wn(r,i.content));break}}i=i.right}for(h();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class ye extends et{constructor(t){super(),this._pending=t!==void 0?[()=>this.insert(0,t)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??ct(),this._length}_integrate(t,n){super._integrate(t,n);try{this._pending.forEach(o=>o())}catch(o){console.error(o)}this._pending=null}_copy(){return new ye}clone(){const t=new ye;return t.applyDelta(this.toDelta()),t}_callObserver(t,n){super._callObserver(t,n);const o=new bw(this,t,n);Wr(this,t,o),!t.local&&this._hasFormatting&&(t._needFormattingCleanup=!0)}toString(){this.doc??ct();let t="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ht&&(t+=n.content.str),n=n.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:n=!0}={}){this.doc!==null?V(this.doc,o=>{const r=new ni(null,this._start,0,new Map);for(let s=0;s<t.length;s++){const i=t[s];if(i.insert!==void 0){const l=!n&&typeof i.insert=="string"&&s===t.length-1&&r.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof l!="string"||l.length>0)&&Ss(o,this,r,l,i.attributes||{})}else i.retain!==void 0?Ca(o,this,r,i.retain,i.attributes||{}):i.delete!==void 0&&Sa(o,r,i.delete)}}):this._pending.push(()=>this.applyDelta(t))}toDelta(t,n,o){this.doc??ct();const r=[],s=new Map,i=this.doc;let l="",a=this._start;function c(){if(l.length>0){const u={};let h=!1;s.forEach((p,m)=>{h=!0,u[m]=p});const f={insert:l};h&&(f.attributes=u),r.push(f),l=""}}const d=()=>{for(;a!==null;){if(Le(a,t)||n!==void 0&&Le(a,n))switch(a.content.constructor){case Ht:{const u=s.get("ychange");t!==void 0&&!Le(a,t)?(u===void 0||u.user!==a.id.client||u.type!=="removed")&&(c(),s.set("ychange",o?o("removed",a.id):{type:"removed"})):n!==void 0&&!Le(a,n)?(u===void 0||u.user!==a.id.client||u.type!=="added")&&(c(),s.set("ychange",o?o("added",a.id):{type:"added"})):u!==void 0&&(c(),s.delete("ychange")),l+=a.content.str;break}case Vt:case Ke:{c();const u={insert:a.content.getContent()[0]};if(s.size>0){const h={};u.attributes=h,s.forEach((f,p)=>{h[p]=f})}r.push(u);break}case Q:Le(a,t)&&(c(),wn(s,a.content));break}a=a.right}c()};return t||n?V(i,u=>{t&&ti(u,t),n&&ti(u,n),d()},"cleanup"):d(),r}insert(t,n,o){if(n.length<=0)return;const r=this.doc;r!==null?V(r,s=>{const i=xo(s,this,t,!o);o||(o={},i.currentAttributes.forEach((l,a)=>{o[a]=l})),Ss(s,this,i,n,o)}):this._pending.push(()=>this.insert(t,n,o))}insertEmbed(t,n,o){const r=this.doc;r!==null?V(r,s=>{const i=xo(s,this,t,!o);Ss(s,this,i,n,o||{})}):this._pending.push(()=>this.insertEmbed(t,n,o||{}))}delete(t,n){if(n===0)return;const o=this.doc;o!==null?V(o,r=>{Sa(r,xo(r,this,t,!0),n)}):this._pending.push(()=>this.delete(t,n))}format(t,n,o){if(n===0)return;const r=this.doc;r!==null?V(r,s=>{const i=xo(s,this,t,!1);i.right!==null&&Ca(s,this,i,n,o)}):this._pending.push(()=>this.format(t,n,o))}removeAttribute(t){this.doc!==null?V(this.doc,n=>{Er(n,this,t)}):this._pending.push(()=>this.removeAttribute(t))}setAttribute(t,n){this.doc!==null?V(this.doc,o=>{ol(o,this,t,n)}):this._pending.push(()=>this.setAttribute(t,n))}getAttribute(t){return rl(this,t)}getAttributes(){return Ud(this)}_write(t){t.writeTypeRef(Nw)}}const ww=e=>new ye;class Es{constructor(t,n=()=>!0){this._filter=n,this._root=t,this._currentNode=t._start,this._firstCall=!0,t.doc??ct()}[Symbol.iterator](){return this}next(){let t=this._currentNode,n=t&&t.content&&t.content.type;if(t!==null&&(!this._firstCall||t.deleted||!this._filter(n)))do if(n=t.content.type,!t.deleted&&(n.constructor===ut||n.constructor===ze)&&n._start!==null)t=n._start;else for(;t!==null;){const o=t.next;if(o!==null){t=o;break}else t.parent===this._root?t=null:t=t.parent._item}while(t!==null&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,t===null?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class ze extends et{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,n){super._integrate(t,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new ze}clone(){const t=new ze;return t.insert(0,this.toArray().map(n=>n instanceof et?n.clone():n)),t}get length(){return this.doc??ct(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(t){return new Es(this,t)}querySelector(t){t=t.toUpperCase();const o=new Es(this,r=>r.nodeName&&r.nodeName.toUpperCase()===t).next();return o.done?null:o.value}querySelectorAll(t){return t=t.toUpperCase(),$e(new Es(this,n=>n.nodeName&&n.nodeName.toUpperCase()===t))}_callObserver(t,n){Wr(this,t,new vw(this,n,t))}toString(){return Bd(this,t=>t.toString()).join("")}toJSON(){return this.toString()}toDOM(t=document,n={},o){const r=t.createDocumentFragment();return o!==void 0&&o._createAssociation(r,this),qn(this,s=>{r.insertBefore(s.toDOM(t,n,o),null)}),r}insert(t,n){this.doc!==null?V(this.doc,o=>{Nd(o,this,t,n)}):this._prelimContent.splice(t,0,...n)}insertAfter(t,n){if(this.doc!==null)V(this.doc,o=>{const r=t&&t instanceof et?t._item:t;Sr(o,this,r,n)});else{const o=this._prelimContent,r=t===null?0:o.findIndex(s=>s===t)+1;if(r===0&&t!==null)throw we("Reference item not found");o.splice(r,0,...n)}}delete(t,n=1){this.doc!==null?V(this.doc,o=>{Hd(o,this,t,n)}):this._prelimContent.splice(t,n)}toArray(){return Pd(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return Dd(this,t)}slice(t=0,n=this.length){return Id(this,t,n)}forEach(t){qn(this,t)}_write(t){t.writeTypeRef(Uw)}}const kw=e=>new ze;class ut extends ze{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,n){super._integrate(t,n),this._prelimAttrs.forEach((o,r)=>{this.setAttribute(r,o)}),this._prelimAttrs=null}_copy(){return new ut(this.nodeName)}clone(){const t=new ut(this.nodeName),n=this.getAttributes();return Xg(n,(o,r)=>{typeof o=="string"&&t.setAttribute(r,o)}),t.insert(0,this.toArray().map(o=>o instanceof et?o.clone():o)),t}toString(){const t=this.getAttributes(),n=[],o=[];for(const l in t)o.push(l);o.sort();const r=o.length;for(let l=0;l<r;l++){const a=o[l];n.push(a+'="'+t[a]+'"')}const s=this.nodeName.toLocaleLowerCase(),i=n.length>0?" "+n.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(t){this.doc!==null?V(this.doc,n=>{Er(n,this,t)}):this._prelimAttrs.delete(t)}setAttribute(t,n){this.doc!==null?V(this.doc,o=>{ol(o,this,t,n)}):this._prelimAttrs.set(t,n)}getAttribute(t){return rl(this,t)}hasAttribute(t){return Vd(this,t)}getAttributes(t){return t?cw(this,t):Ud(this)}toDOM(t=document,n={},o){const r=t.createElement(this.nodeName),s=this.getAttributes();for(const i in s){const l=s[i];typeof l=="string"&&r.setAttribute(i,l)}return qn(this,i=>{r.appendChild(i.toDOM(t,n,o))}),o!==void 0&&o._createAssociation(r,this),r}_write(t){t.writeTypeRef(Hw),t.writeKey(this.nodeName)}}const yw=e=>new ut(e.readKey());class vw extends zr{constructor(t,n,o){super(t,o),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(r=>{r===null?this.childListChanged=!0:this.attributesChanged.add(r)})}}class xr extends hn{constructor(t){super(),this.hookName=t}_copy(){return new xr(this.hookName)}clone(){const t=new xr(this.hookName);return this.forEach((n,o)=>{t.set(o,n)}),t}toDOM(t=document,n={},o){const r=n[this.hookName];let s;return r!==void 0?s=r.createDom(this):s=document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),o!==void 0&&o._createAssociation(s,this),s}_write(t){t.writeTypeRef(Vw),t.writeKey(this.hookName)}}const Cw=e=>new xr(e.readKey());class vt extends ye{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new vt}clone(){const t=new vt;return t.applyDelta(this.toDelta()),t}toDOM(t=document,n,o){const r=t.createTextNode(this.toString());return o!==void 0&&o._createAssociation(r,this),r}toString(){return this.toDelta().map(t=>{const n=[];for(const r in t.attributes){const s=[];for(const i in t.attributes[r])s.push({key:i,value:t.attributes[r][i]});s.sort((i,l)=>i.key<l.key?-1:1),n.push({nodeName:r,attrs:s})}n.sort((r,s)=>r.nodeName<s.nodeName?-1:1);let o="";for(let r=0;r<n.length;r++){const s=n[r];o+=`<${s.nodeName}`;for(let i=0;i<s.attrs.length;i++){const l=s.attrs[i];o+=` ${l.key}="${l.value}"`}o+=">"}o+=t.insert;for(let r=n.length-1;r>=0;r--)o+=`</${n[r].nodeName}>`;return o}).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef($w)}}const Sw=e=>new vt;class sl{constructor(t,n){this.id=t,this.length=n}get deleted(){throw Rt()}mergeWith(t){return!1}write(t,n,o){throw Rt()}integrate(t,n){throw Rt()}}const Ew=0;class Lt extends sl{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){n>0&&(this.id.clock+=n,this.length-=n),Ed(t.doc.store,this)}write(t,n){t.writeInfo(Ew),t.writeLen(this.length-n)}getMissing(t,n){return null}}class ro{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ro(this.content)}splice(t){throw Rt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeBuf(this.content)}getRef(){return 3}}const xw=e=>new ro(e.readBuf());class Jn{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Jn(this.len)}splice(t){const n=new Jn(this.len-t);return this.len=t,n}mergeWith(t){return this.len+=t.len,!0}integrate(t,n){zn(t.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(t){}gc(t){}write(t,n){t.writeLen(this.len-n)}getRef(){return 1}}const Aw=e=>new Jn(e.readLen()),Wd=(e,t)=>new Ee({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class so{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const n={};this.opts=n,t.gc||(n.gc=!1),t.autoLoad&&(n.autoLoad=!0),t.meta!==null&&(n.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new so(Wd(this.doc.guid,this.opts))}splice(t){throw Rt()}mergeWith(t){return!1}integrate(t,n){this.doc._item=n,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,n){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const Mw=e=>new so(Wd(e.readString(),e.readAny()));class Ke{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Ke(this.embed)}splice(t){throw Rt()}mergeWith(t){return!1}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeJSON(this.embed)}getRef(){return 5}}const Tw=e=>new Ke(e.readJSON());class Q{constructor(t,n){this.key=t,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Q(this.key,this.value)}splice(t){throw Rt()}mergeWith(t){return!1}integrate(t,n){const o=n.parent;o._searchMarker=null,o._hasFormatting=!0}delete(t){}gc(t){}write(t,n){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const _w=e=>new Q(e.readKey(),e.readJSON());class Ar{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ar(this.arr)}splice(t){const n=new Ar(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const o=this.arr.length;t.writeLen(o-n);for(let r=n;r<o;r++){const s=this.arr[r];t.writeString(s===void 0?"undefined":JSON.stringify(s))}}getRef(){return 2}}const Lw=e=>{const t=e.readLen(),n=[];for(let o=0;o<t;o++){const r=e.readString();r==="undefined"?n.push(void 0):n.push(JSON.parse(r))}return new Ar(n)},Iw=yr("node_env")==="development";class je{constructor(t){this.arr=t,Iw&&rd(t)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new je(this.arr)}splice(t){const n=new je(this.arr.slice(t));return this.arr=this.arr.slice(0,t),n}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){const o=this.arr.length;t.writeLen(o-n);for(let r=n;r<o;r++){const s=this.arr[r];t.writeAny(s)}}getRef(){return 8}}const Pw=e=>{const t=e.readLen(),n=[];for(let o=0;o<t;o++)n.push(e.readAny());return new je(n)};class Ht{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ht(this.str)}splice(t){const n=new Ht(this.str.slice(t));this.str=this.str.slice(0,t);const o=this.str.charCodeAt(t-1);return o>=55296&&o<=56319&&(this.str=this.str.slice(0,t-1)+"�",n.str="�"+n.str.slice(1)),n}mergeWith(t){return this.str+=t.str,!0}integrate(t,n){}delete(t){}gc(t){}write(t,n){t.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const Ow=e=>new Ht(e.readString()),Bw=[uw,fw,ww,yw,kw,Cw,Sw],Dw=0,Rw=1,Nw=2,Hw=3,Uw=4,Vw=5,$w=6;class Vt{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Vt(this.type._copy())}splice(t){throw Rt()}mergeWith(t){return!1}integrate(t,n){this.type._integrate(t.doc,n)}delete(t){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(t.beforeState.get(n.id.client)||0)&&t._mergeStructs.push(n):n.delete(t),n=n.right;this.type._map.forEach(o=>{o.deleted?o.id.clock<(t.beforeState.get(o.id.client)||0)&&t._mergeStructs.push(o):o.delete(t)}),t.changed.delete(this.type)}gc(t){let n=this.type._start;for(;n!==null;)n.gc(t,!0),n=n.right;this.type._start=null,this.type._map.forEach(o=>{for(;o!==null;)o.gc(t,!0),o=o.left}),this.type._map=new Map}write(t,n){this.type._write(t)}getRef(){return 7}}const Fw=e=>new Vt(Bw[e.readTypeRef()](e)),oi=(e,t)=>{let n=t,o=0,r;do o>0&&(n=T(n.client,n.clock+o)),r=nn(e,n),o=n.clock-r.id.clock,n=r.redone;while(n!==null&&r instanceof H);return{item:r,diff:o}},il=(e,t)=>{for(;e!==null&&e.keep!==t;)e.keep=t,e=e.parent._item},Mr=(e,t,n)=>{const{client:o,clock:r}=t.id,s=new H(T(o,r+n),t,T(o,r+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&s.markDeleted(),t.keep&&(s.keep=!0),t.redone!==null&&(s.redone=T(t.redone.client,t.redone.clock+n)),t.right=s,s.right!==null&&(s.right.left=s),e._mergeStructs.push(s),s.parentSub!==null&&s.right===null&&s.parent._map.set(s.parentSub,s),t.length=n,s},Ea=(e,t)=>cg(e,n=>gn(n.deletions,t)),Gd=(e,t,n,o,r,s)=>{const i=e.doc,l=i.store,a=i.clientID,c=t.redone;if(c!==null)return bt(e,c);let d=t.parent._item,u=null,h;if(d!==null&&d.deleted===!0){if(d.redone===null&&(!n.has(d)||Gd(e,d,n,o,r,s)===null))return null;for(;d.redone!==null;)d=bt(e,d.redone)}const f=d===null?t.parent:d.content.type;if(t.parentSub===null){for(u=t.left,h=t;u!==null;){let b=u;for(;b!==null&&b.parent._item!==d;)b=b.redone===null?null:bt(e,b.redone);if(b!==null&&b.parent._item===d){u=b;break}u=u.left}for(;h!==null;){let b=h;for(;b!==null&&b.parent._item!==d;)b=b.redone===null?null:bt(e,b.redone);if(b!==null&&b.parent._item===d){h=b;break}h=h.right}}else if(h=null,t.right&&!r){for(u=t;u!==null&&u.right!==null&&(u.right.redone||gn(o,u.right.id)||Ea(s.undoStack,u.right.id)||Ea(s.redoStack,u.right.id));)for(u=u.right;u.redone;)u=bt(e,u.redone);if(u&&u.right!==null)return null}else u=f._map.get(t.parentSub)||null;const p=Y(l,a),m=T(a,p),g=new H(m,u,u&&u.lastId,h,h&&h.id,f,t.parentSub,t.content.copy());return t.redone=m,il(g,!0),g.integrate(e,0),g};class H extends sl{constructor(t,n,o,r,s,i,l,a){super(t,a.getLength()),this.origin=o,this.left=n,this.right=r,this.rightOrigin=s,this.parent=i,this.parentSub=l,this.redone=null,this.content=a,this.info=this.content.isCountable()?Ql:0}set marker(t){(this.info&bs)>0!==t&&(this.info^=bs)}get marker(){return(this.info&bs)>0}get keep(){return(this.info&Xl)>0}set keep(t){this.keep!==t&&(this.info^=Xl)}get countable(){return(this.info&Ql)>0}get deleted(){return(this.info&gs)>0}set deleted(t){this.deleted!==t&&(this.info^=gs)}markDeleted(){this.info|=gs}getMissing(t,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Y(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Y(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===en&&this.id.client!==this.parent.client&&this.parent.clock>=Y(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=ma(t,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=bt(t,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Lt||this.right&&this.right.constructor===Lt)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===H?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===H&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===en){const o=nn(n,this.parent);o.constructor===Lt?this.parent=null:this.parent=o.content.type}return null}integrate(t,n){if(n>0&&(this.id.clock+=n,this.left=ma(t,t.doc.store,T(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let o=this.left,r;if(o!==null)r=o.right;else if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start;const s=new Set,i=new Set;for(;r!==null&&r!==this.right;){if(i.add(r),s.add(r),Xe(this.origin,r.origin)){if(r.id.client<this.id.client)o=r,s.clear();else if(Xe(this.rightOrigin,r.rightOrigin))break}else if(r.origin!==null&&i.has(nn(t.doc.store,r.origin)))s.has(nn(t.doc.store,r.origin))||(o=r,s.clear());else break;r=r.right}this.left=o}if(this.left!==null){const o=this.left.right;this.right=o,this.left.right=this}else{let o;if(this.parentSub!==null)for(o=this.parent._map.get(this.parentSub)||null;o!==null&&o.left!==null;)o=o.left;else o=this.parent._start,this.parent._start=this;this.right=o}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(t)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Ed(t.doc.store,this),this.content.integrate(t,this),ba(t,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(t)}else new Lt(this.id,this.length).integrate(t,0)}get next(){let t=this.right;for(;t!==null&&t.deleted;)t=t.right;return t}get prev(){let t=this.left;for(;t!==null&&t.deleted;)t=t.left;return t}get lastId(){return this.length===1?this.id:T(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Xe(t.origin,this.lastId)&&this.right===t&&Xe(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&this.redone===null&&t.redone===null&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const n=this.parent._searchMarker;return n&&n.forEach(o=>{o.p===t&&(o.p=this,!this.deleted&&this.countable&&(o.index-=this.length))}),t.keep&&(this.keep=!0),this.right=t.right,this.right!==null&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),zn(t.deleteSet,this.id.client,this.id.clock,this.length),ba(t,n,this.parentSub),this.content.delete(t)}}gc(t,n){if(!this.deleted)throw St();this.content.gc(t),n?Gb(t,this,new Lt(this.id,this.length)):this.content=new Jn(this.length)}write(t,n){const o=n>0?T(this.id.client,this.id.clock+n-1):this.origin,r=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&Ur|(o===null?0:ht)|(r===null?0:ie)|(s===null?0:Vn);if(t.writeInfo(i),o!==null&&t.writeLeftID(o),r!==null&&t.writeRightID(r),o===null&&r===null){const l=this.parent;if(l._item!==void 0){const a=l._item;if(a===null){const c=jn(l);t.writeParentInfo(!0),t.writeString(c)}else t.writeParentInfo(!1),t.writeLeftID(a.id)}else l.constructor===String?(t.writeParentInfo(!0),t.writeString(l)):l.constructor===en?(t.writeParentInfo(!1),t.writeLeftID(l)):St();s!==null&&t.writeString(s)}this.content.write(t,n)}}const Kd=(e,t)=>zw[t&Ur](e),zw=[()=>{St()},Aw,Lw,xw,Ow,Tw,_w,Fw,Pw,Mw,()=>{St()}],jw=10;class It extends sl{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor!==t.constructor?!1:(this.length+=t.length,!0)}integrate(t,n){St()}write(t,n){t.writeInfo(jw),D(t.restEncoder,this.length-n)}getMissing(t,n){return null}}const qd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},Jd="__ $YJS$ __";qd[Jd]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");qd[Jd]=!0;const Ww=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else n!==void 0&&n()}},Gw=/[\uD800-\uDBFF]/,Kw=/[\uDC00-\uDFFF]/,qw=(e,t)=>{let n=0,o=0;for(;n<e.length&&n<t.length&&e[n]===t[n];)n++;for(n>0&&Gw.test(e[n-1])&&n--;o+n<e.length&&o+n<t.length&&e[e.length-o-1]===t[t.length-o-1];)o++;return o>0&&Kw.test(e[e.length-o])&&o--,{index:n,remove:e.length-n-o,insert:t.slice(n,t.length-o)}},Jw=qw,N=new R("y-sync"),jt=new R("y-undo"),xn=new R("yjs-cursor"),Wt=(e,t)=>e>>>t|e<<32-t,Yw=e=>Wt(e,2)^Wt(e,13)^Wt(e,22),Xw=e=>Wt(e,6)^Wt(e,11)^Wt(e,25),Qw=e=>Wt(e,7)^Wt(e,18)^e>>>3,Zw=e=>Wt(e,17)^Wt(e,19)^e>>>10,tk=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ek=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);class nk{constructor(){const t=new ArrayBuffer(320);this._H=new Uint32Array(t,0,8),this._H.set(ek),this._W=new Uint32Array(t,64,64)}_updateHash(){const t=this._H,n=this._W;for(let u=16;u<64;u++)n[u]=Zw(n[u-2])+n[u-7]+Qw(n[u-15])+n[u-16];let o=t[0],r=t[1],s=t[2],i=t[3],l=t[4],a=t[5],c=t[6],d=t[7];for(let u=0,h,f;u<64;u++)h=d+Xw(l)+(l&a^~l&c)+tk[u]+n[u]>>>0,f=Yw(o)+(o&r^o&s^r&s)>>>0,d=c,c=a,a=l,l=i+h>>>0,i=s,s=r,r=o,o=h+f>>>0;t[0]+=o,t[1]+=r,t[2]+=s,t[3]+=i,t[4]+=l,t[5]+=a,t[6]+=c,t[7]+=d}digest(t){let n=0;for(;n+56<=t.length;){let i=0;for(;i<16&&n+3<t.length;i++)this._W[i]=t[n++]<<24|t[n++]<<16|t[n++]<<8|t[n++];if(n%64!==0){for(this._W.fill(0,i,16);n<t.length;)this._W[i]|=t[n]<<(3-n%4)*8,n++;this._W[i]|=ht<<(3-n%4)*8}this._updateHash()}const o=n%64!==0;this._W.fill(0,0,16);let r=0;for(;n<t.length;r++)for(let i=3;i>=0&&n<t.length;i--)this._W[r]|=t[n++]<<i*8;o||(this._W[r-(n%4===0?0:1)]|=ht<<(3-n%4)*8),this._W[14]=t.byteLength/dg,this._W[15]=t.byteLength*8,this._updateHash();const s=new Uint8Array(32);for(let i=0;i<this._H.length;i++)for(let l=0;l<4;l++)s[i*4+l]=this._H[i]>>>(3-l)*8;return s}}const ok=e=>new nk().digest(e),rk=e=>{for(let n=6;n<e.length;n++)e[n%6]=e[n%6]^e[n];return e.slice(0,6)},sk=e=>db(rk(ok(hb(e)))),Tr=(e,t)=>t===void 0?!e.deleted:t.sv.has(e.id.client)&&t.sv.get(e.id.client)>e.id.clock&&!gn(t.ds,e.id),ik=[{light:"#ecd44433",dark:"#ecd444"}],lk=(e,t,n)=>{if(!e.has(n)){if(e.size<t.length){const o=Ve();e.forEach(r=>o.add(r)),t=t.filter(r=>!o.has(r))}e.set(n,zg(t))}return e.get(n)},ak=(e,{colors:t=ik,colorMapping:n=new Map,permanentUserData:o=null,onFirstRender:r=()=>{},mapping:s}={})=>{let i=!1;const l=new dk(e,s),a=new O({props:{editable:c=>{const d=N.getState(c);return d.snapshot==null&&d.prevSnapshot==null}},key:N,state:{init:(c,d)=>({type:e,doc:e.doc,binding:l,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,isUndoRedoOperation:!1,addToHistory:!0,colors:t,colorMapping:n,permanentUserData:o}),apply:(c,d)=>{const u=c.getMeta(N);if(u!==void 0){d=Object.assign({},d);for(const h in u)d[h]=u[h]}return d.addToHistory=c.getMeta("addToHistory")!==!1,d.isChangeOrigin=u!==void 0&&!!u.isChangeOrigin,d.isUndoRedoOperation=u!==void 0&&!!u.isChangeOrigin&&!!u.isUndoRedoOperation,l.prosemirrorView!==null&&u!==void 0&&(u.snapshot!=null||u.prevSnapshot!=null)&&Gi(0,()=>{l.prosemirrorView!=null&&(u.restore==null?l._renderSnapshot(u.snapshot,u.prevSnapshot,d):(l._renderSnapshot(u.snapshot,u.snapshot,d),delete d.restore,delete d.snapshot,delete d.prevSnapshot,l.mux(()=>{l._prosemirrorChanged(l.prosemirrorView.state.doc)})))}),d}},view:c=>(l.initView(c),s==null&&l._forceRerender(),r(),{update:()=>{const d=a.getState(c.state);if(d.snapshot==null&&d.prevSnapshot==null&&(i||c.state.doc.content.findDiffStart(c.state.doc.type.createAndFill().content)!==null)){if(i=!0,d.addToHistory===!1&&!d.isChangeOrigin){const u=jt.getState(c.state),h=u&&u.undoManager;h&&h.stopCapturing()}l.mux(()=>{d.doc.transact(u=>{u.meta.set("addToHistory",d.addToHistory),l._prosemirrorChanged(c.state.doc)},N)})}},destroy:()=>{l.destroy()}})});return a},ck=(e,t,n)=>{if(t!==null&&t.anchor!==null&&t.head!==null)if(t.type==="all")e.setSelection(new nc(e.doc));else if(t.type==="node"){const o=Re(n.doc,n.type,t.anchor,n.mapping);e.setSelection(xt.create(e.doc,o))}else{const o=Re(n.doc,n.type,t.anchor,n.mapping),r=Re(n.doc,n.type,t.head,n.mapping);o!==null&&r!==null&&e.setSelection(B.between(e.doc.resolve(o),e.doc.resolve(r)))}},_r=(e,t)=>({type:t.selection.jsonID,anchor:Xn(t.selection.anchor,e.type,e.mapping),head:Xn(t.selection.head,e.type,e.mapping)});class dk{constructor(t,n=new Map){this.type=t,this.prosemirrorView=null,this.mux=Ww(),this.mapping=n,this.isOMark=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=t.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{this.beforeTransactionSelection===null&&this.prosemirrorView!=null&&(this.beforeTransactionSelection=_r(this,this.prosemirrorView.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return this.prosemirrorView.hasFocus()?(id&&this._domSelectionInView===null&&(Gi(0,()=>{this._domSelectionInView=null}),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView):!1}_isDomSelectionInView(){const t=this.prosemirrorView._root.getSelection();if(t==null||t.anchorNode==null)return!1;const n=this.prosemirrorView._root.createRange();n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.getClientRects().length===0&&n.startContainer&&n.collapsed&&n.selectNodeContents(n.startContainer);const r=n.getBoundingClientRect(),s=pb.documentElement;return r.bottom>=0&&r.right>=0&&r.left<=(window.innerWidth||s.clientWidth||0)&&r.top<=(window.innerHeight||s.clientHeight||0)}renderSnapshot(t,n){n||(n=Cd(md(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(N,{snapshot:t,prevSnapshot:n}))}unrenderSnapshot(){this.mapping.clear(),this.mux(()=>{const t=this.type.toArray().map(o=>Uo(o,this.prosemirrorView.state.schema,this)).filter(o=>o!==null),n=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new K(I.from(t),0,0));n.setMeta(N,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(n)})}_forceRerender(){this.mapping.clear(),this.mux(()=>{const t=this.beforeTransactionSelection!==null?null:this.prosemirrorView.state.selection,n=this.type.toArray().map(r=>Uo(r,this.prosemirrorView.state.schema,this)).filter(r=>r!==null),o=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new K(I.from(n),0,0));if(t){const r=se(Nt(t.anchor,0),o.doc.content.size),s=se(Nt(t.head,0),o.doc.content.size);o.setSelection(B.create(o.doc,r,s))}this.prosemirrorView.dispatch(o.setMeta(N,{isChangeOrigin:!0,binding:this}))})}_renderSnapshot(t,n,o){let r=this.doc,s=this.type;if(t||(t=Cs(this.doc)),t instanceof Uint8Array||n instanceof Uint8Array)if((!(t instanceof Uint8Array)||!(n instanceof Uint8Array))&&St(),r=new Ee({gc:!1}),vr(r,n),n=Cs(r),vr(r,t),t=Cs(r),s._item===null){const i=Array.from(this.doc.share.keys()).find(l=>this.doc.share.get(l)===this.type);s=r.getXmlFragment(i)}else{const i=r.store.clients.get(s._item.id.client)??[],l=Ot(i,s._item.id.clock);s=i[l].content.type}this.mapping.clear(),this.mux(()=>{r.transact(i=>{const l=o.permanentUserData;l&&l.dss.forEach(u=>{ke(i,u,h=>{})});const a=(u,h)=>{const f=u==="added"?l.getUserByClientId(h.client):l.getUserByDeletedId(h);return{user:f,type:u,color:lk(o.colorMapping,o.colors,f)}},c=Od(s,new Qi(n.ds,t.sv)).map(u=>!u._item.deleted||Tr(u._item,t)||Tr(u._item,n)?Uo(u,this.prosemirrorView.state.schema,{mapping:new Map,isOMark:new Map},t,n,a):null).filter(u=>u!==null),d=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new K(I.from(c),0,0));this.prosemirrorView.dispatch(d.setMeta(N,{isChangeOrigin:!0}))},N)})}_typeChanged(t,n){if(this.prosemirrorView==null)return;const o=N.getState(this.prosemirrorView.state);if(t.length===0||o.snapshot!=null||o.prevSnapshot!=null){this.renderSnapshot(o.snapshot,o.prevSnapshot);return}this.mux(()=>{const r=(l,a)=>this.mapping.delete(a);ke(n,n.deleteSet,l=>{if(l.constructor===H){const a=l.content.type;a&&this.mapping.delete(a)}}),n.changed.forEach(r),n.changedParentTypes.forEach(r);const s=this.type.toArray().map(l=>Yd(l,this.prosemirrorView.state.schema,this)).filter(l=>l!==null);let i=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new K(I.from(s),0,0));ck(i,this.beforeTransactionSelection,this),i=i.setMeta(N,{isChangeOrigin:!0,isUndoRedoOperation:n.origin instanceof Md}),this.beforeTransactionSelection!==null&&this._isLocalCursorInView()&&i.scrollIntoView(),this.prosemirrorView.dispatch(i)})}_prosemirrorChanged(t){this.doc.transact(()=>{si(this.doc,this.type,t,this),this.beforeTransactionSelection=_r(this,this.prosemirrorView.state)},N)}initView(t){this.prosemirrorView!=null&&this.destroy(),this.prosemirrorView=t,this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),this.type.observeDeep(this._observeFunction)}destroy(){this.prosemirrorView!=null&&(this.prosemirrorView=null,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions))}}const Yd=(e,t,n,o,r,s)=>{const i=n.mapping.get(e);if(i===void 0){if(e instanceof ut)return Uo(e,t,n,o,r,s);throw Rt()}return i},Uo=(e,t,n,o,r,s)=>{const i=[],l=a=>{var c,d;if(a instanceof ut){const u=Yd(a,t,n,o,r,s);u!==null&&i.push(u)}else{const u=(d=(c=a._item.right)==null?void 0:c.content)==null?void 0:d.type;u instanceof ye&&!u._item.deleted&&u._item.id.client===u.doc.clientID&&(a.applyDelta([{retain:a.length},...u.toDelta()]),u.doc.transact(f=>{u._item.delete(f)}));const h=uk(a,t,n,o,r,s);h!==null&&h.forEach(f=>{f!==null&&i.push(f)})}};o===void 0||r===void 0?e.toArray().forEach(l):Od(e,new Qi(r.ds,o.sv)).forEach(l);try{const a=e.getAttributes(o);o!==void 0&&(Tr(e._item,o)?Tr(e._item,r)||(a.ychange=s?s("added",e._item.id):{type:"added"}):a.ychange=s?s("removed",e._item.id):{type:"removed"});const c=t.node(e.nodeName,a,i);return n.mapping.set(e,c),c}catch{return e.doc.transact(c=>{e._item.delete(c)},N),n.mapping.delete(e),null}},uk=(e,t,n,o,r,s)=>{const i=[],l=e.toDelta(o,r,s);try{for(let a=0;a<l.length;a++){const c=l[a];i.push(t.text(c.insert,bk(c.attributes,t)))}}catch{return e.doc.transact(c=>{e._item.delete(c)},N),null}return i},hk=(e,t)=>{const n=new vt,o=e.map(r=>({insert:r.text,attributes:Zd(r.marks,t)}));return n.applyDelta(o),t.mapping.set(n,e),n},fk=(e,t)=>{const n=new ut(e.type.name);for(const o in e.attrs){const r=e.attrs[o];r!==null&&o!=="ychange"&&n.setAttribute(o,r)}return n.insert(0,Gr(e).map(o=>ri(o,t))),t.mapping.set(n,e),n},ri=(e,t)=>e instanceof Array?hk(e,t):fk(e,t),xa=e=>typeof e=="object"&&e!==null,ll=(e,t)=>{const n=Object.keys(e).filter(r=>e[r]!==null);let o=n.length===(t==null?0:Object.keys(t).filter(r=>t[r]!==null).length);for(let r=0;r<n.length&&o;r++){const s=n[r],i=e[s],l=t[s];o=s==="ychange"||i===l||xa(i)&&xa(l)&&ll(i,l)}return o},Gr=e=>{const t=e.content.content,n=[];for(let o=0;o<t.length;o++){const r=t[o];if(r.isText){const s=[];for(let i=t[o];o<t.length&&i.isText;i=t[++o])s.push(i);o--,n.push(s)}else n.push(r)}return n},Xd=(e,t)=>{const n=e.toDelta();return n.length===t.length&&n.every((o,r)=>o.insert===t[r].text&&nd(o.attributes||{}).length===t[r].marks.length&&od(o.attributes,(s,i)=>{var c;const l=Qd(i),a=t[r].marks;return ll(s,(c=a.find(d=>d.type.name===l))==null?void 0:c.attrs)}))},Yn=(e,t)=>{if(e instanceof ut&&!(t instanceof Array)&&ii(e,t)){const n=Gr(t);return e._length===n.length&&ll(e.getAttributes(),t.attrs)&&e.toArray().every((o,r)=>Yn(o,n[r]))}return e instanceof vt&&t instanceof Array&&Xd(e,t)},Lr=(e,t)=>e===t||e instanceof Array&&t instanceof Array&&e.length===t.length&&e.every((n,o)=>t[o]===n),Aa=(e,t,n)=>{const o=e.toArray(),r=Gr(t),s=r.length,i=o.length,l=se(i,s);let a=0,c=0,d=!1;for(;a<l;a++){const u=o[a],h=r[a];if(Lr(n.mapping.get(u),h))d=!0;else if(!Yn(u,h))break}for(;a+c<l;c++){const u=o[i-c-1],h=r[s-c-1];if(Lr(n.mapping.get(u),h))d=!0;else if(!Yn(u,h))break}return{equalityFactor:a+c,foundMappedChild:d}},pk=e=>{let t="",n=e._start;const o={};for(;n!==null;)n.deleted||(n.countable&&n.content instanceof Ht?t+=n.content.str:n.content instanceof Q&&(o[n.content.key]=null)),n=n.right;return{str:t,nAttrs:o}},mk=(e,t,n)=>{n.mapping.set(e,t);const{nAttrs:o,str:r}=pk(e),s=t.map(c=>({insert:c.text,attributes:Object.assign({},o,Zd(c.marks,n))})),{insert:i,remove:l,index:a}=Jw(r,s.map(c=>c.insert).join(""));e.delete(a,l),e.insert(a,i),e.applyDelta(s.map(c=>({retain:c.insert.length,attributes:c.attributes})))},gk=/(.*)(--[a-zA-Z0-9+/=]{8})$/,Qd=e=>{var t;return((t=gk.exec(e))==null?void 0:t[1])??e},bk=(e,t)=>{const n=[];for(const o in e)n.push(t.mark(Qd(o),e[o]));return n},Zd=(e,t)=>{const n={};return e.forEach(o=>{if(o.type.name!=="ychange"){const r=Xt(t.isOMark,o.type,()=>!o.type.excludes(o.type));n[r?`${o.type.name}--${sk(o.toJSON())}`:o.type.name]=o.attrs}}),n},si=(e,t,n,o)=>{if(t instanceof ut&&t.nodeName!==n.type.name)throw new Error("node name mismatch!");if(o.mapping.set(t,n),t instanceof ut){const u=t.getAttributes(),h=n.attrs;for(const f in h)h[f]!==null?u[f]!==h[f]&&f!=="ychange"&&t.setAttribute(f,h[f]):t.removeAttribute(f);for(const f in u)h[f]===void 0&&t.removeAttribute(f)}const r=Gr(n),s=r.length,i=t.toArray(),l=i.length,a=se(s,l);let c=0,d=0;for(;c<a;c++){const u=i[c],h=r[c];if(!Lr(o.mapping.get(u),h))if(Yn(u,h))o.mapping.set(u,h);else break}for(;d+c+1<a;d++){const u=i[l-d-1],h=r[s-d-1];if(!Lr(o.mapping.get(u),h))if(Yn(u,h))o.mapping.set(u,h);else break}e.transact(()=>{for(;l-c-d>0&&s-c-d>0;){const h=i[c],f=r[c],p=i[l-d-1],m=r[s-d-1];if(h instanceof vt&&f instanceof Array)Xd(h,f)||mk(h,f,o),c+=1;else{let g=h instanceof ut&&ii(h,f),b=p instanceof ut&&ii(p,m);if(g&&b){const k=Aa(h,f,o),v=Aa(p,m,o);k.foundMappedChild&&!v.foundMappedChild?b=!1:!k.foundMappedChild&&v.foundMappedChild||k.equalityFactor<v.equalityFactor?g=!1:b=!1}g?(si(e,h,f,o),c+=1):b?(si(e,p,m,o),d+=1):(o.mapping.delete(t.get(c)),t.delete(c,1),t.insert(c,[ri(f,o)]),c+=1)}}const u=l-c-d;if(l===1&&s===0&&i[0]instanceof vt?(o.mapping.delete(i[0]),i[0].delete(0,i[0].length)):u>0&&(t.slice(c,c+u).forEach(h=>o.mapping.delete(h)),t.delete(c,u)),c+d<s){const h=[];for(let f=c;f<s-d;f++)h.push(ri(r[f],o));t.insert(c,h)}},N)},ii=(e,t)=>!(t instanceof Array)&&e.nodeName===t.type.name;let Dn=null;const wk=()=>{const e=Dn;Dn=null,e.forEach((t,n)=>{const o=n.state.tr,r=N.getState(n.state);r&&r.binding&&!r.binding.isDestroyed&&(t.forEach((s,i)=>{o.setMeta(i,s)}),n.dispatch(o))})},kk=(e,t,n)=>{Dn||(Dn=new Map,Gi(0,wk)),Xt(Dn,e,Pt).set(t,n)},Xn=(e,t,n)=>{if(e===0)return vs(t,0,-1);let o=t._first===null?null:t._first.content.type;for(;o!==null&&t!==o;){if(o instanceof vt){if(o._length>=e)return vs(o,e,-1);if(e-=o._length,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{do o=o._item===null?null:o._item.parent,e--;while(o!==t&&o!==null&&o._item!==null&&o._item.next===null);o!==null&&o!==t&&(o=o._item===null?null:o._item.next.content.type)}}else{const r=(n.get(o)||{nodeSize:0}).nodeSize;if(o._first!==null&&e<r)o=o._first.content.type,e--;else{if(e===1&&o._length===0&&r>1)return new Gn(o._item===null?null:o._item.id,o._item===null?jn(o):null,null);if(e-=r,o._item!==null&&o._item.next!==null)o=o._item.next.content.type;else{if(e===0)return o=o._item===null?o:o._item.parent,new Gn(o._item===null?null:o._item.id,o._item===null?jn(o):null,null);do o=o._item.parent,e--;while(o!==t&&o._item.next===null);o!==t&&(o=o._item.next.content.type)}}}if(o===null)throw St();if(e===0&&o.constructor!==vt&&o!==t)return yk(o._item.parent,o._item)}return vs(t,t._length,-1)},yk=(e,t)=>{let n=null,o=null;return e._item===null?o=jn(e):n=T(e._item.id.client,e._item.id.clock),new Gn(n,o,t.id)},Re=(e,t,n,o)=>{const r=jb(n,e);if(r===null||r.type!==t&&!Wn(t,r.type._item))return null;let s=r.type,i=0;if(s.constructor===vt)i=r.index;else if(s._item===null||!s._item.deleted){let l=s._first,a=0;for(;a<s._length&&a<r.index&&l!==null;){if(!l.deleted){const c=l.content.type;a++,c instanceof vt?i+=c._length:i+=o.get(c).nodeSize}l=l.right}i+=1}for(;s!==t&&s._item!==null;){const l=s._item.parent;if(l._item===null||!l._item.deleted){i+=1;let a=l._first;for(;a!==null;){const c=a.content.type;if(c===s)break;a.deleted||(c instanceof vt?i+=c._length:i+=o.get(c).nodeSize),a=a.right}}s=l}return i-1},vk=(e,t,n)=>e!==t,Ck=e=>{const t=document.createElement("span");t.classList.add("ProseMirror-yjs-cursor"),t.setAttribute("style",`border-color: ${e.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${e.color}`),n.insertBefore(document.createTextNode(e.name),null);const o=document.createTextNode("⁠"),r=document.createTextNode("⁠");return t.insertBefore(o,null),t.insertBefore(n,null),t.insertBefore(r,null),t},tu=e=>({style:`background-color: ${e.color}70`,class:"ProseMirror-yjs-selection"}),Sk=/^#[0-9a-fA-F]{6}$/,Ma=(e,t,n,o,r)=>{const s=N.getState(e),i=s.doc,l=[];return s.snapshot!=null||s.prevSnapshot!=null||s.binding.mapping.size===0?tt.create(e.doc,[]):(t.getStates().forEach((a,c)=>{if(n(i.clientID,c,a)&&a.cursor!=null){const d=a.user||{};d.color==null?d.color="#ffa500":Sk.test(d.color)||console.warn("A user uses an unsupported color format",d),d.name==null&&(d.name=`User: ${c}`);let u=Re(i,s.type,Bn(a.cursor.anchor),s.binding.mapping),h=Re(i,s.type,Bn(a.cursor.head),s.binding.mapping);if(u!==null&&h!==null){const f=Nt(e.doc.content.size-1,0);u=se(u,f),h=se(h,f),l.push(it.widget(h,()=>o(d,c),{key:c+"",side:10}));const p=se(u,h),m=Nt(u,h);l.push(it.inline(p,m,r(d,c),{inclusiveEnd:!0,inclusiveStart:!1}))}}}),tt.create(e.doc,l))},Ek=(e,{awarenessStateFilter:t=vk,cursorBuilder:n=Ck,selectionBuilder:o=tu,getSelection:r=i=>i.selection}={},s="cursor")=>new O({key:xn,state:{init(i,l){return Ma(l,e,t,n,o)},apply(i,l,a,c){const d=N.getState(c),u=i.getMeta(xn);return d&&d.isChangeOrigin||u&&u.awarenessUpdated?Ma(c,e,t,n,o):l.map(i.mapping,i.doc)}},props:{decorations:i=>xn.getState(i)},view:i=>{const l=()=>{i.docView&&kk(i,xn,{awarenessUpdated:!0})},a=()=>{const c=N.getState(i.state),d=e.getLocalState()||{};if(i.hasFocus()){const u=r(i.state),h=Xn(u.anchor,c.type,c.binding.mapping),f=Xn(u.head,c.type,c.binding.mapping);(d.cursor==null||!pa(Bn(d.cursor.anchor),h)||!pa(Bn(d.cursor.head),f))&&e.setLocalStateField(s,{anchor:h,head:f})}else d.cursor!=null&&Re(c.doc,c.type,Bn(d.cursor.anchor),c.binding.mapping)!==null&&e.setLocalStateField(s,null)};return e.on("change",l),i.dom.addEventListener("focusin",a),i.dom.addEventListener("focusout",a),{update:a,destroy:()=>{i.dom.removeEventListener("focusin",a),i.dom.removeEventListener("focusout",a),e.off("change",l),e.setLocalStateField(s,null)}}}}),xk=e=>{var t,n;return((n=(t=jt.getState(e))==null?void 0:t.undoManager)==null?void 0:n.undo())!=null},Ak=e=>{var t,n;return((n=(t=jt.getState(e))==null?void 0:t.undoManager)==null?void 0:n.redo())!=null},Mk=(e,t)=>{var n,o;return t==null?(o=(n=jt.getState(e))==null?void 0:n.undoManager)==null?void 0:o.canUndo():xk(e)},Tk=(e,t)=>{var n,o;return t==null?(o=(n=jt.getState(e))==null?void 0:n.undoManager)==null?void 0:o.canRedo():Ak(e)},_k=new Set(["paragraph"]),Lk=(e,t)=>!(e instanceof H)||!(e.content instanceof Vt)||!(e.content.type instanceof ye||e.content.type instanceof ut&&t.has(e.content.type.nodeName))||e.content.type._length===0,Ik=({protectedNodes:e=_k,trackedOrigins:t=[],undoManager:n=null}={})=>new O({key:jt,state:{init:(o,r)=>{const s=N.getState(r),i=n||new Md(s.type,{trackedOrigins:new Set([N].concat(t)),deleteFilter:l=>Lk(l,e),captureTransaction:l=>l.meta.get("addToHistory")!==!1});return{undoManager:i,prevSel:null,hasUndoOps:i.undoStack.length>0,hasRedoOps:i.redoStack.length>0}},apply:(o,r,s,i)=>{const l=N.getState(i).binding,a=r.undoManager,c=a.undoStack.length>0,d=a.redoStack.length>0;return l?{undoManager:a,prevSel:_r(l,s),hasUndoOps:c,hasRedoOps:d}:c!==r.hasUndoOps||d!==r.hasRedoOps?Object.assign({},r,{hasUndoOps:a.undoStack.length>0,hasRedoOps:a.redoStack.length>0}):r}},view:o=>{const r=N.getState(o.state),s=jt.getState(o.state).undoManager;return s.on("stack-item-added",({stackItem:i})=>{const l=r.binding;l&&i.meta.set(l,jt.getState(o.state).prevSel)}),s.on("stack-item-popped",({stackItem:i})=>{const l=r.binding;l&&(l.beforeTransactionSelection=i.meta.get(l)||l.beforeTransactionSelection)}),{destroy:()=>{s.destroy()}}}});function Pk(e={}){return new O({view(t){return new Ok(t,e)}})}class Ok{constructor(t,n){var o;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(o=n.width)!==null&&o!==void 0?o:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let s=i=>{this[r](i)};return t.dom.addEventListener(r,s),{name:r,handler:s}})}destroy(){this.handlers.forEach(({name:t,handler:n})=>this.editorView.dom.removeEventListener(t,n))}update(t,n){this.cursorPos!=null&&n.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,o;if(n){let l=t.nodeBefore,a=t.nodeAfter;if(l||a){let c=this.editorView.nodeDOM(this.cursorPos-(l?l.nodeSize:0));if(c){let d=c.getBoundingClientRect(),u=l?d.bottom:d.top;l&&a&&(u=(u+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),o={left:d.left,right:d.right,top:u-this.width/2,bottom:u+this.width/2}}}}if(!o){let l=this.editorView.coordsAtPos(this.cursorPos);o={left:l.left-this.width/2,right:l.left+this.width/2,top:l.top,bottom:l.bottom}}let r=this.editorView.dom.offsetParent;this.element||(this.element=r.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let s,i;if(!r||r==document.body&&getComputedStyle(r).position=="static")s=-pageXOffset,i=-pageYOffset;else{let l=r.getBoundingClientRect();s=l.left-r.scrollLeft,i=l.top-r.scrollTop}this.element.style.left=o.left-s+"px",this.element.style.top=o.top-i+"px",this.element.style.width=o.right-o.left+"px",this.element.style.height=o.bottom-o.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),o=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),r=o&&o.type.spec.disableDropCursor,s=typeof r=="function"?r(this.editorView,n,t):r;if(n&&!s){let i=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let l=yh(this.editorView.state.doc,i,this.editorView.dragging.slice);l!=null&&(i=l)}this.setCursor(i),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){(t.target==this.editorView.dom||!this.editorView.dom.contains(t.relatedTarget))&&this.setCursor(null)}}const Bk={slash_menu:{heading:{title:"Heading 1",subtext:"Top-level heading",aliases:["h","heading1","h1"],group:"Headings"},heading_2:{title:"Heading 2",subtext:"Key section heading",aliases:["h2","heading2","subheading"],group:"Headings"},heading_3:{title:"Heading 3",subtext:"Subsection and group heading",aliases:["h3","heading3","subheading"],group:"Headings"},quote:{title:"Quote",subtext:"Quote or excerpt",aliases:["quotation","blockquote","bq"],group:"Basic blocks"},numbered_list:{title:"Numbered List",subtext:"List with ordered items",aliases:["ol","li","list","numberedlist","numbered list"],group:"Basic blocks"},bullet_list:{title:"Bullet List",subtext:"List with unordered items",aliases:["ul","li","list","bulletlist","bullet list"],group:"Basic blocks"},check_list:{title:"Check List",subtext:"List with checkboxes",aliases:["ul","li","list","checklist","check list","checked list","checkbox"],group:"Basic blocks"},paragraph:{title:"Paragraph",subtext:"The body of your document",aliases:["p","paragraph"],group:"Basic blocks"},code_block:{title:"Code Block",subtext:"Code block with syntax highlighting",aliases:["code","pre"],group:"Basic blocks"},page_break:{title:"Page Break",subtext:"Page separator",aliases:["page","break","separator"],group:"Basic blocks"},table:{title:"Table",subtext:"Table with editable cells",aliases:["table"],group:"Advanced"},image:{title:"Image",subtext:"Resizable image with caption",aliases:["image","imageUpload","upload","img","picture","media","url"],group:"Media"},video:{title:"Video",subtext:"Resizable video with caption",aliases:["video","videoUpload","upload","mp4","film","media","url"],group:"Media"},audio:{title:"Audio",subtext:"Embedded audio with caption",aliases:["audio","audioUpload","upload","mp3","sound","media","url"],group:"Media"},file:{title:"File",subtext:"Embedded file",aliases:["file","upload","embed","media","url"],group:"Media"},emoji:{title:"Emoji",subtext:"Search for and insert an emoji",aliases:["emoji","emote","emotion","face"],group:"Others"}},placeholders:{default:"Enter text or type '/' for commands",heading:"Heading",bulletListItem:"List",numberedListItem:"List",checkListItem:"List",emptyDocument:void 0,new_comment:"Write a comment...",edit_comment:"Edit comment...",comment_reply:"Add comment..."},file_blocks:{image:{add_button_text:"Add image"},video:{add_button_text:"Add video"},audio:{add_button_text:"Add audio"},file:{add_button_text:"Add file"}},side_menu:{add_block_label:"Add block",drag_handle_label:"Open block menu"},drag_handle:{delete_menuitem:"Delete",colors_menuitem:"Colors",header_row_menuitem:"Header row",header_column_menuitem:"Header column"},table_handle:{delete_column_menuitem:"Delete column",delete_row_menuitem:"Delete row",add_left_menuitem:"Add column left",add_right_menuitem:"Add column right",add_above_menuitem:"Add row above",add_below_menuitem:"Add row below",split_cell_menuitem:"Split cell",merge_cells_menuitem:"Merge cells",background_color_menuitem:"Background color"},suggestion_menu:{no_items_title:"No items found"},color_picker:{text_title:"Text",background_title:"Background",colors:{default:"Default",gray:"Gray",brown:"Brown",red:"Red",orange:"Orange",yellow:"Yellow",green:"Green",blue:"Blue",purple:"Purple",pink:"Pink"}},formatting_toolbar:{bold:{tooltip:"Bold",secondary_tooltip:"Mod+B"},italic:{tooltip:"Italic",secondary_tooltip:"Mod+I"},underline:{tooltip:"Underline",secondary_tooltip:"Mod+U"},strike:{tooltip:"Strike",secondary_tooltip:"Mod+Shift+S"},code:{tooltip:"Code",secondary_tooltip:""},colors:{tooltip:"Colors"},link:{tooltip:"Create link",secondary_tooltip:"Mod+K"},file_caption:{tooltip:"Edit caption",input_placeholder:"Edit caption"},file_replace:{tooltip:{image:"Replace image",video:"Replace video",audio:"Replace audio",file:"Replace file"}},file_rename:{tooltip:{image:"Rename image",video:"Rename video",audio:"Rename audio",file:"Rename file"},input_placeholder:{image:"Rename image",video:"Rename video",audio:"Rename audio",file:"Rename file"}},file_download:{tooltip:{image:"Download image",video:"Download video",audio:"Download audio",file:"Download file"}},file_delete:{tooltip:{image:"Delete image",video:"Delete video",audio:"Delete audio",file:"Delete file"}},file_preview_toggle:{tooltip:"Toggle preview"},nest:{tooltip:"Nest block",secondary_tooltip:"Tab"},unnest:{tooltip:"Unnest block",secondary_tooltip:"Shift+Tab"},align_left:{tooltip:"Align text left"},align_center:{tooltip:"Align text center"},align_right:{tooltip:"Align text right"},align_justify:{tooltip:"Justify text"},table_cell_merge:{tooltip:"Merge cells"},comment:{tooltip:"Add comment"}},file_panel:{upload:{title:"Upload",file_placeholder:{image:"Upload image",video:"Upload video",audio:"Upload audio",file:"Upload file"},upload_error:"Error: Upload failed"},embed:{title:"Embed",embed_button:{image:"Embed image",video:"Embed video",audio:"Embed audio",file:"Embed file"},url_placeholder:"Enter URL"}},link_toolbar:{delete:{tooltip:"Remove link"},edit:{text:"Edit link",tooltip:"Edit"},open:{tooltip:"Open in new tab"},form:{title_placeholder:"Edit title",url_placeholder:"Edit URL"}},comments:{actions:{add_reaction:"Add reaction",resolve:"Resolve",edit_comment:"Edit comment",delete_comment:"Delete comment",more_actions:"More actions"},reactions:{reacted_by:"Reacted by"},sidebar:{marked_as_resolved:"Marked as resolved",more_replies:e=>`${e} more replies`}},generic:{ctrl_shortcut:"Ctrl"}};var Dk=Object.defineProperty,Rk=(e,t,n)=>t in e?Dk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t,n)=>Rk(e,typeof t!="symbol"?t+"":t,n);function Nk(e,t=JSON.stringify){const n={};return e.filter(o=>{const r=t(o);return Object.prototype.hasOwnProperty.call(n,r)?!1:n[r]=!0})}function Hk(e){const t=e.filter((n,o)=>e.indexOf(n)!==o);return Nk(t)}const Kr=$.create({name:"uniqueID",priority:1e4,addOptions(){return{attributeName:"id",types:[],setIdAttribute:!1,generateID:()=>{if(typeof window<"u"&&window.__TEST_OPTIONS){const e=window.__TEST_OPTIONS;return e.mockID===void 0?e.mockID=0:e.mockID++,e.mockID.toString()}return _c()},filterTransaction:null}},addGlobalAttributes(){return[{types:this.options.types,attributes:{[this.options.attributeName]:{default:null,parseHTML:e=>e.getAttribute(`data-${this.options.attributeName}`),renderHTML:e=>{const t={[`data-${this.options.attributeName}`]:e[this.options.attributeName]};return this.options.setIdAttribute?{...t,id:e[this.options.attributeName]}:t}}}}]},addProseMirrorPlugins(){let e=null,t=!1;return[new O({key:new R("uniqueID"),appendTransaction:(n,o,r)=>{const s=n.some(f=>f.docChanged)&&!o.doc.eq(r.doc),i=this.options.filterTransaction&&n.some(f=>{let p,m;return!(!((m=(p=this.options).filterTransaction)===null||m===void 0)&&m.call(p,f))});if(!s||i)return;const{tr:l}=r,{types:a,attributeName:c,generateID:d}=this.options,u=xi(o.doc,n),{mapping:h}=u;if(Ai(u).forEach(({newRange:f})=>{const p=Wo(r.doc,f,b=>a.includes(b.type.name)),m=p.map(({node:b})=>b.attrs[c]).filter(b=>b!==null),g=Hk(m);p.forEach(({node:b,pos:k})=>{let v;const x=(v=l.doc.nodeAt(k))===null||v===void 0?void 0:v.attrs[c];if(x===null){const M=o.doc.type.createAndFill().content;if(o.doc.content.findDiffStart(M)===null){const E=JSON.parse(JSON.stringify(r.doc.toJSON()));if(E.content[0].content[0].attrs.id="initialBlockId",JSON.stringify(E.content)===JSON.stringify(M.toJSON())){l.setNodeMarkup(k,void 0,{...b.attrs,[c]:"initialBlockId"});return}}l.setNodeMarkup(k,void 0,{...b.attrs,[c]:d()});return}const{deleted:C}=h.invert().mapResult(k);C&&g.includes(x)&&l.setNodeMarkup(k,void 0,{...b.attrs,[c]:d()})})}),!!l.steps.length)return l},view(n){const o=r=>{let s;e=!((s=n.dom.parentElement)===null||s===void 0)&&s.contains(r.target)?n.dom.parentElement:null};return window.addEventListener("dragstart",o),{destroy(){window.removeEventListener("dragstart",o)}}},props:{handleDOMEvents:{drop:(n,o)=>{let r;return e!==n.dom.parentElement||((r=o.dataTransfer)===null||r===void 0?void 0:r.effectAllowed)==="copy"?t=!0:t=!1,e=null,!1},paste:()=>(t=!0,!1)},transformPasted:n=>{if(!t)return n;const{types:o,attributeName:r}=this.options,s=i=>{const l=[];return i.forEach(a=>{if(a.isText){l.push(a);return}if(!o.includes(a.type.name)){l.push(a.copy(s(a.content)));return}const c=a.type.create({...a.attrs,[r]:null},s(a.content),a.marks);l.push(c)}),I.from(l)};return t=!1,new K(s(n.content),n.openStart,n.openEnd)}}})]}});function Ta(e){return e.type==="link"}function eu(e){return typeof e!="string"&&e.type==="link"}function We(e){return typeof e!="string"&&e.type==="text"}function li(e){var t,n,o,r,s;return al(e)?{...e}:Qn(e)?{type:"tableCell",content:[].concat(e.content),props:{backgroundColor:((t=e.props)==null?void 0:t.backgroundColor)??"default",textColor:((n=e.props)==null?void 0:n.textColor)??"default",textAlignment:((o=e.props)==null?void 0:o.textAlignment)??"left",colspan:((r=e.props)==null?void 0:r.colspan)??1,rowspan:((s=e.props)==null?void 0:s.rowspan)??1}}:{type:"tableCell",content:[].concat(e),props:{backgroundColor:"default",textColor:"default",textAlignment:"left",colspan:1,rowspan:1}}}function Qn(e){return e!=null&&typeof e!="string"&&!Array.isArray(e)&&e.type==="tableCell"}function al(e){return Qn(e)&&e.props!==void 0&&e.content!==void 0}function Zn(e){return al(e)?e.props.colspan??1:1}function ai(e){return al(e)?e.props.rowspan??1:1}class Gt extends Error{constructor(t){super(`Unreachable case: ${t}`)}}function IC(e,t=!0){const{"data-test":n,...o}=e;if(Object.keys(o).length>0&&t)throw new Error("Object must be empty "+JSON.stringify(e))}const Uk=()=>typeof navigator<"u"&&(/Mac/.test(navigator.platform)||/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent));function ue(e,t="Ctrl"){return Uk()?e.replace("Mod","⌘"):e.replace("Mod",t)}function ve(...e){return e.filter(t=>t).join(" ")}const PC=()=>/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function Kt(e,t,n,o){const r=document.createElement("div");r.className=ve("bn-block-content",n.class),r.setAttribute("data-content-type",e);for(const[i,l]of Object.entries(n))i!=="class"&&r.setAttribute(i,l);const s=document.createElement(t);s.className=ve("bn-inline-content",o.class);for(const[i,l]of Object.entries(o))i!=="class"&&s.setAttribute(i,l);return r.appendChild(s),{dom:r,contentDOM:s}}const _a=(e,t)=>{let n=qe(e,t.pmSchema);n.type.name==="blockContainer"&&(n=n.firstChild);const o=t.pmSchema.nodes[n.type.name].spec.toDOM;if(o===void 0)throw new Error("This block has no default HTML serialization as its corresponding TipTap node doesn't implement `renderHTML`.");const r=o(n);if(typeof r!="object"||!("dom"in r))throw new Error("Cannot use this block's default HTML serialization as its corresponding TipTap node's `renderHTML` function does not return an object with the `dom` property.");return r},X={backgroundColor:{default:"default"},textColor:{default:"default"},textAlignment:{default:"left",values:["left","center","right","justify"]}},nu=["backgroundColor","textColor"];function ci(e){return"data-"+e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function OC(e){const t=e.split("/");return!t.length||t[t.length-1]===""?e:t[t.length-1]}function qr(e){const t={};return Object.entries(e).filter(([n,o])=>!nu.includes(n)).forEach(([n,o])=>{t[n]={default:o.default,keepOnSplit:!0,parseHTML:r=>{const s=r.getAttribute(ci(n));if(s===null)return null;if(o.default===void 0&&o.type==="boolean"||o.default!==void 0&&typeof o.default=="boolean")return s==="true"?!0:s==="false"?!1:null;if(o.default===void 0&&o.type==="number"||o.default!==void 0&&typeof o.default=="number"){const i=parseFloat(s);return!Number.isNaN(i)&&Number.isFinite(i)?i:null}return s},renderHTML:r=>r[n]!==o.default?{[ci(n)]:r[n]}:{}}}),t}function Vk(e,t,n,o){if(typeof e=="boolean")throw new Error("Cannot find node position as getPos is a boolean, not a function.");const r=e(),s=n.state.doc.resolve(r).node().attrs.id;if(!s)throw new Error("Block doesn't have id");const i=t.getBlock(s);if(i.type!==o)throw new Error("Block type does not match");return i}function Ao(e,t,n,o,r=!1,s){const i=document.createElement("div");if(s!==void 0)for(const[l,a]of Object.entries(s))l!=="class"&&i.setAttribute(l,a);i.className=ve("bn-block-content",(s==null?void 0:s.class)||""),i.setAttribute("data-content-type",t);for(const[l,a]of Object.entries(n)){const c=o[l].default;!nu.includes(l)&&a!==c&&i.setAttribute(ci(l),a)}return r&&i.setAttribute("data-file-block",""),i.appendChild(e.dom),e.contentDOM!==void 0&&(e.contentDOM.className=ve("bn-inline-content",e.contentDOM.className)),{...e,dom:i}}function Qt(e){return qt.create(e)}function ou(e,t){return{config:e,implementation:t}}function xe(e,t,n){return ou({type:e.name,content:e.config.content==="inline*"?"inline":e.config.content==="tableRow+"?"table":"none",propSchema:t},{node:e,requiredExtensions:n,toInternalHTML:_a,toExternalHTML:_a})}function ru(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n.config]))}function $k(e,t){e.stopEvent=n=>(n.type==="mousedown"&&setTimeout(()=>{t.view.dom.blur()},10),!0)}function Fk(e,t){const n=[{tag:"[data-content-type="+e.type+"]",contentElement:".bn-inline-content"}];return t&&n.push({tag:"*",getAttrs(o){if(typeof o=="string")return!1;const r=t==null?void 0:t(o);return r===void 0?!1:r}}),n}function io(e,t){const n=Qt({name:e.type,content:e.content==="inline"?"inline*":"",group:"blockContent",selectable:e.isSelectable??!0,isolating:!0,addAttributes(){return qr(e.propSchema)},parseHTML(){return Fk(e,t.parse)},renderHTML({HTMLAttributes:o}){const r=document.createElement("div");return Ao({dom:r,contentDOM:e.content==="inline"?r:void 0},e.type,{},e.propSchema,e.isFileBlock,o)},addNodeView(){return({getPos:o})=>{var r;const s=this.options.editor,i=Vk(o,s,this.editor,e.type),l=((r=this.options.domAttributes)==null?void 0:r.blockContent)||{},a=t.render(i,s),c=Ao(a,i.type,i.props,e.propSchema,l);return e.isSelectable===!1&&$k(c,this.editor),c}}});if(n.name!==e.type)throw new Error("Node name does not match block type. This is a bug in BlockNote.");return ou(e,{node:n,toInternalHTML:(o,r)=>{var s;const i=((s=n.options.domAttributes)==null?void 0:s.blockContent)||{},l=t.render(o,r);return Ao(l,o.type,o.props,e.propSchema,e.isFileBlock,i)},toExternalHTML:(o,r)=>{var s,i;const l=((s=n.options.domAttributes)==null?void 0:s.blockContent)||{};let a=(i=t.toExternalHTML)==null?void 0:i.call(t,o,r);return a===void 0&&(a=t.render(o,r)),Ao(a,o.type,o.props,e.propSchema,l)}})}function ae(e,t){const n=e.resolve(t);if(n.nodeAfter&&n.nodeAfter.type.isInGroup("bnBlock"))return{posBeforeNode:n.pos,node:n.nodeAfter};let o=n.depth,r=n.node(o);for(;o>0;){if(r.type.isInGroup("bnBlock"))return{posBeforeNode:n.before(o),node:r};o--,r=n.node(o)}const s=[];e.descendants((l,a)=>{l.type.isInGroup("bnBlock")&&s.push(a)}),console.warn(`Position ${t} is not within a blockContainer node.`);const i=e.resolve(s.find(l=>l>=t)||s[s.length-1]);return{posBeforeNode:i.pos,node:i.nodeAfter}}function cl(e,t){if(!e.type.isInGroup("bnBlock"))throw new Error(`Attempted to get bnBlock node at position but found node of different type ${e.type.name}`);const n=e,o=t,r=o+n.nodeSize,s={node:n,beforePos:o,afterPos:r};if(n.type.name==="blockContainer"){let i,l;if(n.forEach((a,c)=>{if(a.type.spec.group==="blockContent"){const d=a,u=o+c+1,h=u+a.nodeSize;i={node:d,beforePos:u,afterPos:h}}else if(a.type.name==="blockGroup"){const d=a,u=o+c+1,h=u+a.nodeSize;l={node:d,beforePos:u,afterPos:h}}}),!i)throw new Error(`blockContainer node does not contain a blockContent node in its children: ${n}`);return{isBlockContainer:!0,bnBlock:s,blockContent:i,childContainer:l,blockNoteType:i.node.type.name}}else{if(!s.node.type.isInGroup("childContainer"))throw new Error(`bnBlock node is not in the childContainer group: ${s.node}`);return{isBlockContainer:!1,bnBlock:s,childContainer:s,blockNoteType:s.node.type.name}}}function Ce(e){return cl(e.node,e.posBeforeNode)}function lo(e){if(!e.nodeAfter)throw new Error(`Attempted to get blockContainer node at position ${e.pos} but a node at this position does not exist`);return cl(e.nodeAfter,e.pos)}function F(e){const t=ae(e.doc,e.selection.anchor);return Ce(t)}function Jr(e){const t=ae(e.doc,e.selection.anchor);return Ce(t)}function ot(e){return"doc"in e?e.doc.type.schema:e.type.schema}function su(e){return e.cached.blockNoteEditor}function ao(e){return su(e).schema}function dl(e){return ao(e).blockSchema}function ul(e){return ao(e).inlineContentSchema}function kn(e){return ao(e).styleSchema}function hl(e){return su(e).blockCache}function iu(e,t,n){var o,r;const s={type:"tableContent",columnWidths:[],headerRows:void 0,headerCols:void 0,rows:[]},i=[];e.content.forEach((l,a,c)=>{const d={cells:[]};c===0&&l.content.forEach(u=>{let h=u.attrs.colwidth;h==null&&(h=new Array(u.attrs.colspan??1).fill(void 0)),s.columnWidths.push(...h)}),d.cells=l.content.content.map((u,h)=>(i[c]||(i[c]=[]),i[c][h]=u.type.name==="tableHeader",{type:"tableCell",content:u.content.content.map(f=>Yr(f,t,n)).reduce((f,p)=>{if(!f.length)return p;const m=f[f.length-1],g=p[0];return g&&We(m)&&We(g)&&JSON.stringify(m.styles)===JSON.stringify(g.styles)?(m.text+=`
`+g.text,f.push(...p.slice(1)),f):(f.push(...p),f)},[]),props:{colspan:u.attrs.colspan,rowspan:u.attrs.rowspan,backgroundColor:u.attrs.backgroundColor,textColor:u.attrs.textColor,textAlignment:u.attrs.textAlignment}})),s.rows.push(d)});for(let l=0;l<i.length;l++)(o=i[l])!=null&&o.every(a=>a)&&(s.headerRows=(s.headerRows??0)+1);for(let l=0;l<((r=i[0])==null?void 0:r.length);l++)i!=null&&i.every(a=>a[l])&&(s.headerCols=(s.headerCols??0)+1);return s}function Yr(e,t,n){const o=[];let r;return e.content.forEach(s=>{if(s.type.name==="hardBreak"){if(r)if(We(r))r.text+=`
`;else if(Ta(r))r.content[r.content.length-1].text+=`
`;else throw new Error("unexpected");else r={type:"text",text:`
`,styles:{}};return}if(s.type.name!=="link"&&s.type.name!=="text"){if(!t[s.type.name]){console.warn("unrecognized inline content type",s.type.name);return}r&&(o.push(r),r=void 0),o.push(zk(s,t,n));return}const i={};let l;for(const a of s.marks)if(a.type.name==="link")l=a;else{const c=n[a.type.name];if(!c){if(a.type.spec.blocknoteIgnore)continue;throw new Error(`style ${a.type.name} not found in styleSchema`)}if(c.propSchema==="boolean")i[c.type]=!0;else if(c.propSchema==="string")i[c.type]=a.attrs.stringValue;else throw new Gt(c.propSchema)}r?We(r)?l?(o.push(r),r={type:"link",href:l.attrs.href,content:[{type:"text",text:s.textContent,styles:i}]}):JSON.stringify(r.styles)===JSON.stringify(i)?r.text+=s.textContent:(o.push(r),r={type:"text",text:s.textContent,styles:i}):Ta(r)&&(l?r.href===l.attrs.href?JSON.stringify(r.content[r.content.length-1].styles)===JSON.stringify(i)?r.content[r.content.length-1].text+=s.textContent:r.content.push({type:"text",text:s.textContent,styles:i}):(o.push(r),r={type:"link",href:l.attrs.href,content:[{type:"text",text:s.textContent,styles:i}]}):(o.push(r),r={type:"text",text:s.textContent,styles:i})):l?r={type:"link",href:l.attrs.href,content:[{type:"text",text:s.textContent,styles:i}]}:r={type:"text",text:s.textContent,styles:i}}),r&&o.push(r),o}function zk(e,t,n){if(e.type.name==="text"||e.type.name==="link")throw new Error("unexpected");const o={},r=t[e.type.name];for(const[i,l]of Object.entries(e.attrs)){if(!r)throw Error("ic node is of an unrecognized type: "+e.type.name);const a=r.propSchema;i in a&&(o[i]=l)}let s;return r.content==="styled"?s=Yr(e,t,n):s=void 0,{type:e.type.name,props:o,content:s}}function W(e,t,n=dl(t),o=ul(t),r=kn(t),s=hl(t)){var i;if(!e.type.isInGroup("bnBlock"))throw Error("Node should be a bnBlock, but is instead: "+e.type.name);const l=s==null?void 0:s.get(e);if(l)return l;const a=cl(e,0);let c=a.bnBlock.node.attrs.id;c===null&&(c=Kr.options.generateID());const d=n[a.blockNoteType];if(!d)throw Error("Block is of an unrecognized type: "+a.blockNoteType);const u={};for(const[g,b]of Object.entries({...e.attrs,...a.isBlockContainer?a.blockContent.node.attrs:{}})){const k=d.propSchema;g in k&&!(k[g].default===void 0&&b===void 0)&&(u[g]=b)}const h=n[a.blockNoteType],f=[];(i=a.childContainer)==null||i.node.forEach(g=>{f.push(W(g,t,n,o,r,s))});let p;if(h.content==="inline"){if(!a.isBlockContainer)throw new Error("impossible");p=Yr(a.blockContent.node,o,r)}else if(h.content==="table"){if(!a.isBlockContainer)throw new Error("impossible");p=iu(a.blockContent.node,o,r)}else if(h.content==="none")p=void 0;else throw new Gt(h.content);const m={id:c,type:h.type,props:u,content:p,children:f};return s==null||s.set(e,m),m}function jk(e,t,n=dl(t),o=ul(t),r=kn(t),s=hl(t)){const i=[];return e.firstChild.descendants(l=>(i.push(W(l,t,n,o,r,s)),!1)),i}function Wk(e,t,n=dl(t),o=ul(t),r=kn(t),s=hl(t)){function i(l,a,c){if(l.type.name!=="blockGroup")throw new Error("unexpected");const d=[];let u,h;return l.forEach((f,p,m)=>{if(f.type.name!=="blockContainer")throw new Error("unexpected");if(f.childCount===0)return;if(f.childCount===0||f.childCount>2)throw new Error("unexpected, blockContainer.childCount: "+f.childCount);const g=m===0,b=m===l.childCount-1;if(f.firstChild.type.name==="blockGroup"){if(!g)throw new Error("unexpected");const C=i(f.firstChild,Math.max(0,a-1),b?Math.max(0,c-1):0);u=C.blockCutAtStart,b&&(h=C.blockCutAtEnd),d.push(...C.blocks);return}const k=W(f,t,n,o,r,s),v=f.childCount>1?f.child(1):void 0;let x=[];if(v){const C=i(v,0,b?Math.max(0,c-1):0);x=C.blocks,b&&(h=C.blockCutAtEnd)}b&&!v&&c>1&&(h=k.id),g&&a>1&&(u=k.id),d.push({...k,children:x})}),{blocks:d,blockCutAtStart:u,blockCutAtEnd:h}}if(e.content.childCount===0)return{blocks:[],blockCutAtStart:void 0,blockCutAtEnd:void 0};if(e.content.childCount!==1)throw new Error("slice must be a single block, did you forget includeParents=true?");return i(e.content.firstChild,Math.max(e.openStart-1,0),Math.max(e.openEnd-1,0))}function lu(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n.config]))}function Gk(e,t){return{config:e,implementation:t}}function Ie(e,t){return Gk({type:e.name,propSchema:t},{mark:e})}function au(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n.config]))}function Ae(e){const{height:t,width:n}=fl(e),o=new Array(t).fill(!1).map(()=>new Array(n).fill(null)),r=(s,i)=>{for(let l=s;l<t;l++)for(let a=i;a<n;a++)if(!o[l][a])return{row:l,col:a};throw new Error("Unable to create occupancy grid for table, no more available cells")};for(let s=0;s<e.content.rows.length;s++)for(let i=0;i<e.content.rows[s].cells.length;i++){const l=li(e.content.rows[s].cells[i]),a=ai(l),c=Zn(l),{row:d,col:u}=r(s,i);for(let h=d;h<d+a;h++)for(let f=u;f<u+c;f++){if(o[h][f])throw new Error(`Unable to create occupancy grid for table, cell at ${h},${f} is already occupied`);o[h][f]={row:s,col:i,rowspan:a,colspan:c,cell:l}}}return o}function to(e){const t=new Set;return e.map(n=>({cells:n.map(o=>t.has(o.row+":"+o.col)?!1:(t.add(o.row+":"+o.col),o.cell)).filter(o=>o!==!1)}))}function Ge(e,t,n=Ae(t)){for(let o=0;o<n.length;o++)for(let r=0;r<n[o].length;r++){const s=n[o][r];if(s.row===e.row&&s.col===e.col)return{row:o,col:r,cell:s.cell}}throw new Error(`Unable to resolve relative table cell indices for table, cell at ${e.row},${e.col} is not occupied`)}function fl(e){const t=e.content.rows.length;let n=0;return e.content.rows.forEach(o=>{let r=0;o.cells.forEach(s=>{r+=Zn(s)}),n=Math.max(n,r)}),{height:t,width:n}}function cu(e,t,n=Ae(t)){var o;const r=(o=n[e.row])==null?void 0:o[e.col];if(r)return{row:r.row,col:r.col,cell:r.cell}}function di(e,t){var n;const o=Ae(e);if(t<0||t>=o.length)return[];let r=0;for(let i=0;i<t;i++){const l=(n=o[r])==null?void 0:n[0];if(!l)return[];r+=l.rowspan}const s=new Array(o[0].length).fill(!1).map((i,l)=>cu({row:r,col:l},e,o)).filter(i=>i!==void 0);return s.filter((i,l)=>s.findIndex(a=>a.row===i.row&&a.col===i.col)===l)}function ui(e,t){var n;const o=Ae(e);if(t<0||t>=o[0].length)return[];let r=0;for(let i=0;i<t;i++){const l=(n=o[0])==null?void 0:n[r];if(!l)return[];r+=l.colspan}const s=new Array(o.length).fill(!1).map((i,l)=>cu({row:l,col:r},e,o)).filter(i=>i!==void 0);return s.filter((i,l)=>s.findIndex(a=>a.row===i.row&&a.col===i.col)===l)}function Kk(e,t,n,o=Ae(e)){const{col:r}=Ge({row:0,col:t},e,o),{col:s}=Ge({row:0,col:n},e,o);return o.forEach(i=>{const[l]=i.splice(r,1);i.splice(s,0,l)}),to(o)}function qk(e,t,n,o=Ae(e)){const{row:r}=Ge({row:t,col:0},e,o),{row:s}=Ge({row:n,col:0},e,o),[i]=o.splice(r,1);return o.splice(s,0,i),to(o)}function hi(e){return e?Qn(e)?hi(e.content):typeof e=="string"?e.length===0:Array.isArray(e)?e.every(t=>typeof t=="string"?t.length===0:We(t)?t.text.length===0:eu(t)?typeof t.content=="string"?t.content.length===0:t.content.every(n=>n.text.length===0):!1):!1:!0}function Jk(e,t,n=Ae(e)){if(t==="columns"){let s=0;for(let i=n[0].length-1;i>=0&&n.every(l=>hi(l[i].cell)&&l[i].colspan===1);i--)s++;for(let i=n.length-1;i>=0;i--){const l=Math.max(n[i].length-s,1);n[i]=n[i].slice(0,l)}return to(n)}let o=0;for(let s=n.length-1;s>=0&&n[s].every(i=>hi(i.cell)&&i.rowspan===1);s--)o++;const r=Math.min(o,n.length-1);return n.splice(n.length-r,r),to(n)}function Yk(e,t,n,o=Ae(e)){const{width:r,height:s}=fl(e);if(t==="columns")o.forEach((i,l)=>{if(n>=0)for(let a=0;a<n;a++)i.push({row:l,col:Math.max(...i.map(c=>c.col))+1,rowspan:1,colspan:1,cell:li("")});else i.splice(r+n,-1*n)});else if(n>0)for(let i=0;i<n;i++){const l=new Array(r).fill(null).map((a,c)=>({row:s+i,col:c,rowspan:1,colspan:1,cell:li("")}));o.push(l)}else n<0&&o.splice(s+n,-1*n);return to(o)}function du(e,t,n){const o=di(e,n);if(!o.some(i=>ai(i.cell)>1))return!0;let r=n,s=n;return o.forEach(i=>{const l=ai(i.cell);r=Math.max(r,i.row+l-1),s=Math.min(s,i.row)}),t<n?n===r:n===s}function uu(e,t,n){const o=ui(e,n);if(!o.some(i=>Zn(i.cell)>1))return!0;let r=n,s=n;return o.forEach(i=>{const l=Zn(i.cell);r=Math.max(r,i.col+l-1),s=Math.min(s,i.col)}),t<n?n===r:n===s}function Xk(e,t,n){const o=Ge(e,n),r=Ge(t,n);return o.col===r.col}function La(e,t,n,o){const r=[];for(const[s,i]of Object.entries(e.styles||{})){const l=n[s];if(!l)throw new Error(`style ${s} not found in styleSchema`);if(l.propSchema==="boolean")r.push(t.mark(s));else if(l.propSchema==="string")r.push(t.mark(s,{stringValue:i}));else throw new Gt(l.propSchema)}return!o||!t.nodes[o].spec.code?e.text.split(/(\n)/g).filter(s=>s.length>0).map(s=>s===`
`?t.nodes.hardBreak.createChecked():t.text(s,r)):e.text.length>0?[t.text(e.text,r)]:[]}function Qk(e,t,n){const o=t.marks.link.create({href:e.href});return fi(e.content,t,n).map(r=>{if(r.type.name==="text")return r.mark([...r.marks,o]);if(r.type.name==="hardBreak")return r;throw new Error("unexpected node type")})}function fi(e,t,n,o){const r=[];if(typeof e=="string")return r.push(...La({text:e,styles:{}},t,n,o)),r;for(const s of e)r.push(...La(s,t,n,o));return r}function Ut(e,t,n,o=kn(t)){const r=[];for(const s of e)typeof s=="string"?r.push(...fi(s,t,o,n)):eu(s)?r.push(...Qk(s,t,o)):We(s)?r.push(...fi([s],t,o,n)):r.push(hu(s,t,o));return r}function Xr(e,t,n=kn(t)){const o=[],r=new Array(e.headerRows??0).fill(!0),s=new Array(e.headerCols??0).fill(!0),i=e.columnWidths??[];for(let l=0;l<e.rows.length;l++){const a=e.rows[l],c=[],d=r[l];for(let h=0;h<a.cells.length;h++){const f=a.cells[h],p=s[h],m=void 0;let g=null;const b=Ge({row:l,col:h},{content:e});let k=i[b.col]?[i[b.col]]:null;if(f)if(typeof f=="string")g=t.text(f);else if(Qn(f)){f.content&&(g=Ut(f.content,t,"tableParagraph",n));const x=Zn(f);x>1&&(k=new Array(x).fill(!1).map((C,M)=>i[b.col+M]??void 0))}else g=Ut(f,t,"tableParagraph",n);const v=t.nodes[p||d?"tableHeader":"tableCell"].createChecked({...Qn(f)?f.props:{},colwidth:k},t.nodes.tableParagraph.createChecked(m,g));c.push(v)}const u=t.nodes.tableRow.createChecked({},c);o.push(u)}return o}function hu(e,t,n){let o,r=e.type;if(r===void 0&&(r="paragraph"),!t.nodes[r])throw new Error(`node type ${r} not found in schema`);if(!e.content)o=t.nodes[r].createChecked(e.props);else if(typeof e.content=="string"){const s=Ut([e.content],t,r,n);o=t.nodes[r].createChecked(e.props,s)}else if(Array.isArray(e.content)){const s=Ut(e.content,t,r,n);o=t.nodes[r].createChecked(e.props,s)}else if(e.content.type==="tableContent"){const s=Xr(e.content,t,n);o=t.nodes[r].createChecked(e.props,s)}else throw new Gt(e.content.type);return o}function qe(e,t,n=kn(t)){let o=e.id;o===void 0&&(o=Kr.options.generateID());const r=[];if(e.children)for(const s of e.children)r.push(qe(s,t,n));if(!e.type||t.nodes[e.type].isInGroup("blockContent")){const s=hu(e,t,n),i=r.length>0?t.nodes.blockGroup.createChecked({},r):void 0;return t.nodes.blockContainer.createChecked({id:o,...e.props},i?[s,i]:s)}else{if(t.nodes[e.type].isInGroup("bnBlock"))return t.nodes[e.type].createChecked({id:o,...e.props},r);throw new Error(`block type ${e.type} doesn't match blockContent or bnBlock group`)}}function Et(e,t){let n,o;if(t.firstChild.descendants((r,s)=>n?!1:!pi(r)||r.attrs.id!==e?!0:(n=r,o=s+1,!1)),!(n===void 0||o===void 0))return{node:n,posBeforeNode:o}}function pi(e){return e.type.isInGroup("bnBlock")}function Zk(e,t){return e.id!==t.id||e.type!==t.type||JSON.stringify(e.props)!==JSON.stringify(t.props)||JSON.stringify(e.content)!==JSON.stringify(t.content)}function ty(e,t=[]){let n={type:"local"};e.getMeta("paste")?n={type:"paste"}:e.getMeta("uiEvent")==="drop"?n={type:"drop"}:e.getMeta("history$")?n={type:e.getMeta("history$").redo?"redo":"undo"}:e.getMeta("y-sync$")&&(e.getMeta("y-sync$").isUndoRedoOperation?n={type:"undo-redo"}:n={type:"yjs-remote"});const o=ot(e),r=xi(e.before,[e,...t]),s=Ai(r),i=s.flatMap(u=>Wo(r.before,u.oldRange,pi)).map(({node:u})=>W(u,o)),l=s.flatMap(u=>Wo(r.doc,u.newRange,pi)).map(({node:u})=>W(u,o)),a=new Map(l.map(u=>[u.id,u])),c=new Map(i.map(u=>[u.id,u])),d=[];for(const[u,h]of a)c.has(u)||d.push({type:"insert",block:h,source:n,prevBlock:void 0});for(const[u,h]of c)a.has(u)||d.push({type:"delete",block:h,source:n,prevBlock:void 0});for(const[u,h]of a)if(c.has(u)){const f=c.get(u);Zk(f,h)&&d.push({type:"update",block:h,prevBlock:f,source:n})}return d}function ey(e,t,n,o="before"){const r=typeof n=="string"?n:n.id,s=ot(e),i=t.map(c=>qe(c,s)),l=Et(r,e.doc);if(!l)throw new Error(`Block with ID ${r} not found`);let a=l.posBeforeNode;return o==="after"&&(a+=l.node.nodeSize),e.step(new yi(a,a,new K(I.from(i),0,0))),i.map(c=>W(c,s))}function Ia(e,t,n){const o=ot(e),r=n.map(c=>qe(c,o)),s=new Set(t.map(c=>typeof c=="string"?c:c.id)),i=[],l=typeof t[0]=="string"?t[0]:t[0].id;let a=0;if(e.doc.descendants((c,d)=>{if(s.size===0)return!1;if(!c.type.isInGroup("bnBlock")||!s.has(c.attrs.id))return!0;if(i.push(W(c,o)),s.delete(c.attrs.id),n.length>0&&c.attrs.id===l){const p=e.doc.nodeSize;e.insert(d,r);const m=e.doc.nodeSize;a+=p-m}const u=e.doc.nodeSize,h=e.doc.resolve(d-a);h.node().type.name==="blockGroup"&&h.node(h.depth-1).type.name!=="doc"&&h.node().childCount===1?e.delete(h.before(),h.after()):e.delete(d-a,d-a+c.nodeSize);const f=e.doc.nodeSize;return a+=u-f,!1}),s.size>0){const c=[...s].join(`
`);throw Error("Blocks with the following IDs could not be found in the editor: "+c)}return{insertedBlocks:r.map(c=>W(c,o)),removedBlocks:i}}const st=(e,t)=>({tr:n,dispatch:o})=>(o&&fu(n,e,t),!0);function fu(e,t,n,o,r){const s=lo(e.doc.resolve(t)),i=ot(e),l=i.nodes[s.blockNoteType],a=i.nodes[n.type||s.blockNoteType],c=a.isInGroup("bnBlock")?a:i.nodes.blockContainer;if(s.isBlockContainer&&a.isInGroup("blockContent"))Pa(n,e,s),ny(n,e,l,a,s);else if(!s.isBlockContainer&&a.isInGroup("bnBlock"))Pa(n,e,s);else{const d=W(s.bnBlock.node,i);e.replaceWith(s.bnBlock.beforePos,s.bnBlock.afterPos,qe({children:d.children,...n},i));return}e.setNodeMarkup(s.bnBlock.beforePos,c,{...s.bnBlock.node.attrs,...n.props})}function ny(e,t,n,o,r,s,i){const l=ot(t);let a="keep";if(e.content)if(typeof e.content=="string")a=Ut([e.content],l,o.name);else if(Array.isArray(e.content))a=Ut(e.content,l,o.name);else if(e.content.type==="tableContent")a=Xr(e.content,l);else throw new Gt(e.content.type);else n.spec.content===""||o.spec.content!==n.spec.content&&(a=[]);a==="keep"?t.setNodeMarkup(r.blockContent.beforePos,o,{...r.blockContent.node.attrs,...e.props}):t.replaceWith(r.blockContent.beforePos,r.blockContent.afterPos,o.createChecked({...r.blockContent.node.attrs,...e.props},a))}function Pa(e,t,n){const o=ot(t);if(e.children!==void 0&&e.children.length>0){const r=e.children.map(s=>qe(s,o));if(n.childContainer)t.step(new yi(n.childContainer.beforePos+1,n.childContainer.afterPos-1,new K(I.from(r),0,0)));else{if(!n.isBlockContainer)throw new Error("impossible");t.insert(n.blockContent.afterPos,o.nodes.blockGroup.createChecked({},r))}}}function oy(e,t,n,o,r){const s=typeof t=="string"?t:t.id,i=Et(s,e.doc);if(!i)throw new Error(`Block with ID ${s} not found`);fu(e,i.posBeforeNode,n);const l=e.doc.resolve(i.posBeforeNode+1).node(),a=ot(e);return W(l,a)}function pu(e){const t=Array.from(e.classList).filter(n=>!n.startsWith("bn-"))||[];t.length>0?e.className=t.join(" "):e.removeAttribute("class")}function mu(e,t,n,o){let r;if(t)if(typeof t=="string")r=Ut([t],e.pmSchema);else if(Array.isArray(t))r=Ut(t,e.pmSchema);else if(t.type==="tableContent")r=Xr(t,e.pmSchema);else throw new Gt(t.type);else throw new Error("blockContent is required");const s=n.serializeFragment(I.from(r),o);return s.nodeType===1&&pu(s),s}function ry(e,t,n,o,r,s,i){var l,a,c,d,u,h,f,p;const m=(i==null?void 0:i.document)??document,g=t.pmSchema.nodes.blockContainer;let b=n.props;if(!n.props){b={};for(const[E,A]of Object.entries(t.schema.blockSchema[n.type].propSchema))A.default!==void 0&&(b[E]=A.default)}const k=(a=(l=g.spec)==null?void 0:l.toDOM)==null?void 0:a.call(l,g.create({id:n.id,...b})),v=Array.from(k.dom.attributes),x=t.blockImplementations[n.type].implementation.toExternalHTML({...n,props:b},t),C=m.createDocumentFragment();if(x.dom.classList.contains("bn-block-content")){const E=[...v,...Array.from(x.dom.attributes)].filter(A=>A.name.startsWith("data")&&A.name!=="data-content-type"&&A.name!=="data-file-block"&&A.name!=="data-node-view-wrapper"&&A.name!=="data-node-type"&&A.name!=="data-id"&&A.name!=="data-index"&&A.name!=="data-editable");for(const A of E)x.dom.firstChild.setAttribute(A.name,A.value);pu(x.dom.firstChild),C.append(...Array.from(x.dom.childNodes))}else C.append(x.dom);if(x.contentDOM&&n.content){const E=mu(t,n.content,o,i);x.contentDOM.appendChild(E)}let M;if(r.has(n.type)?M="OL":s.has(n.type)&&(M="UL"),M){if(((c=e.lastChild)==null?void 0:c.nodeName)!==M){const A=m.createElement(M);M==="OL"&&b!=null&&b.start&&(b==null?void 0:b.start)!==1&&A.setAttribute("start",b.start+""),e.append(A)}const E=m.createElement("li");E.append(C),e.lastChild.appendChild(E)}else e.append(C);if(n.children&&n.children.length>0){const E=m.createDocumentFragment();if(gu(E,t,n.children,o,r,s,i),((d=e.lastChild)==null?void 0:d.nodeName)==="UL"||((u=e.lastChild)==null?void 0:u.nodeName)==="OL")for(;((h=E.firstChild)==null?void 0:h.nodeName)==="UL"||((f=E.firstChild)==null?void 0:f.nodeName)==="OL";)e.lastChild.lastChild.appendChild(E.firstChild);t.pmSchema.nodes[n.type].isInGroup("blockContent")?e.append(E):(p=x.contentDOM)==null||p.append(E)}}const gu=(e,t,n,o,r,s,i)=>{for(const l of n)ry(e,t,l,o,r,s,i)},sy=(e,t,n,o,r,s)=>{const i=((s==null?void 0:s.document)??document).createDocumentFragment();return gu(i,e,t,n,o,r,s),i},Qr=(e,t)=>{const n=vi.fromSchema(e);return{exportBlocks:(o,r)=>{const s=sy(t,o,n,new Set(["numberedListItem"]),new Set(["bulletListItem","checkListItem"]),r),i=document.createElement("div");return i.append(s),i.innerHTML},exportInlineContent:(o,r)=>{const s=mu(t,o,n,r),i=document.createElement("div");return i.append(s.cloneNode(!0)),i.innerHTML}}};function iy(e,t,n,o,r){let s;if(t)if(typeof t=="string")s=Ut([t],e.pmSchema,o);else if(Array.isArray(t))s=Ut(t,e.pmSchema,o);else if(t.type==="tableContent")s=Xr(t,e.pmSchema);else throw new Gt(t.type);else throw new Error("blockContent is required");return n.serializeFragment(I.from(s),r)}function ly(e,t,n,o,r){var s,i,l,a,c;const d=e.pmSchema.nodes.blockContainer;let u=t.props;if(!t.props){u={};for(const[p,m]of Object.entries(e.schema.blockSchema[t.type].propSchema))m.default!==void 0&&(u[p]=m.default)}const h=e.blockImplementations[t.type].implementation.toInternalHTML({...t,props:u},e);if(t.type==="numberedListItem"&&h.dom.setAttribute("data-index",o.toString()),h.contentDOM&&t.content){const p=iy(e,t.content,n,t.type,r);h.contentDOM.appendChild(p)}if(e.pmSchema.nodes[t.type].isInGroup("bnBlock")){if(t.children&&t.children.length>0){const p=bu(e,t.children,n,r);(s=h.contentDOM)==null||s.append(p)}return h.dom}const f=(l=(i=d.spec)==null?void 0:i.toDOM)==null?void 0:l.call(i,d.create({id:t.id,...u}));return(a=f.contentDOM)==null||a.appendChild(h.dom),t.children&&t.children.length>0&&((c=f.contentDOM)==null||c.appendChild(wu(e,t.children,n,r))),f.dom}function bu(e,t,n,o){const r=((o==null?void 0:o.document)??document).createDocumentFragment();let s=0;for(const i of t){i.type==="numberedListItem"?s++:s=0;const l=ly(e,i,n,s,o);r.appendChild(l)}return r}const wu=(e,t,n,o)=>{var r;const s=e.pmSchema.nodes.blockGroup,i=s.spec.toDOM(s.create({})),l=bu(e,t,n,o);return(r=i.contentDOM)==null||r.appendChild(l),i.dom},ay=(e,t)=>{const n=vi.fromSchema(e);return{serializeBlocks:(o,r)=>wu(t,o,n,r).outerHTML}},Zr=(e,t)=>{const n=e.querySelector(t);if(!n)return;const o=e.querySelector("figcaption"),r=(o==null?void 0:o.textContent)??void 0;return{targetElement:n,caption:r}},cy=(e,t,n,o)=>{const r=document.createElement("div");r.className="bn-add-file-button";const s=document.createElement("div");s.className="bn-add-file-button-icon",o?s.appendChild(o):s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z"></path></svg>',r.appendChild(s);const i=document.createElement("p");i.className="bn-add-file-button-text",i.innerHTML=n||t.dictionary.file_blocks.file.add_button_text,r.appendChild(i);const l=c=>{c.preventDefault()},a=()=>{t.transact(c=>c.setMeta(t.filePanel.plugins[0],{block:e}))};return r.addEventListener("mousedown",l,!0),r.addEventListener("click",a,!0),{dom:r,destroy:()=>{r.removeEventListener("mousedown",l,!0),r.removeEventListener("click",a,!0)}}},dy='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3 8L9.00319 2H19.9978C20.5513 2 21 2.45531 21 2.9918V21.0082C21 21.556 20.5551 22 20.0066 22H3.9934C3.44476 22 3 21.5501 3 20.9932V8ZM10 4V9H5V20H19V4H10Z"></path></svg>',uy=e=>{const t=document.createElement("div");t.className="bn-file-name-with-icon";const n=document.createElement("div");n.className="bn-file-icon",n.innerHTML=dy,t.appendChild(n);const o=document.createElement("p");return o.className="bn-file-name",o.textContent=e.props.name,t.appendChild(o),{dom:t}},pl=(e,t,n,o,r)=>{const s=document.createElement("div");if(s.className="bn-file-block-content-wrapper",e.props.url===""){const l=cy(e,t,o,r);s.appendChild(l.dom);const a=t.onUploadStart(c=>{if(c===e.id){s.removeChild(l.dom);const d=document.createElement("div");d.className="bn-file-loading-preview",d.textContent="Loading...",s.appendChild(d)}});return{dom:s,destroy:()=>{a(),l.destroy()}}}const i={dom:s};if(e.props.showPreview===!1||!n){const l=uy(e);s.appendChild(l.dom),i.destroy=()=>{var a;(a=l.destroy)==null||a.call(l)}}else s.appendChild(n.dom);if(e.props.caption){const l=document.createElement("p");l.className="bn-file-caption",l.textContent=e.props.caption,s.appendChild(l)}return i},ml=(e,t)=>{const n=document.createElement("figure"),o=document.createElement("figcaption");return o.textContent=t,n.appendChild(e),n.appendChild(o),{dom:n}},ts=(e,t)=>{const n=document.createElement("div"),o=document.createElement("p");return o.textContent=t,n.appendChild(e),n.appendChild(o),{dom:n}},Oa=e=>({url:e.src||void 0}),hy='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2 16.0001H5.88889L11.1834 20.3319C11.2727 20.405 11.3846 20.4449 11.5 20.4449C11.7761 20.4449 12 20.2211 12 19.9449V4.05519C12 3.93977 11.9601 3.8279 11.887 3.73857C11.7121 3.52485 11.3971 3.49335 11.1834 3.66821L5.88889 8.00007H2C1.44772 8.00007 1 8.44778 1 9.00007V15.0001C1 15.5524 1.44772 16.0001 2 16.0001ZM23 12C23 15.292 21.5539 18.2463 19.2622 20.2622L17.8445 18.8444C19.7758 17.1937 21 14.7398 21 12C21 9.26016 19.7758 6.80629 17.8445 5.15557L19.2622 3.73779C21.5539 5.75368 23 8.70795 23 12ZM18 12C18 10.0883 17.106 8.38548 15.7133 7.28673L14.2842 8.71584C15.3213 9.43855 16 10.64 16 12C16 13.36 15.3213 14.5614 14.2842 15.2841L15.7133 16.7132C17.106 15.6145 18 13.9116 18 12Z"></path></svg>',fy={backgroundColor:X.backgroundColor,name:{default:""},url:{default:""},caption:{default:""},showPreview:{default:!0}},py={type:"audio",propSchema:fy,content:"none",isFileBlock:!0,fileBlockAccept:["audio/*"]},my=(e,t)=>{const n=document.createElement("div");n.innerHTML=hy;const o=document.createElement("audio");return o.className="bn-audio",t.resolveFileUrl?t.resolveFileUrl(e.props.url).then(r=>{o.src=r}):o.src=e.props.url,o.controls=!0,o.contentEditable="false",o.draggable=!1,pl(e,t,{dom:o},t.dictionary.file_blocks.audio.add_button_text,n.firstElementChild)},gy=e=>{if(e.tagName==="AUDIO")return e.closest("figure")?void 0:Oa(e);if(e.tagName==="FIGURE"){const t=Zr(e,"audio");if(!t)return;const{targetElement:n,caption:o}=t;return{...Oa(n),caption:o}}},by=e=>{if(!e.props.url){const n=document.createElement("p");return n.textContent="Add audio",{dom:n}}let t;return e.props.showPreview?(t=document.createElement("audio"),t.src=e.props.url):(t=document.createElement("a"),t.href=e.props.url,t.textContent=e.props.name||e.props.url),e.props.caption?e.props.showPreview?ml(t,e.props.caption):ts(t,e.props.caption):{dom:t}},wy=io(py,{render:my,parse:gy,toExternalHTML:by}),Ba=Symbol.for("blocknote.shikiParser"),xs=Symbol.for("blocknote.shikiHighlighterPromise"),ky={language:{default:"text"}},yy=Qt({name:"codeBlock",content:"inline*",group:"blockContent",marks:"insertion deletion modification",code:!0,defining:!0,addOptions(){return{defaultLanguage:"text",indentLineWithTab:!0,supportedLanguages:{}}},addAttributes(){const e=this.options;return{language:{default:e.editor.settings.codeBlock.defaultLanguage,parseHTML:t=>{let n=t,o=null;(n==null?void 0:n.tagName)==="DIV"&&(n==null?void 0:n.dataset.contentType)==="codeBlock"&&(n=n.children[0]),(n==null?void 0:n.tagName)==="PRE"&&(n=n==null?void 0:n.children[0]);const r=n==null?void 0:n.getAttribute("data-language");if(r)o=r.toLowerCase();else{const s=[...(n==null?void 0:n.className.split(" "))||[]].filter(i=>i.startsWith("language-")).map(i=>i.replace("language-",""));s.length>0&&(o=s[0].toLowerCase())}return o?As(e.editor.settings.codeBlock,o)??o:null},renderHTML:t=>t.language?{class:`language-${t.language}`,"data-language":t.language}:{}}}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"pre",preserveWhitespace:"full"}]},renderHTML({HTMLAttributes:e}){var t,n;const o=document.createElement("pre"),{dom:r,contentDOM:s}=Kt(this.name,"code",((t=this.options.domAttributes)==null?void 0:t.blockContent)||{},{...((n=this.options.domAttributes)==null?void 0:n.inlineContent)||{},...e});return r.removeChild(s),r.appendChild(o),o.appendChild(s),{dom:r,contentDOM:s}},addNodeView(){const e=this.options;return({editor:t,node:n,getPos:o,HTMLAttributes:r})=>{var s,i;const l=document.createElement("pre"),a=document.createElement("select"),c=document.createElement("div"),{dom:d,contentDOM:u}=Kt(this.name,"code",{...((s=this.options.domAttributes)==null?void 0:s.blockContent)||{},...r},((i=this.options.domAttributes)==null?void 0:i.inlineContent)||{}),h=f=>{const p=f.target.value;t.commands.command(({tr:m})=>(m.setNodeAttribute(o(),"language",p),!0))};return Object.entries(e.editor.settings.codeBlock.supportedLanguages).forEach(([f,{name:p}])=>{const m=document.createElement("option");m.value=f,m.text=p,a.appendChild(m)}),c.contentEditable="false",a.value=n.attrs.language||e.editor.settings.codeBlock.defaultLanguage,d.removeChild(u),d.appendChild(c),d.appendChild(l),l.appendChild(u),c.appendChild(a),a.addEventListener("change",h),{dom:d,contentDOM:u,update:f=>f.type===this.type,destroy:()=>{a.removeEventListener("change",h)}}}},addProseMirrorPlugins(){const e=this.options,t=globalThis;let n,o;return[cp({parser:r=>{if(!e.editor.settings.codeBlock.createHighlighter)return[];if(!n)return t[xs]=t[xs]||e.editor.settings.codeBlock.createHighlighter(),t[xs].then(i=>{n=i});const s=As(e.editor.settings.codeBlock,r.language);return!s||s==="text"||s==="none"||s==="plaintext"||s==="txt"?[]:n.getLoadedLanguages().includes(s)?(o||(o=t[Ba]||dp(n),t[Ba]=o),o(r)):n.loadLanguage(s)},languageExtractor:r=>r.attrs.language,nodeTypes:[this.name]})]},addInputRules(){const e=this.options;return[new be({find:/^```(.*?)\s$/,handler:({state:t,range:n,match:o})=>{const r=t.doc.resolve(n.from),s=o[1].trim(),i={language:As(e.editor.settings.codeBlock,s)??s};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),this.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,this.type,i).setSelection(B.create(t.tr.doc,n.from))}})]},addKeyboardShortcuts(){return{Delete:({editor:e})=>{const{selection:t}=e.state,{$from:n}=t;if(e.isActive(this.name)&&!n.parent.textContent&&Dr(t)){const o=n.pos-n.parentOffset-2;return e.chain().setNodeSelection(o).deleteSelection().run(),!0}return!1},Tab:({editor:e})=>this.options.indentLineWithTab&&e.isActive(this.name)?(e.commands.insertContent("  "),!0):!1,Enter:({editor:e})=>{const{$from:t}=e.state.selection;if(!e.isActive(this.name))return!1;const n=t.parentOffset===t.parent.nodeSize-2,o=t.parent.textContent.endsWith(`

`);return!n||!o?(e.commands.insertContent(`
`),!0):e.chain().command(({tr:r})=>(r.delete(t.pos-2,t.pos),!0)).exitCode().run()},"Shift-Enter":({editor:e})=>{const{$from:t}=e.state.selection;return e.isActive(this.name)?(e.chain().insertContentAt(t.pos-t.parentOffset+t.parent.nodeSize,{type:"paragraph"}).run(),!0):!1}}}}),vy=xe(yy,ky);function As(e,t){var n;return(n=Object.entries(e.supportedLanguages).find(([o,{aliases:r}])=>(r==null?void 0:r.includes(t))||o===t))==null?void 0:n[0]}const Cy=lt.create({name:"backgroundColor",addAttributes(){return{stringValue:{default:void 0,parseHTML:e=>e.getAttribute("data-background-color"),renderHTML:e=>({"data-background-color":e.stringValue})}}},parseHTML(){return[{tag:"span",getAttrs:e=>typeof e=="string"?!1:e.hasAttribute("data-background-color")?{stringValue:e.getAttribute("data-background-color")}:!1}]},renderHTML({HTMLAttributes:e}){return["span",e,0]}}),Sy=Ie(Cy,"string"),Ey=lt.create({name:"textColor",addAttributes(){return{stringValue:{default:void 0,parseHTML:e=>e.getAttribute("data-text-color"),renderHTML:e=>({"data-text-color":e.stringValue})}}},parseHTML(){return[{tag:"span",getAttrs:e=>typeof e=="string"?!1:e.hasAttribute("data-text-color")?{stringValue:e.getAttribute("data-text-color")}:!1}]},renderHTML({HTMLAttributes:e}){return["span",e,0]}}),xy=Ie(Ey,"string"),Da=e=>({url:e.src||void 0}),Ay={backgroundColor:X.backgroundColor,name:{default:""},url:{default:""},caption:{default:""}},My={type:"file",propSchema:Ay,content:"none",isFileBlock:!0},Ty=(e,t)=>pl(e,t),_y=e=>{if(e.tagName==="EMBED")return e.closest("figure")?void 0:Da(e);if(e.tagName==="FIGURE"){const t=Zr(e,"embed");if(!t)return;const{targetElement:n,caption:o}=t;return{...Da(n),caption:o}}},Ly=e=>{if(!e.props.url){const n=document.createElement("p");return n.textContent="Add file",{dom:n}}const t=document.createElement("a");return t.href=e.props.url,t.textContent=e.props.name||e.props.url,e.props.caption?ts(t,e.props.caption):{dom:t}},Iy=io(My,{render:Ty,parse:_y,toExternalHTML:Ly}),ku={...X,level:{default:1,values:[1,2,3]}},Py=Qt({name:"heading",content:"inline*",group:"blockContent",addAttributes(){return qr(ku)},addInputRules(){return[...[1,2,3].map(e=>new be({find:new RegExp(`^(#{${e}})\\s$`),handler:({state:t,chain:n,range:o})=>{const r=F(t);!r.isBlockContainer||r.blockContent.node.type.spec.content!=="inline*"||n().command(st(r.bnBlock.beforePos,{type:"heading",props:{level:e}})).deleteRange({from:o.from,to:o.to}).run()}}))]},addKeyboardShortcuts(){return{"Mod-Alt-1":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"heading",props:{level:1}}))},"Mod-Alt-2":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"heading",props:{level:2}}))},"Mod-Alt-3":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"heading",props:{level:3}}))}}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"h1",attrs:{level:1},node:"heading"},{tag:"h2",attrs:{level:2},node:"heading"},{tag:"h3",attrs:{level:3},node:"heading"}]},renderHTML({node:e,HTMLAttributes:t}){var n,o;return Kt(this.name,`h${e.attrs.level}`,{...((n=this.options.domAttributes)==null?void 0:n.blockContent)||{},...t},((o=this.options.domAttributes)==null?void 0:o.inlineContent)||{})}}),Oy=xe(Py,ku),yu=(e,t,n,o,r,s)=>{const{dom:i,destroy:l}=pl(e,t,n,r,s),a=i;e.props.url&&e.props.showPreview&&(e.props.previewWidth?a.style.width=`${e.props.previewWidth}px`:a.style.width="fit-content");const c=document.createElement("div");c.className="bn-resize-handle",c.style.left="4px";const d=document.createElement("div");d.className="bn-resize-handle",d.style.right="4px";let u,h=e.props.previewWidth;const f=v=>{var x,C;if(!u){!t.isEditable&&o.contains(c)&&o.contains(d)&&(o.removeChild(c),o.removeChild(d));return}let M;e.props.textAlignment==="center"?u.handleUsed==="left"?M=u.initialWidth+(u.initialClientX-v.clientX)*2:M=u.initialWidth+(v.clientX-u.initialClientX)*2:u.handleUsed==="left"?M=u.initialWidth+u.initialClientX-v.clientX:M=u.initialWidth+v.clientX-u.initialClientX,h=Math.min(Math.max(M,64),((C=(x=t.domElement)==null?void 0:x.firstElementChild)==null?void 0:C.clientWidth)||Number.MAX_VALUE),a.style.width=`${h}px`},p=v=>{(!v.target||!a.contains(v.target)||!t.isEditable)&&o.contains(c)&&o.contains(d)&&(o.removeChild(c),o.removeChild(d)),u&&(u=void 0,t.updateBlock(e,{props:{previewWidth:h}}))},m=()=>{t.isEditable&&(o.appendChild(c),o.appendChild(d))},g=v=>{v.relatedTarget===c||v.relatedTarget===d||u||t.isEditable&&o.contains(c)&&o.contains(d)&&(o.removeChild(c),o.removeChild(d))},b=v=>{v.preventDefault(),u={handleUsed:"left",initialWidth:a.clientWidth,initialClientX:v.clientX}},k=v=>{v.preventDefault(),u={handleUsed:"right",initialWidth:a.clientWidth,initialClientX:v.clientX}};return window.addEventListener("mousemove",f),window.addEventListener("mouseup",p),a.addEventListener("mouseenter",m),a.addEventListener("mouseleave",g),c.addEventListener("mousedown",b),d.addEventListener("mousedown",k),{dom:a,destroy:()=>{l==null||l(),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",p),a.removeEventListener("mouseenter",m),a.removeEventListener("mouseleave",g),c.removeEventListener("mousedown",b),d.removeEventListener("mousedown",k)}}},Ra=e=>{const t=e.src||void 0,n=e.width||void 0;return{url:t,previewWidth:n}},By='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 11.1005L7 9.1005L12.5 14.6005L16 11.1005L19 14.1005V5H5V11.1005ZM4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4C3 3.44772 3.44772 3 4 3ZM15.5 10C14.6716 10 14 9.32843 14 8.5C14 7.67157 14.6716 7 15.5 7C16.3284 7 17 7.67157 17 8.5C17 9.32843 16.3284 10 15.5 10Z"></path></svg>',Dy={textAlignment:X.textAlignment,backgroundColor:X.backgroundColor,name:{default:""},url:{default:""},caption:{default:""},showPreview:{default:!0},previewWidth:{default:void 0,type:"number"}},Ry={type:"image",propSchema:Dy,content:"none",isFileBlock:!0,fileBlockAccept:["image/*"]},Ny=(e,t)=>{const n=document.createElement("div");n.innerHTML=By;const o=document.createElement("div");o.className="bn-visual-media-wrapper";const r=document.createElement("img");return r.className="bn-visual-media",t.resolveFileUrl?t.resolveFileUrl(e.props.url).then(s=>{r.src=s}):r.src=e.props.url,r.alt=e.props.name||e.props.caption||"BlockNote image",r.contentEditable="false",r.draggable=!1,o.appendChild(r),yu(e,t,{dom:o},o,t.dictionary.file_blocks.image.add_button_text,n.firstElementChild)},Hy=e=>{if(e.tagName==="IMG")return e.closest("figure")?void 0:Ra(e);if(e.tagName==="FIGURE"){const t=Zr(e,"img");if(!t)return;const{targetElement:n,caption:o}=t;return{...Ra(n),caption:o}}},Uy=e=>{if(!e.props.url){const n=document.createElement("p");return n.textContent="Add image",{dom:n}}let t;return e.props.showPreview?(t=document.createElement("img"),t.src=e.props.url,t.alt=e.props.name||e.props.caption||"BlockNote image",e.props.previewWidth&&(t.width=e.props.previewWidth)):(t=document.createElement("a"),t.href=e.props.url,t.textContent=e.props.name||e.props.url),e.props.caption?e.props.showPreview?ml(t,e.props.caption):ts(t,e.props.caption):{dom:t}},Vy=io(Ry,{render:Ny,parse:Hy,toExternalHTML:Uy});function gl(e,t,n){var o,r,s;const i=Be.fromSchema(t),l=e,a=document.createElement("div");a.setAttribute("data-node-type","blockGroup");for(const f of Array.from(l.childNodes))a.appendChild(f.cloneNode(!0));let c=i.parse(a,{topNode:t.nodes.blockGroup.create()});((r=(o=c.firstChild)==null?void 0:o.firstChild)==null?void 0:r.type.name)==="checkListItem"&&(c=c.copy(c.content.cut(c.firstChild.firstChild.nodeSize+2)));const d=(s=c.firstChild)==null?void 0:s.firstChild;if(!(d!=null&&d.isTextblock))return I.from(c);const u=t.nodes[n].create({},d.content),h=c.content.cut(d.nodeSize+2);if(h.size>0){const f=c.copy(h);return u.content.addToEnd(f)}return u.content}const vu=(e,t,n)=>({state:o,dispatch:r})=>{const s=ae(o.doc,e),i=Ce(s);if(!i.isBlockContainer)throw new Error(`BlockContainer expected when calling splitBlock, position ${e}`);const l=[{type:i.bnBlock.node.type,attrs:n?{...i.bnBlock.node.attrs,id:void 0}:{}},{type:t?i.blockContent.node.type:o.schema.nodes.paragraph,attrs:n?{...i.blockContent.node.attrs}:{}}];return r&&o.tr.split(e,2,l),!0},bl=e=>{const{blockInfo:t,selectionEmpty:n}=e.transact(s=>({blockInfo:Jr(s),selectionEmpty:s.selection.anchor===s.selection.head}));if(!t.isBlockContainer)return!1;const{bnBlock:o,blockContent:r}=t;return!(r.node.type.name==="bulletListItem"||r.node.type.name==="numberedListItem"||r.node.type.name==="checkListItem")||!n?!1:e._tiptapEditor.commands.first(({state:s,chain:i,commands:l})=>[()=>l.command(()=>r.node.childCount===0?l.command(st(o.beforePos,{type:"paragraph",props:{}})):!1),()=>l.command(()=>r.node.childCount>0?(i().deleteSelection().command(vu(s.selection.from,!0)).run(),!0):!1)])},$y={...X},Fy=Qt({name:"bulletListItem",content:"inline*",group:"blockContent",priority:90,addInputRules(){return[new be({find:new RegExp("^[-+*]\\s$"),handler:({state:e,chain:t,range:n})=>{const o=F(e);!o.isBlockContainer||o.blockContent.node.type.spec.content!=="inline*"||t().command(st(o.bnBlock.beforePos,{type:"bulletListItem",props:{}})).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{Enter:()=>bl(this.options.editor),"Mod-Shift-8":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"bulletListItem",props:{}}))}}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"li",getAttrs:e=>{var t;if(typeof e=="string")return!1;const n=e.parentElement;return n===null?!1:n.tagName==="UL"||n.tagName==="DIV"&&((t=n.parentElement)==null?void 0:t.tagName)==="UL"?{}:!1},getContent:(e,t)=>gl(e,t,this.name),node:"bulletListItem"}]},renderHTML({HTMLAttributes:e}){var t,n;return Kt(this.name,"p",{...((t=this.options.domAttributes)==null?void 0:t.blockContent)||{},...e},((n=this.options.domAttributes)==null?void 0:n.inlineContent)||{})}}),zy=xe(Fy,$y),Cu={...X,checked:{default:!1}},jy=Qt({name:"checkListItem",content:"inline*",group:"blockContent",addAttributes(){return qr(Cu)},addInputRules(){return[new be({find:new RegExp("\\[\\s*\\]\\s$"),handler:({state:e,chain:t,range:n})=>{const o=F(e);!o.isBlockContainer||o.blockContent.node.type.spec.content!=="inline*"||t().command(st(o.bnBlock.beforePos,{type:"checkListItem",props:{checked:!1}})).deleteRange({from:n.from,to:n.to})}}),new be({find:new RegExp("\\[[Xx]\\]\\s$"),handler:({state:e,chain:t,range:n})=>{const o=F(e);!o.isBlockContainer||o.blockContent.node.type.spec.content!=="inline*"||t().command(st(o.bnBlock.beforePos,{type:"checkListItem",props:{checked:!0}})).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{Enter:()=>bl(this.options.editor),"Mod-Shift-9":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"checkListItem",props:{}}))}}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"input",getAttrs:e=>typeof e=="string"||e.closest("[data-content-type]")||e.closest("li")?!1:e.type==="checkbox"?{checked:e.checked}:!1,node:"checkListItem"},{tag:"li",getAttrs:e=>{var t;if(typeof e=="string")return!1;const n=e.parentElement;if(n===null)return!1;if(n.tagName==="UL"||n.tagName==="DIV"&&((t=n.parentElement)==null?void 0:t.tagName)==="UL"){const o=e.querySelector("input[type=checkbox]")||null;return o===null?!1:{checked:o.checked}}return!1},getContent:(e,t)=>gl(e,t,this.name),node:"checkListItem"}]},renderHTML({node:e,HTMLAttributes:t}){var n,o;const r=document.createElement("input");r.type="checkbox",r.checked=e.attrs.checked,e.attrs.checked&&r.setAttribute("checked","");const{dom:s,contentDOM:i}=Kt(this.name,"p",{...((n=this.options.domAttributes)==null?void 0:n.blockContent)||{},...t},((o=this.options.domAttributes)==null?void 0:o.inlineContent)||{});return s.insertBefore(r,i),{dom:s,contentDOM:i}},addNodeView(){return({node:e,getPos:t,editor:n,HTMLAttributes:o})=>{var r,s;const i=document.createElement("div"),l=document.createElement("div");l.contentEditable="false";const a=document.createElement("input");a.type="checkbox",a.checked=e.attrs.checked,e.attrs.checked&&a.setAttribute("checked","");const c=()=>{if(!n.isEditable){a.checked=!a.checked;return}if(typeof t!="boolean"){const h=ae(n.state.doc,t());if(h.node.type.name!=="blockContainer")throw new Error(`Expected blockContainer node, got ${h.node.type.name}`);this.editor.commands.command(st(h.posBeforeNode,{type:"checkListItem",props:{checked:a.checked}}))}};a.addEventListener("change",c);const{dom:d,contentDOM:u}=Kt(this.name,"p",{...((r=this.options.domAttributes)==null?void 0:r.blockContent)||{},...o},((s=this.options.domAttributes)==null?void 0:s.inlineContent)||{});if(typeof t!="boolean"){const h="label-"+this.editor.state.doc.resolve(t()).node().attrs.id;a.setAttribute("aria-labelledby",h),u.id=h}return d.removeChild(u),d.appendChild(i),i.appendChild(l),i.appendChild(u),l.appendChild(a),{dom:d,contentDOM:u,destroy:()=>{a.removeEventListener("change",c)}}}}}),Wy=xe(jy,Cu),Gy=new R("numbered-list-indexing"),Ky=()=>new O({key:Gy,appendTransaction:(e,t,n)=>{const o=n.tr;o.setMeta("numberedListIndexing",!0);let r=!1;return n.doc.descendants((s,i)=>{var l;if(s.type.name==="blockContainer"&&s.firstChild.type.name==="numberedListItem"){let a=`${s.firstChild.attrs.start||1}`;const c=Ce({posBeforeNode:i,node:s});if(!c.isBlockContainer)throw new Error("impossible");const d=o.doc.resolve(c.bnBlock.beforePos).nodeBefore;if(d){const p=Ce({posBeforeNode:c.bnBlock.beforePos-d.nodeSize,node:d});if(p.blockNoteType==="numberedListItem"){if(!p.isBlockContainer)throw new Error("impossible");const m=p.blockContent.node.attrs.index;a=(parseInt(m)+1).toString()}}const u=c.blockContent.node,h=u.attrs.index,f=((l=d==null?void 0:d.firstChild)==null?void 0:l.type.name)!=="numberedListItem";if(h!==a||u.attrs.start&&!f){r=!0;const{start:p,...m}=u.attrs;o.setNodeMarkup(c.blockContent.beforePos,void 0,{...m,index:a,...typeof p=="number"&&f&&{start:p}})}}}),r?o:null}}),Su={...X,start:{default:void 0,type:"number"}},qy=Qt({name:"numberedListItem",content:"inline*",group:"blockContent",priority:90,addAttributes(){return{...qr(Su),index:{default:null,parseHTML:e=>e.getAttribute("data-index"),renderHTML:e=>({"data-index":e.index})}}},addInputRules(){return[new be({find:new RegExp("^(\\d+)\\.\\s$"),handler:({state:e,chain:t,range:n,match:o})=>{const r=F(e);if(!r.isBlockContainer||r.blockContent.node.type.spec.content!=="inline*"||r.blockNoteType==="numberedListItem")return;const s=parseInt(o[1]);t().command(st(r.bnBlock.beforePos,{type:"numberedListItem",props:s===1&&{}||{start:s}})).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{Enter:()=>bl(this.options.editor),"Mod-Shift-7":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"numberedListItem",props:{}}))}}},addProseMirrorPlugins(){return[Ky()]},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"li",getAttrs:e=>{var t;if(typeof e=="string")return!1;const n=e.parentElement;if(n===null)return!1;if(n.tagName==="OL"||n.tagName==="DIV"&&((t=n.parentElement)==null?void 0:t.tagName)==="OL"){const o=parseInt(n.getAttribute("start")||"1")||1;return e.previousSibling||o===1?{}:{start:o}}return!1},getContent:(e,t)=>gl(e,t,this.name),priority:300,node:"numberedListItem"}]},renderHTML({HTMLAttributes:e}){var t,n;return Kt(this.name,"p",{...((t=this.options.domAttributes)==null?void 0:t.blockContent)||{},...e},((n=this.options.domAttributes)==null?void 0:n.inlineContent)||{})}}),Jy=xe(qy,Su),Yy={...X},Xy=Qt({name:"paragraph",content:"inline*",group:"blockContent",addKeyboardShortcuts(){return{"Mod-Alt-0":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"paragraph",props:{}}))}}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"p",getAttrs:e=>{var t;return typeof e=="string"||!((t=e.textContent)!=null&&t.trim())?!1:{}},node:"paragraph"}]},renderHTML({HTMLAttributes:e}){var t,n;return Kt(this.name,"p",{...((t=this.options.domAttributes)==null?void 0:t.blockContent)||{},...e},((n=this.options.domAttributes)==null?void 0:n.inlineContent)||{})}}),Qy=xe(Xy,Yy),Zy={...X},t0=Qt({name:"quote",content:"inline*",group:"blockContent",addInputRules(){return[new be({find:new RegExp("^>\\s$"),handler:({state:e,chain:t,range:n})=>{const o=F(e);!o.isBlockContainer||o.blockContent.node.type.spec.content!=="inline*"||t().command(st(o.bnBlock.beforePos,{type:"quote",props:{}})).deleteRange({from:n.from,to:n.to})}})]},addKeyboardShortcuts(){return{"Mod-Alt-q":()=>{const e=F(this.editor.state);return!e.isBlockContainer||e.blockContent.node.type.spec.content!=="inline*"?!0:this.editor.commands.command(st(e.bnBlock.beforePos,{type:"quote"}))}}},parseHTML(){return[{tag:"div[data-content-type="+this.name+"]",contentElement:".bn-inline-content"},{tag:"blockquote",node:"quote"}]},renderHTML({HTMLAttributes:e}){var t,n;return Kt(this.name,"blockquote",{...((t=this.options.domAttributes)==null?void 0:t.blockContent)||{},...e},((n=this.options.domAttributes)==null?void 0:n.inlineContent)||{})}}),e0=xe(t0,Zy),n0=35,Eu=120,BC=31,o0=$.create({name:"BlockNoteTableExtension",addProseMirrorPlugins:()=>[gm({cellMinWidth:n0,defaultCellMinWidth:Eu,View:null}),Am()],addKeyboardShortcuts(){return{Enter:()=>this.editor.state.selection.empty&&this.editor.state.selection.$head.parent.type.name==="tableParagraph"?(this.editor.commands.insertContent({type:"hardBreak"}),!0):!1,Backspace:()=>{const e=this.editor.state.selection,t=e.empty,n=e.$head.parentOffset===0,o=e.$head.node().type.name==="tableParagraph";return t&&n&&o},Tab:()=>this.editor.commands.command(({state:e,dispatch:t,view:n})=>Rl(1)(e,t,n)),"Shift-Tab":()=>this.editor.commands.command(({state:e,dispatch:t,view:n})=>Rl(-1)(e,t,n))}},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:P(S(e,"tableRole",t))}}}),r0={textColor:X.textColor},s0=Qt({name:"table",content:"tableRow+",group:"blockContent",tableRole:"table",marks:"deletion insertion modification",isolating:!0,parseHTML(){return[{tag:"table"}]},renderHTML({HTMLAttributes:e}){var t,n;return Kt(this.name,"table",{...((t=this.options.domAttributes)==null?void 0:t.blockContent)||{},...e},((n=this.options.domAttributes)==null?void 0:n.inlineContent)||{})},addNodeView(){return({node:e,HTMLAttributes:t})=>{var n;class o extends Hc{constructor(s,i,l){super(s,i),this.node=s,this.cellMinWidth=i,this.blockContentHTMLAttributes=l;const a=document.createElement("div");a.className=ve("bn-block-content",l.class),a.setAttribute("data-content-type","table");for(const[h,f]of Object.entries(l))h!=="class"&&a.setAttribute(h,f);const c=this.dom,d=document.createElement("div");d.className="tableWrapper-inner",d.appendChild(c.firstChild),c.appendChild(d),a.appendChild(c);const u=document.createElement("div");u.className="table-widgets-container",u.style.position="relative",c.appendChild(u),this.dom=a}ignoreMutation(s){return!s.target.closest(".tableWrapper-inner")||super.ignoreMutation(s)}}return new o(e,Eu,{...((n=this.options.domAttributes)==null?void 0:n.blockContent)||{},...t})}}}),i0=Qt({name:"tableParagraph",group:"tableContent",content:"inline*",parseHTML(){return[{tag:"p",getAttrs:e=>{if(typeof e=="string"||!e.textContent||!e.closest("[data-content-type]"))return!1;const t=e.parentElement;return t===null?!1:t.tagName==="TD"||t.tagName==="TH"?{}:!1},node:"tableParagraph"}]},renderHTML({HTMLAttributes:e}){return["p",e,0]}}),l0=qt.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)+",tableRole:"row",marks:"deletion insertion modification",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:e}){return["tr",Ct(this.options.HTMLAttributes,e),0]}});function Na(e,t){const n=Be.fromSchema(t).parse(e,{topNode:t.nodes.blockGroup.create()}),o=[];return n.content.descendants(r=>{if(r.isInline)return o.push(r),!1}),I.fromArray(o)}const a0=xe(s0,r0,[o0,i0,Lp.extend({content:"tableContent+",parseHTML(){return[{tag:"th",getContent:(e,t)=>Na(e,t)}]}}),_p.extend({content:"tableContent+",parseHTML(){return[{tag:"td",getContent:(e,t)=>Na(e,t)}]}}),l0]),Ha=e=>{const t=e.src||void 0,n=e.width||void 0;return{url:t,previewWidth:n}},c0='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2 3.9934C2 3.44476 2.45531 3 2.9918 3H21.0082C21.556 3 22 3.44495 22 3.9934V20.0066C22 20.5552 21.5447 21 21.0082 21H2.9918C2.44405 21 2 20.5551 2 20.0066V3.9934ZM8 5V19H16V5H8ZM4 5V7H6V5H4ZM18 5V7H20V5H18ZM4 9V11H6V9H4ZM18 9V11H20V9H18ZM4 13V15H6V13H4ZM18 13V15H20V13H18ZM4 17V19H6V17H4ZM18 17V19H20V17H18Z"></path></svg>',d0={textAlignment:X.textAlignment,backgroundColor:X.backgroundColor,name:{default:""},url:{default:""},caption:{default:""},showPreview:{default:!0},previewWidth:{default:void 0,type:"number"}},u0={type:"video",propSchema:d0,content:"none",isFileBlock:!0,fileBlockAccept:["video/*"]},h0=(e,t)=>{const n=document.createElement("div");n.innerHTML=c0;const o=document.createElement("div");o.className="bn-visual-media-wrapper";const r=document.createElement("video");return r.className="bn-visual-media",t.resolveFileUrl?t.resolveFileUrl(e.props.url).then(s=>{r.src=s}):r.src=e.props.url,r.controls=!0,r.contentEditable="false",r.draggable=!1,r.width=e.props.previewWidth,o.appendChild(r),yu(e,t,{dom:o},o,t.dictionary.file_blocks.video.add_button_text,n.firstElementChild)},f0=e=>{if(e.tagName==="VIDEO")return e.closest("figure")?void 0:Ha(e);if(e.tagName==="FIGURE"){const t=Zr(e,"video");if(!t)return;const{targetElement:n,caption:o}=t;return{...Ha(n),caption:o}}},p0=e=>{if(!e.props.url){const n=document.createElement("p");return n.textContent="Add video",{dom:n}}let t;return e.props.showPreview?(t=document.createElement("video"),t.src=e.props.url,e.props.previewWidth&&(t.width=e.props.previewWidth)):(t=document.createElement("a"),t.href=e.props.url,t.textContent=e.props.name||e.props.url),e.props.caption?e.props.showPreview?ml(t,e.props.caption):ts(t,e.props.caption):{dom:t}},m0=io(u0,{render:h0,parse:f0,toExternalHTML:p0}),xu={paragraph:Qy,heading:Oy,quote:e0,codeBlock:vy,bulletListItem:zy,numberedListItem:Jy,checkListItem:Wy,table:a0,file:Iy,image:Vy,video:m0,audio:wy},g0=ru(xu),Au={bold:Ie(gp,"boolean"),italic:Ie(Ep,"boolean"),underline:Ie(Tp,"boolean"),strike:Ie(Mp,"boolean"),code:Ie(kp,"boolean"),textColor:xy,backgroundColor:Sy};au(Au);const Mu={text:{config:"text",implementation:{}},link:{config:"link",implementation:{}}},b0=lu(Mu);function pt(e,t){return e in t.schema.blockSchema&&t.schema.blockSchema[e]===g0[e]}function w0(e,t){return e in t.schema.inlineContentSchema&&t.schema.inlineContentSchema[e]===b0[e]}function k0(e,t,n){return t.type===e&&t.type in n.schema.blockSchema&&pt(t.type,n)}function DC(e,t){return e.type in t.schema.blockSchema&&t.schema.blockSchema[e.type].isFileBlock||!1}function RC(e,t){return e.type in t.schema.blockSchema&&t.schema.blockSchema[e.type].isFileBlock&&"showPreview"in t.schema.blockSchema[e.type].propSchema||!1}function NC(e,t){return t.schema.blockSchema[e.type].isFileBlock&&!e.props.url}function y0(e,t,n){return t in n.schema.blockSchema&&e in n.schema.blockSchema[t].propSchema&&n.schema.blockSchema[t].propSchema[e]===X[e]}function HC(e,t,n){return y0(e,t.type,n)}function Ua(e){return e instanceof U}function v0(e){let t=e.getTextCursorPosition().block,n=e.schema.blockSchema[t.type].content;for(;n==="none";){if(t=e.getTextCursorPosition().nextBlock,t===void 0)return;n=e.schema.blockSchema[t.type].content,e.setTextCursorPosition(t,"end")}}function ft(e,t){const n=e.getTextCursorPosition().block;if(n.content===void 0)throw new Error("Slash Menu open in a block that doesn't contain content.");let o;return Array.isArray(n.content)&&(n.content.length===1&&We(n.content[0])&&n.content[0].type==="text"&&n.content[0].text==="/"||n.content.length===0)?(o=e.updateBlock(n,t),e.setTextCursorPosition(o)):(o=e.insertBlocks([t],n,"after")[0],e.setTextCursorPosition(e.getTextCursorPosition().nextBlock)),v0(e),o}function UC(e){const t=[];return pt("heading",e)&&t.push({onItemClick:()=>{ft(e,{type:"heading",props:{level:1}})},badge:ue("Mod-Alt-1"),key:"heading",...e.dictionary.slash_menu.heading},{onItemClick:()=>{ft(e,{type:"heading",props:{level:2}})},badge:ue("Mod-Alt-2"),key:"heading_2",...e.dictionary.slash_menu.heading_2},{onItemClick:()=>{ft(e,{type:"heading",props:{level:3}})},badge:ue("Mod-Alt-3"),key:"heading_3",...e.dictionary.slash_menu.heading_3}),pt("quote",e)&&t.push({onItemClick:()=>{ft(e,{type:"quote"})},key:"quote",...e.dictionary.slash_menu.quote}),pt("numberedListItem",e)&&t.push({onItemClick:()=>{ft(e,{type:"numberedListItem"})},badge:ue("Mod-Shift-7"),key:"numbered_list",...e.dictionary.slash_menu.numbered_list}),pt("bulletListItem",e)&&t.push({onItemClick:()=>{ft(e,{type:"bulletListItem"})},badge:ue("Mod-Shift-8"),key:"bullet_list",...e.dictionary.slash_menu.bullet_list}),pt("checkListItem",e)&&t.push({onItemClick:()=>{ft(e,{type:"checkListItem"})},badge:ue("Mod-Shift-9"),key:"check_list",...e.dictionary.slash_menu.check_list}),pt("paragraph",e)&&t.push({onItemClick:()=>{ft(e,{type:"paragraph"})},badge:ue("Mod-Alt-0"),key:"paragraph",...e.dictionary.slash_menu.paragraph}),pt("codeBlock",e)&&t.push({onItemClick:()=>{ft(e,{type:"codeBlock"})},badge:ue("Mod-Alt-c"),key:"code_block",...e.dictionary.slash_menu.code_block}),pt("table",e)&&t.push({onItemClick:()=>{ft(e,{type:"table",content:{type:"tableContent",rows:[{cells:["","",""]},{cells:["","",""]}]}})},badge:void 0,key:"table",...e.dictionary.slash_menu.table}),pt("image",e)&&t.push({onItemClick:()=>{const n=ft(e,{type:"image"});e.transact(o=>o.setMeta(e.filePanel.plugins[0],{block:n}))},key:"image",...e.dictionary.slash_menu.image}),pt("video",e)&&t.push({onItemClick:()=>{const n=ft(e,{type:"video"});e.transact(o=>o.setMeta(e.filePanel.plugins[0],{block:n}))},key:"video",...e.dictionary.slash_menu.video}),pt("audio",e)&&t.push({onItemClick:()=>{const n=ft(e,{type:"audio"});e.transact(o=>o.setMeta(e.filePanel.plugins[0],{block:n}))},key:"audio",...e.dictionary.slash_menu.audio}),pt("file",e)&&t.push({onItemClick:()=>{const n=ft(e,{type:"file"});e.transact(o=>o.setMeta(e.filePanel.plugins[0],{block:n}))},key:"file",...e.dictionary.slash_menu.file}),t.push({onItemClick:()=>{e.openSuggestionMenu(":",{deleteTriggerCharacter:!0,ignoreQueryLength:!0})},key:"emoji",...e.dictionary.slash_menu.emoji}),t}function VC(e,t){return e.filter(({title:n,aliases:o})=>n.toLowerCase().includes(t.toLowerCase())||o&&o.filter(r=>r.toLowerCase().includes(t.toLowerCase())).length!==0)}function Ms(e){return e&&Object.fromEntries(Object.entries(e).filter(([,t])=>t!==void 0))}class es{constructor(t){w(this,"blockSpecs"),w(this,"inlineContentSpecs"),w(this,"styleSpecs"),w(this,"blockSchema"),w(this,"inlineContentSchema"),w(this,"styleSchema"),w(this,"BlockNoteEditor","only for types"),w(this,"Block","only for types"),w(this,"PartialBlock","only for types"),this.blockSpecs=Ms(t==null?void 0:t.blockSpecs)||xu,this.inlineContentSpecs=Ms(t==null?void 0:t.inlineContentSpecs)||Mu,this.styleSpecs=Ms(t==null?void 0:t.styleSpecs)||Au,this.blockSchema=ru(this.blockSpecs),this.inlineContentSchema=lu(this.inlineContentSpecs),this.styleSchema=au(this.styleSpecs)}static create(t){return new es(t)}}const C0={type:"pageBreak",propSchema:{},content:"none",isFileBlock:!1,isSelectable:!1},S0=()=>{const e=document.createElement("div");return e.className="bn-page-break",e.setAttribute("data-page-break",""),{dom:e}},E0=e=>{if(e.tagName==="DIV"&&e.hasAttribute("data-page-break"))return{type:"pageBreak"}},x0=()=>{const e=document.createElement("div");return e.setAttribute("data-page-break",""),{dom:e}},A0=io(C0,{render:S0,parse:E0,toExternalHTML:x0});es.create({blockSpecs:{pageBreak:A0}});function M0(e){return e.transact(t=>{const n=ae(t.doc,t.selection.anchor);if(t.selection instanceof U)return{type:"cell",anchorBlockId:n.node.attrs.id,anchorCellOffset:t.selection.$anchorCell.pos-n.posBeforeNode,headCellOffset:t.selection.$headCell.pos-n.posBeforeNode};if(t.selection instanceof xt)return{type:"node",anchorBlockId:n.node.attrs.id};{const o=ae(t.doc,t.selection.head);return{type:"text",anchorBlockId:n.node.attrs.id,headBlockId:o.node.attrs.id,anchorOffset:t.selection.anchor-n.posBeforeNode,headOffset:t.selection.head-o.posBeforeNode}}})}function T0(e,t){var n,o;const r=(n=Et(t.anchorBlockId,e.doc))==null?void 0:n.posBeforeNode;if(r===void 0)throw new Error(`Could not find block with ID ${t.anchorBlockId} to update selection`);let s;if(t.type==="cell")s=U.create(e.doc,r+t.anchorCellOffset,r+t.headCellOffset);else if(t.type==="node")s=xt.create(e.doc,r+1);else{const i=(o=Et(t.headBlockId,e.doc))==null?void 0:o.posBeforeNode;if(i===void 0)throw new Error(`Could not find block with ID ${t.headBlockId} to update selection`);s=B.create(e.doc,r+t.anchorOffset,i+t.headOffset)}e.setSelection(s)}function mi(e){return e.map(t=>t.type==="columnList"?t.children.map(n=>mi(n.children)).flat():{...t,children:mi(t.children)}).flat()}function Tu(e,t,n){e.transact(o=>{var r;const s=((r=e.getSelection())==null?void 0:r.blocks)||[e.getTextCursorPosition().block],i=M0(e);e.removeBlocks(s),e.insertBlocks(mi(s),t,n),T0(o,i)})}function _u(e){return!e||e.type!=="columnList"}function Lu(e,t,n){let o,r;if(t?t.children.length>0?(o=t.children[t.children.length-1],r="after"):(o=t,r="before"):n&&(o=n,r="before"),!o||!r)return;const s=e.getParentBlock(o);return _u(s)?{referenceBlock:o,placement:r}:Lu(e,r==="after"?o:e.getPrevBlock(o),s)}function Iu(e,t,n){let o,r;if(t?t.children.length>0?(o=t.children[0],r="before"):(o=t,r="after"):n&&(o=n,r="after"),!o||!r)return;const s=e.getParentBlock(o);return _u(s)?{referenceBlock:o,placement:r}:Iu(e,r==="before"?o:e.getNextBlock(o),s)}function _0(e){e.transact(()=>{const t=e.getSelection(),n=(t==null?void 0:t.blocks[0])||e.getTextCursorPosition().block,o=Lu(e,e.getPrevBlock(n),e.getParentBlock(n));o&&Tu(e,o.referenceBlock,o.placement)})}function L0(e){e.transact(()=>{const t=e.getSelection(),n=(t==null?void 0:t.blocks[(t==null?void 0:t.blocks.length)-1])||e.getTextCursorPosition().block,o=Iu(e,e.getNextBlock(n),e.getParentBlock(n));o&&Tu(e,o.referenceBlock,o.placement)})}function I0(e,t){return function(n,o){const{$from:r,$to:s}=n.selection,i=r.blockRange(s,c=>c.childCount>0&&(c.type.name==="blockGroup"||c.type.name==="column"));if(!i)return!1;const l=i.startIndex;if(l===0)return!1;const a=i.parent.child(l-1);if(a.type!==e)return!1;if(o){const c=a.lastChild&&a.lastChild.type===t,d=I.from(c?e.create():null),u=new K(I.from(e.create(null,I.from(t.create(null,d)))),c?3:1,0),h=i.start,f=i.end;o(n.tr.step(new $o(h-(c?3:1),f,h,f,u,1,!0)).scrollIntoView())}return!0}}function Pu(e){return e.exec((t,n)=>I0(t.schema.nodes.blockContainer,t.schema.nodes.blockGroup)(t,n))}function P0(e){e._tiptapEditor.commands.liftListItem("blockContainer")}function O0(e){return e.transact(t=>{const{bnBlock:n}=Jr(t);return t.doc.resolve(n.beforePos).nodeBefore!==null})}function B0(e){return e.transact(t=>{const{bnBlock:n}=Jr(t);return t.doc.resolve(n.beforePos).depth>1})}function D0(e,t){const n=typeof t=="string"?t:t.id,o=ot(e),r=Et(n,e);if(r)return W(r.node,o)}function R0(e,t){const n=typeof t=="string"?t:t.id,o=Et(n,e),r=ot(e);if(!o)return;const s=e.resolve(o.posBeforeNode).nodeBefore;if(s)return W(s,r)}function N0(e,t){const n=typeof t=="string"?t:t.id,o=Et(n,e),r=ot(e);if(!o)return;const s=e.resolve(o.posBeforeNode+o.node.nodeSize).nodeAfter;if(s)return W(s,r)}function H0(e,t){const n=typeof t=="string"?t:t.id,o=ot(e),r=Et(n,e);if(!r)return;const s=e.resolve(r.posBeforeNode),i=s.node(),l=s.node(-1),a=l.type.name!=="doc"?i.type.name==="blockGroup"?l:i:void 0;if(a)return W(a,o)}function U0(e,t,n,o={updateSelection:!0}){let{from:r,to:s}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},i=!0,l=!0,a="";if(n.forEach(c=>{c.check(),i&&c.isText&&c.marks.length===0?a+=c.text:i=!1,l=l?c.isBlock:!1}),r===s&&l){const{parent:c}=e.doc.resolve(r);c.isTextblock&&!c.type.spec.code&&!c.childCount&&(r-=1,s+=1)}return i?e.insertText(a,r,s):e.replaceWith(r,s,n),o.updateSelection&&bc(e,e.steps.length-1,-1),!0}function V0(e){const t=ot(e);if(e.selection.empty||"node"in e.selection)return;const n=e.doc.resolve(ae(e.doc,e.selection.from).posBeforeNode),o=e.doc.resolve(ae(e.doc,e.selection.to).posBeforeNode),r=(c,d)=>{const u=n.posAtIndex(c,d),h=e.doc.resolve(u).nodeAfter;if(!h)throw new Error(`Error getting selection - node not found at position ${u}`);return W(h,t)},s=[],i=n.sharedDepth(o.pos),l=n.index(i),a=o.index(i);if(n.depth>i){s.push(W(n.nodeAfter,t));for(let c=n.depth;c>i;c--)if(n.node(c).type.isInGroup("childContainer")){const d=n.index(c)+1,u=n.node(c).childCount;for(let h=d;h<u;h++)s.push(r(h,c))}}else s.push(r(l,i));for(let c=l+1;c<=a;c++)s.push(r(c,i));if(s.length===0)throw new Error(`Error getting selection - selection doesn't span any blocks (${e.selection})`);return{blocks:s}}function $0(e,t,n){const o=typeof t=="string"?t:t.id,r=typeof n=="string"?n:n.id,s=ot(e),i=ao(s);if(o===r)throw new Error(`Attempting to set selection with the same anchor and head blocks (id ${o})`);const l=Et(o,e.doc);if(!l)throw new Error(`Block with ID ${o} not found`);const a=Et(r,e.doc);if(!a)throw new Error(`Block with ID ${r} not found`);const c=Ce(l),d=Ce(a),u=i.blockSchema[c.blockNoteType],h=i.blockSchema[d.blockNoteType];if(!c.isBlockContainer||u.content==="none")throw new Error(`Attempting to set selection anchor in block without content (id ${o})`);if(!d.isBlockContainer||h.content==="none")throw new Error(`Attempting to set selection anchor in block without content (id ${r})`);let f,p;if(u.content==="table"){const m=j.get(c.blockContent.node);f=c.blockContent.beforePos+m.positionAt(0,0,c.blockContent.node)+1+2}else f=c.blockContent.beforePos+1;if(h.content==="table"){const m=j.get(d.blockContent.node),g=d.blockContent.beforePos+m.positionAt(m.height-1,m.width-1,d.blockContent.node)+1,b=e.doc.resolve(g).nodeAfter.nodeSize;p=g+b-2}else p=d.blockContent.afterPos-1;e.setSelection(B.create(e.doc,f,p))}function F0(e){const t=ot(e);let n=e.selection.$from,o=e.selection.$to;for(;o.parentOffset>=o.parent.nodeSize-2&&o.depth>0;)o=e.doc.resolve(o.pos+1);for(;o.parentOffset===0&&o.depth>0;)o=e.doc.resolve(o.pos-1);for(;n.parentOffset===0&&n.depth>0;)n=e.doc.resolve(n.pos-1);for(;n.parentOffset>=n.parent.nodeSize-2&&n.depth>0;)n=e.doc.resolve(n.pos+1);const r=Wk(e.doc.slice(n.pos,o.pos,!0),t);return{_meta:{startPos:n.pos,endPos:o.pos},...r}}function z0(e){const{bnBlock:t}=Jr(e),n=ot(e.doc),o=e.doc.resolve(t.beforePos),r=o.nodeBefore,s=e.doc.resolve(t.afterPos).nodeAfter;let i;return o.depth>1&&(i=o.node(),i.type.isInGroup("bnBlock")||(i=o.node(o.depth-1))),{block:W(t.node,n),prevBlock:r===null?void 0:W(r,n),nextBlock:s===null?void 0:W(s,n),parentBlock:i===void 0?void 0:W(i,n)}}function Ou(e,t,n="start"){const o=typeof t=="string"?t:t.id,r=ot(e.doc),s=ao(r),i=Et(o,e.doc);if(!i)throw new Error(`Block with ID ${o} not found`);const l=Ce(i),a=s.blockSchema[l.blockNoteType].content;if(l.isBlockContainer){const c=l.blockContent;if(a==="none"){e.setSelection(xt.create(e.doc,c.beforePos));return}if(a==="inline")n==="start"?e.setSelection(B.create(e.doc,c.beforePos+1)):e.setSelection(B.create(e.doc,c.afterPos-1));else if(a==="table")n==="start"?e.setSelection(B.create(e.doc,c.beforePos+4)):e.setSelection(B.create(e.doc,c.afterPos-4));else throw new Gt(a)}else{const c=n==="start"?l.childContainer.node.firstChild:l.childContainer.node.lastChild;Ou(e,c.attrs.id,n)}}let Qe;async function wl(){if(Qe)return Qe;const e=await Promise.all([Tt(()=>import("./index.C06_t6vS.js").then(t=>t.i),__vite__mapDeps([0,1,2,3,4,5])),Tt(()=>import("./index.D13MPiJ5.js").then(t=>t.i),__vite__mapDeps([6,7,8,5,9])),Tt(()=>import("./index.CjrT3HcA.js"),__vite__mapDeps([10,11,12,2])),Tt(()=>import("./index.D1r_Q0JC.js"),__vite__mapDeps([13,4,5])),Tt(()=>import("./index.BtpttBoU.js"),__vite__mapDeps([14,15,16,17,9,18,19,20])),Tt(()=>import("./index.1zKQqHhf.js"),__vite__mapDeps([21,22,8,3,20,23,24,19,18,25])),Tt(()=>import("./index.DWHkiPoB.js"),__vite__mapDeps([26,7,23,24,19,20,18,27])),Tt(()=>import("./index.D55_0Pbk.js"),__vite__mapDeps([28,27,25,24])),Tt(()=>import("./index.FLUkLUsW.js"),__vite__mapDeps([29,30,15,19,20])),Tt(()=>import("./index.CS-76Dhj.js"),__vite__mapDeps([31,17,9,20,32]))]);return Qe={rehypeParse:e[0],rehypeStringify:e[1],unified:e[2],hastUtilFromDom:e[3],rehypeRemark:e[4],remarkGfm:e[5],remarkStringify:e[6],remarkParse:e[7],remarkRehype:e[8],rehypeFormat:e[9]},Qe}function j0(){const e=t=>{let n=t.children.length;for(let o=0;o<n;o++){const r=t.children[o];if(r.type==="element"&&(e(r),r.tagName==="u"))if(r.children.length>0){t.children.splice(o,1,...r.children);const s=r.children.length-1;n+=s,o+=s}else t.children.splice(o,1),n--,o--}};return e}function W0(){const e=Qe;if(!e)throw new Error("addSpacesToCheckboxes requires ESM dependencies to be initialized");const t=n=>{var o;if(n.children&&"length"in n.children&&n.children.length)for(let r=n.children.length-1;r>=0;r--){const s=n.children[r],i=r+1<n.children.length?n.children[r+1]:void 0;s.type==="element"&&s.tagName==="input"&&((o=s.properties)==null?void 0:o.type)==="checkbox"&&(i==null?void 0:i.type)==="element"&&i.tagName==="p"?(i.tagName="span",i.children.splice(0,0,e.hastUtilFromDom.fromDom(document.createTextNode(" ")))):t(s)}};return t}function kl(e){const t=Qe;if(!t)throw new Error("cleanHTMLToMarkdown requires ESM dependencies to be initialized");return t.unified.unified().use(t.rehypeParse.default,{fragment:!0}).use(j0).use(W0).use(t.rehypeRemark.default).use(t.remarkGfm.default).use(t.remarkStringify.default,{handlers:{text:n=>n.value}}).processSync(e).value}async function G0(e,t,n,o){await wl();const r=Qr(t,n).exportBlocks(e,o);return kl(r)}function K0(e){return Array.prototype.indexOf.call(e.parentElement.childNodes,e)}function q0(e){return e.nodeType===3&&!/\S/.test(e.nodeValue||"")}function J0(e){e.querySelectorAll("li > ul, li > ol").forEach(t=>{const n=K0(t),o=t.parentElement,r=Array.from(o.childNodes).slice(n+1);t.remove(),r.forEach(s=>{s.remove()}),o.insertAdjacentElement("afterend",t),r.reverse().forEach(s=>{if(q0(s))return;const i=document.createElement("li");i.append(s),t.insertAdjacentElement("afterend",i)}),o.childNodes.length===0&&o.remove()})}function Y0(e){e.querySelectorAll("li + ul, li + ol").forEach(t=>{var n,o;const r=t.previousElementSibling,s=document.createElement("div");r.insertAdjacentElement("afterend",s),s.append(r);const i=document.createElement("div");for(i.setAttribute("data-node-type","blockGroup"),s.append(i);((n=s.nextElementSibling)==null?void 0:n.nodeName)==="UL"||((o=s.nextElementSibling)==null?void 0:o.nodeName)==="OL";)i.append(s.nextElementSibling)})}let Va=null;function X0(){return Va||(Va=document.implementation.createHTMLDocument("title"))}function Bu(e){if(typeof e=="string"){const t=X0().createElement("div");t.innerHTML=e,e=t}return J0(e),Y0(e),e}async function Du(e,t){const n=Bu(e),o=Be.fromSchema(t).parse(n,{topNode:t.nodes.blockGroup.create()}),r=[];for(let s=0;s<o.childCount;s++)r.push(W(o.child(s),t));return r}function Q0(e,t){const n=t.value?t.value:"",o={};t.lang&&(o["data-language"]=t.lang);let r={type:"element",tagName:"code",properties:o,children:[{type:"text",value:n}]};return t.meta&&(r.data={meta:t.meta}),e.patch(t,r),r=e.applyData(t,r),r={type:"element",tagName:"pre",properties:{},children:[r]},e.patch(t,r),r}async function Ru(e){const t=await wl();return t.unified.unified().use(t.remarkParse.default).use(t.remarkGfm.default).use(t.remarkRehype.default,{handlers:{...t.remarkRehype.defaultHandlers,code:Q0}}).use(t.rehypeStringify.default).processSync(e).value}async function Z0(e,t){const n=await Ru(e);return Du(n,t)}const yl=["vscode-editor-data","blocknote/html","text/markdown","text/html","text/plain","Files"];function tv(e,t){if(!e.startsWith(".")||!t.startsWith("."))throw new Error("The strings provided are not valid file extensions.");return e===t}function ev(e,t){const n=e.split("/"),o=t.split("/");if(n.length!==2)throw new Error(`The string ${e} is not a valid MIME type.`);if(o.length!==2)throw new Error(`The string ${t} is not a valid MIME type.`);return n[1]==="*"||o[1]==="*"?n[0]===o[0]:(n[0]==="*"||o[0]==="*"||n[0]===o[0])&&n[1]===o[1]}function $a(e,t,n){let o;return Array.isArray(t.content)&&t.content.length===0?o=e.updateBlock(t,n).id:o=e.insertBlocks([n],t,"after")[0].id,o}async function Nu(e,t){var n;if(!t.uploadFile){console.warn("Attempted ot insert file, but uploadFile is not set in the BlockNote editor options");return}const o="dataTransfer"in e?e.dataTransfer:e.clipboardData;if(o===null)return;let r=null;for(const l of yl)if(o.types.includes(l)){r=l;break}if(r!=="Files")return;const s=o.items;if(!s)return;e.preventDefault();const i=Object.values(t.schema.blockSchema).filter(l=>l.isFileBlock);for(let l=0;l<s.length;l++){let a="file";for(const d of i)for(const u of d.fileBlockAccept||[]){const h=u.startsWith("."),f=s[l].getAsFile();if(f&&(!h&&f.type&&ev(s[l].type,u)||h&&tv("."+f.name.split(".").pop(),u))){a=d.type;break}}const c=s[l].getAsFile();if(c){const d={type:a,props:{name:c.name}};let u;if(e.type==="paste"){const p=t.getTextCursorPosition().block;u=$a(t,p,d)}else if(e.type==="drop"){const p={left:e.clientX,top:e.clientY},m=(n=t.prosemirrorView)==null?void 0:n.posAtCoords(p);if(!m)return;u=t.transact(g=>{const b=ae(g.doc,m.pos);return $a(t,t.getBlock(b.node.attrs.id),d)})}else return;const h=await t.uploadFile(c,u),f=typeof h=="string"?{props:{url:h}}:{...h};t.updateBlock(u,f)}}}const nv=e=>$.create({name:"dropFile",addProseMirrorPlugins(){return[new O({props:{handleDOMEvents:{drop(t,n){if(!e.isEditable)return;let o=null;for(const r of yl)if(n.dataTransfer.types.includes(r)){o=r;break}return o===null?!0:o==="Files"?(Nu(n,e),!0):!1}}}})]}}),ov=/(^|\n) {0,3}#{1,6} {1,8}[^\n]{1,64}\r?\n\r?\n\s{0,32}\S/,rv=new RegExp("(?:\\s|^)(_|__|\\*|\\*\\*|~~|==|\\+\\+)(?!\\s).{1,64}(?<!\\s)(?=\\1)"),sv=/\[[^\]]{1,128}\]\(https?:\/\/\S{1,999}\)/,iv=new RegExp("(?:\\s|^)`(?!\\s)[^`]{1,48}(?<!\\s)`([^\\w]|$)"),lv=/(?:^|\n)\s{0,5}-\s{1}[^\n]+\n\s{0,15}-\s/,av=/(?:^|\n)\s{0,5}\d+\.\s{1}[^\n]+\n\s{0,15}\d+\.\s/,cv=/\n{2} {0,3}-{2,48}\n{2}/,dv=/(?:\n|^)(```|~~~|\$\$)(?!`|~)[^\s]{0,64} {0,64}[^\n]{0,64}\n[\s\S]{0,9999}?\s*\1 {0,64}(?:\n+|$)/,uv=/(?:\n|^)(?!\s)\w[^\n]{0,64}\r?\n(-|=)\1{0,64}\n\n\s{0,64}(\w|$)/,hv=/(?:^|(\r?\n\r?\n))( {0,3}>[^\n]{1,333}\n){1,999}($|(\r?\n))/,fv=/^\s*\|(.+\|)+\s*$/m,pv=/^\s*\|(\s*[-:]+[-:]\s*\|)+\s*$/m,mv=/^\s*\|(.+\|)+\s*$/m,gv=e=>ov.test(e)||rv.test(e)||sv.test(e)||iv.test(e)||lv.test(e)||av.test(e)||cv.test(e)||dv.test(e)||uv.test(e)||hv.test(e)||fv.test(e)||pv.test(e)||mv.test(e);async function bv(e,t){const{schema:n}=t.state;if(!e.clipboardData)return!1;const o=e.clipboardData.getData("text/plain");if(!o)return!1;if(!n.nodes.codeBlock)return t.pasteText(o),!0;const r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;return i?(t.pasteHTML(`<pre><code class="language-${i}">${o.replace(/\r\n?/g,`
`)}</code></pre>`),!0):!1}function wv({event:e,editor:t,prioritizeMarkdownOverHTML:n,plainTextAsMarkdown:o}){var r;if(t.transact(l=>l.selection.$from.parent.type.spec.code&&l.selection.$to.parent.type.spec.code)){const l=(r=e.clipboardData)==null?void 0:r.getData("text/plain");if(l)return t.pasteText(l),!0}let s;for(const l of yl)if(e.clipboardData.types.includes(l)){s=l;break}if(!s)return!0;if(s==="vscode-editor-data")return bv(e,t.prosemirrorView),!0;if(s==="Files")return Nu(e,t),!0;const i=e.clipboardData.getData(s);if(s==="blocknote/html")return t.pasteHTML(i,!0),!0;if(s==="text/markdown")return t.pasteMarkdown(i),!0;if(n){const l=e.clipboardData.getData("text/plain");if(gv(l))return t.pasteMarkdown(l),!0}return s==="text/html"?(t.pasteHTML(i),!0):o?(t.pasteMarkdown(i),!0):(t.pasteText(i),!0)}const kv=(e,t)=>$.create({name:"pasteFromClipboard",addProseMirrorPlugins(){return[new O({props:{handleDOMEvents:{paste(n,o){if(o.preventDefault(),!!e.isEditable)return t({event:o,editor:e,defaultPasteHandler:({prioritizeMarkdownOverHTML:r=!0,plainTextAsMarkdown:s=!0}={})=>wv({event:o,editor:e,prioritizeMarkdownOverHTML:r,plainTextAsMarkdown:s})})}}}})]}});function Hu(e){const t=[];return e.descendants(n=>{var o,r;const s=ot(n);return n.type.name==="blockContainer"&&((o=n.firstChild)==null?void 0:o.type.name)==="blockGroup"?!0:n.type.name==="columnList"&&n.childCount===1?((r=n.firstChild)==null||r.forEach(i=>{t.push(W(i,s))}),!1):n.type.isInGroup("bnBlock")?(t.push(W(n,s)),!1):!0}),t}function yv(e,t,n){var o;let r=!1;const s=e.state.selection instanceof U;if(!s){const a=e.state.doc.slice(e.state.selection.from,e.state.selection.to,!1).content,c=[];for(let d=0;d<a.childCount;d++)c.push(a.child(d));r=c.find(d=>d.type.isInGroup("bnBlock")||d.type.name==="blockGroup"||d.type.spec.group==="blockContent")===void 0,r&&(t=a)}let i;const l=Qr(e.state.schema,n);if(s){((o=t.firstChild)==null?void 0:o.type.name)==="table"&&(t=t.firstChild.content);const a=iu(t,n.schema.inlineContentSchema,n.schema.styleSchema);i=`<table>${l.exportInlineContent(a,{})}</table>`}else if(r){const a=Yr(t,n.schema.inlineContentSchema,n.schema.styleSchema);i=l.exportInlineContent(a,{})}else{const a=Hu(t);i=l.exportBlocks(a,{})}return i}function Uu(e,t){"node"in e.state.selection&&e.state.selection.node.type.spec.group==="blockContent"&&t.transact(i=>i.setSelection(new xt(i.doc.resolve(e.state.selection.from-1))));const n=e.serializeForClipboard(e.state.selection.content()).dom.innerHTML,o=e.state.selection.content().content,r=yv(e,o,t),s=kl(r);return{clipboardHTML:n,externalHTML:r,markdown:s}}const Fa=()=>{const e=window.getSelection();if(!e||e.isCollapsed)return!0;let t=e.focusNode;for(;t;){if(t instanceof HTMLElement&&t.getAttribute("contenteditable")==="false")return!0;t=t.parentElement}return!1},za=(e,t,n)=>{n.preventDefault(),n.clipboardData.clearData();const{clipboardHTML:o,externalHTML:r,markdown:s}=Uu(t,e);n.clipboardData.setData("blocknote/html",o),n.clipboardData.setData("text/html",r),n.clipboardData.setData("text/plain",s)},vv=e=>$.create({name:"copyToClipboard",addProseMirrorPlugins(){return[new O({props:{handleDOMEvents:{copy(t,n){return Fa()||za(e,t,n),!0},cut(t,n){return Fa()||(za(e,t,n),t.editable&&t.dispatch(t.state.tr.deleteSelection())),!0},dragstart(t,n){if(!("node"in t.state.selection)||t.state.selection.node.type.spec.group!=="blockContent")return;e.transact(i=>i.setSelection(new xt(i.doc.resolve(t.state.selection.from-1)))),n.preventDefault(),n.dataTransfer.clearData();const{clipboardHTML:o,externalHTML:r,markdown:s}=Uu(t,e);return n.dataTransfer.setData("blocknote/html",o),n.dataTransfer.setData("text/html",r),n.dataTransfer.setData("text/plain",s),!0}}}})]}}),Cv=$.create({name:"blockBackgroundColor",addGlobalAttributes(){return[{types:["blockContainer","tableCell","tableHeader"],attributes:{backgroundColor:{default:X.backgroundColor.default,parseHTML:e=>e.hasAttribute("data-background-color")?e.getAttribute("data-background-color"):X.backgroundColor.default,renderHTML:e=>e.backgroundColor===X.backgroundColor.default?{}:{"data-background-color":e.backgroundColor}}}}]}});class vl{constructor(){w(this,"callbacks",{})}on(t,n){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(n),()=>this.off(t,n)}emit(t,...n){const o=this.callbacks[t];o&&o.forEach(r=>r.apply(this,n))}off(t,n){const o=this.callbacks[t];o&&(n?this.callbacks[t]=o.filter(r=>r!==n):delete this.callbacks[t])}removeAllListeners(){this.callbacks={}}}class at extends vl{constructor(...t){super(),w(this,"plugins",[])}static key(){throw new Error("You must implement the key method in your extension")}addProsemirrorPlugin(t){this.plugins.push(t)}get priority(){}}const Vu=class $u extends at{constructor(t){super(),w(this,"provider"),w(this,"recentlyUpdatedCursors"),w(this,"renderCursor",(n,o)=>{let r=this.recentlyUpdatedCursors.get(o);if(!r){const s=(this.collaboration.renderCursor??$u.defaultCursorRender)(n);this.collaboration.showCursorLabels!=="always"&&(s.addEventListener("mouseenter",()=>{const i=this.recentlyUpdatedCursors.get(o);i.element.setAttribute("data-active",""),i.hideTimeout&&(clearTimeout(i.hideTimeout),this.recentlyUpdatedCursors.set(o,{element:i.element,hideTimeout:void 0}))}),s.addEventListener("mouseleave",()=>{const i=this.recentlyUpdatedCursors.get(o);this.recentlyUpdatedCursors.set(o,{element:i.element,hideTimeout:setTimeout(()=>{i.element.removeAttribute("data-active")},2e3)})})),r={element:s,hideTimeout:void 0},this.recentlyUpdatedCursors.set(o,r)}return r.element}),w(this,"updateUser",n=>{this.provider.awareness.setLocalStateField("user",n)}),this.collaboration=t,this.provider=t.provider,this.recentlyUpdatedCursors=new Map,this.provider.awareness.setLocalStateField("user",t.user),t.showCursorLabels!=="always"&&this.provider.awareness.on("change",({updated:n})=>{for(const o of n){const r=this.recentlyUpdatedCursors.get(o);r&&(r.element.setAttribute("data-active",""),r.hideTimeout&&clearTimeout(r.hideTimeout),this.recentlyUpdatedCursors.set(o,{element:r.element,hideTimeout:setTimeout(()=>{r.element.removeAttribute("data-active")},2e3)}))}}),this.addProsemirrorPlugin(Ek(this.provider.awareness,{selectionBuilder:tu,cursorBuilder:this.renderCursor}))}static key(){return"yCursorPlugin"}get priority(){return 999}};w(Vu,"defaultCursorRender",e=>{const t=document.createElement("span");t.classList.add("bn-collaboration-cursor__base");const n=document.createElement("span");n.setAttribute("contentedEditable","false"),n.classList.add("bn-collaboration-cursor__caret"),n.setAttribute("style",`background-color: ${e.color}`);const o=document.createElement("span");return o.classList.add("bn-collaboration-cursor__label"),o.setAttribute("style",`background-color: ${e.color}`),o.insertBefore(document.createTextNode(e.name),null),n.insertBefore(o,null),t.insertBefore(document.createTextNode("⁠"),null),t.insertBefore(n,null),t.insertBefore(document.createTextNode("⁠"),null),t});let Fu=Vu;class gi extends at{static key(){return"ySyncPlugin"}constructor(t){super(),this.addProsemirrorPlugin(ak(t))}get priority(){return 1001}}class bi extends at{static key(){return"yUndoPlugin"}constructor(){super(),this.addProsemirrorPlugin(Ik())}get priority(){return 1e3}}const zu=lt.create({name:"comment",excludes:"",inclusive:!1,keepOnSplit:!0,addAttributes(){return{orphan:{parseHTML:e=>!!e.getAttribute("data-orphan"),renderHTML:e=>e.orphan?{"data-orphan":"true"}:{},default:!1},threadId:{parseHTML:e=>e.getAttribute("data-bn-thread-id"),renderHTML:e=>({"data-bn-thread-id":e.threadId}),default:""}}},renderHTML({HTMLAttributes:e}){return["span",Ct(e,{class:"bn-thread-mark"})]},parseHTML(){return[{tag:"span.bn-thread-mark"}]},extendMarkSchema(e){return e.name==="comment"?{blocknoteIgnore:!0}:{}}});class Sv extends vl{constructor(t){super(),w(this,"userCache",new Map),w(this,"loadingUsers",new Set),this.resolveUsers=t}async loadUsers(t){const n=t.filter(o=>!this.userCache.has(o)&&!this.loadingUsers.has(o));if(n.length!==0){for(const o of n)this.loadingUsers.add(o);try{const o=await this.resolveUsers(n);for(const r of o)this.userCache.set(r.id,r);this.emit("update",this.userCache)}finally{for(const o of n)this.loadingUsers.delete(o)}}}getUser(t){return this.userCache.get(t)}subscribe(t){return this.on("update",t)}}const Mo=new R("blocknote-comments"),Ev="SET_SELECTED_THREAD_ID";function xv(e,t){const n=new Map;return e.descendants((o,r)=>{o.marks.forEach(s=>{if(s.type.name===t){const i=s.attrs.threadId;if(!i)return;const l=r,a=l+o.nodeSize,c=n.get(i)??{from:1/0,to:0};n.set(i,{from:Math.min(l,c.from),to:Math.max(a,c.to)})}})}),n}class Av extends at{constructor(t,n,o){if(super(),w(this,"userStore"),w(this,"pendingComment",!1),w(this,"selectedThreadId"),w(this,"threadPositions",new Map),w(this,"updateMarksFromThreads",s=>{this.editor.transact(i=>{i.doc.descendants((l,a)=>{l.marks.forEach(c=>{if(c.type.name===this.markType){const d=c.type,u=c.attrs.threadId,h=s.get(u),f=!!(!h||h.resolved||h.deletedAt);if(f!==c.attrs.orphan){const p=Math.max(a,0),m=Math.min(a+l.nodeSize,i.doc.content.size-1,i.doc.content.size-1);i.removeMark(p,m,c),i.addMark(p,m,d.create({...c.attrs,orphan:f})),f&&this.selectedThreadId===u&&(this.selectedThreadId=void 0,this.emitStateUpdate())}}})})})}),this.editor=t,this.threadStore=n,this.markType=o,!t.resolveUsers)throw new Error("resolveUsers is required for comments");this.userStore=new Sv(t.resolveUsers),this.threadStore.subscribe(this.updateMarksFromThreads),t.onCreate(()=>{this.updateMarksFromThreads(this.threadStore.getThreads()),t.onSelectionChange(()=>{this.pendingComment&&(this.pendingComment=!1,this.emitStateUpdate())})});const r=this;this.addProsemirrorPlugin(new O({key:Mo,state:{init(){return{decorations:tt.empty}},apply(s,i){const l=s.getMeta(Mo);if(!s.docChanged&&!l)return i;const a=s.docChanged?xv(s.doc,r.markType):r.threadPositions;(a.size>0||r.threadPositions.size>0)&&(r.threadPositions=a,r.emitStateUpdate());const c=[];if(r.selectedThreadId){const d=a.get(r.selectedThreadId);d&&c.push(it.inline(d.from,d.to,{class:"bn-thread-mark-selected"}))}return{decorations:tt.create(s.doc,c)}}},props:{decorations(s){var i;return((i=Mo.getState(s))==null?void 0:i.decorations)??tt.empty},handleClick:(s,i,l)=>{if(l.button!==0)return;const a=s.state.doc.nodeAt(i);if(!a){r.selectThread(void 0);return}const c=a.marks.find(u=>u.type.name===o&&u.attrs.orphan!==!0),d=c==null?void 0:c.attrs.threadId;r.selectThread(d,!1)}}}))}static key(){return"comments"}emitStateUpdate(){this.emit("update",{selectedThreadId:this.selectedThreadId,pendingComment:this.pendingComment,threadPositions:this.threadPositions})}onUpdate(t){return this.on("update",t)}selectThread(t,n=!0){var o,r;if(this.selectedThreadId!==t&&(this.selectedThreadId=t,this.emitStateUpdate(),this.editor.transact(s=>s.setMeta(Mo,{name:Ev})),t&&n)){const s=this.threadPositions.get(t);if(!s)return;(r=(o=this.editor.prosemirrorView)==null?void 0:o.domAtPos(s.from).node)==null||r.scrollIntoView({behavior:"smooth",block:"center"})}}startPendingComment(){this.pendingComment=!0,this.emitStateUpdate()}stopPendingComment(){this.pendingComment=!1,this.emitStateUpdate()}async createThread(t){const n=await this.threadStore.createThread(t);if(this.threadStore.addThreadToDocument){const o=this.editor.prosemirrorView,r=o.state.selection,s=N.getState(o.state),i={prosemirror:{head:r.head,anchor:r.anchor},yjs:s?_r(s.binding,o.state):void 0};await this.threadStore.addThreadToDocument({threadId:n.id,selection:i})}else this.editor._tiptapEditor.commands.setMark(this.markType,{orphan:!1,threadId:n.id})}}class Mv{constructor(t,n,o,r){w(this,"state"),w(this,"emitUpdate"),w(this,"mouseDownHandler",()=>{var s;(s=this.state)!=null&&s.show&&(this.state.show=!1,this.emitUpdate())}),w(this,"dragstartHandler",()=>{var s;(s=this.state)!=null&&s.show&&(this.state.show=!1,this.emitUpdate())}),w(this,"scrollHandler",()=>{var s;if((s=this.state)!=null&&s.show){const i=this.pmView.root.querySelector(`[data-node-type="blockContainer"][data-id="${this.state.block.id}"]`);if(!i)return;this.state.referencePos=i.getBoundingClientRect(),this.emitUpdate()}}),w(this,"closeMenu",()=>{var s;(s=this.state)!=null&&s.show&&(this.state.show=!1,this.emitUpdate())}),this.editor=t,this.pluginKey=n,this.pmView=o,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized file panel");r(this.state)},o.dom.addEventListener("mousedown",this.mouseDownHandler),o.dom.addEventListener("dragstart",this.dragstartHandler),o.root.addEventListener("scroll",this.scrollHandler,!0)}update(t,n){var o,r;const s=this.pluginKey.getState(t.state),i=this.pluginKey.getState(n);if(!((o=this.state)!=null&&o.show)&&s!=null&&s.block&&this.editor.isEditable){const c=this.pmView.root.querySelector(`[data-node-type="blockContainer"][data-id="${s.block.id}"]`);if(!c)return;this.state={show:!0,referencePos:c.getBoundingClientRect(),block:s.block},this.emitUpdate();return}const l=(s==null?void 0:s.block)&&!(i!=null&&i.block),a=!(s!=null&&s.block)&&(i==null?void 0:i.block);l&&this.state&&!this.state.show&&(this.state.show=!0,this.emitUpdate()),a&&(r=this.state)!=null&&r.show&&(this.state.show=!1,this.emitUpdate())}destroy(){this.pmView.dom.removeEventListener("mousedown",this.mouseDownHandler),this.pmView.dom.removeEventListener("dragstart",this.dragstartHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0)}}const Ts=new R("FilePanelPlugin");class Tv extends at{constructor(t){super(),w(this,"view"),w(this,"closeMenu",()=>{var n;return(n=this.view)==null?void 0:n.closeMenu()}),this.addProsemirrorPlugin(new O({key:Ts,view:n=>(this.view=new Mv(t,Ts,n,o=>{this.emit("update",o)}),this.view),props:{handleKeyDown:(n,o)=>{var r;return o.key==="Escape"&&this.shown?((r=this.view)==null||r.closeMenu(),!0):!1}},state:{init:()=>({block:void 0}),apply:(n,o)=>n.getMeta(Ts)||(!n.getMeta(N)&&(n.selectionSet||n.docChanged)?{block:void 0}:o)}}))}static key(){return"filePanel"}get shown(){var t,n;return((n=(t=this.view)==null?void 0:t.state)==null?void 0:n.show)||!1}onUpdate(t){return this.on("update",t)}}class _v{constructor(t,n,o){w(this,"state"),w(this,"emitUpdate"),w(this,"preventHide",!1),w(this,"preventShow",!1),w(this,"shouldShow",({view:r,state:s,from:i,to:l})=>{const{doc:a,selection:c}=s,{empty:d}=c,u=!a.textBetween(i,l).length&&Dr(s.selection);if(c.$from.parent.type.spec.code||Ps(c)&&c.node.type.spec.code||d||u)return!1;const h=document.activeElement;return!(!this.isElementWithinEditorWrapper(h)&&r.editable)}),w(this,"blurHandler",r=>{var s;if(this.preventHide){this.preventHide=!1;return}const i=this.pmView.dom.parentElement;r&&r.relatedTarget&&(i===r.relatedTarget||i.contains(r.relatedTarget)||r.relatedTarget.matches(".bn-ui-container, .bn-ui-container *"))||(s=this.state)!=null&&s.show&&(this.state.show=!1,this.emitUpdate())}),w(this,"isElementWithinEditorWrapper",r=>{if(!r)return!1;const s=this.pmView.dom.parentElement;return s?s.contains(r):!1}),w(this,"viewMousedownHandler",r=>{this.isElementWithinEditorWrapper(r.target)||(this.preventShow=!0)}),w(this,"mouseupHandler",()=>{this.preventShow&&(this.preventShow=!1,setTimeout(()=>this.update(this.pmView)))}),w(this,"dragHandler",()=>{var r;(r=this.state)!=null&&r.show&&(this.state.show=!1,this.emitUpdate())}),w(this,"scrollHandler",()=>{var r;(r=this.state)!=null&&r.show&&(this.state.referencePos=this.getSelectionBoundingBox(),this.emitUpdate())}),w(this,"closeMenu",()=>{var r;(r=this.state)!=null&&r.show&&(this.state.show=!1,this.emitUpdate())}),this.editor=t,this.pmView=n,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized formatting toolbar");o(this.state)},n.dom.addEventListener("mousedown",this.viewMousedownHandler),n.root.addEventListener("mouseup",this.mouseupHandler),n.dom.addEventListener("dragstart",this.dragHandler),n.dom.addEventListener("dragover",this.dragHandler),n.dom.addEventListener("blur",this.blurHandler),n.root.addEventListener("scroll",this.scrollHandler,!0)}update(t,n){var o,r,s;const{state:i,composing:l}=t,{doc:a,selection:c}=i,d=n&&n.doc.eq(a)&&n.selection.eq(c);if(l||d)return;const{ranges:u}=c,h=Math.min(...u.map(g=>g.$from.pos)),f=Math.max(...u.map(g=>g.$to.pos)),p=this.shouldShow({view:t,state:i,from:h,to:f}),m=typeof Range.prototype.getClientRects>"u";if(!this.preventShow&&(p||this.preventHide)&&!m){const g={show:!0,referencePos:this.getSelectionBoundingBox()};(g.show!==((o=this.state)==null?void 0:o.show)||g.referencePos.toJSON()!==((r=this.state)==null?void 0:r.referencePos.toJSON()))&&(this.state=g,this.emitUpdate());return}if((s=this.state)!=null&&s.show&&!this.preventHide&&(!p||this.preventShow||!this.editor.isEditable)){this.state.show=!1,this.emitUpdate();return}}destroy(){this.pmView.dom.removeEventListener("mousedown",this.viewMousedownHandler),this.pmView.root.removeEventListener("mouseup",this.mouseupHandler),this.pmView.dom.removeEventListener("dragstart",this.dragHandler),this.pmView.dom.removeEventListener("dragover",this.dragHandler),this.pmView.dom.removeEventListener("blur",this.blurHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0)}getSelectionBoundingBox(){const{state:t}=this.pmView,{selection:n}=t,{ranges:o}=n,r=Math.min(...o.map(i=>i.$from.pos)),s=Math.max(...o.map(i=>i.$to.pos));if(Ps(n)){const i=this.pmView.nodeDOM(r);if(i)return i.getBoundingClientRect()}return Go(this.pmView,r,s)}}const Lv=new R("FormattingToolbarPlugin");class Iv extends at{constructor(t){super(),w(this,"view"),w(this,"closeMenu",()=>this.view.closeMenu()),this.addProsemirrorPlugin(new O({key:Lv,view:n=>(this.view=new _v(t,n,o=>{this.emit("update",o)}),this.view),props:{handleKeyDown:(n,o)=>o.key==="Escape"&&this.shown?(this.view.closeMenu(),!0):!1}}))}static key(){return"formattingToolbar"}get shown(){var t,n;return((n=(t=this.view)==null?void 0:t.state)==null?void 0:n.show)||!1}onUpdate(t){return this.on("update",t)}}const Pv=qt.create({name:"hardBreak",inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,priority:10,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",Ct(this.options.HTMLAttributes,e)]},renderText(){return`
`}}),ja=(e,t)=>{const n=e.resolve(t);if(n.depth<=1)return;const o=n.posAtIndex(n.index(n.depth-1),n.depth-1);return lo(e.resolve(o))},Vo=(e,t)=>{const n=e.resolve(t),o=n.index();if(o===0)return;const r=n.posAtIndex(o-1);return lo(e.resolve(r))},ju=(e,t)=>{for(;t.childContainer;){const n=t.childContainer.node,o=e.resolve(t.childContainer.beforePos+1).posAtIndex(n.childCount-1);t=lo(e.resolve(o))}return t},Ov=(e,t)=>e.isBlockContainer&&e.blockContent.node.type.spec.content==="inline*"&&e.blockContent.node.childCount>0&&t.isBlockContainer&&t.blockContent.node.type.spec.content==="inline*",Bv=(e,t,n,o)=>{if(!o.isBlockContainer)throw new Error(`Attempted to merge block at position ${o.bnBlock.beforePos} into previous block at position ${n.bnBlock.beforePos}, but next block is not a block container`);if(o.childContainer){const r=e.doc.resolve(o.childContainer.beforePos+1),s=e.doc.resolve(o.childContainer.afterPos-1),i=r.blockRange(s);if(t){const l=e.doc.resolve(o.bnBlock.beforePos);e.tr.lift(i,l.depth)}}if(t){if(!n.isBlockContainer)throw new Error(`Attempted to merge block at position ${o.bnBlock.beforePos} into previous block at position ${n.bnBlock.beforePos}, but previous block is not a block container`);t(e.tr.delete(n.blockContent.afterPos-1,o.blockContent.beforePos+1))}return!0},Wa=e=>({state:t,dispatch:n})=>{const o=t.doc.resolve(e),r=lo(o),s=Vo(t.doc,r.bnBlock.beforePos);if(!s)return!1;const i=ju(t.doc,s);return Ov(i,r)?Bv(t,n,i,r):!1},Dv=$.create({priority:50,addKeyboardShortcuts(){const e=()=>this.editor.commands.first(({chain:o,commands:r})=>[()=>r.deleteSelection(),()=>r.undoInputRule(),()=>r.command(({state:s})=>{const i=F(s);if(!i.isBlockContainer)return!1;const l=s.selection.from===i.blockContent.beforePos+1,a=i.blockContent.node.type.name==="paragraph";return l&&!a?r.command(st(i.bnBlock.beforePos,{type:"paragraph",props:{}})):!1}),()=>r.command(({state:s})=>{const i=F(s);if(!i.isBlockContainer)return!1;const{blockContent:l}=i;return s.selection.from===l.beforePos+1?r.liftListItem("blockContainer"):!1}),()=>r.command(({state:s})=>{const i=F(s);if(!i.isBlockContainer)return!1;const{bnBlock:l,blockContent:a}=i,c=s.selection.from===a.beforePos+1,d=s.selection.empty,u=l.beforePos;return c&&d?o().command(Wa(u)).scrollIntoView().run():!1}),()=>r.command(({state:s,dispatch:i})=>{const l=F(s);if(!l.isBlockContainer||s.selection.from!==l.blockContent.beforePos+1||Vo(s.doc,l.bnBlock.beforePos))return!1;const a=ja(s.doc,l.bnBlock.beforePos);if((a==null?void 0:a.blockNoteType)!=="column")return!1;const c=a,d=ja(s.doc,c.bnBlock.beforePos);if((d==null?void 0:d.blockNoteType)!=="columnList")throw new Error("parent of column is not a column list");const u=c.childContainer.node.childCount===1,h=u&&d.childContainer.node.childCount===2,f=d.childContainer.node.firstChild===c.bnBlock.node;if(i){const p=s.doc.slice(l.bnBlock.beforePos,l.bnBlock.afterPos,!1);if(h)if(f){s.tr.step(new $o(d.bnBlock.beforePos,d.bnBlock.afterPos,c.bnBlock.afterPos+1,d.bnBlock.afterPos-2,p,p.size,!1));const m=s.tr.doc.resolve(c.bnBlock.beforePos);s.tr.setSelection(B.between(m,m))}else{s.tr.step(new $o(d.bnBlock.beforePos,d.bnBlock.afterPos,d.bnBlock.beforePos+2,c.bnBlock.beforePos-1,p,0,!1));const m=s.tr.doc.resolve(s.tr.mapping.map(c.bnBlock.beforePos-1));s.tr.setSelection(B.between(m,m))}else if(u)if(f){s.tr.delete(c.bnBlock.beforePos,c.bnBlock.afterPos),s.tr.insert(d.bnBlock.beforePos,p.content);const m=s.tr.doc.resolve(d.bnBlock.beforePos);s.tr.setSelection(B.between(m,m))}else s.tr.delete(c.bnBlock.beforePos-1,c.bnBlock.beforePos+1);else{s.tr.delete(l.bnBlock.beforePos,l.bnBlock.afterPos),f?s.tr.insert(d.bnBlock.beforePos-1,p.content):s.tr.insert(c.bnBlock.beforePos-1,p.content);const m=s.tr.doc.resolve(c.bnBlock.beforePos-1);s.tr.setSelection(B.between(m,m))}}return!0}),()=>r.command(({state:s})=>{const i=F(s);if(!i.isBlockContainer)return!1;if(i.blockContent.node.childCount===0&&i.blockContent.node.type.spec.content==="inline*"){const l=Vo(s.doc,i.bnBlock.beforePos);if(!l||!l.isBlockContainer)return!1;let a=o();if(l.blockContent.node.type.spec.content==="tableRow+"){const c=i.bnBlock.beforePos-1-1-1-1-1;a=a.setTextSelection(c)}else if(l.blockContent.node.type.spec.content===""){const c=l.blockContent.afterPos-l.blockContent.node.nodeSize;a=a.setNodeSelection(c)}else{const c=l.blockContent.afterPos-l.blockContent.node.nodeSize;a=a.setTextSelection(c)}return a.deleteRange({from:i.bnBlock.beforePos,to:i.bnBlock.afterPos}).scrollIntoView().run()}return!1}),()=>r.command(({state:s})=>{const i=F(s);if(!i.isBlockContainer)throw new Error("todo");const l=s.selection.from===i.blockContent.beforePos+1,a=s.selection.empty,c=Vo(s.doc,i.bnBlock.beforePos);if(c&&l&&a){const d=ju(s.doc,c);if(!d.isBlockContainer)throw new Error("todo");if(d.blockContent.node.type.spec.content===""||d.blockContent.node.type.spec.content==="inline*"&&d.blockContent.node.childCount===0)return o().cut({from:i.bnBlock.beforePos,to:i.bnBlock.afterPos},d.bnBlock.afterPos).deleteRange({from:d.bnBlock.beforePos,to:d.bnBlock.afterPos}).run()}return!1})]),t=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.command(({state:r})=>{const s=F(r);if(!s.isBlockContainer)return!1;const{bnBlock:i,blockContent:l,childContainer:a}=s,{depth:c}=r.doc.resolve(i.beforePos),d=i.afterPos===r.doc.nodeSize-3,u=r.selection.from===l.afterPos-1,h=r.selection.empty;if(!d&&u&&h&&a===void 0){let f=c,p=i.afterPos+1,m=r.doc.resolve(p).depth;for(;m<f;)f=m,p+=2,m=r.doc.resolve(p).depth;return o.command(Wa(p-1))}return!1})]),n=(o=!1)=>this.editor.commands.first(({commands:r})=>[()=>r.command(({state:s})=>{const i=F(s);if(!i.isBlockContainer)return!1;const{bnBlock:l,blockContent:a}=i,{depth:c}=s.doc.resolve(l.beforePos),d=s.selection.$anchor.parentOffset===0,u=s.selection.anchor===s.selection.head,h=a.node.childCount===0,f=c>1;return d&&u&&h&&f?r.liftListItem("blockContainer"):!1}),()=>r.command(({state:s})=>{const i=F(s),l=this.options.editor.schema.blockSchema[i.blockNoteType].hardBreakShortcut??"shift+enter";return l==="none"?!1:l==="shift+enter"&&o||l==="enter"?r.insertContent({type:"hardBreak"}):!1}),()=>r.command(({state:s,dispatch:i})=>{const l=F(s);if(!l.isBlockContainer)return!1;const{bnBlock:a,blockContent:c}=l,d=s.selection.$anchor.parentOffset===0,u=s.selection.anchor===s.selection.head,h=c.node.childCount===0;if(d&&u&&h){const f=a.afterPos,p=f+2;if(i){const m=s.schema.nodes.blockContainer.createAndFill();s.tr.insert(f,m).scrollIntoView(),s.tr.setSelection(new B(s.doc.resolve(p)))}return!0}return!1}),()=>r.command(({state:s,chain:i})=>{const l=F(s);if(!l.isBlockContainer)return!1;const{blockContent:a}=l,c=s.selection.$anchor.parentOffset===0;return a.node.childCount===0?!1:(i().deleteSelection().command(vu(s.selection.from,c,c)).run(),!0)})]);return{Backspace:e,Delete:t,Enter:()=>n(),"Shift-Enter":()=>n(!0),Tab:()=>{var o,r,s;return this.options.tabBehavior!=="prefer-indent"&&((o=this.options.editor.formattingToolbar)!=null&&o.shown||(r=this.options.editor.linkToolbar)!=null&&r.shown||(s=this.options.editor.filePanel)!=null&&s.shown)?!1:Pu(this.options.editor)},"Shift-Tab":()=>{var o,r,s;return this.options.tabBehavior!=="prefer-indent"&&((o=this.options.editor.formattingToolbar)!=null&&o.shown||(r=this.options.editor.linkToolbar)!=null&&r.shown||(s=this.options.editor.filePanel)!=null&&s.shown)?!1:(this.editor.commands.liftListItem("blockContainer"),!0)},"Shift-Mod-ArrowUp":()=>(this.options.editor.moveBlocksUp(),!0),"Shift-Mod-ArrowDown":()=>(this.options.editor.moveBlocksDown(),!0),"Mod-z":()=>this.options.editor.undo(),"Mod-y":()=>this.options.editor.redo(),"Shift-Mod-z":()=>this.options.editor.redo()}}});class Rv{constructor(t,n,o){w(this,"state"),w(this,"emitUpdate"),w(this,"menuUpdateTimer"),w(this,"startMenuUpdateTimer"),w(this,"stopMenuUpdateTimer"),w(this,"mouseHoveredLinkMark"),w(this,"mouseHoveredLinkMarkRange"),w(this,"keyboardHoveredLinkMark"),w(this,"keyboardHoveredLinkMarkRange"),w(this,"linkMark"),w(this,"linkMarkRange"),w(this,"mouseOverHandler",r=>{if(this.mouseHoveredLinkMark=void 0,this.mouseHoveredLinkMarkRange=void 0,this.stopMenuUpdateTimer(),r.target instanceof HTMLAnchorElement&&r.target.nodeName==="A"){const s=r.target,i=this.pmView.posAtDOM(s,0)+1,l=this.pmView.state.doc.resolve(i),a=l.marks();for(const c of a)if(c.type.name===this.pmView.state.schema.mark("link").type.name){this.mouseHoveredLinkMark=c,this.mouseHoveredLinkMarkRange=Rn(l,c.type,c.attrs)||void 0;break}}return this.startMenuUpdateTimer(),!1}),w(this,"clickHandler",r=>{var s;const i=this.pmView.dom.parentElement;this.linkMark&&r&&r.target&&!(i===r.target||i.contains(r.target))&&(s=this.state)!=null&&s.show&&(this.state.show=!1,this.emitUpdate())}),w(this,"scrollHandler",()=>{var r;this.linkMark!==void 0&&(r=this.state)!=null&&r.show&&(this.state.referencePos=Go(this.pmView,this.linkMarkRange.from,this.linkMarkRange.to),this.emitUpdate())}),w(this,"closeMenu",()=>{var r;(r=this.state)!=null&&r.show&&(this.state.show=!1,this.emitUpdate())}),this.editor=t,this.pmView=n,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized link toolbar");o(this.state)},this.startMenuUpdateTimer=()=>{this.menuUpdateTimer=setTimeout(()=>{this.update(this.pmView,void 0,!0)},250)},this.stopMenuUpdateTimer=()=>(this.menuUpdateTimer&&(clearTimeout(this.menuUpdateTimer),this.menuUpdateTimer=void 0),!1),this.pmView.dom.addEventListener("mouseover",this.mouseOverHandler),this.pmView.root.addEventListener("click",this.clickHandler,!0),this.pmView.root.addEventListener("scroll",this.scrollHandler,!0)}editLink(t,n){var o;this.editor.transact(r=>{const s=ot(r);r.insertText(n,this.linkMarkRange.from,this.linkMarkRange.to),r.addMark(this.linkMarkRange.from,this.linkMarkRange.from+n.length,s.mark("link",{href:t}))}),this.pmView.focus(),(o=this.state)!=null&&o.show&&(this.state.show=!1,this.emitUpdate())}deleteLink(){var t;this.editor.transact(n=>n.removeMark(this.linkMarkRange.from,this.linkMarkRange.to,this.linkMark.type).setMeta("preventAutolink",!0)),this.pmView.focus(),(t=this.state)!=null&&t.show&&(this.state.show=!1,this.emitUpdate())}update(t,n,o=!1){var r;const{state:s}=t;if(n&&n.selection.from===s.selection.from&&n.selection.to===s.selection.to||!this.pmView.hasFocus())return;const i=this.linkMark;if(this.linkMark=void 0,this.linkMarkRange=void 0,this.keyboardHoveredLinkMark=void 0,this.keyboardHoveredLinkMarkRange=void 0,this.pmView.state.selection.empty){const l=this.pmView.state.selection.$from.marks();for(const a of l)if(a.type.name===this.pmView.state.schema.mark("link").type.name){this.keyboardHoveredLinkMark=a,this.keyboardHoveredLinkMarkRange=Rn(this.pmView.state.selection.$from,a.type,a.attrs)||void 0;break}}if(this.mouseHoveredLinkMark&&o&&(this.linkMark=this.mouseHoveredLinkMark,this.linkMarkRange=this.mouseHoveredLinkMarkRange),this.keyboardHoveredLinkMark&&(this.linkMark=this.keyboardHoveredLinkMark,this.linkMarkRange=this.keyboardHoveredLinkMarkRange),this.linkMark&&this.editor.isEditable){this.state={show:!0,referencePos:Go(this.pmView,this.linkMarkRange.from,this.linkMarkRange.to),url:this.linkMark.attrs.href,text:this.pmView.state.doc.textBetween(this.linkMarkRange.from,this.linkMarkRange.to)},this.emitUpdate();return}if((r=this.state)!=null&&r.show&&i&&(!this.linkMark||!this.editor.isEditable)){this.state.show=!1,this.emitUpdate();return}}destroy(){this.pmView.dom.removeEventListener("mouseover",this.mouseOverHandler),this.pmView.root.removeEventListener("scroll",this.scrollHandler,!0),this.pmView.root.removeEventListener("click",this.clickHandler,!0)}}const Nv=new R("LinkToolbarPlugin");class Hv extends at{constructor(t){super(),w(this,"view"),w(this,"editLink",(n,o)=>{this.view.editLink(n,o)}),w(this,"deleteLink",()=>{this.view.deleteLink()}),w(this,"startHideTimer",()=>{this.view.startMenuUpdateTimer()}),w(this,"stopHideTimer",()=>{this.view.stopMenuUpdateTimer()}),w(this,"closeMenu",()=>this.view.closeMenu()),this.addProsemirrorPlugin(new O({key:Nv,view:n=>(this.view=new Rv(t,n,o=>{this.emit("update",o)}),this.view),props:{handleKeyDown:(n,o)=>o.key==="Escape"&&this.shown?(this.view.closeMenu(),!0):!1}}))}static key(){return"linkToolbar"}onUpdate(t){return this.on("update",t)}get shown(){var t,n;return((n=(t=this.view)==null?void 0:t.state)==null?void 0:n.show)||!1}}const Uv=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"],Vv="https",$v=new R("node-selection-keyboard");class Fv extends at{static key(){return"nodeSelectionKeyboard"}constructor(){super(),this.addProsemirrorPlugin(new O({key:$v,props:{handleKeyDown:(t,n)=>{if("node"in t.state.selection){if(n.ctrlKey||n.metaKey)return!1;if(n.key.length===1)return n.preventDefault(),!0;if(n.key==="Enter"&&!n.shiftKey&&!n.altKey&&!n.ctrlKey&&!n.metaKey){const o=t.state.tr;return t.dispatch(o.insert(t.state.tr.selection.$to.after(),t.state.schema.nodes.paragraph.createChecked()).setSelection(new B(o.doc.resolve(t.state.tr.selection.$to.after()+1)))),!0}}return!1}}}))}}const zv=new R("blocknote-placeholder");class jv extends at{static key(){return"placeholder"}constructor(t,n){super(),this.addProsemirrorPlugin(new O({key:zv,view:o=>{var r,s;const i=`placeholder-selector-${_c()}`;o.dom.classList.add(i);const l=document.createElement("style"),a=t._tiptapEditor.options.injectNonce;a&&l.setAttribute("nonce",a),((r=t.prosemirrorView)==null?void 0:r.root)instanceof ShadowRoot?t.prosemirrorView.root.append(l):(s=t.prosemirrorView)==null||s.root.head.appendChild(l);const c=l.sheet,d=(u="")=>`.${i} .bn-block-content${u} .bn-inline-content:has(> .ProseMirror-trailingBreak:only-child):before`;try{const{default:u,emptyDocument:h,...f}=n;for(const[g,b]of Object.entries(f)){const k=`[data-content-type="${g}"]`;c.insertRule(`${d(k)} { content: ${JSON.stringify(b)}; }`)}c.insertRule(`${d("[data-is-only-empty-block]")} { content: ${JSON.stringify(h)}; }`),c.insertRule(`${d("[data-is-empty-and-focused]")} { content: ${JSON.stringify(u)}; }`)}catch(u){console.warn("Failed to insert placeholder CSS rule - this is likely due to the browser not supporting certain CSS pseudo-element selectors (:has, :only-child:, or :before)",u)}return{destroy:()=>{var u,h;((u=t.prosemirrorView)==null?void 0:u.root)instanceof ShadowRoot?t.prosemirrorView.root.removeChild(l):(h=t.prosemirrorView)==null||h.root.head.removeChild(l)}}},props:{decorations:o=>{const{doc:r,selection:s}=o;if(!t.isEditable||!s.empty||s.$from.parent.type.spec.code)return;const i=[];o.doc.content.size===6&&i.push(it.node(2,4,{"data-is-only-empty-block":"true"}));const l=s.$anchor,a=l.parent;if(a.content.size===0){const c=l.before();i.push(it.node(c,c+a.nodeSize,{"data-is-empty-and-focused":"true"}))}return tt.create(r,i)}}}))}}const Ga=new R("previous-blocks"),Wv={index:"index",level:"level",type:"type",depth:"depth","depth-change":"depth-change"};class Gv extends at{static key(){return"previousBlockType"}constructor(){super();let t;this.addProsemirrorPlugin(new O({key:Ga,view(n){return{update:async(o,r)=>{var s;((s=this.key)==null?void 0:s.getState(o.state).updatedBlocks.size)>0&&(t=setTimeout(()=>{o.dispatch(o.state.tr.setMeta(Ga,{clearUpdate:!0}))},0))},destroy:()=>{t&&clearTimeout(t)}}},state:{init(){return{prevTransactionOldBlockAttrs:{},currentTransactionOldBlockAttrs:{},updatedBlocks:new Set}},apply(n,o,r,s){if(o.currentTransactionOldBlockAttrs={},o.updatedBlocks.clear(),!n.docChanged||r.doc.eq(s.doc))return o;const i={},l=Ll(r.doc,d=>d.attrs.id),a=new Map(l.map(d=>[d.node.attrs.id,d])),c=Ll(s.doc,d=>d.attrs.id);for(const d of c){const u=a.get(d.node.attrs.id),h=u==null?void 0:u.node.firstChild,f=d.node.firstChild;if(u&&h&&f){const p={index:f.attrs.index,level:f.attrs.level,type:f.type.name,depth:s.doc.resolve(d.pos).depth};let m={index:h.attrs.index,level:h.attrs.level,type:h.type.name,depth:r.doc.resolve(u.pos).depth};i[d.node.attrs.id]=m,n.getMeta("numberedListIndexing")&&(d.node.attrs.id in o.prevTransactionOldBlockAttrs&&(m=o.prevTransactionOldBlockAttrs[d.node.attrs.id]),p.type==="numberedListItem"&&(m.index=p.index)),o.currentTransactionOldBlockAttrs[d.node.attrs.id]=m,JSON.stringify(m)!==JSON.stringify(p)&&(m["depth-change"]=m.depth-p.depth,o.updatedBlocks.add(d.node.attrs.id))}}return o.prevTransactionOldBlockAttrs=i,o}},props:{decorations(n){const o=this.getState(n);if(o.updatedBlocks.size===0)return;const r=[];return n.doc.descendants((s,i)=>{if(!s.attrs.id||!o.updatedBlocks.has(s.attrs.id))return;const l=o.currentTransactionOldBlockAttrs[s.attrs.id],a={};for(const[d,u]of Object.entries(l))a["data-prev-"+Wv[d]]=u||"none";const c=it.node(i,i+s.nodeSize,{...a});r.push(c)}),tt.create(n.doc,r)}}}))}}const Ka=new R("blocknote-show-selection");class Kv extends at{constructor(t){super(),w(this,"enabled",!1),this.editor=t,this.addProsemirrorPlugin(new O({key:Ka,props:{decorations:n=>{const{doc:o,selection:r}=n;if(!this.enabled)return tt.empty;const s=it.inline(r.from,r.to,{"data-show-selection":"true"});return tt.create(o,[s])}}}))}static key(){return"showSelection"}setEnabled(t){this.enabled!==t&&(this.enabled=t,this.editor.transact(n=>n.setMeta(Ka,{})))}getEnabled(){return this.enabled}}function Wu(e,t){for(var n,o;e&&e.parentElement&&e.parentElement!==t.dom&&((n=e.getAttribute)==null?void 0:n.call(e,"data-node-type"))!=="blockContainer";)e=e.parentElement;if(((o=e.getAttribute)==null?void 0:o.call(e,"data-node-type"))==="blockContainer")return{node:e,id:e.getAttribute("data-id")}}class Ne extends G{constructor(t,n){super(t,n),w(this,"nodes");const o=t.node();this.nodes=[],t.doc.nodesBetween(t.pos,n.pos,(r,s,i)=>{if(i!==null&&i.eq(o))return this.nodes.push(r),!1})}static create(t,n,o=n){return new Ne(t.resolve(n),t.resolve(o))}content(){return new K(I.from(this.nodes),0,0)}eq(t){if(!(t instanceof Ne)||this.nodes.length!==t.nodes.length||this.from!==t.from||this.to!==t.to)return!1;for(let n=0;n<this.nodes.length;n++)if(!this.nodes[n].eq(t.nodes[n]))return!1;return!0}map(t,n){const o=n.mapResult(this.from),r=n.mapResult(this.to);return r.deleted?G.near(t.resolve(o.pos)):o.deleted?G.near(t.resolve(r.pos)):new Ne(t.resolve(o.pos),t.resolve(r.pos))}toJSON(){return{type:"multiple-node",anchor:this.anchor,head:this.head}}}G.jsonID("multiple-node",Ne);let Bt;function qv(e,t){let n,o;const r=t.resolve(e.from).node().type.spec.group==="blockContent",s=t.resolve(e.to).node().type.spec.group==="blockContent",i=Math.min(e.$anchor.depth,e.$head.depth);if(r&&s){const l=e.$from.start(i-1),a=e.$to.end(i-1);n=t.resolve(l-1).pos,o=t.resolve(a+1).pos}else n=e.from,o=e.to;return{from:n,to:o}}function qa(e,t,n=t){t===n&&(n+=e.state.doc.resolve(t+1).node().nodeSize);const o=e.domAtPos(t).node.cloneNode(!0),r=e.domAtPos(t).node,s=(d,u)=>Array.prototype.indexOf.call(d.children,u),i=s(r,e.domAtPos(t+1).node.parentElement),l=s(r,e.domAtPos(n-1).node.parentElement);for(let d=r.childElementCount-1;d>=0;d--)(d>l||d<i)&&o.removeChild(o.children[d]);Gu(e.root),Bt=o;const a=Bt.getElementsByTagName("iframe");for(let d=0;d<a.length;d++){const u=a[d],h=u.parentElement;h&&h.removeChild(u)}const c=e.dom.className.split(" ").filter(d=>d!=="ProseMirror"&&d!=="bn-root"&&d!=="bn-editor").join(" ");Bt.className=Bt.className+" bn-drag-preview "+c,e.root instanceof ShadowRoot?e.root.appendChild(Bt):e.root.body.appendChild(Bt)}function Gu(e){Bt!==void 0&&(e instanceof ShadowRoot?e.removeChild(Bt):e.body.removeChild(Bt),Bt=void 0)}function Jv(e,t,n){if(!e.dataTransfer)return;const o=n.prosemirrorView;if(!o)return;const r=Et(t.id,o.state.doc);if(!r)throw new Error(`Block with ID ${t.id} not found`);const s=r.posBeforeNode;if(s!=null){const i=o.state.selection,l=o.state.doc,{from:a,to:c}=qv(i,l),d=a<=s&&s<c,u=i.$anchor.node()!==i.$head.node()||i instanceof Ne;d&&u?(o.dispatch(o.state.tr.setSelection(Ne.create(l,a,c))),qa(o,a,c)):(o.dispatch(o.state.tr.setSelection(xt.create(o.state.doc,s))),qa(o,s));const h=o.state.selection.content(),f=n.pmSchema,p=o.serializeForClipboard(h).dom.innerHTML,m=Qr(f,n),g=Hu(h.content),b=m.exportBlocks(g,{}),k=kl(b);e.dataTransfer.clearData(),e.dataTransfer.setData("blocknote/html",p),e.dataTransfer.setData("text/html",b),e.dataTransfer.setData("text/plain",k),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage(Bt,0,0)}}const Sn=.1;function wi(e,t,n,o=!0){const r=e.root.elementsFromPoint(t.left+(n==="editor"?50:0),t.top);for(const s of r)if(e.dom.contains(s))return o&&s.closest("[data-node-type=columnList]")?wi(e,{left:t.left+50,top:t.top},n,!1):Wu(s,e)}function Yv(e,t,n){if(!t.dom.firstChild)return;const o=t.dom.firstChild.getBoundingClientRect(),r={left:e.x,top:e.y},s=r.left<o.left,i=r.left>o.right;n==="viewport"&&(s&&(r.left=o.left+10),i&&(r.left=o.right-10));let l=wi(t,r,n);if(!i&&l){const a=l.node.getBoundingClientRect();r.left=a.right-10,l=wi(t,r,"viewport",!1)}return l}class Xv{constructor(t,n,o,r){w(this,"state"),w(this,"emitUpdate"),w(this,"mousePos"),w(this,"hoveredBlock"),w(this,"menuFrozen",!1),w(this,"isDragOrigin",!1),w(this,"updateState",s=>{this.state=s,this.emitUpdate(this.state)}),w(this,"updateStateFromMousePos",()=>{var s,i,l,a;if(this.menuFrozen||!this.mousePos)return;const c=Yv(this.mousePos,this.pmView,this.sideMenuDetection);if(!c||!this.editor.isEditable){(s=this.state)!=null&&s.show&&(this.state.show=!1,this.updateState(this.state));return}if((i=this.state)!=null&&i.show&&(l=this.hoveredBlock)!=null&&l.hasAttribute("data-id")&&((a=this.hoveredBlock)==null?void 0:a.getAttribute("data-id"))===c.id)return;this.hoveredBlock=c.node;const d=c.node.firstChild;if(d&&this.editor.isEditable){const u=d.getBoundingClientRect(),h=c.node.closest("[data-node-type=column]");this.updateState({show:!0,referencePos:new DOMRect(h?h.firstElementChild.getBoundingClientRect().x:this.pmView.dom.firstChild.getBoundingClientRect().x,u.y,u.width,u.height),block:this.editor.getBlock(this.hoveredBlock.getAttribute("data-id"))})}}),w(this,"onDrop",s=>{var i,l;if(this.pmView.dragging===null)return;this.editor._tiptapEditor.commands.blur();const a=s.target instanceof Node&&((i=s.target instanceof HTMLElement?s.target:s.target.parentElement)==null?void 0:i.closest(".bn-editor"))||null;if(a&&(!this.isDragOrigin&&this.pmView.dom===a?this.pmView.dispatch(this.pmView.state.tr.setSelection(B.create(this.pmView.state.tr.doc,this.pmView.state.tr.selection.to))):this.isDragOrigin&&this.pmView.dom!==a&&setTimeout(()=>this.pmView.dispatch(this.pmView.state.tr.deleteSelection()),0)),this.sideMenuDetection==="editor"||s.synthetic||!((l=s.dataTransfer)!=null&&l.types.includes("blocknote/html")))return;const c=this.pmView.posAtCoords({left:s.clientX,top:s.clientY});if(!c||c.inside===-1){const d=this.createSyntheticEvent(s);this.pmView.dom.dispatchEvent(d)}}),w(this,"onDragEnd",()=>{this.pmView.dragging=null}),w(this,"onDragStart",s=>{var i;const l=(i=s.dataTransfer)==null?void 0:i.getData("blocknote/html");if(!l)return;if(this.pmView.dragging)throw new Error("New drag was started while an existing drag is ongoing");const a=document.createElement("div");a.innerHTML=l;const c=Be.fromSchema(this.pmView.state.schema).parse(a,{topNode:this.pmView.state.schema.nodes.blockGroup.create()});this.pmView.dragging={slice:new K(c.content,0,0),move:!0}}),w(this,"onDragOver",s=>{var i;if(this.sideMenuDetection==="editor"||s.synthetic||!((i=s.dataTransfer)!=null&&i.types.includes("blocknote/html")))return;const l=this.pmView.posAtCoords({left:s.clientX,top:s.clientY});if(!l||l.inside===-1&&this.pmView.dom.firstChild){const a=this.createSyntheticEvent(s);this.pmView.dom.dispatchEvent(a)}}),w(this,"onKeyDown",s=>{var i;(i=this.state)!=null&&i.show&&this.editor.isFocused()&&(this.state.show=!1,this.emitUpdate(this.state))}),w(this,"onMouseMove",s=>{var i;if(this.menuFrozen)return;this.mousePos={x:s.clientX,y:s.clientY};const l=this.pmView.dom.getBoundingClientRect(),a=this.mousePos.x>l.left&&this.mousePos.x<l.right&&this.mousePos.y>l.top&&this.mousePos.y<l.bottom,c=this.pmView.dom.parentElement;if(a&&s&&s.target&&!(c===s.target||c.contains(s.target))){(i=this.state)!=null&&i.show&&(this.state.show=!1,this.emitUpdate(this.state));return}this.updateStateFromMousePos()}),w(this,"onScroll",()=>{var s;(s=this.state)!=null&&s.show&&(this.state.referencePos=this.hoveredBlock.getBoundingClientRect(),this.emitUpdate(this.state))}),this.editor=t,this.sideMenuDetection=n,this.pmView=o,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized side menu");r(this.state)},this.pmView.root.addEventListener("dragstart",this.onDragStart),this.pmView.root.addEventListener("dragover",this.onDragOver),this.pmView.root.addEventListener("drop",this.onDrop,!0),this.pmView.root.addEventListener("dragend",this.onDragEnd,!0),wl(),this.pmView.root.addEventListener("mousemove",this.onMouseMove,!0),this.pmView.root.addEventListener("keydown",this.onKeyDown,!0),o.root.addEventListener("scroll",this.onScroll,!0)}createSyntheticEvent(t){const n=new Event(t.type,t),o=this.pmView.dom.firstChild.getBoundingClientRect();return n.clientX=t.clientX,n.clientY=t.clientY,t.clientX<o.left&&t.clientX>o.left-o.width*Sn?n.clientX=o.left+o.width*Sn/2:t.clientX>o.right&&t.clientX<o.right+o.width*Sn?n.clientX=o.right-o.width*Sn/2:(t.clientX<o.left||t.clientX>o.right)&&(n.clientX=o.left+Sn*o.width*2),n.clientY=Math.min(Math.max(t.clientY,o.top),o.top+o.height),n.dataTransfer=t.dataTransfer,n.preventDefault=()=>t.preventDefault(),n.synthetic=!0,n}update(t,n){var o;!n.doc.eq(this.pmView.state.doc)&&(o=this.state)!=null&&o.show&&this.updateStateFromMousePos()}destroy(){var t;(t=this.state)!=null&&t.show&&(this.state.show=!1,this.emitUpdate(this.state)),this.pmView.root.removeEventListener("mousemove",this.onMouseMove,!0),this.pmView.root.removeEventListener("dragstart",this.onDragStart),this.pmView.root.removeEventListener("dragover",this.onDragOver),this.pmView.root.removeEventListener("drop",this.onDrop,!0),this.pmView.root.removeEventListener("dragend",this.onDragEnd,!0),this.pmView.root.removeEventListener("keydown",this.onKeyDown,!0),this.pmView.root.removeEventListener("scroll",this.onScroll,!0)}}const Qv=new R("SideMenuPlugin");class Zv extends at{constructor(t,n){super(),w(this,"view"),w(this,"blockDragStart",(o,r)=>{this.view&&(this.view.isDragOrigin=!0),Jv(o,r,this.editor)}),w(this,"blockDragEnd",()=>{this.editor.prosemirrorView&&Gu(this.editor.prosemirrorView.root),this.view&&(this.view.isDragOrigin=!1)}),w(this,"freezeMenu",()=>{this.view.menuFrozen=!0,this.view.state.show=!0,this.view.emitUpdate(this.view.state)}),w(this,"unfreezeMenu",()=>{this.view.menuFrozen=!1,this.view.state.show=!1,this.view.emitUpdate(this.view.state)}),this.editor=t,this.addProsemirrorPlugin(new O({key:Qv,view:o=>(this.view=new Xv(t,n,o,r=>{this.emit("update",r)}),this.view)}))}static key(){return"sideMenu"}onUpdate(t){return this.on("update",t)}}const To=new Map;function tC(e){if(To.has(e))return To.get(e);const t=new vh;return e._tiptapEditor.on("transaction",({transaction:n})=>{t.appendMapping(n.mapping)}),e._tiptapEditor.on("destroy",()=>{To.delete(e)}),To.set(e,t),t}function eC(e,t,n="left"){const o=N.getState(e._tiptapEditor.state);if(!o){const s=tC(e),i=s.maps.length;return()=>s.slice(i).map(t,n==="left"?-1:1)}const r=Xn(t+(n==="right"?1:0),o.binding.type,o.binding.mapping);return()=>{const s=N.getState(e._tiptapEditor.state),i=Re(s.doc,s.binding.type,r,s.binding.mapping);if(i===null)throw new Error("Position not found, cannot track positions");return i+(n==="right"?-1:0)}}const nC=Nr(e=>e.type.name==="blockContainer");class oC{constructor(t,n){w(this,"state"),w(this,"emitUpdate"),w(this,"rootEl"),w(this,"pluginState"),w(this,"handleScroll",()=>{var s,i;if((s=this.state)!=null&&s.show){const l=(i=this.rootEl)==null?void 0:i.querySelector(`[data-decoration-id="${this.pluginState.decorationId}"]`);if(!l)return;this.state.referencePos=l.getBoundingClientRect(),this.emitUpdate(this.pluginState.triggerCharacter)}}),w(this,"closeMenu",()=>{this.editor.transact(s=>s.setMeta(rn,null))}),w(this,"clearQuery",()=>{this.pluginState!==void 0&&this.editor._tiptapEditor.chain().focus().deleteRange({from:this.pluginState.queryStartPos()-(this.pluginState.deleteTriggerCharacter?this.pluginState.triggerCharacter.length:0),to:this.editor.transact(s=>s.selection.from)}).run()});var o,r;this.editor=t,this.pluginState=void 0,this.emitUpdate=s=>{var i;if(!this.state)throw new Error("Attempting to update uninitialized suggestions menu");n(s,{...this.state,ignoreQueryLength:(i=this.pluginState)==null?void 0:i.ignoreQueryLength})},this.rootEl=(o=this.editor.prosemirrorView)==null?void 0:o.root,(r=this.rootEl)==null||r.addEventListener("scroll",this.handleScroll,!0)}update(t,n){var o;const r=rn.getState(n),s=rn.getState(t.state),i=r===void 0&&s!==void 0,l=r!==void 0&&s===void 0;if(!i&&!(r!==void 0&&s!==void 0)&&!l)return;if(this.pluginState=l?r:s,l||!this.editor.isEditable){this.state&&(this.state.show=!1),this.emitUpdate(this.pluginState.triggerCharacter);return}const a=(o=this.rootEl)==null?void 0:o.querySelector(`[data-decoration-id="${this.pluginState.decorationId}"]`);this.editor.isEditable&&a&&(this.state={show:!0,referencePos:a.getBoundingClientRect(),query:this.pluginState.query},this.emitUpdate(this.pluginState.triggerCharacter))}destroy(){var t;(t=this.rootEl)==null||t.removeEventListener("scroll",this.handleScroll,!0)}}const rn=new R("SuggestionMenuPlugin");class rC extends at{constructor(t){super(),w(this,"view"),w(this,"triggerCharacters",[]),w(this,"addTriggerCharacter",o=>{this.triggerCharacters.push(o)}),w(this,"removeTriggerCharacter",o=>{this.triggerCharacters=this.triggerCharacters.filter(r=>r!==o)}),w(this,"closeMenu",()=>this.view.closeMenu()),w(this,"clearQuery",()=>this.view.clearQuery());const n=this.triggerCharacters;this.addProsemirrorPlugin(new O({key:rn,view:()=>(this.view=new oC(t,(o,r)=>{this.emit(`update ${o}`,r)}),this.view),state:{init(){},apply:(o,r,s,i)=>{if(o.getMeta("orderedListIndexing")!==void 0||o.selection.$from.parent.type.spec.code)return r;const l=o.getMeta(rn);if(typeof l=="object"&&l!==null){r&&this.closeMenu();const c=eC(t,i.selection.from-l.triggerCharacter.length);return{triggerCharacter:l.triggerCharacter,deleteTriggerCharacter:l.deleteTriggerCharacter!==!1,queryStartPos:()=>c()+l.triggerCharacter.length,query:"",decorationId:`id_${Math.floor(Math.random()*4294967295)}`,ignoreQueryLength:l==null?void 0:l.ignoreQueryLength}}if(r===void 0)return r;if(i.selection.from!==i.selection.to||l===null||o.getMeta("focus")||o.getMeta("blur")||o.getMeta("pointer")||r.triggerCharacter!==void 0&&i.selection.from<r.queryStartPos()||!i.selection.$from.sameParent(i.doc.resolve(r.queryStartPos())))return;const a={...r};return a.query=i.doc.textBetween(r.queryStartPos(),i.selection.from),a}},props:{handleTextInput(o,r,s,i){return n.includes(i)?(o.dispatch(o.state.tr.insertText(i)),o.dispatch(o.state.tr.setMeta(rn,{triggerCharacter:i}).scrollIntoView()),!0):!1},decorations(o){const r=this.getState(o);if(r===void 0)return null;if(!r.deleteTriggerCharacter){const s=nC(o.selection);if(s)return tt.create(o.doc,[it.node(s.pos,s.pos+s.node.nodeSize,{nodeName:"span",class:"bn-suggestion-decorator","data-decoration-id":r.decorationId})])}return tt.create(o.doc,[it.inline(r.queryStartPos()-r.triggerCharacter.length,r.queryStartPos(),{nodeName:"span",class:"bn-suggestion-decorator","data-decoration-id":r.decorationId})])}}}))}static key(){return"suggestionMenu"}onUpdate(t,n){return this.triggerCharacters.includes(t)||this.addTriggerCharacter(t),this.on(`update ${t}`,n)}get shown(){var t,n;return((n=(t=this.view)==null?void 0:t.state)==null?void 0:n.show)||!1}}const sC=lt.create({name:"insertion",inclusive:!1,excludes:"deletion modification insertion",addAttributes(){return{id:{default:null,validate:"number"}}},extendMarkSchema(e){return e.name!=="insertion"?{}:{blocknoteIgnore:!0,inclusive:!1,toDOM(t,n){return["ins",{"data-id":String(t.attrs.id),"data-inline":String(n),...!n&&{style:"display: contents"}},0]},parseDOM:[{tag:"ins",getAttrs(t){return t.dataset.id?{id:parseInt(t.dataset.id,10)}:!1}}]}}}),iC=lt.create({name:"deletion",inclusive:!1,excludes:"insertion modification deletion",addAttributes(){return{id:{default:null,validate:"number"}}},extendMarkSchema(e){return e.name!=="deletion"?{}:{blocknoteIgnore:!0,inclusive:!1,toDOM(t,n){return["del",{"data-id":String(t.attrs.id),"data-inline":String(n),...!n&&{style:"display: contents"}},0]},parseDOM:[{tag:"del",getAttrs(t){return t.dataset.id?{id:parseInt(t.dataset.id,10)}:!1}}]}}}),lC=lt.create({name:"modification",inclusive:!1,excludes:"deletion insertion",addAttributes(){return{id:{default:null,validate:"number"},type:{validate:"string"},attrName:{default:null,validate:"string|null"},previousValue:{default:null},newValue:{default:null}}},extendMarkSchema(e){return e.name!=="modification"?{}:{blocknoteIgnore:!0,inclusive:!1,toDOM(t,n){return[n?"span":"div",{"data-type":"modification","data-id":String(t.attrs.id),"data-mod-type":t.attrs.type,"data-mod-prev-val":JSON.stringify(t.attrs.previousValue),"data-mod-new-val":JSON.stringify(t.attrs.newValue)},0]},parseDOM:[{tag:"span[data-type='modification']",getAttrs(t){return t.dataset.id?{id:parseInt(t.dataset.id,10),type:t.dataset.modType,previousValue:t.dataset.modPrevVal,newValue:t.dataset.modNewVal}:!1}},{tag:"div[data-type='modification']",getAttrs(t){return t.dataset.id?{id:parseInt(t.dataset.id,10),type:t.dataset.modType,previousValue:t.dataset.modPrevVal}:!1}}]}}});let mt;function Ja(e){mt||(mt=document.createElement("div"),mt.innerHTML="_",mt.style.opacity="0",mt.style.height="1px",mt.style.width="1px",e instanceof Document?e.body.appendChild(mt):e.appendChild(mt))}function aC(e){mt&&(e instanceof Document?e.body.removeChild(mt):e.removeChild(mt),mt=void 0)}function _o(e){return Array.prototype.indexOf.call(e.parentElement.childNodes,e)}function cC(e){let t=e;for(;t&&t.nodeName!=="TD"&&t.nodeName!=="TH"&&!t.classList.contains("tableWrapper");){if(t.classList.contains("ProseMirror"))return;const n=t.parentNode;if(!n||!(n instanceof Element))return;t=n}return t.nodeName==="TD"||t.nodeName==="TH"?{type:"cell",domNode:t,tbodyNode:t.closest("tbody")}:{type:"wrapper",domNode:t,tbodyNode:t.querySelector("tbody")}}function dC(e,t){const n=t.querySelectorAll(e);for(let o=0;o<n.length;o++)n[o].style.visibility="hidden"}class uC{constructor(t,n,o){w(this,"state"),w(this,"emitUpdate"),w(this,"tableId"),w(this,"tablePos"),w(this,"tableElement"),w(this,"menuFrozen",!1),w(this,"mouseState","up"),w(this,"prevWasEditable",null),w(this,"viewMousedownHandler",()=>{this.mouseState="down"}),w(this,"mouseUpHandler",r=>{this.mouseState="up",this.mouseMoveHandler(r)}),w(this,"mouseMoveHandler",r=>{var s,i,l,a,c,d,u;if(this.menuFrozen||this.mouseState==="selecting"||!(r.target instanceof Element)||!this.pmView.dom.contains(r.target))return;const h=cC(r.target);if((h==null?void 0:h.type)==="cell"&&this.mouseState==="down"&&!((s=this.state)!=null&&s.draggingState)){this.mouseState="selecting",(i=this.state)!=null&&i.show&&(this.state.show=!1,this.state.showAddOrRemoveRowsButton=!1,this.state.showAddOrRemoveColumnsButton=!1,this.emitUpdate());return}if(!h||!this.editor.isEditable){(l=this.state)!=null&&l.show&&(this.state.show=!1,this.state.showAddOrRemoveRowsButton=!1,this.state.showAddOrRemoveColumnsButton=!1,this.emitUpdate());return}if(!h.tbodyNode)return;const f=h.tbodyNode.getBoundingClientRect(),p=Wu(h.domNode,this.pmView);if(!p)return;this.tableElement=p.node;let m;const g=this.editor.transact(v=>Et(p.id,v.doc));if(!g)throw new Error(`Block with ID ${p.id} not found`);const b=W(g.node,this.editor.pmSchema,this.editor.schema.blockSchema,this.editor.schema.inlineContentSchema,this.editor.schema.styleSchema);if(k0("table",b,this.editor)&&(this.tablePos=g.posBeforeNode+1,m=b),!m)return;this.tableId=p.id;const k=(a=h.domNode.closest(".tableWrapper"))==null?void 0:a.querySelector(".table-widgets-container");if((h==null?void 0:h.type)==="wrapper"){const v=r.clientY>=f.bottom-1&&r.clientY<f.bottom+20,x=r.clientX>=f.right-1&&r.clientX<f.right+20,C=r.clientX>f.right||r.clientY>f.bottom;this.state={...this.state,show:!0,showAddOrRemoveRowsButton:v,showAddOrRemoveColumnsButton:x,referencePosTable:f,block:m,widgetContainer:k,colIndex:C||(c=this.state)==null?void 0:c.colIndex,rowIndex:C||(d=this.state)==null?void 0:d.rowIndex,referencePosCell:C||(u=this.state)==null?void 0:u.referencePosCell}}else{const v=_o(h.domNode),x=_o(h.domNode.parentElement),C=h.domNode.getBoundingClientRect();if(this.state!==void 0&&this.state.show&&this.tableId===p.id&&this.state.rowIndex===x&&this.state.colIndex===v)return;this.state={show:!0,showAddOrRemoveColumnsButton:v===m.content.rows[0].cells.length-1,showAddOrRemoveRowsButton:x===m.content.rows.length-1,referencePosTable:f,block:m,draggingState:void 0,referencePosCell:C,colIndex:v,rowIndex:x,widgetContainer:k}}return this.emitUpdate(),!1}),w(this,"dragOverHandler",r=>{var s;if(((s=this.state)==null?void 0:s.draggingState)===void 0)return;r.preventDefault(),r.dataTransfer.dropEffect="move",dC(".prosemirror-dropcursor-block, .prosemirror-dropcursor-inline",this.pmView.root);const i={left:Math.min(Math.max(r.clientX,this.state.referencePosTable.left+1),this.state.referencePosTable.right-1),top:Math.min(Math.max(r.clientY,this.state.referencePosTable.top+1),this.state.referencePosTable.bottom-1)},l=this.pmView.root.elementsFromPoint(i.left,i.top).filter(m=>m.tagName==="TD"||m.tagName==="TH");if(l.length===0)return;const a=l[0];let c=!1;const d=_o(a.parentElement),u=_o(a),h=this.state.draggingState.draggedCellOrientation==="row"?this.state.rowIndex:this.state.colIndex,f=(this.state.draggingState.draggedCellOrientation==="row"?d:u)!==h;(this.state.rowIndex!==d||this.state.colIndex!==u)&&(this.state.rowIndex=d,this.state.colIndex=u,this.state.referencePosCell=a.getBoundingClientRect(),c=!0);const p=this.state.draggingState.draggedCellOrientation==="row"?i.top:i.left;this.state.draggingState.mousePos!==p&&(this.state.draggingState.mousePos=p,c=!0),c&&this.emitUpdate(),f&&this.editor.transact(m=>m.setMeta(An,!0))}),w(this,"dropHandler",r=>{if(this.mouseState="up",this.state===void 0||this.state.draggingState===void 0)return!1;if(this.state.rowIndex===void 0||this.state.colIndex===void 0)throw new Error("Attempted to drop table row or column, but no table block was hovered prior.");r.preventDefault();const{draggingState:s,colIndex:i,rowIndex:l}=this.state,a=this.state.block.content.columnWidths;if(s.draggedCellOrientation==="row"){if(!du(this.state.block,s.originalIndex,l))return!1;const c=qk(this.state.block,s.originalIndex,l);this.editor.updateBlock(this.state.block,{type:"table",content:{...this.state.block.content,rows:c}})}else{if(!uu(this.state.block,s.originalIndex,i))return!1;const c=Kk(this.state.block,s.originalIndex,i),[d]=a.splice(s.originalIndex,1);a.splice(i,0,d),this.editor.updateBlock(this.state.block,{type:"table",content:{...this.state.block.content,columnWidths:a,rows:c}})}return this.editor.setTextCursorPosition(this.state.block.id),!0}),this.editor=t,this.pmView=n,this.emitUpdate=()=>{if(!this.state)throw new Error("Attempting to update uninitialized image toolbar");o(this.state)},n.dom.addEventListener("mousemove",this.mouseMoveHandler),n.dom.addEventListener("mousedown",this.viewMousedownHandler),window.addEventListener("mouseup",this.mouseUpHandler),n.root.addEventListener("dragover",this.dragOverHandler),n.root.addEventListener("drop",this.dropHandler)}update(){var t;if(!this.state||!this.state.show)return;if(this.state.block=this.editor.getBlock(this.state.block.id),!this.state.block||this.state.block.type!=="table"||!((t=this.tableElement)!=null&&t.isConnected)){this.state.show=!1,this.state.showAddOrRemoveRowsButton=!1,this.state.showAddOrRemoveColumnsButton=!1,this.emitUpdate();return}const{height:n,width:o}=fl(this.state.block);this.state.rowIndex!==void 0&&this.state.colIndex!==void 0&&(this.state.rowIndex>=n&&(this.state.rowIndex=n-1),this.state.colIndex>=o&&(this.state.colIndex=o-1));const r=this.tableElement.querySelector("tbody");if(!r)throw new Error("Table block does not contain a 'tbody' HTML element. This should never happen.");if(this.state.rowIndex!==void 0&&this.state.colIndex!==void 0){const s=r.children[this.state.rowIndex].children[this.state.colIndex];s?this.state.referencePosCell=s.getBoundingClientRect():(this.state.rowIndex=void 0,this.state.colIndex=void 0)}this.state.referencePosTable=r.getBoundingClientRect(),this.emitUpdate()}destroy(){this.pmView.dom.removeEventListener("mousemove",this.mouseMoveHandler),window.removeEventListener("mouseup",this.mouseUpHandler),this.pmView.dom.removeEventListener("mousedown",this.viewMousedownHandler),this.pmView.root.removeEventListener("dragover",this.dragOverHandler),this.pmView.root.removeEventListener("drop",this.dropHandler)}}const An=new R("TableHandlesPlugin");class hC extends at{constructor(t){super(),w(this,"view"),w(this,"colDragStart",n=>{if(this.view.state===void 0||this.view.state.colIndex===void 0)throw new Error("Attempted to drag table column, but no table block was hovered prior.");if(this.view.state.draggingState={draggedCellOrientation:"col",originalIndex:this.view.state.colIndex,mousePos:n.clientX},this.view.emitUpdate(),this.editor.transact(o=>o.setMeta(An,{draggedCellOrientation:this.view.state.draggingState.draggedCellOrientation,originalIndex:this.view.state.colIndex,newIndex:this.view.state.colIndex,tablePos:this.view.tablePos})),!this.editor.prosemirrorView)throw new Error("Editor view not initialized.");Ja(this.editor.prosemirrorView.root),n.dataTransfer.setDragImage(mt,0,0),n.dataTransfer.effectAllowed="move"}),w(this,"rowDragStart",n=>{if(this.view.state===void 0||this.view.state.rowIndex===void 0)throw new Error("Attempted to drag table row, but no table block was hovered prior.");if(this.view.state.draggingState={draggedCellOrientation:"row",originalIndex:this.view.state.rowIndex,mousePos:n.clientY},this.view.emitUpdate(),this.editor.transact(o=>o.setMeta(An,{draggedCellOrientation:this.view.state.draggingState.draggedCellOrientation,originalIndex:this.view.state.rowIndex,newIndex:this.view.state.rowIndex,tablePos:this.view.tablePos})),!this.editor.prosemirrorView)throw new Error("Editor view not initialized.");Ja(this.editor.prosemirrorView.root),n.dataTransfer.setDragImage(mt,0,0),n.dataTransfer.effectAllowed="copyMove"}),w(this,"dragEnd",()=>{if(this.view.state===void 0)throw new Error("Attempted to drag table row, but no table block was hovered prior.");if(this.view.state.draggingState=void 0,this.view.emitUpdate(),this.editor.transact(n=>n.setMeta(An,null)),!this.editor.prosemirrorView)throw new Error("Editor view not initialized.");aC(this.editor.prosemirrorView.root)}),w(this,"freezeHandles",()=>{this.view.menuFrozen=!0}),w(this,"unfreezeHandles",()=>{this.view.menuFrozen=!1}),w(this,"getCellsAtRowHandle",(n,o)=>di(n,o)),w(this,"getCellsAtColumnHandle",(n,o)=>ui(n,o)),w(this,"setCellSelection",(n,o,r=o)=>{const s=this.view;if(!s)throw new Error("Table handles view not initialized");const i=n.doc.resolve(s.tablePos+1),l=n.doc.resolve(i.posAtIndex(o.row)+1),a=n.doc.resolve(l.posAtIndex(o.col)),c=n.doc.resolve(i.posAtIndex(r.row)+1),d=n.doc.resolve(c.posAtIndex(r.col)),u=n.tr;return u.setSelection(new U(a,d)),n.apply(u)}),w(this,"addRowOrColumn",(n,o)=>{this.editor.exec((r,s)=>{const i=this.setCellSelection(r,o.orientation==="row"?{row:n,col:0}:{row:0,col:n});return o.orientation==="row"?o.side==="above"?Qp(i,s):Zp(i,s):o.side==="left"?Kp(i,s):qp(i,s)})}),w(this,"removeRowOrColumn",(n,o)=>o==="row"?this.editor.exec((r,s)=>{const i=this.setCellSelection(r,{row:n,col:0});return em(i,s)}):this.editor.exec((r,s)=>{const i=this.setCellSelection(r,{row:0,col:n});return Yp(i,s)})),w(this,"mergeCells",n=>this.editor.exec((o,r)=>{const s=n?this.setCellSelection(o,n.relativeStartCell,n.relativeEndCell):o;return om(s,r)})),w(this,"splitCell",n=>this.editor.exec((o,r)=>{const s=n?this.setCellSelection(o,n):o;return rm(s,r)})),w(this,"getCellSelection",()=>this.editor.transact(n=>{const o=n.selection;let r=o.$from,s=o.$to;if(Ua(o)){const{ranges:p}=o;p.forEach(m=>{r=m.$from.min(r??m.$from),s=m.$to.max(s??m.$to)})}else if(r=n.doc.resolve(o.$from.pos-o.$from.parentOffset-1),s=n.doc.resolve(o.$to.pos-o.$to.parentOffset-1),r.pos===0||s.pos===0)return;const i=n.doc.resolve(r.pos-r.parentOffset-1),l=n.doc.resolve(s.pos-s.parentOffset-1),a=n.doc.resolve(i.pos-i.parentOffset-1),c=r.index(i.depth),d=i.index(a.depth),u=s.index(l.depth),h=l.index(a.depth),f=[];for(let p=d;p<=h;p++)for(let m=c;m<=u;m++)f.push({row:p,col:m});return{from:{row:d,col:c},to:{row:h,col:u},cells:f}})),w(this,"getMergeDirection",n=>this.editor.transact(o=>{const r=Ua(o.selection)?o.selection:void 0;if(!r||!n||r.ranges.length<=1)return;const s=this.getCellSelection();if(s)return Xk(s.from,s.to,n)?"vertical":"horizontal"})),w(this,"cropEmptyRowsOrColumns",(n,o)=>Jk(n,o)),w(this,"addRowsOrColumns",(n,o,r)=>Yk(n,o,r)),this.editor=t,this.addProsemirrorPlugin(new O({key:An,view:n=>(this.view=new uC(t,n,o=>{this.emit("update",o)}),this.view),props:{decorations:n=>{if(this.view===void 0||this.view.state===void 0||this.view.state.draggingState===void 0||this.view.tablePos===void 0)return;const o=this.view.state.draggingState.draggedCellOrientation==="row"?this.view.state.rowIndex:this.view.state.colIndex;if(o===void 0)return;const r=[],{block:s,draggingState:i}=this.view.state,{originalIndex:l,draggedCellOrientation:a}=i;if(o===l||!s||a==="row"&&!du(s,l,o)||a==="col"&&!uu(s,l,o))return tt.create(n.doc,r);const c=n.doc.resolve(this.view.tablePos+1);return this.view.state.draggingState.draggedCellOrientation==="row"?di(this.view.state.block,o).forEach(({row:d,col:u})=>{const h=n.doc.resolve(c.posAtIndex(d)+1),f=n.doc.resolve(h.posAtIndex(u)+1),p=f.node(),m=f.pos+(o>l?p.nodeSize-2:0);r.push(it.widget(m,()=>{const g=document.createElement("div");return g.className="bn-table-drop-cursor",g.style.left="0",g.style.right="0",o>l?g.style.bottom="-2px":g.style.top="-3px",g.style.height="4px",g}))}):ui(this.view.state.block,o).forEach(({row:d,col:u})=>{const h=n.doc.resolve(c.posAtIndex(d)+1),f=n.doc.resolve(h.posAtIndex(u)+1),p=f.node(),m=f.pos+(o>l?p.nodeSize-2:0);r.push(it.widget(m,()=>{const g=document.createElement("div");return g.className="bn-table-drop-cursor",g.style.top="0",g.style.bottom="0",o>l?g.style.right="-2px":g.style.left="-3px",g.style.width="4px",g}))}),tt.create(n.doc,r)}}}))}static key(){return"tableHandles"}onUpdate(t){return this.on("update",t)}}const fC=$.create({name:"textAlignment",addGlobalAttributes(){return[{types:["paragraph","heading","bulletListItem","numberedListItem","checkListItem","tableCell","tableHeader"],attributes:{textAlignment:{default:"left",parseHTML:e=>e.getAttribute("data-text-alignment"),renderHTML:e=>e.textAlignment==="left"?{}:{"data-text-alignment":e.textAlignment}}}}]}}),pC=$.create({name:"blockTextColor",addGlobalAttributes(){return[{types:["blockContainer","tableCell","tableHeader"],attributes:{textColor:{default:X.textColor.default,parseHTML:e=>e.hasAttribute("data-text-color")?e.getAttribute("data-text-color"):X.textColor.default,renderHTML:e=>e.textColor===X.textColor.default?{}:{"data-text-color":e.textColor}}}}]}}),mC=$.create({name:"trailingNode",addProseMirrorPlugins(){const e=new R(this.name);return[new O({key:e,appendTransaction:(t,n,o)=>{const{doc:r,tr:s,schema:i}=o,l=e.getState(o),a=r.content.size-2,c=i.nodes.blockContainer,d=i.nodes.paragraph;if(l)return s.insert(a,c.create(void 0,d.create()))},state:{init:(t,n)=>{},apply:(t,n)=>{if(!t.docChanged)return n;let o=t.doc.lastChild;if(!o||o.type.name!=="blockGroup")throw new Error("Expected blockGroup");if(o=o.lastChild,!o||o.type.name!=="blockContainer")return!0;const r=o.firstChild;if(!r)throw new Error("Expected blockContent");return o.nodeSize>4||r.type.spec.content!=="inline*"}}})]}}),gC={blockColor:"data-block-color",blockStyle:"data-block-style",id:"data-id",depth:"data-depth",depthChange:"data-depth-change"},bC=qt.create({name:"blockContainer",group:"blockGroupChild bnBlock",content:"blockContent blockGroup?",priority:50,defining:!0,marks:"insertion modification deletion",parseHTML(){return[{tag:"div[data-node-type="+this.name+"]",getAttrs:e=>{if(typeof e=="string")return!1;const t={};for(const[n,o]of Object.entries(gC))e.getAttribute(o)&&(t[n]=e.getAttribute(o));return t}},{tag:'div[data-node-type="blockOuter"]',skip:!0}]},renderHTML({HTMLAttributes:e}){var t;const n=document.createElement("div");n.className="bn-block-outer",n.setAttribute("data-node-type","blockOuter");for(const[s,i]of Object.entries(e))s!=="class"&&n.setAttribute(s,i);const o={...((t=this.options.domAttributes)==null?void 0:t.block)||{},...e},r=document.createElement("div");r.className=ve("bn-block",o.class),r.setAttribute("data-node-type",this.name);for(const[s,i]of Object.entries(o))s!=="class"&&r.setAttribute(s,i);return n.appendChild(r),{dom:n,contentDOM:r}}}),wC=qt.create({name:"blockGroup",group:"childContainer",content:"blockGroupChild+",marks:"deletion insertion modification",parseHTML(){return[{tag:"div",getAttrs:e=>typeof e=="string"?!1:e.getAttribute("data-node-type")==="blockGroup"?null:!1}]},renderHTML({HTMLAttributes:e}){var t;const n={...((t=this.options.domAttributes)==null?void 0:t.blockGroup)||{},...e},o=document.createElement("div");o.className=ve("bn-block-group",n.class),o.setAttribute("data-node-type","blockGroup");for(const[r,s]of Object.entries(n))r!=="class"&&o.setAttribute(r,s);return{dom:o,contentDOM:o}}}),kC=qt.create({name:"doc",topNode:!0,content:"blockGroup",marks:"insertion modification deletion"});class yC extends at{constructor({editor:t,collaboration:n}){super(t),w(this,"editor"),w(this,"collaboration"),w(this,"forkedState"),this.editor=t,this.collaboration=n}static key(){return"ForkYDocPlugin"}findTypeInOtherYdoc(t,n){const o=t.doc;if(t._item===null){const r=Array.from(o.share.keys()).find(s=>o.share.get(s)===t);if(r==null)throw new Error("type does not exist in other ydoc");return n.get(r,t.constructor)}else{const r=t._item,s=n.store.clients.get(r.id.client)??[],i=Ot(s,r.id.clock);return s[i].content.type}}get isForkedFromRemote(){return this.forkedState!==void 0}fork(){if(this.isForkedFromRemote)return;const t=this.collaboration.fragment;if(!t)throw new Error("No fragment to fork from");const n=new Ee;ca(n,da(t.doc));const o=this.findTypeInOtherYdoc(t,n);this.forkedState={originalFragment:t,forkedFragment:o},this.editor._tiptapEditor.unregisterPlugin([xn,jt,N]),this.editor._tiptapEditor.registerPlugin(new gi(o).plugins[0]),this.editor._tiptapEditor.registerPlugin(new bi().plugins[0]),this.emit("forked",!0)}merge({keepChanges:t}){if(!this.forkedState)return;this.editor._tiptapEditor.unregisterPlugin(N),this.editor._tiptapEditor.unregisterPlugin(jt);const{originalFragment:n,forkedFragment:o}=this.forkedState;if(t){const r=da(o.doc);ca(n.doc,r)}this.editor.extensions.ySyncPlugin=new gi(n),this.editor.extensions.yCursorPlugin=new Fu(this.collaboration),this.editor.extensions.yUndoPlugin=new bi,this.editor._tiptapEditor.registerPlugin(this.editor.extensions.ySyncPlugin.plugins[0]),this.editor._tiptapEditor.registerPlugin(this.editor.extensions.yCursorPlugin.plugins[0]),this.editor._tiptapEditor.registerPlugin(this.editor.extensions.yUndoPlugin.plugins[0]),this.forkedState=void 0,this.emit("forked",!1)}}const vC=e=>{var t;const n={},o=CC(e);for(const s of o)n[s.name]=s;e.collaboration&&(n.ySyncPlugin=new gi(e.collaboration.fragment),n.yUndoPlugin=new bi,(t=e.collaboration.provider)!=null&&t.awareness&&(n.yCursorPlugin=new Fu(e.collaboration)),n.forkYDocPlugin=new yC({editor:e.editor,collaboration:e.collaboration})),n.formattingToolbar=new Iv(e.editor),n.linkToolbar=new Hv(e.editor),n.sideMenu=new Zv(e.editor,e.sideMenuDetection),n.suggestionMenus=new rC(e.editor),n.filePanel=new Tv(e.editor),n.placeholder=new jv(e.editor,e.placeholders),(e.animations??!0)&&(n.animations=new Gv),e.tableHandles&&(n.tableHandles=new hC(e.editor)),n.nodeSelectionKeyboard=new Fv,n.showSelection=new Kv(e.editor),e.comments&&(n.comments=new Av(e.editor,e.comments.threadStore,zu.name));const r=e.disableExtensions||[];for(const s of r)delete n[s];return n};let Ya=!1;const CC=e=>{const t=[vn.ClipboardTextSerializer,vn.Commands,vn.Editable,vn.FocusEvents,vn.Tabindex,Bm,$.create({name:"dropCursor",addProseMirrorPlugins:()=>[e.dropCursor({width:5,color:"#ddeeff",editor:e.editor})]}),Kr.configure({types:["blockContainer","columnList","column"],setIdAttribute:e.setIdAttribute}),Pv,sg,sC,iC,lC,rg.extend({inclusive:!1}).configure({defaultProtocol:Vv,protocols:Ya?[]:Uv}),...Object.values(e.styleSpecs).map(n=>n.implementation.mark.configure({editor:e.editor})),pC,Cv,fC,$.create({name:"OverrideEscape",addKeyboardShortcuts(){return{Escape:()=>e.editor.suggestionMenus.shown?!1:this.editor.commands.blur()}}}),kC,bC.configure({editor:e.editor,domAttributes:e.domAttributes}),Dv.configure({editor:e.editor,tabBehavior:e.tabBehavior}),wC.configure({domAttributes:e.domAttributes}),...Object.values(e.inlineContentSpecs).filter(n=>n.config!=="link"&&n.config!=="text").map(n=>n.implementation.node.configure({editor:e.editor})),...Object.values(e.blockSpecs).flatMap(n=>[...(n.implementation.requiredExtensions||[]).map(o=>o.configure({editor:e.editor,domAttributes:e.domAttributes})),n.implementation.node.configure({editor:e.editor,domAttributes:e.domAttributes})]),vv(e.editor),kv(e.editor,e.pasteHandler||(n=>n.defaultPasteHandler())),nv(e.editor),...e.trailingBlock===void 0||e.trailingBlock?[mC]:[],...e.comments?[zu]:[]];return Ya=!0,e.collaboration||t.push(Dm),t};function SC(e,t){const n=[];return e.forEach((o,r,s)=>{s!==t&&n.push(o)}),I.from(n)}function EC(e,t){const n=[];for(let o=0;o<e.childCount;o++)if(e.child(o).type.name==="tableRow")if(n.length>0&&n[n.length-1].type.name==="table"){const r=n[n.length-1],s=r.copy(r.content.addToEnd(e.child(o)));n[n.length-1]=s}else{const r=t.nodes.table.createChecked(void 0,e.child(o));n.push(r)}else n.push(e.child(o));return e=I.from(n),e}function xC(e,t){let n=I.from(e.content);if(n=EC(n,t.state.schema),!AC(n,t))return new K(n,e.openStart,e.openEnd);for(let o=0;o<n.childCount;o++)if(n.child(o).type.spec.group==="blockContent"){const r=[n.child(o)];if(o+1<n.childCount&&n.child(o+1).type.name==="blockGroup"){const i=n.child(o+1).child(0).child(0);(i.type.name==="bulletListItem"||i.type.name==="numberedListItem"||i.type.name==="checkListItem")&&(r.push(n.child(o+1)),n=SC(n,o+1))}const s=t.state.schema.nodes.blockContainer.createChecked(void 0,r);n=n.replaceChild(o,s)}return new K(n,e.openStart,e.openEnd)}function AC(e,t){var n,o;const r=e.childCount===1,s=((n=e.firstChild)==null?void 0:n.type.spec.content)==="inline*",i=((o=e.firstChild)==null?void 0:o.type.spec.content)==="tableRow+";if(r){if(s)return!1;if(i){const l=F(t.state);if(l.isBlockContainer)return l.blockContent.node.type.spec.content!=="tableRow+"}}return!0}const ki=class extends np{constructor(t,n){super({...t,content:void 0}),w(this,"_state"),w(this,"mount",(l,a,c)=>{a?(this.options.element=a,this.createViewAlternative(l,c)):this.destroy()});const o=this.schema;let r;const s=o.nodes.doc.createAndFill;o.nodes.doc.createAndFill=(...l)=>{if(r)return r;const a=s.apply(o.nodes.doc,l),c=JSON.parse(JSON.stringify(a.toJSON()));return c.content[0].content[0].attrs.id="initialBlockId",r=ec.fromJSON(o,c),r};let i;try{const l=t==null?void 0:t.content.map(a=>qe(a,this.schema,n).toJSON());i=jo({type:"doc",content:[{type:"blockGroup",content:l}]},this.schema,this.options.parseOptions)}catch(l){throw console.error("Error creating document from blocks passed as `initialContent`. Caused by exception: ",l),new Error("Error creating document from blocks passed as `initialContent`:\n"+ +JSON.stringify(t.content))}this._state=tc.create({doc:i,schema:this.schema})}get state(){return this.view&&(this._state=this.view.state),this._state}dispatch(t){if(!this.view){this._state=this.state.apply(t),this.emit("transaction",{editor:this,transaction:t});return}if(this.view.isDestroyed)return;if(this.isCapturingTransaction){this.dispatchTransaction(t);return}const{state:n,transactions:o}=this.state.applyTransaction(t),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:t}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=t.getMeta("focus"),i=t.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:t}),i&&this.emit("blur",{editor:this,event:i.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&(this.emit("update",{editor:this,transaction:t}),this.emit("v3-update",{editor:this,transaction:t,appendedTransactions:o.slice(1)}))}forceEnablePlugins(){if(this.view)throw new Error("forcePluginsEnabled called after view has been initialized");this._state=this.state.reconfigure({plugins:this.extensionManager.plugins})}createViewAlternative(t,n){this.contentComponent=n;const o={};this.extensionManager.extensions.forEach(s=>{s.type==="mark"&&s.config.addMarkView&&(o[s.name]=s.config.addMarkView(t))}),this.view=new Za({mount:this.options.element},{...this.options.editorProps,dispatchTransaction:this.dispatch.bind(this),state:this.state,markViews:o,nodeViews:this.extensionManager.nodeViews});const r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.commands.focus(this.options.autofocus||this.options.element.getAttribute("data-bn-autofocus")==="true",{scrollIntoView:!1}),this.emit("create",{editor:this}),this.isInitialized=!0}};w(ki,"create",(e,t)=>{var n,o;const r=(n=globalThis==null?void 0:globalThis.window)==null?void 0:n.setTimeout;typeof((o=globalThis==null?void 0:globalThis.window)==null?void 0:o.setTimeout)<"u"&&(globalThis.window.setTimeout=()=>0);try{return new ki(e,t)}finally{r&&(globalThis.window.setTimeout=r)}});let Ku=ki;Ku.prototype.createView=function(){this.options.onPaste=this.options.onDrop=void 0};const MC={enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!1};class qu extends vl{constructor(t){var n,o,r,s,i,l,a,c,d,u,h,f,p,m,g;super(),w(this,"pmSchema"),w(this,"extensions",{}),w(this,"headless",!1),w(this,"_tiptapEditor"),w(this,"elementRenderer",null),w(this,"blockCache",new WeakMap),w(this,"dictionary"),w(this,"schema"),w(this,"blockImplementations"),w(this,"inlineContentImplementations"),w(this,"styleImplementations"),w(this,"formattingToolbar"),w(this,"linkToolbar"),w(this,"sideMenu"),w(this,"suggestionMenus"),w(this,"filePanel"),w(this,"tableHandles"),w(this,"comments"),w(this,"showSelectionPlugin"),w(this,"forkYDocPlugin"),w(this,"uploadFile"),w(this,"onUploadStartCallbacks",[]),w(this,"onUploadEndCallbacks",[]),w(this,"resolveFileUrl"),w(this,"resolveUsers"),w(this,"settings"),w(this,"activeTransaction",null),w(this,"mount",(E,A)=>{this._tiptapEditor.mount(this,E,A)}),this.options=t;const b=t;if(b.onEditorContentChange)throw new Error("onEditorContentChange initialization option is deprecated, use <BlockNoteView onChange={...} />, the useEditorChange(...) hook, or editor.onChange(...)");if(b.onTextCursorPositionChange)throw new Error("onTextCursorPositionChange initialization option is deprecated, use <BlockNoteView onSelectionChange={...} />, the useEditorSelectionChange(...) hook, or editor.onSelectionChange(...)");if(b.onEditorReady)throw new Error("onEditorReady is deprecated. Editor is immediately ready for use after creation.");if(b.editable)throw new Error("editable initialization option is deprecated, use <BlockNoteView editable={true/false} />, or alternatively editor.isEditable = true/false");this.dictionary=t.dictionary||Bk,this.settings={tables:{splitCells:((n=t==null?void 0:t.tables)==null?void 0:n.splitCells)??!1,cellBackgroundColor:((o=t==null?void 0:t.tables)==null?void 0:o.cellBackgroundColor)??!1,cellTextColor:((r=t==null?void 0:t.tables)==null?void 0:r.cellTextColor)??!1,headers:((s=t==null?void 0:t.tables)==null?void 0:s.headers)??!1},codeBlock:{indentLineWithTab:((i=t==null?void 0:t.codeBlock)==null?void 0:i.indentLineWithTab)??!0,defaultLanguage:((l=t==null?void 0:t.codeBlock)==null?void 0:l.defaultLanguage)??"text",supportedLanguages:((a=t==null?void 0:t.codeBlock)==null?void 0:a.supportedLanguages)??{},createHighlighter:((c=t==null?void 0:t.codeBlock)==null?void 0:c.createHighlighter)??void 0}};const k={defaultStyles:!0,schema:t.schema||es.create(),_headless:!1,...t,placeholders:{...this.dictionary.placeholders,...t.placeholders}};if(k.comments&&!k.resolveUsers)throw new Error("resolveUsers is required when using comments");this.resolveUsers=k.resolveUsers,this.schema=k.schema,this.blockImplementations=k.schema.blockSpecs,this.inlineContentImplementations=k.schema.inlineContentSpecs,this.styleImplementations=k.schema.styleSpecs,this.extensions=vC({editor:this,domAttributes:k.domAttributes||{},blockSpecs:this.schema.blockSpecs,styleSpecs:this.schema.styleSpecs,inlineContentSpecs:this.schema.inlineContentSpecs,collaboration:k.collaboration,trailingBlock:k.trailingBlock,disableExtensions:k.disableExtensions,setIdAttribute:k.setIdAttribute,animations:k.animations??!0,tableHandles:pt("table",this),dropCursor:this.options.dropCursor??Pk,placeholders:k.placeholders,tabBehavior:k.tabBehavior,sideMenuDetection:k.sideMenuDetection||"viewport",comments:k.comments,pasteHandler:k.pasteHandler}),(((d=k._tiptapOptions)==null?void 0:d.extensions)||[]).forEach(E=>{this.extensions[E.name]=E});for(let E of k.extensions||[]){typeof E=="function"&&(E=E(this));const A=E.constructor.key();if(!A)throw new Error(`Extension ${E.constructor.name} does not have a key method`);if(this.extensions[A])throw new Error(`Extension ${E.constructor.name} already exists with key ${A}`);this.extensions[A]=E}if(Object.entries(k._extensions||{}).forEach(([E,A])=>{const At=typeof A=="function"?A(this):A;if(!("plugin"in At)){this.extensions[E]=At;return}this.extensions[E]=new class extends at{static key(){return E}constructor(){super(),this.addProsemirrorPlugin(At.plugin)}get priority(){return At.priority}}}),this.formattingToolbar=this.extensions.formattingToolbar,this.linkToolbar=this.extensions.linkToolbar,this.sideMenu=this.extensions.sideMenu,this.suggestionMenus=this.extensions.suggestionMenus,this.filePanel=this.extensions.filePanel,this.tableHandles=this.extensions.tableHandles,this.comments=this.extensions.comments,this.showSelectionPlugin=this.extensions.showSelection,this.forkYDocPlugin=this.extensions.forkYDocPlugin,k.uploadFile){const E=k.uploadFile;this.uploadFile=async(A,At)=>{this.onUploadStartCallbacks.forEach(Me=>Me.apply(this,[At]));try{return await E(A,At)}finally{this.onUploadEndCallbacks.forEach(Me=>Me.apply(this,[At]))}}}this.resolveFileUrl=k.resolveFileUrl,this.headless=k._headless;const v="ySyncPlugin"in this.extensions||"liveblocksExtension"in this.extensions;v&&k.initialContent&&console.warn("When using Collaboration, initialContent might cause conflicts, because changes should come from the collaboration provider");const x=k.initialContent||(v?[{type:"paragraph",id:"initialBlockId"}]:[{type:"paragraph",id:Kr.options.generateID()}]);if(!Array.isArray(x)||x.length===0)throw new Error("initialContent must be a non-empty array of blocks, received: "+x);const C=[...Object.entries(this.extensions).map(([E,A])=>{if(A instanceof $||A instanceof qt||A instanceof lt)return A;if(!(A instanceof at&&!A.plugins.length))return $.create({name:E,priority:A.priority,addProseMirrorPlugins:()=>A.plugins})})].filter(E=>E!==void 0),M={...MC,...k._tiptapOptions,content:x,extensions:C,editorProps:{...(u=k._tiptapOptions)==null?void 0:u.editorProps,attributes:{tabIndex:"0",...(f=(h=k._tiptapOptions)==null?void 0:h.editorProps)==null?void 0:f.attributes,...(p=k.domAttributes)==null?void 0:p.editor,class:ve("bn-editor",k.defaultStyles?"bn-default-styles":"",((g=(m=k.domAttributes)==null?void 0:m.editor)==null?void 0:g.class)||"")},transformPasted:xC}};this.headless?this.pmSchema=Tf(M.extensions):(this._tiptapEditor=Ku.create(M,this.schema.styleSchema),this.pmSchema=this._tiptapEditor.schema),this.pmSchema.cached.blockNoteEditor=this,this.emit("create")}static create(t={}){return new qu(t)}exec(t){if(this.activeTransaction)throw new Error("`exec` should not be called within a `transact` call, move the `exec` call outside of the `transact` call");const n=this._tiptapEditor.state,o=this._tiptapEditor.view;return t(n,r=>this._tiptapEditor.dispatch(r),o)}canExec(t){if(this.activeTransaction)throw new Error("`canExec` should not be called within a `transact` call, move the `canExec` call outside of the `transact` call");const n=this._tiptapEditor.state,o=this._tiptapEditor.view;return t(n,void 0,o)}transact(t){if(this.activeTransaction)return t(this.activeTransaction);try{this.activeTransaction=this._tiptapEditor.state.tr;const n=t(this.activeTransaction),o=this.activeTransaction;return this.activeTransaction=null,o&&(o.docChanged||o.selectionSet||o.scrolledIntoView||o.storedMarksSet||!o.isGeneric)&&this._tiptapEditor.dispatch(o),n}finally{this.activeTransaction=null}}extension(t,n=t.key()){const o=this.extensions[n];if(!o)throw new Error(`Extension ${n} not found`);return o}get prosemirrorState(){if(this.activeTransaction)throw new Error("`prosemirrorState` should not be called within a `transact` call, move the `prosemirrorState` call outside of the `transact` call or use `editor.transact` to read the current editor state");return this._tiptapEditor.state}get prosemirrorView(){return this._tiptapEditor.view}get domElement(){var t;return(t=this.prosemirrorView)==null?void 0:t.dom}isFocused(){var t;return((t=this.prosemirrorView)==null?void 0:t.hasFocus())||!1}focus(){var t;(t=this.prosemirrorView)==null||t.focus()}onUploadStart(t){return this.onUploadStartCallbacks.push(t),()=>{const n=this.onUploadStartCallbacks.indexOf(t);n>-1&&this.onUploadStartCallbacks.splice(n,1)}}onUploadEnd(t){return this.onUploadEndCallbacks.push(t),()=>{const n=this.onUploadEndCallbacks.indexOf(t);n>-1&&this.onUploadEndCallbacks.splice(n,1)}}get topLevelBlocks(){return this.document}get document(){return this.transact(t=>jk(t.doc,this.pmSchema))}getBlock(t){return this.transact(n=>D0(n.doc,t))}getPrevBlock(t){return this.transact(n=>R0(n.doc,t))}getNextBlock(t){return this.transact(n=>N0(n.doc,t))}getParentBlock(t){return this.transact(n=>H0(n.doc,t))}forEachBlock(t,n=!1){const o=this.document.slice();n&&o.reverse();function r(s){for(const i of s){if(t(i)===!1)return!1;const l=n?i.children.slice().reverse():i.children;if(!r(l))return!1}return!0}r(o)}onEditorContentChange(t){this._tiptapEditor.on("update",t)}onEditorSelectionChange(t){this._tiptapEditor.on("selectionUpdate",t)}getTextCursorPosition(){return this.transact(t=>z0(t))}setTextCursorPosition(t,n="start"){return this.transact(o=>Ou(o,t,n))}getSelection(){return this.transact(t=>V0(t))}getSelectionCutBlocks(){return this.transact(t=>F0(t))}setSelection(t,n){return this.transact(o=>$0(o,t,n))}get isEditable(){if(!this._tiptapEditor){if(!this.headless)throw new Error("no editor, but also not headless?");return!1}return this._tiptapEditor.isEditable===void 0?!0:this._tiptapEditor.isEditable}set isEditable(t){if(!this._tiptapEditor){if(!this.headless)throw new Error("no editor, but also not headless?");return}this._tiptapEditor.options.editable!==t&&this._tiptapEditor.setEditable(t)}insertBlocks(t,n,o="before"){return this.transact(r=>ey(r,t,n,o))}updateBlock(t,n){return this.transact(o=>oy(o,t,n))}removeBlocks(t){return this.transact(n=>Ia(n,t,[]).removedBlocks)}replaceBlocks(t,n){return this.transact(o=>Ia(o,t,n))}undo(){return this.options.collaboration?this.exec(Mk):this.exec(lc)}redo(){return this.options.collaboration?this.exec(Tk):this.exec(ic)}insertInlineContent(t,{updateSelection:n=!1}={}){const o=Ut(t,this.pmSchema);this.transact(r=>{U0(r,{from:r.selection.from,to:r.selection.to},o,{updateSelection:n})})}getActiveStyles(){return this.transact(t=>{const n={},o=t.selection.$to.marks();for(const r of o){const s=this.schema.styleSchema[r.type.name];if(!s){r.type.name!=="link"&&!r.type.spec.blocknoteIgnore&&console.warn("mark not found in styleschema",r.type.name);continue}s.propSchema==="boolean"?n[s.type]=!0:n[s.type]=r.attrs.stringValue}return n})}addStyles(t){for(const[n,o]of Object.entries(t)){const r=this.schema.styleSchema[n];if(!r)throw new Error(`style ${n} not found in styleSchema`);if(r.propSchema==="boolean")this._tiptapEditor.commands.setMark(n);else if(r.propSchema==="string")this._tiptapEditor.commands.setMark(n,{stringValue:o});else throw new Gt(r.propSchema)}}removeStyles(t){for(const n of Object.keys(t))this._tiptapEditor.commands.unsetMark(n)}toggleStyles(t){for(const[n,o]of Object.entries(t)){const r=this.schema.styleSchema[n];if(!r)throw new Error(`style ${n} not found in styleSchema`);if(r.propSchema==="boolean")this._tiptapEditor.commands.toggleMark(n);else if(r.propSchema==="string")this._tiptapEditor.commands.toggleMark(n,{stringValue:o});else throw new Gt(r.propSchema)}}getSelectedText(){return this.transact(t=>t.doc.textBetween(t.selection.from,t.selection.to))}getSelectedLinkUrl(){return this._tiptapEditor.getAttributes("link").href}createLink(t,n){if(t==="")return;const o=this.pmSchema.mark("link",{href:t});this.transact(r=>{const{from:s,to:i}=r.selection;n?r.insertText(n,s,i).addMark(s,s+n.length,o):r.setSelection(B.create(r.doc,i)).addMark(s,i,o)})}canNestBlock(){return O0(this)}nestBlock(){Pu(this)}canUnnestBlock(){return B0(this)}unnestBlock(){P0(this)}moveBlocksUp(){return _0(this)}moveBlocksDown(){return L0(this)}async blocksToHTMLLossy(t=this.document){return Qr(this.pmSchema,this).exportBlocks(t,{})}async blocksToFullHTML(t){return ay(this.pmSchema,this).serializeBlocks(t,{})}async tryParseHTMLToBlocks(t){return Du(t,this.pmSchema)}async blocksToMarkdownLossy(t=this.document){return G0(t,this.pmSchema,this,{})}async tryParseMarkdownToBlocks(t){return Z0(t,this.pmSchema)}updateCollaborationUserInfo(t){if(!this.options.collaboration)throw new Error("Cannot update collaboration user info when collaboration is disabled.");this.extensions.yCursorPlugin.updateUser(t)}onChange(t){if(this.headless)return;const n=({transaction:o,appendedTransactions:r})=>{t(this,{getChanges:()=>ty(o,r)})};return this._tiptapEditor.on("v3-update",n),()=>{this._tiptapEditor.off("v3-update",n)}}onSelectionChange(t,n){if(this.headless)return;const o=r=>{r.transaction.getMeta(N)&&!n||t(this)};return this._tiptapEditor.on("selectionUpdate",o),()=>{this._tiptapEditor.off("selectionUpdate",o)}}onCreate(t){return this.on("create",t),()=>{this.off("create",t)}}getSelectionBoundingBox(){if(!this.prosemirrorView)return;const{selection:t}=this.prosemirrorState,{ranges:n}=t,o=Math.min(...n.map(s=>s.$from.pos)),r=Math.max(...n.map(s=>s.$to.pos));if(Ps(t)){const s=this.prosemirrorView.nodeDOM(o);if(s)return s.getBoundingClientRect()}return Go(this.prosemirrorView,o,r)}get isEmpty(){const t=this.document;return t.length===0||t.length===1&&t[0].type==="paragraph"&&t[0].content.length===0}openSuggestionMenu(t,n){this.prosemirrorView&&(this.focus(),this.transact(o=>{n!=null&&n.deleteTriggerCharacter&&o.insertText(t),o.scrollIntoView().setMeta(this.suggestionMenus.plugins[0],{triggerCharacter:t,deleteTriggerCharacter:(n==null?void 0:n.deleteTriggerCharacter)||!1,ignoreQueryLength:(n==null?void 0:n.ignoreQueryLength)||!1})}))}getForceSelectionVisible(){return this.showSelectionPlugin.getEnabled()}setForceSelectionVisible(t){this.showSelectionPlugin.setEnabled(t)}convertHtmlToBlockNoteHtml(t){return Bu(t.trim()).innerHTML}pasteHTML(t,n=!1){var o;let r=t;n||(r=this.convertHtmlToBlockNoteHtml(t)),r&&((o=this.prosemirrorView)==null||o.pasteHTML(r))}pasteText(t){var n;return(n=this.prosemirrorView)==null?void 0:n.pasteText(t)}async pasteMarkdown(t){return this.pasteHTML(await Ru(t))}}const FC={gray:{text:"#9b9a97",background:"#ebeced"},brown:{text:"#64473a",background:"#e9e5e3"},red:{text:"#e03e3e",background:"#fbe4e4"},orange:{text:"#d9730d",background:"#f6e9d9"},yellow:{text:"#dfab01",background:"#fbf3db"},green:{text:"#4d6461",background:"#ddedea"},blue:{text:"#0b6e99",background:"#ddebf1"},purple:{text:"#6940a5",background:"#eae4f2"},pink:{text:"#ad1a72",background:"#f4dfeb"}};class zC{constructor(t,n,o){this.mappings=n,this.options=o}async resolveFile(t){var n;if(!((n=this.options)!=null&&n.resolveFileUrl))return(await fetch(t)).blob();const o=await this.options.resolveFileUrl(t);return o instanceof Blob?o:(await fetch(o)).blob()}mapStyles(t){return Object.entries(t).map(([n,o])=>this.mappings.styleMapping[n](o,this))}mapInlineContent(t){return this.mappings.inlineContentMapping[t.type](t,this)}transformInlineContent(t){return t.map(n=>this.mapInlineContent(n))}async mapBlock(t,n,o){return this.mappings.blockMapping[t.type](t,this,n,o)}}let _s;async function TC(){return _s||(_s=(async()=>{const[e,t]=await Promise.all([Tt(()=>import("./module.BvCTiNll.js"),[]),Tt(()=>import("./native.48B9X9Wg.js"),[])]),n="default"in e?e.default:e,o="default"in t?t.default:t;return await n.init({data:o}),{emojiMart:n,emojiData:o}})(),_s)}async function jC(e,t){if(!w0("text",e))return[];const{emojiData:n,emojiMart:o}=await TC();return(t.trim()===""?Object.values(n.emojis):await o.SearchIndex.search(t)).map(r=>({id:r.skins[0].native,onItemClick:()=>e.insertInlineContent(r.skins[0].native+" ")}))}export{gy as $,BC as A,qr as B,u0 as C,RC as D,IC as E,zC as G,DC as H,Ao as I,Ua as K,NC as O,OC as P,ve as Q,HC as R,PC as T,UC as U,ci as V,FC as W,ue as Z,VC as _,qu as a,$k as b,Fk as c,jC as d,es as e,nu as f,Eu as g,Au as h,Vk as i,y0 as j,al as k,xu as l,ou as m,py as n,xe as o,Vv as p,Qt as q,li as r,ai as s,_y as t,Uv as u,Zn as v,My as w,Hy as x,Ry as y,f0 as z};
