import{ay as _e,be as B,i as N,bw as ye,b6 as we,gc as Te,e4 as Ee,gd as Fe,aa as xe,R as L,ge as oe,a6 as se,bu as j,bz as Le,gf as ve,r as b,gg as Ve,o as ie,j as n,gh as Re,gi as re,gj as He,gk as le,gl as de,aC as ce,d as ue,gm as Me,a as d,l as E,H as w,ae as K,aG as Oe,n as I,h as s,gn as Ne,bR as ke,b8 as me,go as De,d1 as Ge,_ as ge,bf as pe,ad as v,c1 as he,p as U,aE as Pe,gp as Ue,aD as $e,gq as ze,du as Be,dB as $,gr as D,gs as je,eJ as Ke,cn as Ye,co as qe,dA as J,gt as Qe,aB as Xe,gu as Je,fp as Ze,dz as We,z as Y,J as en,B as q,gv as nn,dK as z,gw as tn,gx as an,gy as O,gz as on,bT as sn,gA as rn}from"./index.Dg3lKJeg.js";import{S as Q,a as ln}from"./SettingsAdminHealthStatusRightContainer.BTa_LJj5.js";import{S as fe}from"./Table.6yesK_WS.js";import{S as Se}from"./TableBody.DCdzfPFn.js";import{T as G,S as P}from"./TableRow.BM7bNp8J.js";import{S as k}from"./TableHeader.D43eMMOy.js";import{I as be,a as dn,b as cn,c as un,d as mn,e as gn,f as pn,g as hn}from"./IconVariable.Ce6zUoKW.js";import{S as fn}from"./SettingsListCard.8D1EoUNq.js";import{I as Sn}from"./IconDatabase.B0xrit7q.js";import{S as bn}from"./SettingsPageContainer.CJeLyK8s.js";import{S as In}from"./SubMenuTopBarContainer.BNGFwgBo.js";import"./Breadcrumb.CQyf5Hn6.js";const X=_e({key:"userLookupResultState",default:null}),An=()=>{const[e,t]=B(X);return{updateFeatureFlagState:(l,g,r)=>{N(e)&&t({...e,workspaces:e.workspaces.map(m=>m.id===l?{...m,featureFlags:m.featureFlags.map(h=>h.key===g?{...h,value:r}:h)}:m)})}}},Cn=()=>{const{getAuthTokensFromLoginToken:e}=ye(),t=we(Te);return{executeImpersonationAuth:async l=>{t(!0),await e(l),t(!1)}}},_n=()=>{const{redirectToWorkspaceDomain:e}=Ee();return{executeImpersonationRedirect:async(a,l)=>await e(Fe(a),xe.Verify,{loginToken:l})}},yn=I.div`
  display: flex;
  flex-direction: column;
  gap: ${({theme:e})=>e.spacing(3)};
  margin-top: ${({theme:e})=>e.spacing(6)};
`,wn=I.div`
  margin-top: ${({theme:e})=>e.spacing(3)};
`,Tn=({activeWorkspace:e})=>{const t=L(oe),{enqueueErrorSnackBar:a}=se(),[l]=B(j),g=L(Le),[r]=ve(),[m,h]=b.useState(!1),{executeImpersonationAuth:f}=Cn(),{executeImpersonationRedirect:A}=_n(),[p]=Ve(),{updateFeatureFlagState:y}=An(),c=L(X),{i18n:S,_:F}=ie(),V=async o=>{if(!(c!=null&&c.user.id)){a({message:S._({id:"X5x85V"})});return}h(!0),await p({variables:{userId:c.user.id,workspaceId:o},onCompleted:async i=>{const{loginToken:u,workspace:C}=i.impersonate;if(C.id===(g==null?void 0:g.id)){await f(u.token);return}return A(C.workspaceUrls,u.token)},onError:i=>{a({message:`Failed to impersonate user. ${i.message}`})}}).finally(()=>{h(!1)})},R=async(o,i,u)=>{var _,x;const C=(x=(_=c==null?void 0:c.workspaces.find(T=>T.id===o))==null?void 0:_.featureFlags.find(T=>T.key===i))==null?void 0:x.value;y(o,i,u),await r({variables:{workspaceId:o,featureFlag:i,value:u},onError:T=>{N(C)&&y(o,i,C),a({message:`Failed to update feature flag. ${T.message}`})}})},H=[{Icon:Re,label:S._({id:"6YtxFj"}),value:n(Me,{label:(e==null?void 0:e.name)??"",leftComponent:n(He,{avatarUrl:le({imageUrl:ue.isNonEmptyString(e==null?void 0:e.logo)?e==null?void 0:e.logo:de,baseUrl:ce})??""})})},{Icon:be,label:S._({id:"S0kLOH"}),value:e==null?void 0:e.id},{Icon:re,label:S._({id:"wlQNTg"}),value:e==null?void 0:e.totalUsers}];return e?d(yn,{children:[d(E,{children:[n(w,{title:S._({id:"J22jAC"}),description:S._({id:"PtK3Kn"})}),n(Q,{items:H,gridAutoColumns:"1fr 4fr"}),n(wn,{children:(l==null?void 0:l.canImpersonate)&&n(K,{Icon:dn,variant:"primary",accent:"default",title:S._({id:"tSVr6t"}),onClick:()=>V(e.id),disabled:m||e.allowImpersonation===!1,dataTestId:"impersonate-button"})})]}),t&&n(fe,{children:d(Se,{children:[d(G,{gridAutoColumns:"1fr 100px",mobileGridAutoColumns:"1fr 80px",children:[n(k,{children:S._({id:"YXjpZx"})}),n(k,{align:"right",children:S._({id:"uAQUqI"})})]}),e.featureFlags.map(o=>d(G,{gridAutoColumns:"1fr 100px",mobileGridAutoColumns:"1fr 80px",children:[n(P,{children:o.key}),n(P,{align:"right",children:n(Oe,{value:o.value,onChange:i=>R(e.id,o.key,i)})})]},o.key))]})})]}):null},En=I.a`
  align-items: center;
  color: ${({theme:e})=>e.font.color.primary};
  display: flex;
  font-size: ${({theme:e})=>e.font.size.sm};
  font-weight: ${({theme:e})=>e.font.weight.regular};
  gap: ${({theme:e})=>e.spacing(1)};
  text-decoration: none;

  :hover {
    color: ${({theme:e})=>e.font.color.primary};
    cursor: pointer;
  }
`,Z=I.span`
  color: ${({theme:e})=>e.font.color.primary};
  font-size: ${({theme:e})=>e.font.size.sm};
  font-weight: ${({theme:e})=>e.font.weight.regular};
`,W=({version:e,loading:t,noVersionMessage:a})=>t?n(Z,{children:s._({id:"Z3FXyt"})}):e?n(En,{href:`https://hub.docker.com/r/twentycrm/twenty/tags?name=${e}`,target:"_blank",rel:"noreferrer",children:e}):n(Z,{children:a}),Fn=()=>{const{data:e,loading:t}=Ne(),{currentVersion:a,latestVersion:l}=(e==null?void 0:e.versionInfo)??{},g=[{Icon:cn,label:s._({id:"Hd06oy"}),value:n(W,{version:a,loading:t,noVersionMessage:s._({id:"Ef7StM"})})},{Icon:un,label:s._({id:"zUzYWu"}),value:n(W,{version:l,loading:t,noVersionMessage:s._({id:"OcMef3"})})}];return n(Q,{rounded:!0,items:g,gridAutoColumns:"3fr 8fr"})},ee="settings-admin-user-lookup-workspace-tabs-id",xn=I.div`
  align-items: center;
  display: flex;
  flex-direction: row;
  gap: ${({theme:e})=>e.spacing(2)};
`,Ln=()=>{const[e,t]=b.useState(""),{enqueueErrorSnackBar:a}=se(),[l,g]=ke(me,ee),[r,m]=B(X),[h,f]=b.useState(!1),[A]=De(),p=L(j),y=p==null?void 0:p.canAccessFullAdminPanel,c=p==null?void 0:p.canImpersonate,S=L(oe),F=async()=>{var C;g(""),f(!0),m(null);const u=(C=(await A({variables:{userIdentifier:e},onCompleted:_=>{f(!1),N(_==null?void 0:_.userLookupAdminPanel)&&m(_.userLookupAdminPanel)},onError:_=>{f(!1),a({apolloError:_})}})).data)==null?void 0:C.userLookupAdminPanel;N(u==null?void 0:u.workspaces)&&u.workspaces.length>0&&g(u.workspaces[0].id)},V=r==null?void 0:r.workspaces.find(i=>i.id===l),R=(r==null?void 0:r.workspaces.map(i=>({id:i.id,title:i.name,logo:le({imageUrl:ue.isNonEmptyString(i.logo)?i.logo:de,baseUrl:ce})??""})))??[],H=`${(r==null?void 0:r.user.firstName)||""} ${(r==null?void 0:r.user.lastName)||""}`.trim(),o=[{Icon:re,label:s._({id:"6YtxFj"}),value:H},{Icon:Ge,label:s._({id:"O3oNi5"}),value:r==null?void 0:r.user.email},{Icon:be,label:s._({id:"S0kLOH"}),value:r==null?void 0:r.user.id}];return d(v,{children:[y&&d(E,{children:[n(w,{title:s._({id:"uyJsf6"}),description:s._({id:"IHIWR4"})}),n(Fn,{})]}),c&&d(E,{children:[n(w,{title:S?s._({id:"kP/brT"}):s._({id:"RNv3YS"}),description:S?s._({id:"PTozs8"}):s._({id:"GPSwzy"})}),d(xn,{children:[n(ge,{instanceId:"admin-user-lookup",value:e,onChange:t,onInputEnter:F,placeholder:s._({id:"rYIISB"}),fullWidth:!0,disabled:h}),n(K,{Icon:pe,variant:"primary",accent:"blue",title:s._({id:"A1taO8"}),onClick:F,disabled:!e.trim()||h})]})]}),N(r)&&d(v,{children:[d(E,{children:[n(w,{title:s._({id:"tNT8wT"}),description:s._({id:"DhgC7B"})}),n(Q,{items:o,rounded:!0,gridAutoColumns:"1fr 4fr"})]}),d(E,{children:[n(w,{title:s._({id:"pmt7u4"}),description:s._({id:"MLmnB2"})}),n(he,{tabs:R,behaveAsLinks:!1,componentInstanceId:ee}),n(Tn,{activeWorkspace:V})]})]})]})},Ie=()=>{const e=U();return n($e,{baseColor:e.background.tertiary,highlightColor:e.background.transparent.lighter,borderRadius:4,children:n(Pe,{height:Ue.standard.m,width:120})})},vn=I.div`
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
`,Vn=({children:e,activeChips:t})=>d("div",{children:[e,t.length>0&&n(vn,{children:t.map(a=>n(ze,{labelKey:a.label,onRemove:a.onRemove,labelValue:a.source??"",variant:a.variant,type:"filter"},a.label+a.source))})]}),Ae=[{value:"all",label:"All Sources",color:"transparent"},{value:"database",label:"Database",color:"blue"},{value:"environment",label:"Environment",color:"green"},{value:"default",label:"Default",color:"gray"}],Rn=({selectedCategory:e,onSelectCategory:t,sourceFilter:a,groupFilter:l,groupOptions:g,showHiddenGroupVariables:r,onSourceFilterChange:m,onGroupFilterChange:h,onShowHiddenChange:f})=>{const A=U(),p=L(Be),y=Ae.filter(c=>p||c.value!=="database");return e?d(J,{children:[d(Qe,{StartComponent:n(Je,{onClick:()=>t(null),Icon:Xe}),children:[e==="source"&&s._({id:"UKCiEd"}),e==="group"&&s._({id:"llc/hA"})]}),d($,{children:[e==="source"&&n(v,{children:y.map(c=>n(D,{text:c.label,color:c.color,selected:c.value===a,onClick:()=>{m(c.value),t(null)}},c.value))}),e==="group"&&n(v,{children:g.map(c=>n(D,{text:c.label,color:"transparent",selected:c.value===l,onClick:()=>{h(c.value),t(null)}},c.value))})]})]}):d(J,{children:[d($,{children:[n(D,{text:s._({id:"wdxz7K"}),color:"transparent",onClick:()=>t("source")}),n(D,{text:s._({id:"L8fEEm"}),color:"transparent",onClick:()=>t("group")})]}),n(je,{}),n($,{scrollable:!1,children:n(Ke,{text:r?s._({id:"wgmt7A"}):s._({id:"1OVrop"}),LeftIcon:()=>r?n(Ye,{size:A.icon.size.md,stroke:A.icon.stroke.sm}):n(qe,{size:A.icon.size.md,stroke:A.icon.stroke.sm}),onClick:()=>f(!r)})})]})},Hn=({sourceFilter:e,groupFilter:t,groupOptions:a,showHiddenGroupVariables:l,onSourceFilterChange:g,onGroupFilterChange:r,onShowHiddenChange:m})=>{const[h,f]=b.useState(null);return n(We,{clickableComponent:n(K,{variant:"secondary",size:"medium",title:"Options",Icon:Ze}),dropdownId:"env-var-options-dropdown",dropdownOffset:{x:0,y:10},dropdownComponents:n(Rn,{selectedCategory:h,onSelectCategory:p=>{f(p)},sourceFilter:e,groupFilter:t,groupOptions:a,showHiddenGroupVariables:l,onSourceFilterChange:g,onGroupFilterChange:r,onShowHiddenChange:m})})},ne=I(P)`
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
`,Mn=I(G)`
  &:hover {
    background-color: ${({theme:e})=>e.background.transparent.light};
  }
`,te=I.div`
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
`,On=({variable:e})=>{const t=U(),a=e.value===""?"null":e.isSensitive?"••••••":typeof e.value=="boolean"?e.value?"true":"false":e.value;return d(Mn,{gridAutoColumns:"5fr 3fr 1fr",to:Y(q.AdminPanelConfigVariableDetails,{variableName:e.name}),children:[n(ne,{color:t.font.color.primary,children:n(te,{children:e.name})}),n(ne,{align:"right",children:n(te,{children:a})}),n(P,{align:"right",children:n(en,{size:t.icon.size.md,color:t.font.color.tertiary})})]})},Nn=I(Se)`
  border-bottom: 1px solid ${({theme:e})=>e.border.color.light};
`,kn=({variables:e})=>d(fe,{children:[d(G,{gridAutoColumns:"5fr 3fr 1fr",children:[n(k,{children:"Name"}),n(k,{align:"right",children:"Value"}),n(k,{align:"right"})]}),n(Nn,{children:e.map(t=>n(On,{variable:t},t.name))})]}),Dn=I(ge)`
  width: 100%;
`,Gn=({value:e,onChange:t})=>n(Dn,{instanceId:"config-variable-search",placeholder:s._({id:"3UPqHL"}),value:e,onChange:t,autoFocus:!1,LeftIcon:pe}),Pn=I.div`
  display: flex;
  gap: 8px;
  justify-content: space-between;
`,ae=I.div`
  margin-bottom: 24px;
`,Un=()=>{var R,H;const{data:e,loading:t}=nn({fetchPolicy:"network-only"}),[a,l]=b.useState(""),[g,r]=b.useState(!1),[m,h]=b.useState("all"),[f,A]=b.useState("all"),p=b.useMemo(()=>(e==null?void 0:e.getConfigVariablesGrouped.groups)??[],[e]),y=b.useMemo(()=>[{value:"all",label:"All Groups"},...p.map(o=>({value:o.name,label:o.name}))],[p]),c=b.useMemo(()=>(e==null?void 0:e.getConfigVariablesGrouped.groups.flatMap(o=>o.variables.map(i=>({...i,isHiddenOnLoad:o.isHiddenOnLoad,groupName:o.name}))))??[],[e]),S=b.useMemo(()=>{const o=a.trim().length>0,i=f!=="all";return c.filter(u=>{var T;const C=u.name.toLowerCase().includes(a.toLowerCase())||(((T=u.description)==null?void 0:T.toLowerCase())||"").includes(a.toLowerCase());if(o&&!C)return!1;const _=i?u.groupName===f:!0;if(i&&!_||!o&&!g&&u.isHiddenOnLoad&&!i)return!1;let x=!0;return m==="database"&&(x=u.source===z.DATABASE),m==="environment"&&(x=u.source===z.ENVIRONMENT),m==="default"&&(x=u.source===z.DEFAULT),x})},[c,a,g,m,f]),F=[];m!=="all"&&F.push({label:((R=Ae.find(o=>o.value===m))==null?void 0:R.label)||"",onRemove:()=>h("all"),variant:"default"}),f!=="all"&&F.push({label:((H=y.find(o=>o.value===f))==null?void 0:H.label)||"",onRemove:()=>A("all"),variant:"danger"});const V=b.useMemo(()=>{const o=new Map;return S.forEach(i=>{if(!o.has(i.groupName)){const u=p.find(C=>C.name===i.groupName);o.set(i.groupName,{variables:[],description:(u==null?void 0:u.description)||""})}o.get(i.groupName).variables.push(i)}),o},[S,p]);return t?n(Ie,{}):d(v,{children:[d(E,{children:[n(w,{title:s._({id:"Vj43Y/"})}),n(Vn,{activeChips:F,children:d(Pn,{children:[n(Gn,{value:a,onChange:l}),n(Hn,{sourceFilter:m,groupFilter:f,groupOptions:y,showHiddenGroupVariables:g,onSourceFilterChange:h,onGroupFilterChange:A,onShowHiddenChange:r})]})})]}),V.size===0&&n(ae,{children:n(E,{children:n(w,{title:s._({id:"A5XQ/A"}),description:s._({id:"YFLMyY"})})})}),[...V.entries()].map(([o,i])=>d(ae,{children:[n(w,{title:o,description:i.description}),n(kn,{variables:i.variables})]},o))]})},M={GENERAL:"general",CONFIG_VARIABLES:"config-variables",HEALTH_STATUS:"health-status"},Ce="settings-admin-tabs-id",$n={[O.database]:Sn,[O.redis]:gn,[O.worker]:an,[O.connectedAccount]:tn,[O.app]:mn},zn=({services:e,loading:t})=>{const a=U();return n(fn,{items:e,rounded:!0,RowIconFn:l=>$n[l.id],RowIconColor:a.font.color.tertiary,getItemLabel:l=>l.label,isLoading:t,RowRightComponent:({item:l})=>n(ln,{status:l.status}),to:l=>Y(q.AdminPanelIndicatorHealthStatus,{indicatorId:l.id})})},Bn=()=>{const{data:e,loading:t}=on({fetchPolicy:"network-only"}),a=(e==null?void 0:e.getSystemHealthStatus.services)??[];return t?n(Ie,{}):n(v,{children:d(E,{children:[n(w,{title:s._({id:"I1IOmb"}),description:s._({id:"k7iMla"})}),n(zn,{services:a,loading:t})]})})},jn=()=>{switch(sn(me,Ce)){case M.GENERAL:return n(Ln,{});case M.CONFIG_VARIABLES:return n(Un,{});case M.HEALTH_STATUS:return n(Bn,{});default:return null}},Kn=()=>{const e=L(j),t=e==null?void 0:e.canAccessFullAdminPanel,a=e==null?void 0:e.canImpersonate,l=[{id:M.GENERAL,title:s._({id:"Weq9zb"}),Icon:pn,disabled:!t&&!a},{id:M.CONFIG_VARIABLES,title:s._({id:"Vj43Y/"}),Icon:hn,disabled:!t},{id:M.HEALTH_STATUS,title:s._({id:"I1IOmb"}),Icon:rn,disabled:!t}];return d(v,{children:[n(he,{tabs:l,behaveAsLinks:!0,componentInstanceId:Ce}),n(jn,{})]})},st=()=>{const{i18n:e,_:t}=ie();return n(In,{title:e._({id:"g1in8j"}),links:[{children:e._({id:"/IX/7x"}),href:Y(q.AdminPanel)},{children:e._({id:"g1in8j"})}],children:n(bn,{children:n(Kn,{})})})};export{st as SettingsAdmin};
