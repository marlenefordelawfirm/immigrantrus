import{M as er,br as rr,bp as ar,n as ir,dW as dn,cr as lt,dw as gn,a2 as sr,bC as or,a6 as ur,N as fr,a8 as cr,a9 as lr,z as Mt,B as J,a1 as pr,j as C,a as Dt,fc as dr,H as gr,Q as hr,ad as _r,ah as yr,ai as mr}from"./index.Dg3lKJeg.js";import{S as Sr}from"./SettingsPageContainer.CJeLyK8s.js";import{D as vr}from"./useIsSettingsIntegrationEnabled.B5bcKBF5.js";import{S as wr}from"./SaveAndCancelButtons.DdB8J98L.js";import{a as Cr,s as br,S as Ar}from"./SettingsIntegrationDatabaseConnectionForm.DZFnB4fV.js";import{B as Tr}from"./Breadcrumb.CQyf5Hn6.js";import{S as Or}from"./index.DYjQm0RB.js";import{u as Er}from"./useDatabaseConnection.CZtEeBAJ.js";import{S as Ir}from"./SubMenuTopBarContainer.BNGFwgBo.js";import"./IconDeviceFloppy.CaehffdS.js";import"./useGetDatabaseConnectionTables.CekobOmF.js";import"./useSettingsIntegrationCategories.BCNgJ2AL.js";const Dr=er`
  ${vr}
  mutation updateServer($input: UpdateRemoteServerInput!) {
    updateOneRemoteServer(input: $input) {
      ...RemoteServerFields
    }
  }
`,xr=()=>{const u=rr(),[o]=ar(Dr,{client:u});return{updateOneDatabaseConnection:async S=>await o({variables:{input:S}})}},Pr=ir.div`
  align-items: center;
  display: flex;
  justify-content: space-between;
`;var xt,cn;function Mr(){if(cn)return xt;cn=1;function u(o){return o}return xt=u,xt}var Nr=Mr();const ln=dn(Nr);var X={exports:{}};X.exports;var pn;function Fr(){return pn||(pn=1,function(u,o){var p=200,S="Expected a function",W="__lodash_hash_undefined__",N=1,I=2,F=9007199254740991,$="[object Arguments]",B="[object Array]",G="[object Boolean]",Z="[object Date]",z="[object Error]",j="[object Function]",pt="[object GeneratorFunction]",v="[object Map]",V="[object Number]",b="[object Object]",Nt="[object Promise]",Ft="[object RegExp]",k="[object Set]",Lt="[object String]",Rt="[object Symbol]",dt="[object WeakMap]",Ut="[object ArrayBuffer]",tt="[object DataView]",hn="[object Float32Array]",_n="[object Float64Array]",yn="[object Int8Array]",mn="[object Int16Array]",Sn="[object Int32Array]",vn="[object Uint8Array]",wn="[object Uint8ClampedArray]",Cn="[object Uint16Array]",bn="[object Uint32Array]",An=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Tn=/^\w*$/,On=/^\./,En=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,In=/[\\^$.*+?()[\]{}|]/g,Dn=/\\(\\)?/g,xn=/^\[object .+?Constructor\]$/,Pn=/^(?:0|[1-9]\d*)$/,f={};f[hn]=f[_n]=f[yn]=f[mn]=f[Sn]=f[vn]=f[wn]=f[Cn]=f[bn]=!0,f[$]=f[B]=f[Ut]=f[G]=f[tt]=f[Z]=f[z]=f[j]=f[v]=f[V]=f[b]=f[Ft]=f[k]=f[Lt]=f[dt]=!1;var $t=typeof lt=="object"&&lt&&lt.Object===Object&&lt,Mn=typeof self=="object"&&self&&self.Object===Object&&self,D=$t||Mn||Function("return this")(),Bt=o&&!o.nodeType&&o,Gt=Bt&&!0&&u&&!u.nodeType&&u,Nn=Gt&&Gt.exports===Bt,Ht=Nn&&$t.process,qt=function(){try{return Ht&&Ht.binding("util")}catch{}}(),Wt=qt&&qt.isTypedArray;function Kt(t,n){for(var e=-1,r=n.length,i=t.length;++e<r;)t[i+e]=n[e];return t}function Fn(t,n){for(var e=-1,r=t?t.length:0;++e<r;)if(n(t[e],e,t))return!0;return!1}function Ln(t){return function(n){return n==null?void 0:n[t]}}function Rn(t,n){for(var e=-1,r=Array(t);++e<t;)r[e]=n(e);return r}function Un(t){return function(n){return t(n)}}function $n(t,n){return t==null?void 0:t[n]}function gt(t){var n=!1;if(t!=null&&typeof t.toString!="function")try{n=!!(t+"")}catch{}return n}function Bn(t){var n=-1,e=Array(t.size);return t.forEach(function(r,i){e[++n]=[i,r]}),e}function ht(t,n){return function(e){return t(n(e))}}function Gn(t){var n=-1,e=Array(t.size);return t.forEach(function(r){e[++n]=r}),e}var Hn=Array.prototype,qn=Function.prototype,nt=Object.prototype,_t=D["__core-js_shared__"],Yt=function(){var t=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Qt=qn.toString,w=nt.hasOwnProperty,H=nt.toString,Wn=RegExp("^"+Qt.call(w).replace(In,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xt=D.Symbol,Jt=D.Uint8Array,Kn=ht(Object.getPrototypeOf,Object),Yn=nt.propertyIsEnumerable,Qn=Hn.splice,yt=Object.getOwnPropertySymbols,Xn=ht(Object.keys,Object),mt=q(D,"DataView"),K=q(D,"Map"),St=q(D,"Promise"),vt=q(D,"Set"),wt=q(D,"WeakMap"),Y=q(Object,"create"),Jn=R(mt),Zn=R(K),zn=R(St),jn=R(vt),Vn=R(wt),et=Xt?Xt.prototype:void 0,Ct=et?et.valueOf:void 0,Zt=et?et.toString:void 0;function L(t){var n=-1,e=t?t.length:0;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function kn(){this.__data__=Y?Y(null):{}}function te(t){return this.has(t)&&delete this.__data__[t]}function ne(t){var n=this.__data__;if(Y){var e=n[t];return e===W?void 0:e}return w.call(n,t)?n[t]:void 0}function ee(t){var n=this.__data__;return Y?n[t]!==void 0:w.call(n,t)}function re(t,n){var e=this.__data__;return e[t]=Y&&n===void 0?W:n,this}L.prototype.clear=kn,L.prototype.delete=te,L.prototype.get=ne,L.prototype.has=ee,L.prototype.set=re;function A(t){var n=-1,e=t?t.length:0;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function ae(){this.__data__=[]}function ie(t){var n=this.__data__,e=at(n,t);if(e<0)return!1;var r=n.length-1;return e==r?n.pop():Qn.call(n,e,1),!0}function se(t){var n=this.__data__,e=at(n,t);return e<0?void 0:n[e][1]}function oe(t){return at(this.__data__,t)>-1}function ue(t,n){var e=this.__data__,r=at(e,t);return r<0?e.push([t,n]):e[r][1]=n,this}A.prototype.clear=ae,A.prototype.delete=ie,A.prototype.get=se,A.prototype.has=oe,A.prototype.set=ue;function T(t){var n=-1,e=t?t.length:0;for(this.clear();++n<e;){var r=t[n];this.set(r[0],r[1])}}function fe(){this.__data__={hash:new L,map:new(K||A),string:new L}}function ce(t){return it(this,t).delete(t)}function le(t){return it(this,t).get(t)}function pe(t){return it(this,t).has(t)}function de(t,n){return it(this,t).set(t,n),this}T.prototype.clear=fe,T.prototype.delete=ce,T.prototype.get=le,T.prototype.has=pe,T.prototype.set=de;function rt(t){var n=-1,e=t?t.length:0;for(this.__data__=new T;++n<e;)this.add(t[n])}function ge(t){return this.__data__.set(t,W),this}function he(t){return this.__data__.has(t)}rt.prototype.add=rt.prototype.push=ge,rt.prototype.has=he;function O(t){this.__data__=new A(t)}function _e(){this.__data__=new A}function ye(t){return this.__data__.delete(t)}function me(t){return this.__data__.get(t)}function Se(t){return this.__data__.has(t)}function ve(t,n){var e=this.__data__;if(e instanceof A){var r=e.__data__;if(!K||r.length<p-1)return r.push([t,n]),this;e=this.__data__=new T(r)}return e.set(t,n),this}O.prototype.clear=_e,O.prototype.delete=ye,O.prototype.get=me,O.prototype.has=Se,O.prototype.set=ve;function zt(t,n){var e=P(t)||sn(t)?Rn(t.length,String):[],r=e.length,i=!!r;for(var a in t)(n||w.call(t,a))&&!(i&&(a=="length"||tn(a,r)))&&e.push(a);return e}function at(t,n){for(var e=t.length;e--;)if(an(t[e][0],n))return e;return-1}function jt(t,n){n=st(n,t)?[n]:Vt(n);for(var e=0,r=n.length;t!=null&&e<r;)t=t[ot(n[e++])];return e&&e==r?t:void 0}function we(t,n,e){var r=n(t);return P(t)?r:Kt(r,e(t))}function Ce(t){return H.call(t)}function be(t,n){return t!=null&&n in Object(t)}function bt(t,n,e,r,i){return t===n?!0:t==null||n==null||!Q(t)&&!ut(n)?t!==t&&n!==n:Ae(t,n,bt,e,r,i)}function Ae(t,n,e,r,i,a){var s=P(t),c=P(n),l=B,d=B;s||(l=x(t),l=l==$?b:l),c||(d=x(n),d=d==$?b:d);var h=l==b&&!gt(t),_=d==b&&!gt(n),g=l==d;if(g&&!h)return a||(a=new O),s||Je(t)?kt(t,n,e,r,i,a):Re(t,n,l,e,r,i,a);if(!(i&I)){var y=h&&w.call(t,"__wrapped__"),m=_&&w.call(n,"__wrapped__");if(y||m){var M=y?t.value():t,E=m?n.value():n;return a||(a=new O),e(M,E,r,i,a)}}return g?(a||(a=new O),Ue(t,n,e,r,i,a)):!1}function Te(t,n,e,r){var i=e.length,a=i;if(t==null)return!a;for(t=Object(t);i--;){var s=e[i];if(s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++i<a;){s=e[i];var c=s[0],l=t[c],d=s[1];if(s[2]){if(l===void 0&&!(c in t))return!1}else{var h=new O,_;if(!(_===void 0?bt(d,l,r,N|I,h):_))return!1}}return!0}function Oe(t){if(!Q(t)||Ke(t))return!1;var n=on(t)||gt(t)?Wn:xn;return n.test(R(t))}function Ee(t){return ut(t)&&Ot(t.length)&&!!f[H.call(t)]}function Ie(t){return typeof t=="function"?t:t==null?tr:typeof t=="object"?P(t)?Me(t[0],t[1]):Pe(t):nr(t)}function De(t){if(!nn(t))return Xn(t);var n=[];for(var e in Object(t))w.call(t,e)&&e!="constructor"&&n.push(e);return n}function xe(t){if(!Q(t))return Ye(t);var n=nn(t),e=[];for(var r in t)r=="constructor"&&(n||!w.call(t,r))||e.push(r);return e}function Pe(t){var n=Be(t);return n.length==1&&n[0][2]?rn(n[0][0],n[0][1]):function(e){return e===t||Te(e,t,n)}}function Me(t,n){return st(t)&&en(n)?rn(ot(t),n):function(e){var r=ze(e,t);return r===void 0&&r===n?je(e,t):bt(n,r,void 0,N|I)}}function Ne(t,n,e){for(var r=-1,i=n.length,a={};++r<i;){var s=n[r],c=t[s];e(c,s)&&(a[s]=c)}return a}function Fe(t){return function(n){return jt(n,t)}}function Le(t){if(typeof t=="string")return t;if(Et(t))return Zt?Zt.call(t):"";var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function Vt(t){return P(t)?t:Qe(t)}function kt(t,n,e,r,i,a){var s=i&I,c=t.length,l=n.length;if(c!=l&&!(s&&l>c))return!1;var d=a.get(t);if(d&&a.get(n))return d==n;var h=-1,_=!0,g=i&N?new rt:void 0;for(a.set(t,n),a.set(n,t);++h<c;){var y=t[h],m=n[h];if(r)var M=s?r(m,y,h,n,t,a):r(y,m,h,t,n,a);if(M!==void 0){if(M)continue;_=!1;break}if(g){if(!Fn(n,function(E,U){if(!g.has(U)&&(y===E||e(y,E,r,i,a)))return g.add(U)})){_=!1;break}}else if(!(y===m||e(y,m,r,i,a))){_=!1;break}}return a.delete(t),a.delete(n),_}function Re(t,n,e,r,i,a,s){switch(e){case tt:if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case Ut:return!(t.byteLength!=n.byteLength||!r(new Jt(t),new Jt(n)));case G:case Z:case V:return an(+t,+n);case z:return t.name==n.name&&t.message==n.message;case Ft:case Lt:return t==n+"";case v:var c=Bn;case k:var l=a&I;if(c||(c=Gn),t.size!=n.size&&!l)return!1;var d=s.get(t);if(d)return d==n;a|=N,s.set(t,n);var h=kt(c(t),c(n),r,i,a,s);return s.delete(t),h;case Rt:if(Ct)return Ct.call(t)==Ct.call(n)}return!1}function Ue(t,n,e,r,i,a){var s=i&I,c=It(t),l=c.length,d=It(n),h=d.length;if(l!=h&&!s)return!1;for(var _=l;_--;){var g=c[_];if(!(s?g in n:w.call(n,g)))return!1}var y=a.get(t);if(y&&a.get(n))return y==n;var m=!0;a.set(t,n),a.set(n,t);for(var M=s;++_<l;){g=c[_];var E=t[g],U=n[g];if(r)var fn=s?r(U,E,g,n,t,a):r(E,U,g,t,n,a);if(!(fn===void 0?E===U||e(E,U,r,i,a):fn)){m=!1;break}M||(M=g=="constructor")}if(m&&!M){var ft=t.constructor,ct=n.constructor;ft!=ct&&"constructor"in t&&"constructor"in n&&!(typeof ft=="function"&&ft instanceof ft&&typeof ct=="function"&&ct instanceof ct)&&(m=!1)}return a.delete(t),a.delete(n),m}function $e(t){return we(t,Ve,He)}function it(t,n){var e=t.__data__;return We(n)?e[typeof n=="string"?"string":"hash"]:e.map}function Be(t){for(var n=It(t),e=n.length;e--;){var r=n[e],i=t[r];n[e]=[r,i,en(i)]}return n}function q(t,n){var e=$n(t,n);return Oe(e)?e:void 0}var Ge=yt?ht(yt,Object):un,He=yt?function(t){for(var n=[];t;)Kt(n,Ge(t)),t=Kn(t);return n}:un,x=Ce;(mt&&x(new mt(new ArrayBuffer(1)))!=tt||K&&x(new K)!=v||St&&x(St.resolve())!=Nt||vt&&x(new vt)!=k||wt&&x(new wt)!=dt)&&(x=function(t){var n=H.call(t),e=n==b?t.constructor:void 0,r=e?R(e):void 0;if(r)switch(r){case Jn:return tt;case Zn:return v;case zn:return Nt;case jn:return k;case Vn:return dt}return n});function qe(t,n,e){n=st(n,t)?[n]:Vt(n);for(var r,i=-1,s=n.length;++i<s;){var a=ot(n[i]);if(!(r=t!=null&&e(t,a)))break;t=t[a]}if(r)return r;var s=t?t.length:0;return!!s&&Ot(s)&&tn(a,s)&&(P(t)||sn(t))}function tn(t,n){return n=n??F,!!n&&(typeof t=="number"||Pn.test(t))&&t>-1&&t%1==0&&t<n}function st(t,n){if(P(t))return!1;var e=typeof t;return e=="number"||e=="symbol"||e=="boolean"||t==null||Et(t)?!0:Tn.test(t)||!An.test(t)||n!=null&&t in Object(n)}function We(t){var n=typeof t;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null}function Ke(t){return!!Yt&&Yt in t}function nn(t){var n=t&&t.constructor,e=typeof n=="function"&&n.prototype||nt;return t===e}function en(t){return t===t&&!Q(t)}function rn(t,n){return function(e){return e==null?!1:e[t]===n&&(n!==void 0||t in Object(e))}}function Ye(t){var n=[];if(t!=null)for(var e in Object(t))n.push(e);return n}var Qe=At(function(t){t=Ze(t);var n=[];return On.test(t)&&n.push(""),t.replace(En,function(e,r,i,a){n.push(i?a.replace(Dn,"$1"):r||e)}),n});function ot(t){if(typeof t=="string"||Et(t))return t;var n=t+"";return n=="0"&&1/t==-1/0?"-0":n}function R(t){if(t!=null){try{return Qt.call(t)}catch{}try{return t+""}catch{}}return""}function At(t,n){if(typeof t!="function"||n&&typeof n!="function")throw new TypeError(S);var e=function(){var r=arguments,i=n?n.apply(this,r):r[0],a=e.cache;if(a.has(i))return a.get(i);var s=t.apply(this,r);return e.cache=a.set(i,s),s};return e.cache=new(At.Cache||T),e}At.Cache=T;function an(t,n){return t===n||t!==t&&n!==n}function sn(t){return Xe(t)&&w.call(t,"callee")&&(!Yn.call(t,"callee")||H.call(t)==$)}var P=Array.isArray;function Tt(t){return t!=null&&Ot(t.length)&&!on(t)}function Xe(t){return ut(t)&&Tt(t)}function on(t){var n=Q(t)?H.call(t):"";return n==j||n==pt}function Ot(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=F}function Q(t){var n=typeof t;return!!t&&(n=="object"||n=="function")}function ut(t){return!!t&&typeof t=="object"}function Et(t){return typeof t=="symbol"||ut(t)&&H.call(t)==Rt}var Je=Wt?Un(Wt):Ee;function Ze(t){return t==null?"":Le(t)}function ze(t,n,e){var r=t==null?void 0:jt(t,n);return r===void 0?e:r}function je(t,n){return t!=null&&qe(t,n,be)}function It(t){return Tt(t)?zt(t):De(t)}function Ve(t){return Tt(t)?zt(t,!0):xe(t)}function ke(t,n){return t==null?{}:Ne(t,$e(t),Ie(n))}function tr(t){return t}function nr(t){return st(t)?Ln(ot(t)):Fe(t)}function un(){return[]}u.exports=ke}(X,X.exports)),X.exports}var Lr=Fr();const Pt=dn(Lr),Rr=u=>{switch(u){case"postgresql":return br.extend({password:sr.string().optional()});case"stripe":return Cr;default:throw new gn(`No schema found for database key: ${u}`,"NO_SCHEMA_FOUND")}},Ur=({databaseKey:u,connection:o})=>{var p;switch(u){case"postgresql":return{dbname:o.foreignDataWrapperOptions.dbname,host:o.foreignDataWrapperOptions.host,port:o.foreignDataWrapperOptions.port,user:((p=o.userMappingOptions)==null?void 0:p.user)||void 0,schema:o.schema||void 0,label:o.label,password:""};case"stripe":return{api_key:o.foreignDataWrapperOptions.api_key,label:o.label};default:throw new Error(`No default form values for database key: ${u}`)}},$r=({databaseKey:u,formValues:o})=>{switch(u){case"postgresql":{const p={userMappingOptions:Pt({user:o.user,password:o.password},ln),foreignDataWrapperOptions:Pt({dbname:o.dbname,host:o.host,port:o.port},ln),schema:o.schema,label:o.label};return Pt(p,S=>!or(S))}case"stripe":return{foreignDataWrapperOptions:{api_key:o.api_key},label:o.label};default:throw new gn(`Cannot format values for database key: ${u}`,"CANNOT_FORMAT_VALUES")}},Br=({connection:u,integration:o,databaseKey:p,tables:S})=>{const{enqueueErrorSnackBar:W}=ur(),N=fr(),I=Rr(p),F=cr({mode:"onTouched",resolver:lr(I),defaultValues:Ur({databaseKey:p,connection:u})}),{updateOneDatabaseConnection:$}=xr(),B=Mt(J.Integrations),G=S==null?void 0:S.some(v=>(v==null?void 0:v.status)===pr.SYNCED),{isDirty:Z,isValid:z}=F.formState,j=Z&&z&&!G,pt=async()=>{const v=F.getValues(),V=Object.keys(F.formState.dirtyFields);try{await $({...$r({databaseKey:p,formValues:yr(v,V)}),id:(u==null?void 0:u.id)??""}),N(J.IntegrationDatabaseConnection,{databaseKey:p,connectionId:u==null?void 0:u.id})}catch(b){W({apolloError:b instanceof mr?b:void 0})}};return C(_r,{children:Dt(hr,{...F,children:[Dt(Pr,{children:[C(Tr,{links:[{children:"Integrations",href:B},{children:o.text,href:`${B}/${p}`},{children:u.label}]}),C(wr,{isSaveDisabled:!j,onCancel:()=>N(J.IntegrationDatabase,{databaseKey:p}),onSave:pt})]}),G&&C(dr,{text:`You cannot edit this connection because it has tracked tables.
If you need to make changes, please create a new connection or unsync the tables first.`,accent:"blue"}),Dt(Or,{children:[C(gr,{title:"Edit Connection",description:"Edit the information to connect your database"}),C(Ar,{databaseKey:p,disabled:G})]})]})})},Gr=()=>{const{connection:u,integration:o,databaseKey:p,tables:S}=Er({});return!u||!o?null:C(Br,{connection:u,integration:o,databaseKey:p,tables:S})},kr=()=>C(Ir,{title:"Edit connection",links:[{children:"Workspace",href:Mt(J.Workspace)},{children:"Integrations",href:Mt(J.Integrations)},{children:"Edit connection"}],children:C(Sr,{children:C(Gr,{})})});export{kr as SettingsIntegrationEditDatabaseConnection};
